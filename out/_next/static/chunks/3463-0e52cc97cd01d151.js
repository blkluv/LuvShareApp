(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3463],{36595:function(e,s,t){"use strict";t.d(s,{Z:function(){return j}});var a=t(85893),r=t(41664),n=t.n(r),l=t(92882),o=t(67294),i=t(73359),d=t(50319),u=t(76781),c=t(34625),g=t(31618),v=t(86501);let w=()=>{let e=(0,l.qr)(e=>e.setProfiles),s=(0,l.qr)(e=>e.setCurrentProfile),t=(0,l.Fc)(e=>e.setProfileId),[r,n]=(0,o.useState)(!1),{chain:w}=(0,g.LN)(),{switchNetwork:h}=(0,g.g0)(),[m,f]=(0,o.useState)(!1),{address:M,connector:p}=(0,g.mA)(),{connectors:x,error:b,connectAsync:N}=(0,g.$4)(),{signMessageAsync:y,isLoading:j}=(0,g.QW)(),[S,{error:k,loading:C}]=(0,i.t)(u.bT,{fetchPolicy:"no-cache"}),[A,{error:P,loading:B}]=(0,d.D)(u.bs),[T,{error:I,loading:q}]=(0,i.t)(u.$);(0,o.useEffect)(()=>{n(!0)},[]);let L=async()=>{try{var a,r,n,l,o,i,d,u,c;let g=await S({variables:{request:{address:M}}});if(!(null==g?void 0:null===(a=g.data)||void 0===a?void 0:null===(r=a.challenge)||void 0===r?void 0:r.text))return v.ZP.error("ERROR_MESSAGE");let w=await y({message:null==g?void 0:null===(n=g.data)||void 0===n?void 0:null===(l=n.challenge)||void 0===l?void 0:l.text}),h=await A({variables:{request:{address:M,signature:w}}});localStorage.setItem("accessToken",null===(o=h.data)||void 0===o?void 0:o.authenticate.accessToken),localStorage.setItem("refreshToken",null===(i=h.data)||void 0===i?void 0:i.authenticate.refreshToken);let{data:m}=await T({variables:{request:{ownedBy:[M]}}});if((null==m?void 0:null===(d=m.profiles)||void 0===d?void 0:null===(u=d.items)||void 0===u?void 0:u.length)===0)return v.ZP.error("You have no lens profile yet, please create one");{let f=null==m?void 0:null===(c=m.profiles)||void 0===c?void 0:c.items,p=f[0];e(f),s(p),t(p.id)}}catch(x){}};return(null==p?void 0:p.id)?(0,a.jsx)("div",{children:(null==w?void 0:w.id)===c.Kj?(0,a.jsx)("button",{className:"flex-1 text-blue-700",onClick:()=>L(),children:r?"Log In":""}):(0,a.jsx)("button",{className:"flex-1 text-blue-700",onClick:()=>{h?h(c.Kj):v.ZP.error("Please change your network!")},children:"Switch Network"})}):(0,a.jsx)("button",{onClick:()=>{v.ZP.error("Log in to view profile",{duration:1e3})},className:"border-gray-800 text-blue-700 hover:text-gray-600 focus:text-black focus:outline-none",children:(0,a.jsx)("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})})};var h=t(93832),m=t(28166),f=t(5434),M=t(14382),p=t(61998),x=t(1257),b=t(10116);let N=()=>{let e=(0,l.qr)(e=>e.currentProfile),s=(0,b.N)(e=>e.clearMessagesBadge),t=(0,b.N)(e=>e.viewedMessagesAtNs),r=(0,b.N)(e=>e.showMessagesBadge),i=(0,b.N)(e=>e.setShowMessagesBadge),{client:d}=(0,M.Z)(!0),u=(e,s)=>{if(!s)return!1;let t=(0,x.nB)(e);return!t||t.getTime()<s.getTime()&&s.getTime()<new Date().getTime()};return(0,o.useEffect)(()=>{let s;if(!d||!e)return;let a=async()=>{let s=await d.conversations.list();if(s.length<=0)return;let a=s.map(e=>e.topic),n=await d.apiClient.batchQuery(a.map(e=>({contentTopic:e,pageSize:1,direction:x.Sr.SORT_DIRECTION_DESCENDING}))),l=n.reduce((e,s)=>{var t,a;return s.length&&(null===(t=s[0])||void 0===t?void 0:t.timestampNs)&&(!e||(null===(a=s[0])||void 0===a?void 0:a.timestampNs)>e)?s[0].timestampNs:e},null),o=(0,x.nB)(null!=l?l:void 0),c=u(t.get(e.id),o);r.set(e.id,c),i(new Map(r))},n=async()=>{s&&await s.return(void 0)},l=s=>!window.location.pathname.startsWith("/messages")&&e.id===s,o=async a=>{for await(let n of s=await d.conversations.streamAllMessages())if(a(e.id)){let l=e.ownedBy!==n.senderAddress;if(l){let o=u(t.get(e.id),n.sent);r.set(e.id,o),i(new Map(r))}}};return a(),o(l),()=>{n()}},[d,null==e?void 0:e.id]),(0,a.jsxs)(n(),{href:"/messages",className:" min-w-[40px] items-start justify-center rounded-md md:flex",onClick:()=>{e&&s(e.id)},children:[(0,a.jsx)(p.Z,{className:"h-6 w-6 pb-1 text-blue-500 "}),r.get(null==e?void 0:e.id)?(0,a.jsx)("span",{className:"z-[6] h-2 w-2 rounded-full bg-red-500 text-red-500"}):null]})},y=()=>{let e=(0,l.qr)(e=>e.currentProfile),[s,t]=(0,o.useState)(!0);return(0,a.jsx)("div",{children:(0,a.jsxs)("nav",{className:"z-999 fixed bottom-0 left-0 right-0 z-[5] m-auto flex h-[70px] items-center justify-around overflow-hidden rounded-lg border-2 border-b-0 border-l border-r border-t border-blue-700 bg-white bg-gradient-to-b from-blue-100 to-transparent px-4 py-3 lg:w-[1100px] xl:w-[1200px]",children:[s?(0,a.jsx)(n(),{href:"/",children:(0,a.jsx)("button",{onClick:()=>{t(!1)},className:"border-gray-800 text-blue-500 hover:text-gray-100 focus:text-gray-100 focus:outline-none",children:(0,a.jsx)("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})})})}):(0,a.jsx)(n(),{href:"/",children:(0,a.jsx)("button",{onClick:()=>{t(!0)},className:"border-gray-800 text-blue-500 hover:text-gray-100 focus:text-gray-100 focus:outline-none",children:(0,a.jsx)("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})})})}),(0,a.jsx)("div",{children:(0,a.jsxs)(n(),{href:"/feed",children:[(0,a.jsx)(f.dnC,{className:"h-6 w-6 pb-1 text-blue-500"})," "]})}),(0,a.jsx)("div",{children:(0,a.jsxs)(n(),{href:"/latest",children:[(0,a.jsx)(h.Z,{className:"h-6 w-6 pb-1 text-blue-500"})," "]})}),(0,a.jsx)("div",{children:(0,a.jsxs)(n(),{href:"/listen",children:[(0,a.jsx)(m.Z,{className:"h-6 w-6 pb-1 text-blue-500"})," "]})}),(0,a.jsx)("div",{children:(0,a.jsx)(N,{})}),e?(0,a.jsx)(n(),{href:"/u/".concat(e.id),children:(0,a.jsx)("button",{className:"border-gray-800 text-blue-500 hover:text-gray-100 focus:text-gray-100 focus:outline-none",children:(0,a.jsx)("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})})},e.id):(0,a.jsx)(w,{})]})})};var j=y},10116:function(e,s,t){"use strict";t.d(s,{N:function(){return u},G:function(){return d}});let a=e=>{let s=[...Array.from(new Map(e.map(e=>[e.id,e])).values())];return s.sort((e,s)=>{var t,a,r,n;return(null!==(r=null===(t=s.sent)||void 0===t?void 0:t.getTime())&&void 0!==r?r:0)-(null!==(n=null===(a=e.sent)||void 0===a?void 0:a.getTime())&&void 0!==n?n:0)}),null!=s?s:[]};var r=t(1257),n=t(73445),l=t(782),o=t(45341),i=t(34625);let d=(0,n.Ue)(e=>({client:void 0,setClient:s=>e(()=>({client:s})),conversations:new Map,setConversations:s=>e(()=>({conversations:s})),addConversation:(s,t)=>{e(e=>{let a=new Map(e.conversations);return a.set(s,t),{conversations:a}})},chatProvider:i.N5.PUSH,setChatProvider:s=>e(()=>({chatProvider:s})),queuedMessages:new Map,addQueuedMessage:(s,t)=>{e(e=>{let a=new Map(e.queuedMessages),r=e.queuedMessages.get(s)||[],n=[...r,t];return n.sort((e,s)=>s.sent.getTime()-e.sent.getTime()),a.set(s,n),{queuedMessages:a}})},removeQueuedMessage:(s,t)=>{e(e=>{let a=new Map(e.queuedMessages),r=e.queuedMessages.get(s)||[],n=r.filter(e=>e.id!==t);return a.set(s,n),{queuedMessages:a}})},updateQueuedMessage:(s,t,a)=>{e(e=>{let r=new Map(e.queuedMessages),n=e.queuedMessages.get(s)||[],l=n.filter(e=>e.id!==t);return n.length!==l.length?(l.push(a),l.sort((e,s)=>s.sent.getTime()-e.sent.getTime()),r.set(s,l),{queuedMessages:r}):{queuedMessages:e.queuedMessages}})},messages:new Map,addMessages:(s,t)=>{let r=0;return e(e=>{let n=new Map(e.messages),l=e.messages.get(s)||[],o=a([...l,...t]);return(r=o.length-l.length)?(n.set(s,o),{messages:n}):{messages:e.messages}}),r},hasSyncedMessages:!1,setHasSyncedMessages:s=>e(()=>({hasSyncedMessages:s})),previewMessages:new Map,setPreviewMessages:s=>e(()=>({previewMessages:s})),ensNames:new Map,setEnsNames:s=>e(()=>({ensNames:s})),previewMessagesNonLens:new Map,setPreviewMessagesNonLens:s=>e(()=>({previewMessagesNonLens:s})),selectedProfileId:"",setSelectedProfileId:s=>e(()=>({selectedProfileId:s})),selectedTab:"All",setSelectedTab:s=>e(()=>({selectedTab:s})),syncedProfiles:new Set,addSyncedProfiles:s=>e(e=>{let{syncedProfiles:t}=e;return{syncedProfiles:new Set([...t,...s])}}),unsyncProfile:s=>e(e=>{let{syncedProfiles:t}=e;return{syncedProfiles:new Set([...t].filter(e=>e!==s))}}),reset:()=>e(e=>({...e,conversations:new Map,messages:new Map,messageProfiles:new Map,previewMessages:new Map,selectedTab:"All",previewMessagesNonLens:new Map,ensNames:new Map}))})),u=(0,n.Ue)((0,l.tJ)(e=>({viewedMessagesAtNs:new Map,showMessagesBadge:new Map,setShowMessagesBadge:s=>e(()=>({showMessagesBadge:s})),clearMessagesBadge:s=>{e(e=>{let t=new Map(e.viewedMessagesAtNs);if(t.set(s,(0,r.$)(new Date)),!e.showMessagesBadge.get(s))return{viewedMessagesAtNs:t};let a=new Map(e.showMessagesBadge);return a.set(s,!1),{viewedMessagesAtNs:t,showMessagesBadge:a}})},unsentMessages:new Map,setUnsentMessage:(s,t)=>e(e=>{let a=new Map(e.unsentMessages);return t?a.set(s,t):a.delete(s),{unsentMessages:a}}),setUnsentMessages:s=>e(()=>({unsentMessages:s}))}),{name:o.d.MessageStore,storage:{setItem(e,s){let t=JSON.stringify({...s,state:{...s.state,viewedMessagesAtNs:Array.from(s.state.viewedMessagesAtNs),showMessagesBadge:Array.from(s.state.showMessagesBadge),unsentMessages:Array.from(s.state.unsentMessages)}});localStorage.setItem(e,t)},getItem:e=>{let s=localStorage.getItem(e);if(!s)return null;let t=JSON.parse(s);return t.state.viewedMessagesAtNs=new Map(t.state.viewedMessagesAtNs),t.state.showMessagesBadge=new Map(t.state.showMessagesBadge),t.state.unsentMessages=new Map(t.state.unsentMessages),t},removeItem(e){localStorage.removeItem(e)}}}))},14382:function(e,s,t){"use strict";t.d(s,{T:function(){return f}});var a=t(45341),r=t(34625),n=t(1257),l=t(67294),o=t(92882),i=t(10116),d=t(88559),u=t(52942),c=t(48764).Buffer;let g="binary",v=e=>"xmtp:".concat(r.Jy,":keys:").concat(e),w=e=>{let s=localStorage.getItem(v(e));return s?c.from(s,g):null},h=(e,s)=>{localStorage.setItem(v(e),c.from(s).toString(g))},m=e=>{localStorage.removeItem(v(e))},f=()=>{let{data:e}=(0,u.Z)(),s=(0,i.G)(e=>e.client),t=(0,i.G)(e=>e.setClient),r=(0,l.useCallback)(async()=>{e&&m(await e.getAddress()),s&&t(void 0),localStorage.removeItem(a.d.MessageStore),localStorage.removeItem(a.d.AttachmentCache),localStorage.removeItem(a.d.AttachmentStore)},[e,s]);return r};s.Z=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=(0,o.qr)(e=>e.currentProfile),t=(0,i.G)(e=>e.client),a=(0,i.G)(e=>e.setClient),[c,g]=(0,l.useState)(),{data:v,isLoading:m}=(0,u.Z)();return(0,l.useEffect)(()=>{let l=async()=>{if(v&&!t&&s){let l=w(await v.getAddress());if(!l){if(e)return;g(!0),l=await n.KU.getKeys(v,{env:r.Jy,appVersion:r.iC+"/"+r.Ji,persistConversations:!1,skipContactPublishing:!0}),h(await v.getAddress(),l)}let o=await n.KU.create(null,{env:r.Jy,appVersion:r.iC+"/"+r.Ji,privateKeyOverride:l,persistConversations:!0});o.registerCodec(new d.AttachmentCodec),o.registerCodec(new d.RemoteAttachmentCodec),a(o),g(!1)}else g(!1)};l(),v&&s||a(void 0)},[s]),{client:t,loading:m||c}}},95856:function(){}}]);