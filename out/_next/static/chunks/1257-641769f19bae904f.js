"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1257],{1257:function(e,t,r){let i,n;r.d(t,{KU:function(){return o4},Ip:function(){return sA},lY:function(){return sq},Sr:function(){return sH},nB:function(){return nG},$:function(){return nH}});var s,o,a,c,d,l,u,p,y={};r.r(y),r.d(y,{b64Decode:function(){return ee},b64Encode:function(){return Y},fetchReq:function(){return er},fetchStreamingRequest:function(){return ei},renderURLSearchParams:function(){return es},replacer:function(){return et}});var h={};r.r(h),r.d(h,{MessageApi:function(){return eo},SortDirection:function(){return d}});var f={};r.r(f),r.d(f,{Compression:function(){return l},ContentTypeId:function(){return tU},EncodedContent:function(){return tx},EncodedContent_ParametersEntry:function(){return tC},SignedContent:function(){return tJ},compressionFromJSON:function(){return tB},compressionToJSON:function(){return tR},protobufPackage:function(){return tK}});var v={};r.r(v),r.d(v,{CreateAuthTokenRequest:function(){return ir},CreateInviteFromTopicRequest:function(){return rF},CreateInviteRequest:function(){return rH},CreateInviteResponse:function(){return rY},CreateInvitesRequest:function(){return rz},CreateInvitesResponse:function(){return r0},DecryptResponse:function(){return rk},DecryptResponse_Response:function(){return rE},DecryptResponse_Response_Success:function(){return rA},DecryptV1Request:function(){return rg},DecryptV1Request_Request:function(){return rb},DecryptV2Request:function(){return rB},DecryptV2Request_Request:function(){return rT},EncryptResponse:function(){return r_},EncryptResponse_Response:function(){return rD},EncryptResponse_Response_Success:function(){return rq},EncryptV1Request:function(){return rP},EncryptV1Request_Request:function(){return rI},EncryptV2Request:function(){return rj},EncryptV2Request_Request:function(){return rL},ErrorCode:function(){return u},GetKeystoreStatusRequest:function(){return ia},GetKeystoreStatusResponse:function(){return id},GetKeystoreStatusResponse_KeystoreStatus:function(){return p},GetV2ConversationsResponse:function(){return is},InitKeystoreRequest:function(){return iu},InitKeystoreResponse:function(){return iy},KeystoreError:function(){return rv},SaveInvitesRequest:function(){return r1},SaveInvitesRequest_Request:function(){return r6},SaveInvitesResponse:function(){return r8},SaveInvitesResponse_Response:function(){return r7},SaveInvitesResponse_Response_Success:function(){return ie},SignDigestRequest:function(){return iv},TopicMap:function(){return ig},TopicMap_TopicData:function(){return ib},TopicMap_TopicsEntry:function(){return ik},errorCodeFromJSON:function(){return ru},errorCodeToJSON:function(){return rp},getKeystoreStatusResponse_KeystoreStatusFromJSON:function(){return ry},getKeystoreStatusResponse_KeystoreStatusToJSON:function(){return rh},protobufPackage:function(){return rl}});var m=r(19485),g=r(93684),w=r(16441),b=r(83875),S=r(79911),k=null;try{k=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(N){}function E(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function O(e){return!0===(e&&e.__isLong__)}function A(e){var t=Math.clz32(e&-e);return e?31-t:t}E.prototype.__isLong__,Object.defineProperty(E.prototype,"__isLong__",{value:!0}),E.isLong=O;var K={},B={};function R(e,t){var r,i,n;return t?(e>>>=0,(n=0<=e&&e<256)&&(i=B[e]))?i:(r=U(e,0,!0),n&&(B[e]=r),r):(e|=0,(n=-128<=e&&e<128)&&(i=K[e]))?i:(r=U(e,e<0?-1:0,!1),n&&(K[e]=r),r)}function T(e,t){if(isNaN(e))return t?q:M;if(t){if(e<0)return q;if(e>=_)return W}else{if(e<=-J)return H;if(e+1>=J)return L}return e<0?T(-e,t).neg():U(e%C|0,e/C|0,t)}function U(e,t,r){return new E(e,t,r)}E.fromInt=R,E.fromNumber=T,E.fromBits=U;var P=Math.pow;function x(e,t,r){if(0===e.length)throw Error("empty string");if("number"==typeof t?(r=t,t=!1):t=!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?q:M;if((r=r||10)<2||36<r)throw RangeError("radix");if((i=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===i)return x(e.substring(1),t,r).neg();for(var i,n=T(P(r,8)),s=M,o=0;o<e.length;o+=8){var a=Math.min(8,e.length-o),c=parseInt(e.substring(o,o+a),r);if(a<8){var d=T(P(r,a));s=s.mul(d).add(T(c))}else s=(s=s.mul(n)).add(T(c))}return s.unsigned=t,s}function I(e,t){return"number"==typeof e?T(e,t):"string"==typeof e?x(e,t):U(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}E.fromString=x,E.fromValue=I;var C=4294967296,_=18446744073709552e3,J=0x7fffffffffffffff,D=R(16777216),M=R(0);E.ZERO=M;var q=R(0,!0);E.UZERO=q;var V=R(1);E.ONE=V;var j=R(1,!0);E.UONE=j;var Z=R(-1);E.NEG_ONE=Z;var L=U(-1,2147483647,!1);E.MAX_VALUE=L;var W=U(-1,-1,!0);E.MAX_UNSIGNED_VALUE=W;var H=U(0,-2147483648,!1);E.MIN_VALUE=H;var G=E.prototype;G.toInt=function(){return this.unsigned?this.low>>>0:this.low},G.toNumber=function(){return this.unsigned?(this.high>>>0)*C+(this.low>>>0):this.high*C+(this.low>>>0)},G.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(!this.eq(H))return"-"+this.neg().toString(e);var t=T(e),r=this.div(t),i=r.mul(t).sub(this);return r.toString(e)+i.toInt().toString(e)}for(var n=T(P(e,6),this.unsigned),s=this,o="";;){var a=s.div(n),c=(s.sub(a.mul(n)).toInt()>>>0).toString(e);if((s=a).isZero())return c+o;for(;c.length<6;)c="0"+c;o=""+c+o}},G.getHighBits=function(){return this.high},G.getHighBitsUnsigned=function(){return this.high>>>0},G.getLowBits=function(){return this.low},G.getLowBitsUnsigned=function(){return this.low>>>0},G.getNumBitsAbs=function(){if(this.isNegative())return this.eq(H)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return 0!=this.high?t+33:t+1},G.isZero=function(){return 0===this.high&&0===this.low},G.eqz=G.isZero,G.isNegative=function(){return!this.unsigned&&this.high<0},G.isPositive=function(){return this.unsigned||this.high>=0},G.isOdd=function(){return(1&this.low)==1},G.isEven=function(){return(1&this.low)==0},G.equals=function(e){return O(e)||(e=I(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},G.eq=G.equals,G.notEquals=function(e){return!this.eq(e)},G.neq=G.notEquals,G.ne=G.notEquals,G.lessThan=function(e){return 0>this.comp(e)},G.lt=G.lessThan,G.lessThanOrEqual=function(e){return 0>=this.comp(e)},G.lte=G.lessThanOrEqual,G.le=G.lessThanOrEqual,G.greaterThan=function(e){return this.comp(e)>0},G.gt=G.greaterThan,G.greaterThanOrEqual=function(e){return this.comp(e)>=0},G.gte=G.greaterThanOrEqual,G.ge=G.greaterThanOrEqual,G.compare=function(e){if(O(e)||(e=I(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},G.comp=G.compare,G.negate=function(){return!this.unsigned&&this.eq(H)?H:this.not().add(V)},G.neg=G.negate,G.add=function(e){O(e)||(e=I(e));var t,r,i=this.high>>>16,n=65535&this.high,s=this.low>>>16,o=65535&this.low,a=e.high>>>16,c=65535&e.high,d=e.low>>>16,l=65535&e.low,u=0,p=0;return t=0+((r=0+(o+l))>>>16),r&=65535,t+=s+d,p+=t>>>16,t&=65535,p+=n+c,u+=p>>>16,p&=65535,u+=i+a,U(t<<16|r,(u&=65535)<<16|p,this.unsigned)},G.subtract=function(e){return O(e)||(e=I(e)),this.add(e.neg())},G.sub=G.subtract,G.multiply=function(e){if(this.isZero())return this;if(O(e)||(e=I(e)),k)return U(k.mul(this.low,this.high,e.low,e.high),k.get_high(),this.unsigned);if(e.isZero())return this.unsigned?q:M;if(this.eq(H))return e.isOdd()?H:M;if(e.eq(H))return this.isOdd()?H:M;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(D)&&e.lt(D))return T(this.toNumber()*e.toNumber(),this.unsigned);var t,r,i=this.high>>>16,n=65535&this.high,s=this.low>>>16,o=65535&this.low,a=e.high>>>16,c=65535&e.high,d=e.low>>>16,l=65535&e.low,u=0,p=0;return t=0+((r=0+o*l)>>>16),r&=65535,t+=s*l,p+=t>>>16,t&=65535,t+=o*d,p+=t>>>16,t&=65535,p+=n*l,u+=p>>>16,p&=65535,p+=s*d,u+=p>>>16,p&=65535,p+=o*c,u+=p>>>16,p&=65535,u+=i*l+n*d+s*c+o*a,U(t<<16|r,(u&=65535)<<16|p,this.unsigned)},G.mul=G.multiply,G.divide=function(e){if(O(e)||(e=I(e)),e.isZero())throw Error("division by zero");if(k){var t,r,i;return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?U((this.unsigned?k.div_u:k.div_s)(this.low,this.high,e.low,e.high),k.get_high(),this.unsigned):this}if(this.isZero())return this.unsigned?q:M;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return q;if(e.gt(this.shru(1)))return j;i=q}else{if(this.eq(H))return e.eq(V)||e.eq(Z)?H:e.eq(H)?V:(t=this.shr(1).div(e).shl(1)).eq(M)?e.isNegative()?V:Z:(r=this.sub(e.mul(t)),i=t.add(r.div(e)));if(e.eq(H))return this.unsigned?q:M;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=M}for(r=this;r.gte(e);){for(var n=Math.ceil(Math.log(t=Math.max(1,Math.floor(r.toNumber()/e.toNumber())))/Math.LN2),s=n<=48?1:P(2,n-48),o=T(t),a=o.mul(e);a.isNegative()||a.gt(r);)t-=s,a=(o=T(t,this.unsigned)).mul(e);o.isZero()&&(o=V),i=i.add(o),r=r.sub(a)}return i},G.div=G.divide,G.modulo=function(e){return(O(e)||(e=I(e)),k)?U((this.unsigned?k.rem_u:k.rem_s)(this.low,this.high,e.low,e.high),k.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},G.mod=G.modulo,G.rem=G.modulo,G.not=function(){return U(~this.low,~this.high,this.unsigned)},G.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},G.clz=G.countLeadingZeros,G.countTrailingZeros=function(){return this.low?A(this.low):A(this.high)+32},G.ctz=G.countTrailingZeros,G.and=function(e){return O(e)||(e=I(e)),U(this.low&e.low,this.high&e.high,this.unsigned)},G.or=function(e){return O(e)||(e=I(e)),U(this.low|e.low,this.high|e.high,this.unsigned)},G.xor=function(e){return O(e)||(e=I(e)),U(this.low^e.low,this.high^e.high,this.unsigned)},G.shiftLeft=function(e){return(O(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?U(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):U(0,this.low<<e-32,this.unsigned)},G.shl=G.shiftLeft,G.shiftRight=function(e){return(O(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?U(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):U(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},G.shr=G.shiftRight,G.shiftRightUnsigned=function(e){return(O(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?U(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):32===e?U(this.high,0,this.unsigned):U(this.high>>>e-32,0,this.unsigned)},G.shru=G.shiftRightUnsigned,G.shr_u=G.shiftRightUnsigned,G.rotateLeft=function(e){var t;return(O(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?U(this.high,this.low,this.unsigned):e<32?(t=32-e,U(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,U(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},G.rotl=G.rotateLeft,G.rotateRight=function(e){var t;return(O(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?U(this.high,this.low,this.unsigned):e<32?(t=32-e,U(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,U(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},G.rotr=G.rotateRight,G.toSigned=function(){return this.unsigned?U(this.low,this.high,!1):this},G.toUnsigned=function(){return this.unsigned?this:U(this.low,this.high,!0)},G.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},G.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},G.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},E.fromBytes=function(e,t,r){return r?E.fromBytesLE(e,t):E.fromBytesBE(e,t)},E.fromBytesLE=function(e,t){return new E(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},E.fromBytesBE=function(e,t){return new E(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var F=function(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&0>t.indexOf(i)&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,i=Object.getOwnPropertySymbols(e);n<i.length;n++)0>t.indexOf(i[n])&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]]);return r};let $=Array(64),z=Array(123);for(let X=0;X<64;)z[$[X]=X<26?X+65:X<52?X+71:X<62?X-4:X-59|43]=X++;function Y(e,t,r){let i=null,n=[],s=0,o=0,a;for(;t<r;){let c=e[t++];switch(o){case 0:n[s++]=$[c>>2],a=(3&c)<<4,o=1;break;case 1:n[s++]=$[a|c>>4],a=(15&c)<<2,o=2;break;case 2:n[s++]=$[a|c>>6],n[s++]=$[63&c],o=0}s>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,n)),s=0)}return(o&&(n[s++]=$[a],n[s++]=61,1===o&&(n[s++]=61)),i)?(s&&i.push(String.fromCharCode.apply(String,n.slice(0,s))),i.join("")):String.fromCharCode.apply(String,n.slice(0,s))}let Q="invalid encoding";function ee(e){let t=[],r=0,i=0,n;for(let s=0;s<e.length;){let o=e.charCodeAt(s++);if(61===o&&i>1)break;if(void 0===(o=z[o]))throw Error(Q);switch(i){case 0:n=o,i=1;break;case 1:t[r++]=n<<2|(48&o)>>4,n=o,i=2;break;case 2:t[r++]=(15&n)<<4|(60&o)>>2,n=o,i=3;break;case 3:t[r++]=(3&n)<<6|o,i=0}}if(1===i)throw Error(Q);return new Uint8Array(t)}function et(e,t){return t&&t.constructor===Uint8Array?Y(t,0,t.length):t}function er(e,t){let r=t||{},{pathPrefix:i}=r,n=F(r,["pathPrefix"]),s=i?`${i}${e}`:e;return fetch(s,n).then(e=>e.json().then(t=>{if(!e.ok)throw t;return t}))}function ei(e,t,r){var i,n,s,o;return i=this,n=void 0,s=void 0,o=function*(){var i;let n=r||{},{pathPrefix:s}=n,o=F(n,["pathPrefix"]),a=s?`${s}${e}`:e,c=yield fetch(a,o);if(!c.ok){let d=yield c.json(),l=d.error&&d.error.message?d.error.message:"";throw Error(l)}if(!c.body)throw Error("response doesnt have a body");yield c.body.pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({start(e){e.buf="",e.pos=0},transform(e,t){for(void 0===t.buf&&(t.buf=""),void 0===t.pos&&(t.pos=0),t.buf+=e;t.pos<t.buf.length;)if("\n"===t.buf[t.pos]){let r=t.buf.substring(0,t.pos),i=JSON.parse(r);t.enqueue(i.result),t.buf=t.buf.substring(t.pos+1),t.pos=0}else++t.pos}})).pipeTo((i=e=>{t&&t(e)},new WritableStream({write(e){i(e)}})))},new(s||(s=Promise))(function(e,t){function r(e){try{c(o.next(e))}catch(r){t(r)}}function a(e){try{c(o.throw(e))}catch(r){t(r)}}function c(t){var i;t.done?e(t.value):((i=t.value)instanceof s?i:new s(function(e){e(i)})).then(r,a)}c((o=o.apply(i,n||[])).next())})}function en(e){return["string","number","boolean"].some(t=>typeof e===t)}function es(e,t=[]){let r=function e(t,r=""){return Object.keys(t).reduce((i,n)=>{let s=t[n],o=r?[r,n].join("."):n,a=Array.isArray(s)&&s.every(e=>en(e))&&s.length>0,c=en(s)&&!(!1===s||0===s||""===s),d={};return!function(e){let t="Object"===Object.prototype.toString.call(e).slice(8,-1);if(!(null!==e&&t)||!t)return!1;let r=Object.getPrototypeOf(e),i="object"==typeof r&&r.constructor===Object.prototype.constructor;return i}(s)?(c||a)&&(d={[o]:s}):d=e(s,o),Object.assign(Object.assign({},i),d)},{})}(e),i=Object.keys(r).reduce((e,i)=>{let n=r[i];return t.find(e=>e===i)?e:Array.isArray(n)?[...e,...n.map(e=>[i,e.toString()])]:e=[...e,[i,n.toString()]]},[]);return new URLSearchParams(i).toString()}(s=d||(d={})).SORT_DIRECTION_UNSPECIFIED="SORT_DIRECTION_UNSPECIFIED",s.SORT_DIRECTION_ASCENDING="SORT_DIRECTION_ASCENDING",s.SORT_DIRECTION_DESCENDING="SORT_DIRECTION_DESCENDING";class eo{static Publish(e,t){return er("/message/v1/publish",Object.assign(Object.assign({},t),{method:"POST",body:JSON.stringify(e,et)}))}static Subscribe(e,t,r){return ei("/message/v1/subscribe",t,Object.assign(Object.assign({},r),{method:"POST",body:JSON.stringify(e,et)}))}static SubscribeAll(e,t,r){return ei("/message/v1/subscribe-all",t,Object.assign(Object.assign({},r),{method:"POST",body:JSON.stringify(e,et)}))}static Query(e,t){return er("/message/v1/query",Object.assign(Object.assign({},t),{method:"POST",body:JSON.stringify(e,et)}))}static BatchQuery(e,t){return er("/message/v1/batch-query",Object.assign(Object.assign({},t),{method:"POST",body:JSON.stringify(e,et)}))}}var ea=r(62100),ec=r.n(ea);function ed(){return{ecdsaCompact:void 0,walletEcdsaCompact:void 0}}let el={encode:(e,t=ec().Writer.create())=>(void 0!==e.ecdsaCompact&&ep.encode(e.ecdsaCompact,t.uint32(10).fork()).ldelim(),void 0!==e.walletEcdsaCompact&&eh.encode(e.walletEcdsaCompact,t.uint32(18).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=ed();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.ecdsaCompact=ep.decode(r,r.uint32());break;case 2:n.walletEcdsaCompact=eh.decode(r,r.uint32());break;default:r.skipType(7&s)}}return n},fromJSON:e=>({ecdsaCompact:eg(e.ecdsaCompact)?ep.fromJSON(e.ecdsaCompact):void 0,walletEcdsaCompact:eg(e.walletEcdsaCompact)?eh.fromJSON(e.walletEcdsaCompact):void 0}),toJSON(e){let t={};return void 0!==e.ecdsaCompact&&(t.ecdsaCompact=e.ecdsaCompact?ep.toJSON(e.ecdsaCompact):void 0),void 0!==e.walletEcdsaCompact&&(t.walletEcdsaCompact=e.walletEcdsaCompact?eh.toJSON(e.walletEcdsaCompact):void 0),t},fromPartial(e){let t=ed();return t.ecdsaCompact=void 0!==e.ecdsaCompact&&null!==e.ecdsaCompact?ep.fromPartial(e.ecdsaCompact):void 0,t.walletEcdsaCompact=void 0!==e.walletEcdsaCompact&&null!==e.walletEcdsaCompact?eh.fromPartial(e.walletEcdsaCompact):void 0,t}};function eu(){return{bytes:new Uint8Array,recovery:0}}let ep={encode:(e,t=ec().Writer.create())=>(0!==e.bytes.length&&t.uint32(10).bytes(e.bytes),0!==e.recovery&&t.uint32(16).uint32(e.recovery),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=eu();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.bytes=r.bytes();break;case 2:n.recovery=r.uint32();break;default:r.skipType(7&s)}}return n},fromJSON:e=>({bytes:eg(e.bytes)?ev(e.bytes):new Uint8Array,recovery:eg(e.recovery)?Number(e.recovery):0}),toJSON(e){let t={};return void 0!==e.bytes&&(t.bytes=em(void 0!==e.bytes?e.bytes:new Uint8Array)),void 0!==e.recovery&&(t.recovery=Math.round(e.recovery)),t},fromPartial(e){var t,r;let i=eu();return i.bytes=null!==(t=e.bytes)&&void 0!==t?t:new Uint8Array,i.recovery=null!==(r=e.recovery)&&void 0!==r?r:0,i}};function ey(){return{bytes:new Uint8Array,recovery:0}}let eh={encode:(e,t=ec().Writer.create())=>(0!==e.bytes.length&&t.uint32(10).bytes(e.bytes),0!==e.recovery&&t.uint32(16).uint32(e.recovery),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=ey();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.bytes=r.bytes();break;case 2:n.recovery=r.uint32();break;default:r.skipType(7&s)}}return n},fromJSON:e=>({bytes:eg(e.bytes)?ev(e.bytes):new Uint8Array,recovery:eg(e.recovery)?Number(e.recovery):0}),toJSON(e){let t={};return void 0!==e.bytes&&(t.bytes=em(void 0!==e.bytes?e.bytes:new Uint8Array)),void 0!==e.recovery&&(t.recovery=Math.round(e.recovery)),t},fromPartial(e){var t,r;let i=ey();return i.bytes=null!==(t=e.bytes)&&void 0!==t?t:new Uint8Array,i.recovery=null!==(r=e.recovery)&&void 0!==r?r:0,i}};var ef=(()=>{if(void 0!==ef)return ef;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r.g)return r.g;throw"Unable to locate global object"})();function ev(e){if(ef.Buffer)return Uint8Array.from(ef.Buffer.from(e,"base64"));{let t=ef.atob(e),r=new Uint8Array(t.length);for(let i=0;i<t.length;++i)r[i]=t.charCodeAt(i);return r}}function em(e){if(ef.Buffer)return ef.Buffer.from(e).toString("base64");{let t=[];return e.forEach(e=>{t.push(String.fromCharCode(e))}),ef.btoa(t.join(""))}}function eg(e){return null!=e}function ew(){return{createdNs:E.UZERO,secp256k1Uncompressed:void 0}}ec().util.Long!==E&&(ec().util.Long=E,ec().configure());let eb={encode:(e,t=ec().Writer.create())=>(e.createdNs.isZero()||t.uint32(8).uint64(e.createdNs),void 0!==e.secp256k1Uncompressed&&ek.encode(e.secp256k1Uncompressed,t.uint32(26).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=ew();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.createdNs=r.uint64();break;case 3:n.secp256k1Uncompressed=ek.decode(r,r.uint32());break;default:r.skipType(7&s)}}return n},fromJSON:e=>({createdNs:e_(e.createdNs)?E.fromValue(e.createdNs):E.UZERO,secp256k1Uncompressed:e_(e.secp256k1Uncompressed)?ek.fromJSON(e.secp256k1Uncompressed):void 0}),toJSON(e){let t={};return void 0!==e.createdNs&&(t.createdNs=(e.createdNs||E.UZERO).toString()),void 0!==e.secp256k1Uncompressed&&(t.secp256k1Uncompressed=e.secp256k1Uncompressed?ek.toJSON(e.secp256k1Uncompressed):void 0),t},fromPartial(e){let t=ew();return t.createdNs=void 0!==e.createdNs&&null!==e.createdNs?E.fromValue(e.createdNs):E.UZERO,t.secp256k1Uncompressed=void 0!==e.secp256k1Uncompressed&&null!==e.secp256k1Uncompressed?ek.fromPartial(e.secp256k1Uncompressed):void 0,t}};function eS(){return{bytes:new Uint8Array}}let ek={encode:(e,t=ec().Writer.create())=>(0!==e.bytes.length&&t.uint32(10).bytes(e.bytes),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=eS();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.bytes=r.bytes():r.skipType(7&s)}return n},fromJSON:e=>({bytes:e_(e.bytes)?eI(e.bytes):new Uint8Array}),toJSON(e){let t={};return void 0!==e.bytes&&(t.bytes=eC(void 0!==e.bytes?e.bytes:new Uint8Array)),t},fromPartial(e){var t;let r=eS();return r.bytes=null!==(t=e.bytes)&&void 0!==t?t:new Uint8Array,r}};function eN(){return{keyBytes:new Uint8Array,signature:void 0}}let eE={encode:(e,t=ec().Writer.create())=>(0!==e.keyBytes.length&&t.uint32(10).bytes(e.keyBytes),void 0!==e.signature&&el.encode(e.signature,t.uint32(18).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=eN();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.keyBytes=r.bytes();break;case 2:n.signature=el.decode(r,r.uint32());break;default:r.skipType(7&s)}}return n},fromJSON:e=>({keyBytes:e_(e.keyBytes)?eI(e.keyBytes):new Uint8Array,signature:e_(e.signature)?el.fromJSON(e.signature):void 0}),toJSON(e){let t={};return void 0!==e.keyBytes&&(t.keyBytes=eC(void 0!==e.keyBytes?e.keyBytes:new Uint8Array)),void 0!==e.signature&&(t.signature=e.signature?el.toJSON(e.signature):void 0),t},fromPartial(e){var t;let r=eN();return r.keyBytes=null!==(t=e.keyBytes)&&void 0!==t?t:new Uint8Array,r.signature=void 0!==e.signature&&null!==e.signature?el.fromPartial(e.signature):void 0,r}};function eO(){return{identityKey:void 0,preKey:void 0}}let eA={encode:(e,t=ec().Writer.create())=>(void 0!==e.identityKey&&eE.encode(e.identityKey,t.uint32(10).fork()).ldelim(),void 0!==e.preKey&&eE.encode(e.preKey,t.uint32(18).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=eO();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.identityKey=eE.decode(r,r.uint32());break;case 2:n.preKey=eE.decode(r,r.uint32());break;default:r.skipType(7&s)}}return n},fromJSON:e=>({identityKey:e_(e.identityKey)?eE.fromJSON(e.identityKey):void 0,preKey:e_(e.preKey)?eE.fromJSON(e.preKey):void 0}),toJSON(e){let t={};return void 0!==e.identityKey&&(t.identityKey=e.identityKey?eE.toJSON(e.identityKey):void 0),void 0!==e.preKey&&(t.preKey=e.preKey?eE.toJSON(e.preKey):void 0),t},fromPartial(e){let t=eO();return t.identityKey=void 0!==e.identityKey&&null!==e.identityKey?eE.fromPartial(e.identityKey):void 0,t.preKey=void 0!==e.preKey&&null!==e.preKey?eE.fromPartial(e.preKey):void 0,t}};function eK(){return{timestamp:E.UZERO,signature:void 0,secp256k1Uncompressed:void 0}}let eB={encode:(e,t=ec().Writer.create())=>(e.timestamp.isZero()||t.uint32(8).uint64(e.timestamp),void 0!==e.signature&&el.encode(e.signature,t.uint32(18).fork()).ldelim(),void 0!==e.secp256k1Uncompressed&&eT.encode(e.secp256k1Uncompressed,t.uint32(26).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=eK();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.timestamp=r.uint64();break;case 2:n.signature=el.decode(r,r.uint32());break;case 3:n.secp256k1Uncompressed=eT.decode(r,r.uint32());break;default:r.skipType(7&s)}}return n},fromJSON:e=>({timestamp:e_(e.timestamp)?E.fromValue(e.timestamp):E.UZERO,signature:e_(e.signature)?el.fromJSON(e.signature):void 0,secp256k1Uncompressed:e_(e.secp256k1Uncompressed)?eT.fromJSON(e.secp256k1Uncompressed):void 0}),toJSON(e){let t={};return void 0!==e.timestamp&&(t.timestamp=(e.timestamp||E.UZERO).toString()),void 0!==e.signature&&(t.signature=e.signature?el.toJSON(e.signature):void 0),void 0!==e.secp256k1Uncompressed&&(t.secp256k1Uncompressed=e.secp256k1Uncompressed?eT.toJSON(e.secp256k1Uncompressed):void 0),t},fromPartial(e){let t=eK();return t.timestamp=void 0!==e.timestamp&&null!==e.timestamp?E.fromValue(e.timestamp):E.UZERO,t.signature=void 0!==e.signature&&null!==e.signature?el.fromPartial(e.signature):void 0,t.secp256k1Uncompressed=void 0!==e.secp256k1Uncompressed&&null!==e.secp256k1Uncompressed?eT.fromPartial(e.secp256k1Uncompressed):void 0,t}};function eR(){return{bytes:new Uint8Array}}let eT={encode:(e,t=ec().Writer.create())=>(0!==e.bytes.length&&t.uint32(10).bytes(e.bytes),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=eR();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.bytes=r.bytes():r.skipType(7&s)}return n},fromJSON:e=>({bytes:e_(e.bytes)?eI(e.bytes):new Uint8Array}),toJSON(e){let t={};return void 0!==e.bytes&&(t.bytes=eC(void 0!==e.bytes?e.bytes:new Uint8Array)),t},fromPartial(e){var t;let r=eR();return r.bytes=null!==(t=e.bytes)&&void 0!==t?t:new Uint8Array,r}};function eU(){return{identityKey:void 0,preKey:void 0}}let eP={encode:(e,t=ec().Writer.create())=>(void 0!==e.identityKey&&eB.encode(e.identityKey,t.uint32(10).fork()).ldelim(),void 0!==e.preKey&&eB.encode(e.preKey,t.uint32(18).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=eU();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.identityKey=eB.decode(r,r.uint32());break;case 2:n.preKey=eB.decode(r,r.uint32());break;default:r.skipType(7&s)}}return n},fromJSON:e=>({identityKey:e_(e.identityKey)?eB.fromJSON(e.identityKey):void 0,preKey:e_(e.preKey)?eB.fromJSON(e.preKey):void 0}),toJSON(e){let t={};return void 0!==e.identityKey&&(t.identityKey=e.identityKey?eB.toJSON(e.identityKey):void 0),void 0!==e.preKey&&(t.preKey=e.preKey?eB.toJSON(e.preKey):void 0),t},fromPartial(e){let t=eU();return t.identityKey=void 0!==e.identityKey&&null!==e.identityKey?eB.fromPartial(e.identityKey):void 0,t.preKey=void 0!==e.preKey&&null!==e.preKey?eB.fromPartial(e.preKey):void 0,t}};var ex=(()=>{if(void 0!==ex)return ex;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r.g)return r.g;throw"Unable to locate global object"})();function eI(e){if(ex.Buffer)return Uint8Array.from(ex.Buffer.from(e,"base64"));{let t=ex.atob(e),r=new Uint8Array(t.length);for(let i=0;i<t.length;++i)r[i]=t.charCodeAt(i);return r}}function eC(e){if(ex.Buffer)return ex.Buffer.from(e).toString("base64");{let t=[];return e.forEach(e=>{t.push(String.fromCharCode(e))}),ex.btoa(t.join(""))}}function e_(e){return null!=e}function eJ(){return{identityKey:void 0,authDataBytes:new Uint8Array,authDataSignature:void 0}}ec().util.Long!==E&&(ec().util.Long=E,ec().configure());let eD={encode:(e,t=ec().Writer.create())=>(void 0!==e.identityKey&&eB.encode(e.identityKey,t.uint32(10).fork()).ldelim(),0!==e.authDataBytes.length&&t.uint32(18).bytes(e.authDataBytes),void 0!==e.authDataSignature&&el.encode(e.authDataSignature,t.uint32(26).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=eJ();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.identityKey=eB.decode(r,r.uint32());break;case 2:n.authDataBytes=r.bytes();break;case 3:n.authDataSignature=el.decode(r,r.uint32());break;default:r.skipType(7&s)}}return n},fromJSON:e=>({identityKey:ej(e.identityKey)?eB.fromJSON(e.identityKey):void 0,authDataBytes:ej(e.authDataBytes)?function(e){if(eV.Buffer)return Uint8Array.from(eV.Buffer.from(e,"base64"));{let t=eV.atob(e),r=new Uint8Array(t.length);for(let i=0;i<t.length;++i)r[i]=t.charCodeAt(i);return r}}(e.authDataBytes):new Uint8Array,authDataSignature:ej(e.authDataSignature)?el.fromJSON(e.authDataSignature):void 0}),toJSON(e){let t={};return void 0!==e.identityKey&&(t.identityKey=e.identityKey?eB.toJSON(e.identityKey):void 0),void 0!==e.authDataBytes&&(t.authDataBytes=function(e){if(eV.Buffer)return eV.Buffer.from(e).toString("base64");{let t=[];return e.forEach(e=>{t.push(String.fromCharCode(e))}),eV.btoa(t.join(""))}}(void 0!==e.authDataBytes?e.authDataBytes:new Uint8Array)),void 0!==e.authDataSignature&&(t.authDataSignature=e.authDataSignature?el.toJSON(e.authDataSignature):void 0),t},fromPartial(e){var t;let r=eJ();return r.identityKey=void 0!==e.identityKey&&null!==e.identityKey?eB.fromPartial(e.identityKey):void 0,r.authDataBytes=null!==(t=e.authDataBytes)&&void 0!==t?t:new Uint8Array,r.authDataSignature=void 0!==e.authDataSignature&&null!==e.authDataSignature?el.fromPartial(e.authDataSignature):void 0,r}};function eM(){return{walletAddr:"",createdNs:E.UZERO}}let eq={encode:(e,t=ec().Writer.create())=>(""!==e.walletAddr&&t.uint32(10).string(e.walletAddr),e.createdNs.isZero()||t.uint32(16).uint64(e.createdNs),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=eM();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.walletAddr=r.string();break;case 2:n.createdNs=r.uint64();break;default:r.skipType(7&s)}}return n},fromJSON:e=>({walletAddr:ej(e.walletAddr)?String(e.walletAddr):"",createdNs:ej(e.createdNs)?E.fromValue(e.createdNs):E.UZERO}),toJSON(e){let t={};return void 0!==e.walletAddr&&(t.walletAddr=e.walletAddr),void 0!==e.createdNs&&(t.createdNs=(e.createdNs||E.UZERO).toString()),t},fromPartial(e){var t;let r=eM();return r.walletAddr=null!==(t=e.walletAddr)&&void 0!==t?t:"",r.createdNs=void 0!==e.createdNs&&null!==e.createdNs?E.fromValue(e.createdNs):E.UZERO,r}};var eV=(()=>{if(void 0!==eV)return eV;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r.g)return r.g;throw"Unable to locate global object"})();function ej(e){return null!=e}function eZ(){return{aes256GcmHkdfSha256:void 0}}ec().util.Long!==E&&(ec().util.Long=E,ec().configure());let eL={encode:(e,t=ec().Writer.create())=>(void 0!==e.aes256GcmHkdfSha256&&eH.encode(e.aes256GcmHkdfSha256,t.uint32(10).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=eZ();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.aes256GcmHkdfSha256=eH.decode(r,r.uint32()):r.skipType(7&s)}return n},fromJSON:e=>({aes256GcmHkdfSha256:e0(e.aes256GcmHkdfSha256)?eH.fromJSON(e.aes256GcmHkdfSha256):void 0}),toJSON(e){let t={};return void 0!==e.aes256GcmHkdfSha256&&(t.aes256GcmHkdfSha256=e.aes256GcmHkdfSha256?eH.toJSON(e.aes256GcmHkdfSha256):void 0),t},fromPartial(e){let t=eZ();return t.aes256GcmHkdfSha256=void 0!==e.aes256GcmHkdfSha256&&null!==e.aes256GcmHkdfSha256?eH.fromPartial(e.aes256GcmHkdfSha256):void 0,t}};function eW(){return{hkdfSalt:new Uint8Array,gcmNonce:new Uint8Array,payload:new Uint8Array}}let eH={encode:(e,t=ec().Writer.create())=>(0!==e.hkdfSalt.length&&t.uint32(10).bytes(e.hkdfSalt),0!==e.gcmNonce.length&&t.uint32(18).bytes(e.gcmNonce),0!==e.payload.length&&t.uint32(26).bytes(e.payload),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=eW();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.hkdfSalt=r.bytes();break;case 2:n.gcmNonce=r.bytes();break;case 3:n.payload=r.bytes();break;default:r.skipType(7&s)}}return n},fromJSON:e=>({hkdfSalt:e0(e.hkdfSalt)?eY(e.hkdfSalt):new Uint8Array,gcmNonce:e0(e.gcmNonce)?eY(e.gcmNonce):new Uint8Array,payload:e0(e.payload)?eY(e.payload):new Uint8Array}),toJSON(e){let t={};return void 0!==e.hkdfSalt&&(t.hkdfSalt=eQ(void 0!==e.hkdfSalt?e.hkdfSalt:new Uint8Array)),void 0!==e.gcmNonce&&(t.gcmNonce=eQ(void 0!==e.gcmNonce?e.gcmNonce:new Uint8Array)),void 0!==e.payload&&(t.payload=eQ(void 0!==e.payload?e.payload:new Uint8Array)),t},fromPartial(e){var t,r,i;let n=eW();return n.hkdfSalt=null!==(t=e.hkdfSalt)&&void 0!==t?t:new Uint8Array,n.gcmNonce=null!==(r=e.gcmNonce)&&void 0!==r?r:new Uint8Array,n.payload=null!==(i=e.payload)&&void 0!==i?i:new Uint8Array,n}};function eG(){return{eciesBytes:new Uint8Array,signature:void 0}}let eF={encode:(e,t=ec().Writer.create())=>(0!==e.eciesBytes.length&&t.uint32(10).bytes(e.eciesBytes),void 0!==e.signature&&el.encode(e.signature,t.uint32(18).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=eG();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.eciesBytes=r.bytes();break;case 2:n.signature=el.decode(r,r.uint32());break;default:r.skipType(7&s)}}return n},fromJSON:e=>({eciesBytes:e0(e.eciesBytes)?eY(e.eciesBytes):new Uint8Array,signature:e0(e.signature)?el.fromJSON(e.signature):void 0}),toJSON(e){let t={};return void 0!==e.eciesBytes&&(t.eciesBytes=eQ(void 0!==e.eciesBytes?e.eciesBytes:new Uint8Array)),void 0!==e.signature&&(t.signature=e.signature?el.toJSON(e.signature):void 0),t},fromPartial(e){var t;let r=eG();return r.eciesBytes=null!==(t=e.eciesBytes)&&void 0!==t?t:new Uint8Array,r.signature=void 0!==e.signature&&null!==e.signature?el.fromPartial(e.signature):void 0,r}};function e$(){return{ephemeralPublicKey:new Uint8Array,iv:new Uint8Array,mac:new Uint8Array,ciphertext:new Uint8Array}}let ez={encode:(e,t=ec().Writer.create())=>(0!==e.ephemeralPublicKey.length&&t.uint32(10).bytes(e.ephemeralPublicKey),0!==e.iv.length&&t.uint32(18).bytes(e.iv),0!==e.mac.length&&t.uint32(26).bytes(e.mac),0!==e.ciphertext.length&&t.uint32(34).bytes(e.ciphertext),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=e$();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.ephemeralPublicKey=r.bytes();break;case 2:n.iv=r.bytes();break;case 3:n.mac=r.bytes();break;case 4:n.ciphertext=r.bytes();break;default:r.skipType(7&s)}}return n},fromJSON:e=>({ephemeralPublicKey:e0(e.ephemeralPublicKey)?eY(e.ephemeralPublicKey):new Uint8Array,iv:e0(e.iv)?eY(e.iv):new Uint8Array,mac:e0(e.mac)?eY(e.mac):new Uint8Array,ciphertext:e0(e.ciphertext)?eY(e.ciphertext):new Uint8Array}),toJSON(e){let t={};return void 0!==e.ephemeralPublicKey&&(t.ephemeralPublicKey=eQ(void 0!==e.ephemeralPublicKey?e.ephemeralPublicKey:new Uint8Array)),void 0!==e.iv&&(t.iv=eQ(void 0!==e.iv?e.iv:new Uint8Array)),void 0!==e.mac&&(t.mac=eQ(void 0!==e.mac?e.mac:new Uint8Array)),void 0!==e.ciphertext&&(t.ciphertext=eQ(void 0!==e.ciphertext?e.ciphertext:new Uint8Array)),t},fromPartial(e){var t,r,i,n;let s=e$();return s.ephemeralPublicKey=null!==(t=e.ephemeralPublicKey)&&void 0!==t?t:new Uint8Array,s.iv=null!==(r=e.iv)&&void 0!==r?r:new Uint8Array,s.mac=null!==(i=e.mac)&&void 0!==i?i:new Uint8Array,s.ciphertext=null!==(n=e.ciphertext)&&void 0!==n?n:new Uint8Array,s}};var eX=(()=>{if(void 0!==eX)return eX;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r.g)return r.g;throw"Unable to locate global object"})();function eY(e){if(eX.Buffer)return Uint8Array.from(eX.Buffer.from(e,"base64"));{let t=eX.atob(e),r=new Uint8Array(t.length);for(let i=0;i<t.length;++i)r[i]=t.charCodeAt(i);return r}}function eQ(e){if(eX.Buffer)return eX.Buffer.from(e).toString("base64");{let t=[];return e.forEach(e=>{t.push(String.fromCharCode(e))}),eX.btoa(t.join(""))}}function e0(e){return null!=e}function e2(){return{topic:"",context:void 0,aes256GcmHkdfSha256:void 0}}ec().util.Long!==E&&(ec().util.Long=E,ec().configure());let e1={encode:(e,t=ec().Writer.create())=>(""!==e.topic&&t.uint32(10).string(e.topic),void 0!==e.context&&e8.encode(e.context,t.uint32(18).fork()).ldelim(),void 0!==e.aes256GcmHkdfSha256&&e6.encode(e.aes256GcmHkdfSha256,t.uint32(26).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=e2();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.topic=r.string();break;case 2:n.context=e8.decode(r,r.uint32());break;case 3:n.aes256GcmHkdfSha256=e6.decode(r,r.uint32());break;default:r.skipType(7&s)}}return n},fromJSON:e=>({topic:tc(e.topic)?String(e.topic):"",context:tc(e.context)?e8.fromJSON(e.context):void 0,aes256GcmHkdfSha256:tc(e.aes256GcmHkdfSha256)?e6.fromJSON(e.aes256GcmHkdfSha256):void 0}),toJSON(e){let t={};return void 0!==e.topic&&(t.topic=e.topic),void 0!==e.context&&(t.context=e.context?e8.toJSON(e.context):void 0),void 0!==e.aes256GcmHkdfSha256&&(t.aes256GcmHkdfSha256=e.aes256GcmHkdfSha256?e6.toJSON(e.aes256GcmHkdfSha256):void 0),t},fromPartial(e){var t;let r=e2();return r.topic=null!==(t=e.topic)&&void 0!==t?t:"",r.context=void 0!==e.context&&null!==e.context?e8.fromPartial(e.context):void 0,r.aes256GcmHkdfSha256=void 0!==e.aes256GcmHkdfSha256&&null!==e.aes256GcmHkdfSha256?e6.fromPartial(e.aes256GcmHkdfSha256):void 0,r}};function e3(){return{keyMaterial:new Uint8Array}}let e6={encode:(e,t=ec().Writer.create())=>(0!==e.keyMaterial.length&&t.uint32(10).bytes(e.keyMaterial),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=e3();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.keyMaterial=r.bytes():r.skipType(7&s)}return n},fromJSON:e=>({keyMaterial:tc(e.keyMaterial)?to(e.keyMaterial):new Uint8Array}),toJSON(e){let t={};return void 0!==e.keyMaterial&&(t.keyMaterial=ta(void 0!==e.keyMaterial?e.keyMaterial:new Uint8Array)),t},fromPartial(e){var t;let r=e3();return r.keyMaterial=null!==(t=e.keyMaterial)&&void 0!==t?t:new Uint8Array,r}};function e5(){return{conversationId:"",metadata:{}}}let e8={encode:(e,t=ec().Writer.create())=>(""!==e.conversationId&&t.uint32(10).string(e.conversationId),Object.entries(e.metadata).forEach(([e,r])=>{e7.encode({key:e,value:r},t.uint32(18).fork()).ldelim()}),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=e5();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.conversationId=r.string();break;case 2:let o=e7.decode(r,r.uint32());void 0!==o.value&&(n.metadata[o.key]=o.value);break;default:r.skipType(7&s)}}return n},fromJSON:e=>{var t;return{conversationId:tc(e.conversationId)?String(e.conversationId):"",metadata:"object"==typeof(t=e.metadata)&&null!==t?Object.entries(e.metadata).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}},toJSON(e){let t={};return void 0!==e.conversationId&&(t.conversationId=e.conversationId),t.metadata={},e.metadata&&Object.entries(e.metadata).forEach(([e,r])=>{t.metadata[e]=r}),t},fromPartial(e){var t,r;let i=e5();return i.conversationId=null!==(t=e.conversationId)&&void 0!==t?t:"",i.metadata=Object.entries(null!==(r=e.metadata)&&void 0!==r?r:{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=String(r)),e),{}),i}};function e4(){return{key:"",value:""}}let e7={encode:(e,t=ec().Writer.create())=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=e4();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.key=r.string();break;case 2:n.value=r.string();break;default:r.skipType(7&s)}}return n},fromJSON:e=>({key:tc(e.key)?String(e.key):"",value:tc(e.value)?String(e.value):""}),toJSON(e){let t={};return void 0!==e.key&&(t.key=e.key),void 0!==e.value&&(t.value=e.value),t},fromPartial(e){var t,r;let i=e4();return i.key=null!==(t=e.key)&&void 0!==t?t:"",i.value=null!==(r=e.value)&&void 0!==r?r:"",i}};function e9(){return{sender:void 0,recipient:void 0,createdNs:E.UZERO}}let te={encode:(e,t=ec().Writer.create())=>(void 0!==e.sender&&eA.encode(e.sender,t.uint32(10).fork()).ldelim(),void 0!==e.recipient&&eA.encode(e.recipient,t.uint32(18).fork()).ldelim(),e.createdNs.isZero()||t.uint32(24).uint64(e.createdNs),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=e9();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.sender=eA.decode(r,r.uint32());break;case 2:n.recipient=eA.decode(r,r.uint32());break;case 3:n.createdNs=r.uint64();break;default:r.skipType(7&s)}}return n},fromJSON:e=>({sender:tc(e.sender)?eA.fromJSON(e.sender):void 0,recipient:tc(e.recipient)?eA.fromJSON(e.recipient):void 0,createdNs:tc(e.createdNs)?E.fromValue(e.createdNs):E.UZERO}),toJSON(e){let t={};return void 0!==e.sender&&(t.sender=e.sender?eA.toJSON(e.sender):void 0),void 0!==e.recipient&&(t.recipient=e.recipient?eA.toJSON(e.recipient):void 0),void 0!==e.createdNs&&(t.createdNs=(e.createdNs||E.UZERO).toString()),t},fromPartial(e){let t=e9();return t.sender=void 0!==e.sender&&null!==e.sender?eA.fromPartial(e.sender):void 0,t.recipient=void 0!==e.recipient&&null!==e.recipient?eA.fromPartial(e.recipient):void 0,t.createdNs=void 0!==e.createdNs&&null!==e.createdNs?E.fromValue(e.createdNs):E.UZERO,t}};function tt(){return{headerBytes:new Uint8Array,ciphertext:void 0}}let tr={encode:(e,t=ec().Writer.create())=>(0!==e.headerBytes.length&&t.uint32(10).bytes(e.headerBytes),void 0!==e.ciphertext&&eL.encode(e.ciphertext,t.uint32(18).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=tt();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.headerBytes=r.bytes();break;case 2:n.ciphertext=eL.decode(r,r.uint32());break;default:r.skipType(7&s)}}return n},fromJSON:e=>({headerBytes:tc(e.headerBytes)?to(e.headerBytes):new Uint8Array,ciphertext:tc(e.ciphertext)?eL.fromJSON(e.ciphertext):void 0}),toJSON(e){let t={};return void 0!==e.headerBytes&&(t.headerBytes=ta(void 0!==e.headerBytes?e.headerBytes:new Uint8Array)),void 0!==e.ciphertext&&(t.ciphertext=e.ciphertext?eL.toJSON(e.ciphertext):void 0),t},fromPartial(e){var t;let r=tt();return r.headerBytes=null!==(t=e.headerBytes)&&void 0!==t?t:new Uint8Array,r.ciphertext=void 0!==e.ciphertext&&null!==e.ciphertext?eL.fromPartial(e.ciphertext):void 0,r}};function ti(){return{v1:void 0}}let tn={encode:(e,t=ec().Writer.create())=>(void 0!==e.v1&&tr.encode(e.v1,t.uint32(10).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=ti();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.v1=tr.decode(r,r.uint32()):r.skipType(7&s)}return n},fromJSON:e=>({v1:tc(e.v1)?tr.fromJSON(e.v1):void 0}),toJSON(e){let t={};return void 0!==e.v1&&(t.v1=e.v1?tr.toJSON(e.v1):void 0),t},fromPartial(e){let t=ti();return t.v1=void 0!==e.v1&&null!==e.v1?tr.fromPartial(e.v1):void 0,t}};var ts=(()=>{if(void 0!==ts)return ts;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r.g)return r.g;throw"Unable to locate global object"})();function to(e){if(ts.Buffer)return Uint8Array.from(ts.Buffer.from(e,"base64"));{let t=ts.atob(e),r=new Uint8Array(t.length);for(let i=0;i<t.length;++i)r[i]=t.charCodeAt(i);return r}}function ta(e){if(ts.Buffer)return ts.Buffer.from(e).toString("base64");{let t=[];return e.forEach(e=>{t.push(String.fromCharCode(e))}),ts.btoa(t.join(""))}}function tc(e){return null!=e}function td(){return{topic:"",peerAddress:"",createdNs:E.UZERO,context:void 0}}ec().util.Long!==E&&(ec().util.Long=E,ec().configure());let tl={encode:(e,t=ec().Writer.create())=>(""!==e.topic&&t.uint32(10).string(e.topic),""!==e.peerAddress&&t.uint32(18).string(e.peerAddress),e.createdNs.isZero()||t.uint32(24).uint64(e.createdNs),void 0!==e.context&&e8.encode(e.context,t.uint32(34).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=td();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.topic=r.string();break;case 2:n.peerAddress=r.string();break;case 3:n.createdNs=r.uint64();break;case 4:n.context=e8.decode(r,r.uint32());break;default:r.skipType(7&s)}}return n},fromJSON:e=>{var t,r,i,n;return{topic:null!=e.topic?String(e.topic):"",peerAddress:null!=e.peerAddress?String(e.peerAddress):"",createdNs:null!=e.createdNs?E.fromValue(e.createdNs):E.UZERO,context:null!=e.context?e8.fromJSON(e.context):void 0}},toJSON(e){let t={};return void 0!==e.topic&&(t.topic=e.topic),void 0!==e.peerAddress&&(t.peerAddress=e.peerAddress),void 0!==e.createdNs&&(t.createdNs=(e.createdNs||E.UZERO).toString()),void 0!==e.context&&(t.context=e.context?e8.toJSON(e.context):void 0),t},fromPartial(e){var t,r;let i=td();return i.topic=null!==(t=e.topic)&&void 0!==t?t:"",i.peerAddress=null!==(r=e.peerAddress)&&void 0!==r?r:"",i.createdNs=void 0!==e.createdNs&&null!==e.createdNs?E.fromValue(e.createdNs):E.UZERO,i.context=void 0!==e.context&&null!==e.context?e8.fromPartial(e.context):void 0,i}};function tu(){return{sender:void 0,recipient:void 0,timestamp:E.UZERO}}ec().util.Long!==E&&(ec().util.Long=E,ec().configure());let tp={encode:(e,t=ec().Writer.create())=>(void 0!==e.sender&&eP.encode(e.sender,t.uint32(10).fork()).ldelim(),void 0!==e.recipient&&eP.encode(e.recipient,t.uint32(18).fork()).ldelim(),e.timestamp.isZero()||t.uint32(24).uint64(e.timestamp),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=tu();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.sender=eP.decode(r,r.uint32());break;case 2:n.recipient=eP.decode(r,r.uint32());break;case 3:n.timestamp=r.uint64();break;default:r.skipType(7&s)}}return n},fromJSON:e=>({sender:tA(e.sender)?eP.fromJSON(e.sender):void 0,recipient:tA(e.recipient)?eP.fromJSON(e.recipient):void 0,timestamp:tA(e.timestamp)?E.fromValue(e.timestamp):E.UZERO}),toJSON(e){let t={};return void 0!==e.sender&&(t.sender=e.sender?eP.toJSON(e.sender):void 0),void 0!==e.recipient&&(t.recipient=e.recipient?eP.toJSON(e.recipient):void 0),void 0!==e.timestamp&&(t.timestamp=(e.timestamp||E.UZERO).toString()),t},fromPartial(e){let t=tu();return t.sender=void 0!==e.sender&&null!==e.sender?eP.fromPartial(e.sender):void 0,t.recipient=void 0!==e.recipient&&null!==e.recipient?eP.fromPartial(e.recipient):void 0,t.timestamp=void 0!==e.timestamp&&null!==e.timestamp?E.fromValue(e.timestamp):E.UZERO,t}};function ty(){return{headerBytes:new Uint8Array,ciphertext:void 0}}let th={encode:(e,t=ec().Writer.create())=>(0!==e.headerBytes.length&&t.uint32(10).bytes(e.headerBytes),void 0!==e.ciphertext&&eL.encode(e.ciphertext,t.uint32(18).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=ty();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.headerBytes=r.bytes();break;case 2:n.ciphertext=eL.decode(r,r.uint32());break;default:r.skipType(7&s)}}return n},fromJSON:e=>({headerBytes:tA(e.headerBytes)?tE(e.headerBytes):new Uint8Array,ciphertext:tA(e.ciphertext)?eL.fromJSON(e.ciphertext):void 0}),toJSON(e){let t={};return void 0!==e.headerBytes&&(t.headerBytes=tO(void 0!==e.headerBytes?e.headerBytes:new Uint8Array)),void 0!==e.ciphertext&&(t.ciphertext=e.ciphertext?eL.toJSON(e.ciphertext):void 0),t},fromPartial(e){var t;let r=ty();return r.headerBytes=null!==(t=e.headerBytes)&&void 0!==t?t:new Uint8Array,r.ciphertext=void 0!==e.ciphertext&&null!==e.ciphertext?eL.fromPartial(e.ciphertext):void 0,r}};function tf(){return{createdNs:E.UZERO,topic:""}}let tv={encode:(e,t=ec().Writer.create())=>(e.createdNs.isZero()||t.uint32(8).uint64(e.createdNs),""!==e.topic&&t.uint32(18).string(e.topic),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=tf();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.createdNs=r.uint64();break;case 2:n.topic=r.string();break;default:r.skipType(7&s)}}return n},fromJSON:e=>({createdNs:tA(e.createdNs)?E.fromValue(e.createdNs):E.UZERO,topic:tA(e.topic)?String(e.topic):""}),toJSON(e){let t={};return void 0!==e.createdNs&&(t.createdNs=(e.createdNs||E.UZERO).toString()),void 0!==e.topic&&(t.topic=e.topic),t},fromPartial(e){var t;let r=tf();return r.createdNs=void 0!==e.createdNs&&null!==e.createdNs?E.fromValue(e.createdNs):E.UZERO,r.topic=null!==(t=e.topic)&&void 0!==t?t:"",r}};function tm(){return{headerBytes:new Uint8Array,ciphertext:void 0}}let tg={encode:(e,t=ec().Writer.create())=>(0!==e.headerBytes.length&&t.uint32(10).bytes(e.headerBytes),void 0!==e.ciphertext&&eL.encode(e.ciphertext,t.uint32(18).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=tm();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.headerBytes=r.bytes();break;case 2:n.ciphertext=eL.decode(r,r.uint32());break;default:r.skipType(7&s)}}return n},fromJSON:e=>({headerBytes:tA(e.headerBytes)?tE(e.headerBytes):new Uint8Array,ciphertext:tA(e.ciphertext)?eL.fromJSON(e.ciphertext):void 0}),toJSON(e){let t={};return void 0!==e.headerBytes&&(t.headerBytes=tO(void 0!==e.headerBytes?e.headerBytes:new Uint8Array)),void 0!==e.ciphertext&&(t.ciphertext=e.ciphertext?eL.toJSON(e.ciphertext):void 0),t},fromPartial(e){var t;let r=tm();return r.headerBytes=null!==(t=e.headerBytes)&&void 0!==t?t:new Uint8Array,r.ciphertext=void 0!==e.ciphertext&&null!==e.ciphertext?eL.fromPartial(e.ciphertext):void 0,r}};function tw(){return{v1:void 0,v2:void 0}}let tb={encode:(e,t=ec().Writer.create())=>(void 0!==e.v1&&th.encode(e.v1,t.uint32(10).fork()).ldelim(),void 0!==e.v2&&tg.encode(e.v2,t.uint32(18).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=tw();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.v1=th.decode(r,r.uint32());break;case 2:n.v2=tg.decode(r,r.uint32());break;default:r.skipType(7&s)}}return n},fromJSON:e=>({v1:tA(e.v1)?th.fromJSON(e.v1):void 0,v2:tA(e.v2)?tg.fromJSON(e.v2):void 0}),toJSON(e){let t={};return void 0!==e.v1&&(t.v1=e.v1?th.toJSON(e.v1):void 0),void 0!==e.v2&&(t.v2=e.v2?tg.toJSON(e.v2):void 0),t},fromPartial(e){let t=tw();return t.v1=void 0!==e.v1&&null!==e.v1?th.fromPartial(e.v1):void 0,t.v2=void 0!==e.v2&&null!==e.v2?tg.fromPartial(e.v2):void 0,t}};function tS(){return{id:"",messageVersion:"",senderAddress:"",recipientAddress:void 0,sentNs:E.UZERO,contentTopic:"",conversation:void 0,contentBytes:new Uint8Array}}let tk={encode:(e,t=ec().Writer.create())=>(""!==e.id&&t.uint32(10).string(e.id),""!==e.messageVersion&&t.uint32(18).string(e.messageVersion),""!==e.senderAddress&&t.uint32(26).string(e.senderAddress),void 0!==e.recipientAddress&&t.uint32(34).string(e.recipientAddress),e.sentNs.isZero()||t.uint32(40).uint64(e.sentNs),""!==e.contentTopic&&t.uint32(50).string(e.contentTopic),void 0!==e.conversation&&tl.encode(e.conversation,t.uint32(58).fork()).ldelim(),0!==e.contentBytes.length&&t.uint32(66).bytes(e.contentBytes),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=tS();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.id=r.string();break;case 2:n.messageVersion=r.string();break;case 3:n.senderAddress=r.string();break;case 4:n.recipientAddress=r.string();break;case 5:n.sentNs=r.uint64();break;case 6:n.contentTopic=r.string();break;case 7:n.conversation=tl.decode(r,r.uint32());break;case 8:n.contentBytes=r.bytes();break;default:r.skipType(7&s)}}return n},fromJSON:e=>({id:tA(e.id)?String(e.id):"",messageVersion:tA(e.messageVersion)?String(e.messageVersion):"",senderAddress:tA(e.senderAddress)?String(e.senderAddress):"",recipientAddress:tA(e.recipientAddress)?String(e.recipientAddress):void 0,sentNs:tA(e.sentNs)?E.fromValue(e.sentNs):E.UZERO,contentTopic:tA(e.contentTopic)?String(e.contentTopic):"",conversation:tA(e.conversation)?tl.fromJSON(e.conversation):void 0,contentBytes:tA(e.contentBytes)?tE(e.contentBytes):new Uint8Array}),toJSON(e){let t={};return void 0!==e.id&&(t.id=e.id),void 0!==e.messageVersion&&(t.messageVersion=e.messageVersion),void 0!==e.senderAddress&&(t.senderAddress=e.senderAddress),void 0!==e.recipientAddress&&(t.recipientAddress=e.recipientAddress),void 0!==e.sentNs&&(t.sentNs=(e.sentNs||E.UZERO).toString()),void 0!==e.contentTopic&&(t.contentTopic=e.contentTopic),void 0!==e.conversation&&(t.conversation=e.conversation?tl.toJSON(e.conversation):void 0),void 0!==e.contentBytes&&(t.contentBytes=tO(void 0!==e.contentBytes?e.contentBytes:new Uint8Array)),t},fromPartial(e){var t,r,i,n,s,o;let a=tS();return a.id=null!==(t=e.id)&&void 0!==t?t:"",a.messageVersion=null!==(r=e.messageVersion)&&void 0!==r?r:"",a.senderAddress=null!==(i=e.senderAddress)&&void 0!==i?i:"",a.recipientAddress=null!==(n=e.recipientAddress)&&void 0!==n?n:void 0,a.sentNs=void 0!==e.sentNs&&null!==e.sentNs?E.fromValue(e.sentNs):E.UZERO,a.contentTopic=null!==(s=e.contentTopic)&&void 0!==s?s:"",a.conversation=void 0!==e.conversation&&null!==e.conversation?tl.fromPartial(e.conversation):void 0,a.contentBytes=null!==(o=e.contentBytes)&&void 0!==o?o:new Uint8Array,a}};var tN=(()=>{if(void 0!==tN)return tN;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r.g)return r.g;throw"Unable to locate global object"})();function tE(e){if(tN.Buffer)return Uint8Array.from(tN.Buffer.from(e,"base64"));{let t=tN.atob(e),r=new Uint8Array(t.length);for(let i=0;i<t.length;++i)r[i]=t.charCodeAt(i);return r}}function tO(e){if(tN.Buffer)return tN.Buffer.from(e).toString("base64");{let t=[];return e.forEach(e=>{t.push(String.fromCharCode(e))}),tN.btoa(t.join(""))}}function tA(e){return null!=e}ec().util.Long!==E&&(ec().util.Long=E,ec().configure());let tK="xmtp.message_contents";function tB(e){switch(e){case 0:case"COMPRESSION_DEFLATE":return l.COMPRESSION_DEFLATE;case 1:case"COMPRESSION_GZIP":return l.COMPRESSION_GZIP;default:return l.UNRECOGNIZED}}function tR(e){switch(e){case l.COMPRESSION_DEFLATE:return"COMPRESSION_DEFLATE";case l.COMPRESSION_GZIP:return"COMPRESSION_GZIP";case l.UNRECOGNIZED:default:return"UNRECOGNIZED"}}function tT(){return{authorityId:"",typeId:"",versionMajor:0,versionMinor:0}}(o=l||(l={}))[o.COMPRESSION_DEFLATE=0]="COMPRESSION_DEFLATE",o[o.COMPRESSION_GZIP=1]="COMPRESSION_GZIP",o[o.UNRECOGNIZED=-1]="UNRECOGNIZED";let tU={encode:(e,t=ec().Writer.create())=>(""!==e.authorityId&&t.uint32(10).string(e.authorityId),""!==e.typeId&&t.uint32(18).string(e.typeId),0!==e.versionMajor&&t.uint32(24).uint32(e.versionMajor),0!==e.versionMinor&&t.uint32(32).uint32(e.versionMinor),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=tT();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.authorityId=r.string();break;case 2:n.typeId=r.string();break;case 3:n.versionMajor=r.uint32();break;case 4:n.versionMinor=r.uint32();break;default:r.skipType(7&s)}}return n},fromJSON:e=>({authorityId:tV(e.authorityId)?String(e.authorityId):"",typeId:tV(e.typeId)?String(e.typeId):"",versionMajor:tV(e.versionMajor)?Number(e.versionMajor):0,versionMinor:tV(e.versionMinor)?Number(e.versionMinor):0}),toJSON(e){let t={};return void 0!==e.authorityId&&(t.authorityId=e.authorityId),void 0!==e.typeId&&(t.typeId=e.typeId),void 0!==e.versionMajor&&(t.versionMajor=Math.round(e.versionMajor)),void 0!==e.versionMinor&&(t.versionMinor=Math.round(e.versionMinor)),t},fromPartial(e){var t,r,i,n;let s=tT();return s.authorityId=null!==(t=e.authorityId)&&void 0!==t?t:"",s.typeId=null!==(r=e.typeId)&&void 0!==r?r:"",s.versionMajor=null!==(i=e.versionMajor)&&void 0!==i?i:0,s.versionMinor=null!==(n=e.versionMinor)&&void 0!==n?n:0,s}};function tP(){return{type:void 0,parameters:{},fallback:void 0,compression:void 0,content:new Uint8Array}}let tx={encode:(e,t=ec().Writer.create())=>(void 0!==e.type&&tU.encode(e.type,t.uint32(10).fork()).ldelim(),Object.entries(e.parameters).forEach(([e,r])=>{tC.encode({key:e,value:r},t.uint32(18).fork()).ldelim()}),void 0!==e.fallback&&t.uint32(26).string(e.fallback),void 0!==e.compression&&t.uint32(40).int32(e.compression),0!==e.content.length&&t.uint32(34).bytes(e.content),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=tP();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.type=tU.decode(r,r.uint32());break;case 2:let o=tC.decode(r,r.uint32());void 0!==o.value&&(n.parameters[o.key]=o.value);break;case 3:n.fallback=r.string();break;case 5:n.compression=r.int32();break;case 4:n.content=r.bytes();break;default:r.skipType(7&s)}}return n},fromJSON:e=>{var t;return{type:tV(e.type)?tU.fromJSON(e.type):void 0,parameters:"object"==typeof(t=e.parameters)&&null!==t?Object.entries(e.parameters).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{},fallback:tV(e.fallback)?String(e.fallback):void 0,compression:tV(e.compression)?tB(e.compression):void 0,content:tV(e.content)?tM(e.content):new Uint8Array}},toJSON(e){let t={};return void 0!==e.type&&(t.type=e.type?tU.toJSON(e.type):void 0),t.parameters={},e.parameters&&Object.entries(e.parameters).forEach(([e,r])=>{t.parameters[e]=r}),void 0!==e.fallback&&(t.fallback=e.fallback),void 0!==e.compression&&(t.compression=void 0!==e.compression?tR(e.compression):void 0),void 0!==e.content&&(t.content=tq(void 0!==e.content?e.content:new Uint8Array)),t},fromPartial(e){var t,r,i,n;let s=tP();return s.type=void 0!==e.type&&null!==e.type?tU.fromPartial(e.type):void 0,s.parameters=Object.entries(null!==(t=e.parameters)&&void 0!==t?t:{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=String(r)),e),{}),s.fallback=null!==(r=e.fallback)&&void 0!==r?r:void 0,s.compression=null!==(i=e.compression)&&void 0!==i?i:void 0,s.content=null!==(n=e.content)&&void 0!==n?n:new Uint8Array,s}};function tI(){return{key:"",value:""}}let tC={encode:(e,t=ec().Writer.create())=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=tI();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.key=r.string();break;case 2:n.value=r.string();break;default:r.skipType(7&s)}}return n},fromJSON:e=>({key:tV(e.key)?String(e.key):"",value:tV(e.value)?String(e.value):""}),toJSON(e){let t={};return void 0!==e.key&&(t.key=e.key),void 0!==e.value&&(t.value=e.value),t},fromPartial(e){var t,r;let i=tI();return i.key=null!==(t=e.key)&&void 0!==t?t:"",i.value=null!==(r=e.value)&&void 0!==r?r:"",i}};function t_(){return{payload:new Uint8Array,sender:void 0,signature:void 0}}let tJ={encode:(e,t=ec().Writer.create())=>(0!==e.payload.length&&t.uint32(10).bytes(e.payload),void 0!==e.sender&&eA.encode(e.sender,t.uint32(18).fork()).ldelim(),void 0!==e.signature&&el.encode(e.signature,t.uint32(26).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=t_();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.payload=r.bytes();break;case 2:n.sender=eA.decode(r,r.uint32());break;case 3:n.signature=el.decode(r,r.uint32());break;default:r.skipType(7&s)}}return n},fromJSON:e=>({payload:tV(e.payload)?tM(e.payload):new Uint8Array,sender:tV(e.sender)?eA.fromJSON(e.sender):void 0,signature:tV(e.signature)?el.fromJSON(e.signature):void 0}),toJSON(e){let t={};return void 0!==e.payload&&(t.payload=tq(void 0!==e.payload?e.payload:new Uint8Array)),void 0!==e.sender&&(t.sender=e.sender?eA.toJSON(e.sender):void 0),void 0!==e.signature&&(t.signature=e.signature?el.toJSON(e.signature):void 0),t},fromPartial(e){var t;let r=t_();return r.payload=null!==(t=e.payload)&&void 0!==t?t:new Uint8Array,r.sender=void 0!==e.sender&&null!==e.sender?eA.fromPartial(e.sender):void 0,r.signature=void 0!==e.signature&&null!==e.signature?el.fromPartial(e.signature):void 0,r}};var tD=(()=>{if(void 0!==tD)return tD;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r.g)return r.g;throw"Unable to locate global object"})();function tM(e){if(tD.Buffer)return Uint8Array.from(tD.Buffer.from(e,"base64"));{let t=tD.atob(e),r=new Uint8Array(t.length);for(let i=0;i<t.length;++i)r[i]=t.charCodeAt(i);return r}}function tq(e){if(tD.Buffer)return tD.Buffer.from(e).toString("base64");{let t=[];return e.forEach(e=>{t.push(String.fromCharCode(e))}),tD.btoa(t.join(""))}}function tV(e){return null!=e}function tj(){return{parts:[]}}ec().util.Long!==E&&(ec().util.Long=E,ec().configure());let tZ={encode(e,t=ec().Writer.create()){for(let r of e.parts)tW.encode(r,t.uint32(10).fork()).ldelim();return t},decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=tj();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.parts.push(tW.decode(r,r.uint32())):r.skipType(7&s)}return n},fromJSON:e=>({parts:Array.isArray(null==e?void 0:e.parts)?e.parts.map(e=>tW.fromJSON(e)):[]}),toJSON(e){let t={};return e.parts?t.parts=e.parts.map(e=>e?tW.toJSON(e):void 0):t.parts=[],t},fromPartial(e){var t;let r=tj();return r.parts=(null===(t=e.parts)||void 0===t?void 0:t.map(e=>tW.fromPartial(e)))||[],r}};function tL(){return{part:void 0,composite:void 0}}let tW={encode:(e,t=ec().Writer.create())=>(void 0!==e.part&&tx.encode(e.part,t.uint32(10).fork()).ldelim(),void 0!==e.composite&&tZ.encode(e.composite,t.uint32(18).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=tL();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.part=tx.decode(r,r.uint32());break;case 2:n.composite=tZ.decode(r,r.uint32());break;default:r.skipType(7&s)}}return n},fromJSON:e=>{var t,r;return{part:null!=e.part?tx.fromJSON(e.part):void 0,composite:null!=e.composite?tZ.fromJSON(e.composite):void 0}},toJSON(e){let t={};return void 0!==e.part&&(t.part=e.part?tx.toJSON(e.part):void 0),void 0!==e.composite&&(t.composite=e.composite?tZ.toJSON(e.composite):void 0),t},fromPartial(e){let t=tL();return t.part=void 0!==e.part&&null!==e.part?tx.fromPartial(e.part):void 0,t.composite=void 0!==e.composite&&null!==e.composite?tZ.fromPartial(e.composite):void 0,t}};function tH(){return{createdNs:E.UZERO,secp256k1:void 0,publicKey:void 0}}ec().util.Long!==E&&(ec().util.Long=E,ec().configure());let tG={encode:(e,t=ec().Writer.create())=>(e.createdNs.isZero()||t.uint32(8).uint64(e.createdNs),void 0!==e.secp256k1&&t$.encode(e.secp256k1,t.uint32(18).fork()).ldelim(),void 0!==e.publicKey&&eE.encode(e.publicKey,t.uint32(26).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=tH();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.createdNs=r.uint64();break;case 2:n.secp256k1=t$.decode(r,r.uint32());break;case 3:n.publicKey=eE.decode(r,r.uint32());break;default:r.skipType(7&s)}}return n},fromJSON:e=>({createdNs:ri(e.createdNs)?E.fromValue(e.createdNs):E.UZERO,secp256k1:ri(e.secp256k1)?t$.fromJSON(e.secp256k1):void 0,publicKey:ri(e.publicKey)?eE.fromJSON(e.publicKey):void 0}),toJSON(e){let t={};return void 0!==e.createdNs&&(t.createdNs=(e.createdNs||E.UZERO).toString()),void 0!==e.secp256k1&&(t.secp256k1=e.secp256k1?t$.toJSON(e.secp256k1):void 0),void 0!==e.publicKey&&(t.publicKey=e.publicKey?eE.toJSON(e.publicKey):void 0),t},fromPartial(e){let t=tH();return t.createdNs=void 0!==e.createdNs&&null!==e.createdNs?E.fromValue(e.createdNs):E.UZERO,t.secp256k1=void 0!==e.secp256k1&&null!==e.secp256k1?t$.fromPartial(e.secp256k1):void 0,t.publicKey=void 0!==e.publicKey&&null!==e.publicKey?eE.fromPartial(e.publicKey):void 0,t}};function tF(){return{bytes:new Uint8Array}}let t$={encode:(e,t=ec().Writer.create())=>(0!==e.bytes.length&&t.uint32(10).bytes(e.bytes),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=tF();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.bytes=r.bytes():r.skipType(7&s)}return n},fromJSON:e=>({bytes:ri(e.bytes)?rt(e.bytes):new Uint8Array}),toJSON(e){let t={};return void 0!==e.bytes&&(t.bytes=rr(void 0!==e.bytes?e.bytes:new Uint8Array)),t},fromPartial(e){var t;let r=tF();return r.bytes=null!==(t=e.bytes)&&void 0!==t?t:new Uint8Array,r}};function tz(){return{identityKey:void 0,preKeys:[]}}let tX={encode(e,t=ec().Writer.create()){for(let r of(void 0!==e.identityKey&&tG.encode(e.identityKey,t.uint32(10).fork()).ldelim(),e.preKeys))tG.encode(r,t.uint32(18).fork()).ldelim();return t},decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=tz();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.identityKey=tG.decode(r,r.uint32());break;case 2:n.preKeys.push(tG.decode(r,r.uint32()));break;default:r.skipType(7&s)}}return n},fromJSON:e=>({identityKey:ri(e.identityKey)?tG.fromJSON(e.identityKey):void 0,preKeys:Array.isArray(null==e?void 0:e.preKeys)?e.preKeys.map(e=>tG.fromJSON(e)):[]}),toJSON(e){let t={};return void 0!==e.identityKey&&(t.identityKey=e.identityKey?tG.toJSON(e.identityKey):void 0),e.preKeys?t.preKeys=e.preKeys.map(e=>e?tG.toJSON(e):void 0):t.preKeys=[],t},fromPartial(e){var t;let r=tz();return r.identityKey=void 0!==e.identityKey&&null!==e.identityKey?tG.fromPartial(e.identityKey):void 0,r.preKeys=(null===(t=e.preKeys)||void 0===t?void 0:t.map(e=>tG.fromPartial(e)))||[],r}};function tY(){return{timestamp:E.UZERO,secp256k1:void 0,publicKey:void 0}}let tQ={encode:(e,t=ec().Writer.create())=>(e.timestamp.isZero()||t.uint32(8).uint64(e.timestamp),void 0!==e.secp256k1&&t2.encode(e.secp256k1,t.uint32(18).fork()).ldelim(),void 0!==e.publicKey&&eB.encode(e.publicKey,t.uint32(26).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=tY();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.timestamp=r.uint64();break;case 2:n.secp256k1=t2.decode(r,r.uint32());break;case 3:n.publicKey=eB.decode(r,r.uint32());break;default:r.skipType(7&s)}}return n},fromJSON:e=>({timestamp:ri(e.timestamp)?E.fromValue(e.timestamp):E.UZERO,secp256k1:ri(e.secp256k1)?t2.fromJSON(e.secp256k1):void 0,publicKey:ri(e.publicKey)?eB.fromJSON(e.publicKey):void 0}),toJSON(e){let t={};return void 0!==e.timestamp&&(t.timestamp=(e.timestamp||E.UZERO).toString()),void 0!==e.secp256k1&&(t.secp256k1=e.secp256k1?t2.toJSON(e.secp256k1):void 0),void 0!==e.publicKey&&(t.publicKey=e.publicKey?eB.toJSON(e.publicKey):void 0),t},fromPartial(e){let t=tY();return t.timestamp=void 0!==e.timestamp&&null!==e.timestamp?E.fromValue(e.timestamp):E.UZERO,t.secp256k1=void 0!==e.secp256k1&&null!==e.secp256k1?t2.fromPartial(e.secp256k1):void 0,t.publicKey=void 0!==e.publicKey&&null!==e.publicKey?eB.fromPartial(e.publicKey):void 0,t}};function t0(){return{bytes:new Uint8Array}}let t2={encode:(e,t=ec().Writer.create())=>(0!==e.bytes.length&&t.uint32(10).bytes(e.bytes),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=t0();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.bytes=r.bytes():r.skipType(7&s)}return n},fromJSON:e=>({bytes:ri(e.bytes)?rt(e.bytes):new Uint8Array}),toJSON(e){let t={};return void 0!==e.bytes&&(t.bytes=rr(void 0!==e.bytes?e.bytes:new Uint8Array)),t},fromPartial(e){var t;let r=t0();return r.bytes=null!==(t=e.bytes)&&void 0!==t?t:new Uint8Array,r}};function t1(){return{identityKey:void 0,preKeys:[]}}let t3={encode(e,t=ec().Writer.create()){for(let r of(void 0!==e.identityKey&&tQ.encode(e.identityKey,t.uint32(10).fork()).ldelim(),e.preKeys))tQ.encode(r,t.uint32(18).fork()).ldelim();return t},decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=t1();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.identityKey=tQ.decode(r,r.uint32());break;case 2:n.preKeys.push(tQ.decode(r,r.uint32()));break;default:r.skipType(7&s)}}return n},fromJSON:e=>({identityKey:ri(e.identityKey)?tQ.fromJSON(e.identityKey):void 0,preKeys:Array.isArray(null==e?void 0:e.preKeys)?e.preKeys.map(e=>tQ.fromJSON(e)):[]}),toJSON(e){let t={};return void 0!==e.identityKey&&(t.identityKey=e.identityKey?tQ.toJSON(e.identityKey):void 0),e.preKeys?t.preKeys=e.preKeys.map(e=>e?tQ.toJSON(e):void 0):t.preKeys=[],t},fromPartial(e){var t;let r=t1();return r.identityKey=void 0!==e.identityKey&&null!==e.identityKey?tQ.fromPartial(e.identityKey):void 0,r.preKeys=(null===(t=e.preKeys)||void 0===t?void 0:t.map(e=>tQ.fromPartial(e)))||[],r}};function t6(){return{v1:void 0,v2:void 0}}let t5={encode:(e,t=ec().Writer.create())=>(void 0!==e.v1&&t3.encode(e.v1,t.uint32(10).fork()).ldelim(),void 0!==e.v2&&tX.encode(e.v2,t.uint32(18).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=t6();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.v1=t3.decode(r,r.uint32());break;case 2:n.v2=tX.decode(r,r.uint32());break;default:r.skipType(7&s)}}return n},fromJSON:e=>({v1:ri(e.v1)?t3.fromJSON(e.v1):void 0,v2:ri(e.v2)?tX.fromJSON(e.v2):void 0}),toJSON(e){let t={};return void 0!==e.v1&&(t.v1=e.v1?t3.toJSON(e.v1):void 0),void 0!==e.v2&&(t.v2=e.v2?tX.toJSON(e.v2):void 0),t},fromPartial(e){let t=t6();return t.v1=void 0!==e.v1&&null!==e.v1?t3.fromPartial(e.v1):void 0,t.v2=void 0!==e.v2&&null!==e.v2?tX.fromPartial(e.v2):void 0,t}};function t8(){return{walletPreKey:new Uint8Array,ciphertext:void 0}}let t4={encode:(e,t=ec().Writer.create())=>(0!==e.walletPreKey.length&&t.uint32(10).bytes(e.walletPreKey),void 0!==e.ciphertext&&eL.encode(e.ciphertext,t.uint32(18).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=t8();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.walletPreKey=r.bytes();break;case 2:n.ciphertext=eL.decode(r,r.uint32());break;default:r.skipType(7&s)}}return n},fromJSON:e=>({walletPreKey:ri(e.walletPreKey)?rt(e.walletPreKey):new Uint8Array,ciphertext:ri(e.ciphertext)?eL.fromJSON(e.ciphertext):void 0}),toJSON(e){let t={};return void 0!==e.walletPreKey&&(t.walletPreKey=rr(void 0!==e.walletPreKey?e.walletPreKey:new Uint8Array)),void 0!==e.ciphertext&&(t.ciphertext=e.ciphertext?eL.toJSON(e.ciphertext):void 0),t},fromPartial(e){var t;let r=t8();return r.walletPreKey=null!==(t=e.walletPreKey)&&void 0!==t?t:new Uint8Array,r.ciphertext=void 0!==e.ciphertext&&null!==e.ciphertext?eL.fromPartial(e.ciphertext):void 0,r}};function t7(){return{v1:void 0}}let t9={encode:(e,t=ec().Writer.create())=>(void 0!==e.v1&&t4.encode(e.v1,t.uint32(10).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=t7();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.v1=t4.decode(r,r.uint32()):r.skipType(7&s)}return n},fromJSON:e=>({v1:ri(e.v1)?t4.fromJSON(e.v1):void 0}),toJSON(e){let t={};return void 0!==e.v1&&(t.v1=e.v1?t4.toJSON(e.v1):void 0),t},fromPartial(e){let t=t7();return t.v1=void 0!==e.v1&&null!==e.v1?t4.fromPartial(e.v1):void 0,t}};var re=(()=>{if(void 0!==re)return re;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r.g)return r.g;throw"Unable to locate global object"})();function rt(e){if(re.Buffer)return Uint8Array.from(re.Buffer.from(e,"base64"));{let t=re.atob(e),r=new Uint8Array(t.length);for(let i=0;i<t.length;++i)r[i]=t.charCodeAt(i);return r}}function rr(e){if(re.Buffer)return re.Buffer.from(e).toString("base64");{let t=[];return e.forEach(e=>{t.push(String.fromCharCode(e))}),re.btoa(t.join(""))}}function ri(e){return null!=e}function rn(){return{keyBundle:void 0}}ec().util.Long!==E&&(ec().util.Long=E,ec().configure());let rs={encode:(e,t=ec().Writer.create())=>(void 0!==e.keyBundle&&eP.encode(e.keyBundle,t.uint32(10).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=rn();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.keyBundle=eP.decode(r,r.uint32()):r.skipType(7&s)}return n},fromJSON:e=>{var t;return{keyBundle:null!=e.keyBundle?eP.fromJSON(e.keyBundle):void 0}},toJSON(e){let t={};return void 0!==e.keyBundle&&(t.keyBundle=e.keyBundle?eP.toJSON(e.keyBundle):void 0),t},fromPartial(e){let t=rn();return t.keyBundle=void 0!==e.keyBundle&&null!==e.keyBundle?eP.fromPartial(e.keyBundle):void 0,t}};function ro(){return{keyBundle:void 0}}let ra={encode:(e,t=ec().Writer.create())=>(void 0!==e.keyBundle&&eA.encode(e.keyBundle,t.uint32(10).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=ro();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.keyBundle=eA.decode(r,r.uint32()):r.skipType(7&s)}return n},fromJSON:e=>{var t;return{keyBundle:null!=e.keyBundle?eA.fromJSON(e.keyBundle):void 0}},toJSON(e){let t={};return void 0!==e.keyBundle&&(t.keyBundle=e.keyBundle?eA.toJSON(e.keyBundle):void 0),t},fromPartial(e){let t=ro();return t.keyBundle=void 0!==e.keyBundle&&null!==e.keyBundle?eA.fromPartial(e.keyBundle):void 0,t}};function rc(){return{v1:void 0,v2:void 0}}let rd={encode:(e,t=ec().Writer.create())=>(void 0!==e.v1&&rs.encode(e.v1,t.uint32(10).fork()).ldelim(),void 0!==e.v2&&ra.encode(e.v2,t.uint32(18).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=rc();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.v1=rs.decode(r,r.uint32());break;case 2:n.v2=ra.decode(r,r.uint32());break;default:r.skipType(7&s)}}return n},fromJSON:e=>{var t,r;return{v1:null!=e.v1?rs.fromJSON(e.v1):void 0,v2:null!=e.v2?ra.fromJSON(e.v2):void 0}},toJSON(e){let t={};return void 0!==e.v1&&(t.v1=e.v1?rs.toJSON(e.v1):void 0),void 0!==e.v2&&(t.v2=e.v2?ra.toJSON(e.v2):void 0),t},fromPartial(e){let t=rc();return t.v1=void 0!==e.v1&&null!==e.v1?rs.fromPartial(e.v1):void 0,t.v2=void 0!==e.v2&&null!==e.v2?ra.fromPartial(e.v2):void 0,t}};ec().util.Long!==E&&(ec().util.Long=E,ec().configure());let rl="xmtp.keystore_api.v1";function ru(e){switch(e){case 0:case"ERROR_CODE_UNSPECIFIED":return u.ERROR_CODE_UNSPECIFIED;case 1:case"ERROR_CODE_INVALID_INPUT":return u.ERROR_CODE_INVALID_INPUT;case 2:case"ERROR_CODE_NO_MATCHING_PREKEY":return u.ERROR_CODE_NO_MATCHING_PREKEY;default:return u.UNRECOGNIZED}}function rp(e){switch(e){case u.ERROR_CODE_UNSPECIFIED:return"ERROR_CODE_UNSPECIFIED";case u.ERROR_CODE_INVALID_INPUT:return"ERROR_CODE_INVALID_INPUT";case u.ERROR_CODE_NO_MATCHING_PREKEY:return"ERROR_CODE_NO_MATCHING_PREKEY";case u.UNRECOGNIZED:default:return"UNRECOGNIZED"}}function ry(e){switch(e){case 0:case"KEYSTORE_STATUS_UNSPECIFIED":return p.KEYSTORE_STATUS_UNSPECIFIED;case 1:case"KEYSTORE_STATUS_UNINITIALIZED":return p.KEYSTORE_STATUS_UNINITIALIZED;case 2:case"KEYSTORE_STATUS_INITIALIZED":return p.KEYSTORE_STATUS_INITIALIZED;default:return p.UNRECOGNIZED}}function rh(e){switch(e){case p.KEYSTORE_STATUS_UNSPECIFIED:return"KEYSTORE_STATUS_UNSPECIFIED";case p.KEYSTORE_STATUS_UNINITIALIZED:return"KEYSTORE_STATUS_UNINITIALIZED";case p.KEYSTORE_STATUS_INITIALIZED:return"KEYSTORE_STATUS_INITIALIZED";case p.UNRECOGNIZED:default:return"UNRECOGNIZED"}}function rf(){return{message:"",code:0}}(a=u||(u={}))[a.ERROR_CODE_UNSPECIFIED=0]="ERROR_CODE_UNSPECIFIED",a[a.ERROR_CODE_INVALID_INPUT=1]="ERROR_CODE_INVALID_INPUT",a[a.ERROR_CODE_NO_MATCHING_PREKEY=2]="ERROR_CODE_NO_MATCHING_PREKEY",a[a.UNRECOGNIZED=-1]="UNRECOGNIZED",(c=p||(p={}))[c.KEYSTORE_STATUS_UNSPECIFIED=0]="KEYSTORE_STATUS_UNSPECIFIED",c[c.KEYSTORE_STATUS_UNINITIALIZED=1]="KEYSTORE_STATUS_UNINITIALIZED",c[c.KEYSTORE_STATUS_INITIALIZED=2]="KEYSTORE_STATUS_INITIALIZED",c[c.UNRECOGNIZED=-1]="UNRECOGNIZED";let rv={encode:(e,t=ec().Writer.create())=>(""!==e.message&&t.uint32(10).string(e.message),0!==e.code&&t.uint32(16).int32(e.code),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=rf();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.message=r.string();break;case 2:n.code=r.int32();break;default:r.skipType(7&s)}}return n},fromJSON:e=>({message:iA(e.message)?String(e.message):"",code:iA(e.code)?ru(e.code):0}),toJSON(e){let t={};return void 0!==e.message&&(t.message=e.message),void 0!==e.code&&(t.code=rp(e.code)),t},fromPartial(e){var t,r;let i=rf();return i.message=null!==(t=e.message)&&void 0!==t?t:"",i.code=null!==(r=e.code)&&void 0!==r?r:0,i}};function rm(){return{requests:[]}}let rg={encode(e,t=ec().Writer.create()){for(let r of e.requests)rb.encode(r,t.uint32(10).fork()).ldelim();return t},decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=rm();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.requests.push(rb.decode(r,r.uint32())):r.skipType(7&s)}return n},fromJSON:e=>({requests:Array.isArray(null==e?void 0:e.requests)?e.requests.map(e=>rb.fromJSON(e)):[]}),toJSON(e){let t={};return e.requests?t.requests=e.requests.map(e=>e?rb.toJSON(e):void 0):t.requests=[],t},fromPartial(e){var t;let r=rm();return r.requests=(null===(t=e.requests)||void 0===t?void 0:t.map(e=>rb.fromPartial(e)))||[],r}};function rw(){return{payload:void 0,peerKeys:void 0,headerBytes:new Uint8Array,isSender:!1}}let rb={encode:(e,t=ec().Writer.create())=>(void 0!==e.payload&&eL.encode(e.payload,t.uint32(10).fork()).ldelim(),void 0!==e.peerKeys&&eP.encode(e.peerKeys,t.uint32(18).fork()).ldelim(),0!==e.headerBytes.length&&t.uint32(26).bytes(e.headerBytes),!0===e.isSender&&t.uint32(32).bool(e.isSender),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=rw();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.payload=eL.decode(r,r.uint32());break;case 2:n.peerKeys=eP.decode(r,r.uint32());break;case 3:n.headerBytes=r.bytes();break;case 4:n.isSender=r.bool();break;default:r.skipType(7&s)}}return n},fromJSON:e=>({payload:iA(e.payload)?eL.fromJSON(e.payload):void 0,peerKeys:iA(e.peerKeys)?eP.fromJSON(e.peerKeys):void 0,headerBytes:iA(e.headerBytes)?iE(e.headerBytes):new Uint8Array,isSender:!!iA(e.isSender)&&Boolean(e.isSender)}),toJSON(e){let t={};return void 0!==e.payload&&(t.payload=e.payload?eL.toJSON(e.payload):void 0),void 0!==e.peerKeys&&(t.peerKeys=e.peerKeys?eP.toJSON(e.peerKeys):void 0),void 0!==e.headerBytes&&(t.headerBytes=iO(void 0!==e.headerBytes?e.headerBytes:new Uint8Array)),void 0!==e.isSender&&(t.isSender=e.isSender),t},fromPartial(e){var t,r;let i=rw();return i.payload=void 0!==e.payload&&null!==e.payload?eL.fromPartial(e.payload):void 0,i.peerKeys=void 0!==e.peerKeys&&null!==e.peerKeys?eP.fromPartial(e.peerKeys):void 0,i.headerBytes=null!==(t=e.headerBytes)&&void 0!==t?t:new Uint8Array,i.isSender=null!==(r=e.isSender)&&void 0!==r&&r,i}};function rS(){return{responses:[]}}let rk={encode(e,t=ec().Writer.create()){for(let r of e.responses)rE.encode(r,t.uint32(10).fork()).ldelim();return t},decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=rS();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.responses.push(rE.decode(r,r.uint32())):r.skipType(7&s)}return n},fromJSON:e=>({responses:Array.isArray(null==e?void 0:e.responses)?e.responses.map(e=>rE.fromJSON(e)):[]}),toJSON(e){let t={};return e.responses?t.responses=e.responses.map(e=>e?rE.toJSON(e):void 0):t.responses=[],t},fromPartial(e){var t;let r=rS();return r.responses=(null===(t=e.responses)||void 0===t?void 0:t.map(e=>rE.fromPartial(e)))||[],r}};function rN(){return{result:void 0,error:void 0}}let rE={encode:(e,t=ec().Writer.create())=>(void 0!==e.result&&rA.encode(e.result,t.uint32(10).fork()).ldelim(),void 0!==e.error&&rv.encode(e.error,t.uint32(18).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=rN();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.result=rA.decode(r,r.uint32());break;case 2:n.error=rv.decode(r,r.uint32());break;default:r.skipType(7&s)}}return n},fromJSON:e=>({result:iA(e.result)?rA.fromJSON(e.result):void 0,error:iA(e.error)?rv.fromJSON(e.error):void 0}),toJSON(e){let t={};return void 0!==e.result&&(t.result=e.result?rA.toJSON(e.result):void 0),void 0!==e.error&&(t.error=e.error?rv.toJSON(e.error):void 0),t},fromPartial(e){let t=rN();return t.result=void 0!==e.result&&null!==e.result?rA.fromPartial(e.result):void 0,t.error=void 0!==e.error&&null!==e.error?rv.fromPartial(e.error):void 0,t}};function rO(){return{decrypted:new Uint8Array}}let rA={encode:(e,t=ec().Writer.create())=>(0!==e.decrypted.length&&t.uint32(10).bytes(e.decrypted),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=rO();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.decrypted=r.bytes():r.skipType(7&s)}return n},fromJSON:e=>({decrypted:iA(e.decrypted)?iE(e.decrypted):new Uint8Array}),toJSON(e){let t={};return void 0!==e.decrypted&&(t.decrypted=iO(void 0!==e.decrypted?e.decrypted:new Uint8Array)),t},fromPartial(e){var t;let r=rO();return r.decrypted=null!==(t=e.decrypted)&&void 0!==t?t:new Uint8Array,r}};function rK(){return{requests:[]}}let rB={encode(e,t=ec().Writer.create()){for(let r of e.requests)rT.encode(r,t.uint32(10).fork()).ldelim();return t},decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=rK();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.requests.push(rT.decode(r,r.uint32())):r.skipType(7&s)}return n},fromJSON:e=>({requests:Array.isArray(null==e?void 0:e.requests)?e.requests.map(e=>rT.fromJSON(e)):[]}),toJSON(e){let t={};return e.requests?t.requests=e.requests.map(e=>e?rT.toJSON(e):void 0):t.requests=[],t},fromPartial(e){var t;let r=rK();return r.requests=(null===(t=e.requests)||void 0===t?void 0:t.map(e=>rT.fromPartial(e)))||[],r}};function rR(){return{payload:void 0,headerBytes:new Uint8Array,contentTopic:""}}let rT={encode:(e,t=ec().Writer.create())=>(void 0!==e.payload&&eL.encode(e.payload,t.uint32(10).fork()).ldelim(),0!==e.headerBytes.length&&t.uint32(18).bytes(e.headerBytes),""!==e.contentTopic&&t.uint32(26).string(e.contentTopic),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=rR();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.payload=eL.decode(r,r.uint32());break;case 2:n.headerBytes=r.bytes();break;case 3:n.contentTopic=r.string();break;default:r.skipType(7&s)}}return n},fromJSON:e=>({payload:iA(e.payload)?eL.fromJSON(e.payload):void 0,headerBytes:iA(e.headerBytes)?iE(e.headerBytes):new Uint8Array,contentTopic:iA(e.contentTopic)?String(e.contentTopic):""}),toJSON(e){let t={};return void 0!==e.payload&&(t.payload=e.payload?eL.toJSON(e.payload):void 0),void 0!==e.headerBytes&&(t.headerBytes=iO(void 0!==e.headerBytes?e.headerBytes:new Uint8Array)),void 0!==e.contentTopic&&(t.contentTopic=e.contentTopic),t},fromPartial(e){var t,r;let i=rR();return i.payload=void 0!==e.payload&&null!==e.payload?eL.fromPartial(e.payload):void 0,i.headerBytes=null!==(t=e.headerBytes)&&void 0!==t?t:new Uint8Array,i.contentTopic=null!==(r=e.contentTopic)&&void 0!==r?r:"",i}};function rU(){return{requests:[]}}let rP={encode(e,t=ec().Writer.create()){for(let r of e.requests)rI.encode(r,t.uint32(10).fork()).ldelim();return t},decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=rU();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.requests.push(rI.decode(r,r.uint32())):r.skipType(7&s)}return n},fromJSON:e=>({requests:Array.isArray(null==e?void 0:e.requests)?e.requests.map(e=>rI.fromJSON(e)):[]}),toJSON(e){let t={};return e.requests?t.requests=e.requests.map(e=>e?rI.toJSON(e):void 0):t.requests=[],t},fromPartial(e){var t;let r=rU();return r.requests=(null===(t=e.requests)||void 0===t?void 0:t.map(e=>rI.fromPartial(e)))||[],r}};function rx(){return{recipient:void 0,payload:new Uint8Array,headerBytes:new Uint8Array}}let rI={encode:(e,t=ec().Writer.create())=>(void 0!==e.recipient&&eP.encode(e.recipient,t.uint32(10).fork()).ldelim(),0!==e.payload.length&&t.uint32(18).bytes(e.payload),0!==e.headerBytes.length&&t.uint32(26).bytes(e.headerBytes),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=rx();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.recipient=eP.decode(r,r.uint32());break;case 2:n.payload=r.bytes();break;case 3:n.headerBytes=r.bytes();break;default:r.skipType(7&s)}}return n},fromJSON:e=>({recipient:iA(e.recipient)?eP.fromJSON(e.recipient):void 0,payload:iA(e.payload)?iE(e.payload):new Uint8Array,headerBytes:iA(e.headerBytes)?iE(e.headerBytes):new Uint8Array}),toJSON(e){let t={};return void 0!==e.recipient&&(t.recipient=e.recipient?eP.toJSON(e.recipient):void 0),void 0!==e.payload&&(t.payload=iO(void 0!==e.payload?e.payload:new Uint8Array)),void 0!==e.headerBytes&&(t.headerBytes=iO(void 0!==e.headerBytes?e.headerBytes:new Uint8Array)),t},fromPartial(e){var t,r;let i=rx();return i.recipient=void 0!==e.recipient&&null!==e.recipient?eP.fromPartial(e.recipient):void 0,i.payload=null!==(t=e.payload)&&void 0!==t?t:new Uint8Array,i.headerBytes=null!==(r=e.headerBytes)&&void 0!==r?r:new Uint8Array,i}};function rC(){return{responses:[]}}let r_={encode(e,t=ec().Writer.create()){for(let r of e.responses)rD.encode(r,t.uint32(10).fork()).ldelim();return t},decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=rC();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.responses.push(rD.decode(r,r.uint32())):r.skipType(7&s)}return n},fromJSON:e=>({responses:Array.isArray(null==e?void 0:e.responses)?e.responses.map(e=>rD.fromJSON(e)):[]}),toJSON(e){let t={};return e.responses?t.responses=e.responses.map(e=>e?rD.toJSON(e):void 0):t.responses=[],t},fromPartial(e){var t;let r=rC();return r.responses=(null===(t=e.responses)||void 0===t?void 0:t.map(e=>rD.fromPartial(e)))||[],r}};function rJ(){return{result:void 0,error:void 0}}let rD={encode:(e,t=ec().Writer.create())=>(void 0!==e.result&&rq.encode(e.result,t.uint32(10).fork()).ldelim(),void 0!==e.error&&rv.encode(e.error,t.uint32(18).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=rJ();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.result=rq.decode(r,r.uint32());break;case 2:n.error=rv.decode(r,r.uint32());break;default:r.skipType(7&s)}}return n},fromJSON:e=>({result:iA(e.result)?rq.fromJSON(e.result):void 0,error:iA(e.error)?rv.fromJSON(e.error):void 0}),toJSON(e){let t={};return void 0!==e.result&&(t.result=e.result?rq.toJSON(e.result):void 0),void 0!==e.error&&(t.error=e.error?rv.toJSON(e.error):void 0),t},fromPartial(e){let t=rJ();return t.result=void 0!==e.result&&null!==e.result?rq.fromPartial(e.result):void 0,t.error=void 0!==e.error&&null!==e.error?rv.fromPartial(e.error):void 0,t}};function rM(){return{encrypted:void 0}}let rq={encode:(e,t=ec().Writer.create())=>(void 0!==e.encrypted&&eL.encode(e.encrypted,t.uint32(10).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=rM();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.encrypted=eL.decode(r,r.uint32()):r.skipType(7&s)}return n},fromJSON:e=>({encrypted:iA(e.encrypted)?eL.fromJSON(e.encrypted):void 0}),toJSON(e){let t={};return void 0!==e.encrypted&&(t.encrypted=e.encrypted?eL.toJSON(e.encrypted):void 0),t},fromPartial(e){let t=rM();return t.encrypted=void 0!==e.encrypted&&null!==e.encrypted?eL.fromPartial(e.encrypted):void 0,t}};function rV(){return{requests:[]}}let rj={encode(e,t=ec().Writer.create()){for(let r of e.requests)rL.encode(r,t.uint32(10).fork()).ldelim();return t},decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=rV();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.requests.push(rL.decode(r,r.uint32())):r.skipType(7&s)}return n},fromJSON:e=>({requests:Array.isArray(null==e?void 0:e.requests)?e.requests.map(e=>rL.fromJSON(e)):[]}),toJSON(e){let t={};return e.requests?t.requests=e.requests.map(e=>e?rL.toJSON(e):void 0):t.requests=[],t},fromPartial(e){var t;let r=rV();return r.requests=(null===(t=e.requests)||void 0===t?void 0:t.map(e=>rL.fromPartial(e)))||[],r}};function rZ(){return{payload:new Uint8Array,headerBytes:new Uint8Array,contentTopic:""}}let rL={encode:(e,t=ec().Writer.create())=>(0!==e.payload.length&&t.uint32(10).bytes(e.payload),0!==e.headerBytes.length&&t.uint32(18).bytes(e.headerBytes),""!==e.contentTopic&&t.uint32(26).string(e.contentTopic),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=rZ();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.payload=r.bytes();break;case 2:n.headerBytes=r.bytes();break;case 3:n.contentTopic=r.string();break;default:r.skipType(7&s)}}return n},fromJSON:e=>({payload:iA(e.payload)?iE(e.payload):new Uint8Array,headerBytes:iA(e.headerBytes)?iE(e.headerBytes):new Uint8Array,contentTopic:iA(e.contentTopic)?String(e.contentTopic):""}),toJSON(e){let t={};return void 0!==e.payload&&(t.payload=iO(void 0!==e.payload?e.payload:new Uint8Array)),void 0!==e.headerBytes&&(t.headerBytes=iO(void 0!==e.headerBytes?e.headerBytes:new Uint8Array)),void 0!==e.contentTopic&&(t.contentTopic=e.contentTopic),t},fromPartial(e){var t,r,i;let n=rZ();return n.payload=null!==(t=e.payload)&&void 0!==t?t:new Uint8Array,n.headerBytes=null!==(r=e.headerBytes)&&void 0!==r?r:new Uint8Array,n.contentTopic=null!==(i=e.contentTopic)&&void 0!==i?i:"",n}};function rW(){return{context:void 0,recipient:void 0,createdNs:E.UZERO}}let rH={encode:(e,t=ec().Writer.create())=>(void 0!==e.context&&e8.encode(e.context,t.uint32(10).fork()).ldelim(),void 0!==e.recipient&&eA.encode(e.recipient,t.uint32(18).fork()).ldelim(),e.createdNs.isZero()||t.uint32(24).uint64(e.createdNs),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=rW();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.context=e8.decode(r,r.uint32());break;case 2:n.recipient=eA.decode(r,r.uint32());break;case 3:n.createdNs=r.uint64();break;default:r.skipType(7&s)}}return n},fromJSON:e=>({context:iA(e.context)?e8.fromJSON(e.context):void 0,recipient:iA(e.recipient)?eA.fromJSON(e.recipient):void 0,createdNs:iA(e.createdNs)?E.fromValue(e.createdNs):E.UZERO}),toJSON(e){let t={};return void 0!==e.context&&(t.context=e.context?e8.toJSON(e.context):void 0),void 0!==e.recipient&&(t.recipient=e.recipient?eA.toJSON(e.recipient):void 0),void 0!==e.createdNs&&(t.createdNs=(e.createdNs||E.UZERO).toString()),t},fromPartial(e){let t=rW();return t.context=void 0!==e.context&&null!==e.context?e8.fromPartial(e.context):void 0,t.recipient=void 0!==e.recipient&&null!==e.recipient?eA.fromPartial(e.recipient):void 0,t.createdNs=void 0!==e.createdNs&&null!==e.createdNs?E.fromValue(e.createdNs):E.UZERO,t}};function rG(){return{recipient:void 0,contentTopic:"",createdNs:E.UZERO}}let rF={encode:(e,t=ec().Writer.create())=>(void 0!==e.recipient&&eA.encode(e.recipient,t.uint32(10).fork()).ldelim(),""!==e.contentTopic&&t.uint32(18).string(e.contentTopic),e.createdNs.isZero()||t.uint32(24).uint64(e.createdNs),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=rG();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.recipient=eA.decode(r,r.uint32());break;case 2:n.contentTopic=r.string();break;case 3:n.createdNs=r.uint64();break;default:r.skipType(7&s)}}return n},fromJSON:e=>({recipient:iA(e.recipient)?eA.fromJSON(e.recipient):void 0,contentTopic:iA(e.contentTopic)?String(e.contentTopic):"",createdNs:iA(e.createdNs)?E.fromValue(e.createdNs):E.UZERO}),toJSON(e){let t={};return void 0!==e.recipient&&(t.recipient=e.recipient?eA.toJSON(e.recipient):void 0),void 0!==e.contentTopic&&(t.contentTopic=e.contentTopic),void 0!==e.createdNs&&(t.createdNs=(e.createdNs||E.UZERO).toString()),t},fromPartial(e){var t;let r=rG();return r.recipient=void 0!==e.recipient&&null!==e.recipient?eA.fromPartial(e.recipient):void 0,r.contentTopic=null!==(t=e.contentTopic)&&void 0!==t?t:"",r.createdNs=void 0!==e.createdNs&&null!==e.createdNs?E.fromValue(e.createdNs):E.UZERO,r}};function r$(){return{context:void 0,recipients:[],createdNs:E.UZERO}}let rz={encode(e,t=ec().Writer.create()){for(let r of(void 0!==e.context&&e8.encode(e.context,t.uint32(10).fork()).ldelim(),e.recipients))eA.encode(r,t.uint32(18).fork()).ldelim();return e.createdNs.isZero()||t.uint32(24).uint64(e.createdNs),t},decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=r$();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.context=e8.decode(r,r.uint32());break;case 2:n.recipients.push(eA.decode(r,r.uint32()));break;case 3:n.createdNs=r.uint64();break;default:r.skipType(7&s)}}return n},fromJSON:e=>({context:iA(e.context)?e8.fromJSON(e.context):void 0,recipients:Array.isArray(null==e?void 0:e.recipients)?e.recipients.map(e=>eA.fromJSON(e)):[],createdNs:iA(e.createdNs)?E.fromValue(e.createdNs):E.UZERO}),toJSON(e){let t={};return void 0!==e.context&&(t.context=e.context?e8.toJSON(e.context):void 0),e.recipients?t.recipients=e.recipients.map(e=>e?eA.toJSON(e):void 0):t.recipients=[],void 0!==e.createdNs&&(t.createdNs=(e.createdNs||E.UZERO).toString()),t},fromPartial(e){var t;let r=r$();return r.context=void 0!==e.context&&null!==e.context?e8.fromPartial(e.context):void 0,r.recipients=(null===(t=e.recipients)||void 0===t?void 0:t.map(e=>eA.fromPartial(e)))||[],r.createdNs=void 0!==e.createdNs&&null!==e.createdNs?E.fromValue(e.createdNs):E.UZERO,r}};function rX(){return{conversation:void 0,payload:new Uint8Array}}let rY={encode:(e,t=ec().Writer.create())=>(void 0!==e.conversation&&tl.encode(e.conversation,t.uint32(10).fork()).ldelim(),0!==e.payload.length&&t.uint32(18).bytes(e.payload),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=rX();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.conversation=tl.decode(r,r.uint32());break;case 2:n.payload=r.bytes();break;default:r.skipType(7&s)}}return n},fromJSON:e=>({conversation:iA(e.conversation)?tl.fromJSON(e.conversation):void 0,payload:iA(e.payload)?iE(e.payload):new Uint8Array}),toJSON(e){let t={};return void 0!==e.conversation&&(t.conversation=e.conversation?tl.toJSON(e.conversation):void 0),void 0!==e.payload&&(t.payload=iO(void 0!==e.payload?e.payload:new Uint8Array)),t},fromPartial(e){var t;let r=rX();return r.conversation=void 0!==e.conversation&&null!==e.conversation?tl.fromPartial(e.conversation):void 0,r.payload=null!==(t=e.payload)&&void 0!==t?t:new Uint8Array,r}};function rQ(){return{responses:[]}}let r0={encode(e,t=ec().Writer.create()){for(let r of e.responses)rY.encode(r,t.uint32(10).fork()).ldelim();return t},decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=rQ();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.responses.push(rY.decode(r,r.uint32())):r.skipType(7&s)}return n},fromJSON:e=>({responses:Array.isArray(null==e?void 0:e.responses)?e.responses.map(e=>rY.fromJSON(e)):[]}),toJSON(e){let t={};return e.responses?t.responses=e.responses.map(e=>e?rY.toJSON(e):void 0):t.responses=[],t},fromPartial(e){var t;let r=rQ();return r.responses=(null===(t=e.responses)||void 0===t?void 0:t.map(e=>rY.fromPartial(e)))||[],r}};function r2(){return{requests:[]}}let r1={encode(e,t=ec().Writer.create()){for(let r of e.requests)r6.encode(r,t.uint32(10).fork()).ldelim();return t},decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=r2();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.requests.push(r6.decode(r,r.uint32())):r.skipType(7&s)}return n},fromJSON:e=>({requests:Array.isArray(null==e?void 0:e.requests)?e.requests.map(e=>r6.fromJSON(e)):[]}),toJSON(e){let t={};return e.requests?t.requests=e.requests.map(e=>e?r6.toJSON(e):void 0):t.requests=[],t},fromPartial(e){var t;let r=r2();return r.requests=(null===(t=e.requests)||void 0===t?void 0:t.map(e=>r6.fromPartial(e)))||[],r}};function r3(){return{contentTopic:"",timestampNs:E.UZERO,payload:new Uint8Array}}let r6={encode:(e,t=ec().Writer.create())=>(""!==e.contentTopic&&t.uint32(10).string(e.contentTopic),e.timestampNs.isZero()||t.uint32(16).uint64(e.timestampNs),0!==e.payload.length&&t.uint32(26).bytes(e.payload),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=r3();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.contentTopic=r.string();break;case 2:n.timestampNs=r.uint64();break;case 3:n.payload=r.bytes();break;default:r.skipType(7&s)}}return n},fromJSON:e=>({contentTopic:iA(e.contentTopic)?String(e.contentTopic):"",timestampNs:iA(e.timestampNs)?E.fromValue(e.timestampNs):E.UZERO,payload:iA(e.payload)?iE(e.payload):new Uint8Array}),toJSON(e){let t={};return void 0!==e.contentTopic&&(t.contentTopic=e.contentTopic),void 0!==e.timestampNs&&(t.timestampNs=(e.timestampNs||E.UZERO).toString()),void 0!==e.payload&&(t.payload=iO(void 0!==e.payload?e.payload:new Uint8Array)),t},fromPartial(e){var t,r;let i=r3();return i.contentTopic=null!==(t=e.contentTopic)&&void 0!==t?t:"",i.timestampNs=void 0!==e.timestampNs&&null!==e.timestampNs?E.fromValue(e.timestampNs):E.UZERO,i.payload=null!==(r=e.payload)&&void 0!==r?r:new Uint8Array,i}};function r5(){return{responses:[]}}let r8={encode(e,t=ec().Writer.create()){for(let r of e.responses)r7.encode(r,t.uint32(10).fork()).ldelim();return t},decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=r5();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.responses.push(r7.decode(r,r.uint32())):r.skipType(7&s)}return n},fromJSON:e=>({responses:Array.isArray(null==e?void 0:e.responses)?e.responses.map(e=>r7.fromJSON(e)):[]}),toJSON(e){let t={};return e.responses?t.responses=e.responses.map(e=>e?r7.toJSON(e):void 0):t.responses=[],t},fromPartial(e){var t;let r=r5();return r.responses=(null===(t=e.responses)||void 0===t?void 0:t.map(e=>r7.fromPartial(e)))||[],r}};function r4(){return{result:void 0,error:void 0}}let r7={encode:(e,t=ec().Writer.create())=>(void 0!==e.result&&ie.encode(e.result,t.uint32(10).fork()).ldelim(),void 0!==e.error&&rv.encode(e.error,t.uint32(18).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=r4();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.result=ie.decode(r,r.uint32());break;case 2:n.error=rv.decode(r,r.uint32());break;default:r.skipType(7&s)}}return n},fromJSON:e=>({result:iA(e.result)?ie.fromJSON(e.result):void 0,error:iA(e.error)?rv.fromJSON(e.error):void 0}),toJSON(e){let t={};return void 0!==e.result&&(t.result=e.result?ie.toJSON(e.result):void 0),void 0!==e.error&&(t.error=e.error?rv.toJSON(e.error):void 0),t},fromPartial(e){let t=r4();return t.result=void 0!==e.result&&null!==e.result?ie.fromPartial(e.result):void 0,t.error=void 0!==e.error&&null!==e.error?rv.fromPartial(e.error):void 0,t}};function r9(){return{conversation:void 0}}let ie={encode:(e,t=ec().Writer.create())=>(void 0!==e.conversation&&tl.encode(e.conversation,t.uint32(10).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=r9();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.conversation=tl.decode(r,r.uint32()):r.skipType(7&s)}return n},fromJSON:e=>({conversation:iA(e.conversation)?tl.fromJSON(e.conversation):void 0}),toJSON(e){let t={};return void 0!==e.conversation&&(t.conversation=e.conversation?tl.toJSON(e.conversation):void 0),t},fromPartial(e){let t=r9();return t.conversation=void 0!==e.conversation&&null!==e.conversation?tl.fromPartial(e.conversation):void 0,t}};function it(){return{timestampNs:void 0}}let ir={encode:(e,t=ec().Writer.create())=>(void 0!==e.timestampNs&&t.uint32(8).uint64(e.timestampNs),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=it();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.timestampNs=r.uint64():r.skipType(7&s)}return n},fromJSON:e=>({timestampNs:iA(e.timestampNs)?E.fromValue(e.timestampNs):void 0}),toJSON(e){let t={};return void 0!==e.timestampNs&&(t.timestampNs=(e.timestampNs||void 0).toString()),t},fromPartial(e){let t=it();return t.timestampNs=void 0!==e.timestampNs&&null!==e.timestampNs?E.fromValue(e.timestampNs):void 0,t}};function ii(){return{conversations:[]}}let is={encode(e,t=ec().Writer.create()){for(let r of e.conversations)tl.encode(r,t.uint32(10).fork()).ldelim();return t},decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=ii();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.conversations.push(tl.decode(r,r.uint32())):r.skipType(7&s)}return n},fromJSON:e=>({conversations:Array.isArray(null==e?void 0:e.conversations)?e.conversations.map(e=>tl.fromJSON(e)):[]}),toJSON(e){let t={};return e.conversations?t.conversations=e.conversations.map(e=>e?tl.toJSON(e):void 0):t.conversations=[],t},fromPartial(e){var t;let r=ii();return r.conversations=(null===(t=e.conversations)||void 0===t?void 0:t.map(e=>tl.fromPartial(e)))||[],r}};function io(){return{walletAddress:""}}let ia={encode:(e,t=ec().Writer.create())=>(""!==e.walletAddress&&t.uint32(10).string(e.walletAddress),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=io();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.walletAddress=r.string():r.skipType(7&s)}return n},fromJSON:e=>({walletAddress:iA(e.walletAddress)?String(e.walletAddress):""}),toJSON(e){let t={};return void 0!==e.walletAddress&&(t.walletAddress=e.walletAddress),t},fromPartial(e){var t;let r=io();return r.walletAddress=null!==(t=e.walletAddress)&&void 0!==t?t:"",r}};function ic(){return{status:0}}let id={encode:(e,t=ec().Writer.create())=>(0!==e.status&&t.uint32(8).int32(e.status),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=ic();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.status=r.int32():r.skipType(7&s)}return n},fromJSON:e=>({status:iA(e.status)?ry(e.status):0}),toJSON(e){let t={};return void 0!==e.status&&(t.status=rh(e.status)),t},fromPartial(e){var t;let r=ic();return r.status=null!==(t=e.status)&&void 0!==t?t:0,r}};function il(){return{v1:void 0}}let iu={encode:(e,t=ec().Writer.create())=>(void 0!==e.v1&&t3.encode(e.v1,t.uint32(10).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=il();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.v1=t3.decode(r,r.uint32()):r.skipType(7&s)}return n},fromJSON:e=>({v1:iA(e.v1)?t3.fromJSON(e.v1):void 0}),toJSON(e){let t={};return void 0!==e.v1&&(t.v1=e.v1?t3.toJSON(e.v1):void 0),t},fromPartial(e){let t=il();return t.v1=void 0!==e.v1&&null!==e.v1?t3.fromPartial(e.v1):void 0,t}};function ip(){return{error:void 0}}let iy={encode:(e,t=ec().Writer.create())=>(void 0!==e.error&&rv.encode(e.error,t.uint32(10).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=ip();for(;r.pos<i;){let s=r.uint32();s>>>3==1?n.error=rv.decode(r,r.uint32()):r.skipType(7&s)}return n},fromJSON:e=>({error:iA(e.error)?rv.fromJSON(e.error):void 0}),toJSON(e){let t={};return void 0!==e.error&&(t.error=e.error?rv.toJSON(e.error):void 0),t},fromPartial(e){let t=ip();return t.error=void 0!==e.error&&null!==e.error?rv.fromPartial(e.error):void 0,t}};function ih(){return{digest:new Uint8Array,identityKey:void 0,prekeyIndex:void 0}}let iv={encode:(e,t=ec().Writer.create())=>(0!==e.digest.length&&t.uint32(10).bytes(e.digest),void 0!==e.identityKey&&t.uint32(16).bool(e.identityKey),void 0!==e.prekeyIndex&&t.uint32(24).uint32(e.prekeyIndex),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=ih();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.digest=r.bytes();break;case 2:n.identityKey=r.bool();break;case 3:n.prekeyIndex=r.uint32();break;default:r.skipType(7&s)}}return n},fromJSON:e=>({digest:iA(e.digest)?iE(e.digest):new Uint8Array,identityKey:iA(e.identityKey)?Boolean(e.identityKey):void 0,prekeyIndex:iA(e.prekeyIndex)?Number(e.prekeyIndex):void 0}),toJSON(e){let t={};return void 0!==e.digest&&(t.digest=iO(void 0!==e.digest?e.digest:new Uint8Array)),void 0!==e.identityKey&&(t.identityKey=e.identityKey),void 0!==e.prekeyIndex&&(t.prekeyIndex=Math.round(e.prekeyIndex)),t},fromPartial(e){var t,r,i;let n=ih();return n.digest=null!==(t=e.digest)&&void 0!==t?t:new Uint8Array,n.identityKey=null!==(r=e.identityKey)&&void 0!==r?r:void 0,n.prekeyIndex=null!==(i=e.prekeyIndex)&&void 0!==i?i:void 0,n}};function im(){return{topics:{}}}let ig={encode:(e,t=ec().Writer.create())=>(Object.entries(e.topics).forEach(([e,r])=>{ik.encode({key:e,value:r},t.uint32(10).fork()).ldelim()}),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=im();for(;r.pos<i;){let s=r.uint32();if(s>>>3==1){let o=ik.decode(r,r.uint32());void 0!==o.value&&(n.topics[o.key]=o.value)}else r.skipType(7&s)}return n},fromJSON:e=>{var t;return{topics:"object"==typeof(t=e.topics)&&null!==t?Object.entries(e.topics).reduce((e,[t,r])=>(e[t]=ib.fromJSON(r),e),{}):{}}},toJSON(e){let t={};return t.topics={},e.topics&&Object.entries(e.topics).forEach(([e,r])=>{t.topics[e]=ib.toJSON(r)}),t},fromPartial(e){var t;let r=im();return r.topics=Object.entries(null!==(t=e.topics)&&void 0!==t?t:{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=ib.fromPartial(r)),e),{}),r}};function iw(){return{createdNs:E.UZERO,peerAddress:"",invitation:void 0}}let ib={encode:(e,t=ec().Writer.create())=>(e.createdNs.isZero()||t.uint32(8).uint64(e.createdNs),""!==e.peerAddress&&t.uint32(18).string(e.peerAddress),void 0!==e.invitation&&e1.encode(e.invitation,t.uint32(26).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=iw();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.createdNs=r.uint64();break;case 2:n.peerAddress=r.string();break;case 3:n.invitation=e1.decode(r,r.uint32());break;default:r.skipType(7&s)}}return n},fromJSON:e=>({createdNs:iA(e.createdNs)?E.fromValue(e.createdNs):E.UZERO,peerAddress:iA(e.peerAddress)?String(e.peerAddress):"",invitation:iA(e.invitation)?e1.fromJSON(e.invitation):void 0}),toJSON(e){let t={};return void 0!==e.createdNs&&(t.createdNs=(e.createdNs||E.UZERO).toString()),void 0!==e.peerAddress&&(t.peerAddress=e.peerAddress),void 0!==e.invitation&&(t.invitation=e.invitation?e1.toJSON(e.invitation):void 0),t},fromPartial(e){var t;let r=iw();return r.createdNs=void 0!==e.createdNs&&null!==e.createdNs?E.fromValue(e.createdNs):E.UZERO,r.peerAddress=null!==(t=e.peerAddress)&&void 0!==t?t:"",r.invitation=void 0!==e.invitation&&null!==e.invitation?e1.fromPartial(e.invitation):void 0,r}};function iS(){return{key:"",value:void 0}}let ik={encode:(e,t=ec().Writer.create())=>(""!==e.key&&t.uint32(10).string(e.key),void 0!==e.value&&ib.encode(e.value,t.uint32(18).fork()).ldelim(),t),decode(e,t){let r=e instanceof ec().Reader?e:new(ec()).Reader(e),i=void 0===t?r.len:r.pos+t,n=iS();for(;r.pos<i;){let s=r.uint32();switch(s>>>3){case 1:n.key=r.string();break;case 2:n.value=ib.decode(r,r.uint32());break;default:r.skipType(7&s)}}return n},fromJSON:e=>({key:iA(e.key)?String(e.key):"",value:iA(e.value)?ib.fromJSON(e.value):void 0}),toJSON(e){let t={};return void 0!==e.key&&(t.key=e.key),void 0!==e.value&&(t.value=e.value?ib.toJSON(e.value):void 0),t},fromPartial(e){var t;let r=iS();return r.key=null!==(t=e.key)&&void 0!==t?t:"",r.value=void 0!==e.value&&null!==e.value?ib.fromPartial(e.value):void 0,r}};var iN=(()=>{if(void 0!==iN)return iN;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r.g)return r.g;throw"Unable to locate global object"})();function iE(e){if(iN.Buffer)return Uint8Array.from(iN.Buffer.from(e,"base64"));{let t=iN.atob(e),r=new Uint8Array(t.length);for(let i=0;i<t.length;++i)r[i]=t.charCodeAt(i);return r}}function iO(e){if(iN.Buffer)return iN.Buffer.from(e).toString("base64");{let t=[];return e.forEach(e=>{t.push(String.fromCharCode(e))}),iN.btoa(t.join(""))}}function iA(e){return null!=e}ec().util.Long!==E&&(ec().util.Long=E,ec().configure());var iK=r(95856),iB=r.t(iK,2);/*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) */let iR=BigInt(0),iT=BigInt(1),iU=BigInt(2),iP=BigInt(3),ix=BigInt(8),iI=Object.freeze({a:iR,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:iT,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")}),iC=(e,t)=>(e+t/iU)/t,i_={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar(e){let{n:t}=iI,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-iT*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),n=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=BigInt("0x100000000000000000000000000000000"),o=iC(r*e,t),a=iC(-i*e,t),c=i8(e-o*r-a*n,t),d=i8(-o*i-a*r,t),l=c>s,u=d>s;if(l&&(c=t-c),u&&(d=t-d),c>s||d>s)throw Error("splitScalarEndo: Endomorphism failed, k="+e);return{k1neg:l,k1:c,k2neg:u,k2:d}}};function iJ(e){let{a:t,b:r}=iI,i=i8(e*e),n=i8(i*e);return i8(n+t*e+r)}let iD=iI.a===iR;class iM extends Error{constructor(e){super(e)}}function iq(e){if(!(e instanceof iV))throw TypeError("JacobianPoint expected")}class iV{constructor(e,t,r){this.x=e,this.y=t,this.z=r}static fromAffine(e){if(!(e instanceof iL))throw TypeError("JacobianPoint#fromAffine: expected Point");return e.equals(iL.ZERO)?iV.ZERO:new iV(e.x,e.y,iT)}static toAffineBatch(e){let t=function(e,t=iI.P){let r=Array(e.length),i=e.reduce((e,i,n)=>i===iR?e:(r[n]=e,i8(e*i,t)),iT),n=i7(i,t);return e.reduceRight((e,i,n)=>i===iR?e:(r[n]=i8(e*r[n],t),i8(e*i,t)),n),r}(e.map(e=>e.z));return e.map((e,r)=>e.toAffine(t[r]))}static normalizeZ(e){return iV.toAffineBatch(e).map(iV.fromAffine)}equals(e){iq(e);let{x:t,y:r,z:i}=this,{x:n,y:s,z:o}=e,a=i8(i*i),c=i8(o*o),d=i8(t*c),l=i8(n*a),u=i8(i8(r*o)*c),p=i8(i8(s*i)*a);return d===l&&u===p}negate(){return new iV(this.x,i8(-this.y),this.z)}double(){let{x:e,y:t,z:r}=this,i=i8(e*e),n=i8(t*t),s=i8(n*n),o=e+n,a=i8(iU*(i8(o*o)-i-s)),c=i8(iP*i),d=i8(c*c),l=i8(d-iU*a),u=i8(c*(a-l)-ix*s),p=i8(iU*t*r);return new iV(l,u,p)}add(e){iq(e);let{x:t,y:r,z:i}=this,{x:n,y:s,z:o}=e;if(n===iR||s===iR)return this;if(t===iR||r===iR)return e;let a=i8(i*i),c=i8(o*o),d=i8(t*c),l=i8(n*a),u=i8(i8(r*o)*c),p=i8(i8(s*i)*a),y=i8(l-d),h=i8(p-u);if(y===iR)return h===iR?this.double():iV.ZERO;let f=i8(y*y),v=i8(y*f),m=i8(d*f),g=i8(h*h-v-iU*m),w=i8(h*(m-g)-u*v),b=i8(i*o*y);return new iV(g,w,b)}subtract(e){return this.add(e.negate())}multiplyUnsafe(e){let t=iV.ZERO;if("bigint"==typeof e&&e===iR)return t;let r=i5(e);if(r===iT)return this;if(!iD){let i=t,n=this;for(;r>iR;)r&iT&&(i=i.add(n)),n=n.double(),r>>=iT;return i}let{k1neg:s,k1:o,k2neg:a,k2:c}=i_.splitScalar(r),d=t,l=t,u=this;for(;o>iR||c>iR;)o&iT&&(d=d.add(u)),c&iT&&(l=l.add(u)),u=u.double(),o>>=iT,c>>=iT;return s&&(d=d.negate()),a&&(l=l.negate()),l=new iV(i8(l.x*i_.beta),l.y,l.z),d.add(l)}precomputeWindow(e){let t=iD?128/e+1:256/e+1,r=[],i=this,n=i;for(let s=0;s<t;s++){n=i,r.push(n);for(let o=1;o<2**(e-1);o++)n=n.add(i),r.push(n);i=n.double()}return r}wNAF(e,t){!t&&this.equals(iV.BASE)&&(t=iL.BASE);let r=t&&t._WINDOW_SIZE||1;if(256%r)throw Error("Point#wNAF: Invalid precomputation window, must be power of 2");let i=t&&iZ.get(t);!i&&(i=this.precomputeWindow(r),t&&1!==r&&(i=iV.normalizeZ(i),iZ.set(t,i)));let n=iV.ZERO,s=iV.BASE,o=1+(iD?128/r:256/r),a=2**(r-1),c=BigInt(2**r-1),d=2**r,l=BigInt(r);for(let u=0;u<o;u++){let p=u*a,y=Number(e&c);e>>=l,y>a&&(y-=d,e+=iT);let h=p+Math.abs(y)-1,f=u%2!=0,v=y<0;0===y?s=s.add(ij(f,i[p])):n=n.add(ij(v,i[h]))}return{p:n,f:s}}multiply(e,t){let r,i,n=i5(e);if(iD){let{k1neg:s,k1:o,k2neg:a,k2:c}=i_.splitScalar(n),{p:d,f:l}=this.wNAF(o,t),{p:u,f:p}=this.wNAF(c,t);d=ij(s,d),u=ij(a,u),u=new iV(i8(u.x*i_.beta),u.y,u.z),r=d.add(u),i=l.add(p)}else{let{p:y,f:h}=this.wNAF(n,t);r=y,i=h}return iV.normalizeZ([r,i])[0]}toAffine(e){let{x:t,y:r,z:i}=this,n=this.equals(iV.ZERO);null==e&&(e=n?ix:i7(i));let s=e,o=i8(s*s),a=i8(o*s),c=i8(t*o),d=i8(r*a),l=i8(i*s);if(n)return iL.ZERO;if(l!==iT)throw Error("invZ was invalid");return new iL(c,d)}}function ij(e,t){let r=t.negate();return e?r:t}iV.BASE=new iV(iI.Gx,iI.Gy,iT),iV.ZERO=new iV(iR,iT,iR);let iZ=new WeakMap;class iL{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,iZ.delete(this)}hasEvenY(){return this.y%iU===iR}static fromCompressedHex(e){let t=32===e.length,r=i3(t?e:e.subarray(1));if(!nr(r))throw Error("Point is not on curve");let i=iJ(r),n=function(e){let{P:t}=iI,r=BigInt(6),i=BigInt(11),n=BigInt(22),s=BigInt(23),o=BigInt(44),a=BigInt(88),c=e*e*e%t,d=c*c*e%t,l=i4(d,iP)*d%t,u=i4(l,iP)*d%t,p=i4(u,iU)*c%t,y=i4(p,i)*p%t,h=i4(y,n)*y%t,f=i4(h,o)*h%t,v=i4(f,a)*f%t,m=i4(v,o)*h%t,g=i4(m,iP)*d%t,w=i4(g,s)*y%t,b=i4(w,r)*c%t,S=i4(b,iU);if(S*S%t!==e)throw Error("Cannot find square root");return S}(i),s=(n&iT)===iT;if(t)s&&(n=i8(-n));else{let o=(1&e[0])==1;o!==s&&(n=i8(-n))}let a=new iL(r,n);return a.assertValidity(),a}static fromUncompressedHex(e){let t=i3(e.subarray(1,33)),r=i3(e.subarray(33,65)),i=new iL(t,r);return i.assertValidity(),i}static fromHex(e){let t=i6(e),r=t.length,i=t[0];if(32===r||33===r&&(2===i||3===i))return this.fromCompressedHex(t);if(65===r&&4===i)return this.fromUncompressedHex(t);throw Error(`Point.fromHex: received invalid point. Expected 32-33 compressed bytes or 65 uncompressed bytes, not ${r}`)}static fromPrivateKey(e){return iL.BASE.multiply(ni(e))}static fromSignature(e,t,r){let{r:i,s:n}=ns(t);if(![0,1,2,3].includes(r))throw Error("Cannot recover: invalid recovery bit");let s=i9(i6(e)),{n:o}=iI,a=2===r||3===r?i+o:i,c=i7(a,o),d=i8(-s*c,o),l=i8(n*c,o),u=iL.fromHex((1&r?"03":"02")+iY(a)),p=iL.BASE.multiplyAndAddUnsafe(u,d,l);if(!p)throw Error("Cannot recover signature: point at infinify");return p.assertValidity(),p}toRawBytes(e=!1){return i1(this.toHex(e))}toHex(e=!1){let t=iY(this.x);if(!e)return`04${t}${iY(this.y)}`;{let r=this.hasEvenY()?"02":"03";return`${r}${t}`}}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){let e="Point is not on elliptic curve",{x:t,y:r}=this;if(!nr(t)||!nr(r))throw Error(e);let i=i8(r*r),n=iJ(t);if(i8(i-n)!==iR)throw Error(e)}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new iL(this.x,i8(-this.y))}double(){return iV.fromAffine(this).double().toAffine()}add(e){return iV.fromAffine(this).add(iV.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return iV.fromAffine(this).multiply(e,this).toAffine()}multiplyAndAddUnsafe(e,t,r){let i=iV.fromAffine(this),n=t===iR||t===iT||this!==iL.BASE?i.multiplyUnsafe(t):i.multiply(t),s=iV.fromAffine(e).multiplyUnsafe(r),o=n.add(s);return o.equals(iV.ZERO)?void 0:o.toAffine()}}function iW(e){return Number.parseInt(e[0],16)>=8?"00"+e:e}function iH(e){if(e.length<2||2!==e[0])throw Error(`Invalid signature integer tag: ${iz(e)}`);let t=e[1],r=e.subarray(2,t+2);if(!t||r.length!==t)throw Error("Invalid signature integer: wrong length");if(0===r[0]&&r[1]<=127)throw Error("Invalid signature integer: trailing length");return{data:i3(r),left:e.subarray(t+2)}}iL.BASE=new iL(iI.Gx,iI.Gy),iL.ZERO=new iL(iR,iR);class iG{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromCompact(e){let t=e instanceof Uint8Array,r="Signature.fromCompact";if("string"!=typeof e&&!t)throw TypeError(`${r}: Expected string or Uint8Array`);let i=t?iz(e):e;if(128!==i.length)throw Error(`${r}: Expected 64-byte hex`);return new iG(i2(i.slice(0,64)),i2(i.slice(64,128)))}static fromDER(e){let t=e instanceof Uint8Array;if("string"!=typeof e&&!t)throw TypeError("Signature.fromDER: Expected string or Uint8Array");let{r,s:i}=function(e){if(e.length<2||48!=e[0])throw Error(`Invalid signature tag: ${iz(e)}`);if(e[1]!==e.length-2)throw Error("Invalid signature: incorrect length");let{data:t,left:r}=iH(e.subarray(2)),{data:i,left:n}=iH(r);if(n.length)throw Error(`Invalid signature: left bytes after parsing: ${iz(n)}`);return{r:t,s:i}}(t?e:i1(e));return new iG(r,i)}static fromHex(e){return this.fromDER(e)}assertValidity(){let{r:e,s:t}=this;if(!nt(e))throw Error("Invalid Signature: r must be 0 < r < n");if(!nt(t))throw Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){let e=iI.n>>iT;return this.s>e}normalizeS(){return this.hasHighS()?new iG(this.r,i8(-this.s,iI.n)):this}toDERRawBytes(){return i1(this.toDERHex())}toDERHex(){let e=iW(i0(this.s)),t=iW(i0(this.r)),r=e.length/2,i=t.length/2,n=i0(r),s=i0(i),o=i0(i+r+4);return`30${o}02${s}${t}02${n}${e}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return i1(this.toCompactHex())}toCompactHex(){return iY(this.r)+iY(this.s)}}function iF(...e){if(!e.every(e=>e instanceof Uint8Array))throw Error("Uint8Array list expected");if(1===e.length)return e[0];let t=e.reduce((e,t)=>e+t.length,0),r=new Uint8Array(t);for(let i=0,n=0;i<e.length;i++){let s=e[i];r.set(s,n),n+=s.length}return r}let i$=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function iz(e){if(!(e instanceof Uint8Array))throw Error("Expected Uint8Array");let t="";for(let r=0;r<e.length;r++)t+=i$[e[r]];return t}let iX=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function iY(e){if("bigint"!=typeof e)throw Error("Expected bigint");if(!(iR<=e&&e<iX))throw Error("Expected number 0 <= n < 2^256");return e.toString(16).padStart(64,"0")}function iQ(e){let t=i1(iY(e));if(32!==t.length)throw Error("Error: expected 32 bytes");return t}function i0(e){let t=e.toString(16);return 1&t.length?`0${t}`:t}function i2(e){if("string"!=typeof e)throw TypeError("hexToNumber: expected string, got "+typeof e);return BigInt(`0x${e}`)}function i1(e){if("string"!=typeof e)throw TypeError("hexToBytes: expected string, got "+typeof e);if(e.length%2)throw Error("hexToBytes: received invalid unpadded hex"+e.length);let t=new Uint8Array(e.length/2);for(let r=0;r<t.length;r++){let i=2*r,n=e.slice(i,i+2),s=Number.parseInt(n,16);if(Number.isNaN(s)||s<0)throw Error("Invalid byte sequence");t[r]=s}return t}function i3(e){return i2(iz(e))}function i6(e){return e instanceof Uint8Array?Uint8Array.from(e):i1(e)}function i5(e){if("number"==typeof e&&Number.isSafeInteger(e)&&e>0)return BigInt(e);if("bigint"==typeof e&&nt(e))return e;throw TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function i8(e,t=iI.P){let r=e%t;return r>=iR?r:t+r}function i4(e,t){let{P:r}=iI,i=e;for(;t-- >iR;)i*=i,i%=r;return i}function i7(e,t=iI.P){if(e===iR||t<=iR)throw Error(`invert: expected positive integers, got n=${e} mod=${t}`);let r=i8(e,t),i=t,n=iR,s=iT,o=iT,a=iR;for(;r!==iR;){let c=i/r,d=i%r,l=n-o*c,u=s-a*c;i=r,r=d,n=o,s=a,o=l,a=u}let p=i;if(p!==iT)throw Error("invert: does not exist");return i8(n,t)}function i9(e,t=!1){let r=function(e){let t=8*e.length-256,r=i3(e);return t>0?r>>BigInt(t):r}(e);if(t)return r;let{n:i}=iI;return r>=i?r-i:r}class ne{constructor(e,t){if(this.hashLen=e,this.qByteLen=t,"number"!=typeof e||e<2)throw Error("hashLen must be a number");if("number"!=typeof t||t<2)throw Error("qByteLen must be a number");this.v=new Uint8Array(e).fill(1),this.k=new Uint8Array(e).fill(0),this.counter=0}hmac(...e){return nf.hmacSha256(this.k,...e)}hmacSync(...e){return n(this.k,...e)}checkSync(){if("function"!=typeof n)throw new iM("hmacSha256Sync needs to be set")}incr(){if(this.counter>=1e3)throw Error("Tried 1,000 k values for sign(), all were invalid");this.counter+=1}async reseed(e=new Uint8Array){this.k=await this.hmac(this.v,Uint8Array.from([0]),e),this.v=await this.hmac(this.v),0!==e.length&&(this.k=await this.hmac(this.v,Uint8Array.from([1]),e),this.v=await this.hmac(this.v))}reseedSync(e=new Uint8Array){this.checkSync(),this.k=this.hmacSync(this.v,Uint8Array.from([0]),e),this.v=this.hmacSync(this.v),0!==e.length&&(this.k=this.hmacSync(this.v,Uint8Array.from([1]),e),this.v=this.hmacSync(this.v))}async generate(){this.incr();let e=0,t=[];for(;e<this.qByteLen;){this.v=await this.hmac(this.v);let r=this.v.slice();t.push(r),e+=this.v.length}return iF(...t)}generateSync(){this.checkSync(),this.incr();let e=0,t=[];for(;e<this.qByteLen;){this.v=this.hmacSync(this.v);let r=this.v.slice();t.push(r),e+=this.v.length}return iF(...t)}}function nt(e){return iR<e&&e<iI.n}function nr(e){return iR<e&&e<iI.P}function ni(e){let t;if("bigint"==typeof e)t=e;else if("number"==typeof e&&Number.isSafeInteger(e)&&e>0)t=BigInt(e);else if("string"==typeof e){if(64!==e.length)throw Error("Expected 32 bytes of private key");t=i2(e)}else if(e instanceof Uint8Array){if(32!==e.length)throw Error("Expected 32 bytes of private key");t=i3(e)}else throw TypeError("Expected valid private key");if(!nt(t))throw Error("Expected private key: 0 < key < n");return t}function nn(e){return e instanceof iL?(e.assertValidity(),e):iL.fromHex(e)}function ns(e){if(e instanceof iG)return e.assertValidity(),e;try{return iG.fromDER(e)}catch(t){return iG.fromCompact(e)}}function no(e,t=!1){return iL.fromPrivateKey(e).toRawBytes(t)}function na(e,t,r,i=!1){return iL.fromSignature(e,t,r).toRawBytes(i)}function nc(e){let t=e instanceof Uint8Array,r="string"==typeof e,i=(t||r)&&e.length;return t?33===i||65===i:r?66===i||130===i:e instanceof iL}function nd(e,t,r=!1){if(nc(e))throw TypeError("getSharedSecret: first arg must be private key");if(!nc(t))throw TypeError("getSharedSecret: second arg must be public key");let i=nn(t);return i.assertValidity(),i.multiply(ni(e)).toRawBytes(r)}function nl(e){let t=e.length>32?e.slice(0,32):e;return i3(t)}async function nu(e,t,r={}){let i;let{seed:n,m:s,d:o}=function(e,t,r){if(null==e)throw Error(`sign: expected valid message hash, not "${e}"`);let i=i6(e),n=ni(t),s=[iQ(n),function(e){let t=nl(e),r=i8(t,iI.n);return iQ(r<iR?t:r)}(i)];if(null!=r){!0===r&&(r=nf.randomBytes(32));let o=i6(r);if(32!==o.length)throw Error("sign: Expected 32 bytes of extra data");s.push(o)}let a=iF(...s),c=nl(i);return{seed:a,m:c,d:n}}(e,t,r.extraEntropy),a=new ne(32,32);for(await a.reseed(n);!(i=function(e,t,r,i=!0){let{n}=iI,s=i9(e,!0);if(!nt(s))return;let o=i7(s,n),a=iL.BASE.multiply(s),c=i8(a.x,n);if(c===iR)return;let d=i8(o*i8(t+r*c,n),n);if(d===iR)return;let l=new iG(c,d),u=(a.x===l.r?0:2)|Number(a.y&iT);return i&&l.hasHighS()&&(l=l.normalizeS(),u^=1),{sig:l,recovery:u}}(await a.generate(),s,o,r.canonical));)await a.reseed();return function(e,t){let{sig:r,recovery:i}=e,{der:n,recovered:s}=Object.assign({canonical:!0,der:!0},t),o=n?r.toDERRawBytes():r.toCompactRawBytes();return s?[o,i]:o}(i,r)}let np={strict:!0};iL.BASE._setWindowSize(8);let ny={node:iB,web:"object"==typeof self&&"crypto"in self?self.crypto:void 0},nh={},nf={bytesToHex:iz,hexToBytes:i1,concatBytes:iF,mod:i8,invert:i7,isValidPrivateKey(e){try{return ni(e),!0}catch(t){return!1}},_bigintTo32Bytes:iQ,_normalizePrivateKey:ni,hashToPrivateKey:e=>{if((e=i6(e)).length<40||e.length>1024)throw Error("Expected valid bytes of private key as per FIPS 186");let t=i8(i3(e),iI.n-iT)+iT;return iQ(t)},randomBytes:(e=32)=>{if(ny.web)return ny.web.getRandomValues(new Uint8Array(e));if(ny.node){let{randomBytes:t}=ny.node;return Uint8Array.from(t(e))}throw Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>nf.hashToPrivateKey(nf.randomBytes(40)),precompute(e=8,t=iL.BASE){let r=t===iL.BASE?t:new iL(t.x,t.y);return r._setWindowSize(e),r.multiply(iP),r},sha256:async(...e)=>{if(ny.web){let t=await ny.web.subtle.digest("SHA-256",iF(...e));return new Uint8Array(t)}if(ny.node){let{createHash:r}=ny.node,i=r("sha256");return e.forEach(e=>i.update(e)),Uint8Array.from(i.digest())}throw Error("The environment doesn't have sha256 function")},hmacSha256:async(e,...t)=>{if(ny.web){let r=await ny.web.subtle.importKey("raw",e,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),i=iF(...t),n=await ny.web.subtle.sign("HMAC",r,i);return new Uint8Array(n)}if(ny.node){let{createHmac:s}=ny.node,o=s("sha256",e);return t.forEach(e=>o.update(e)),Uint8Array.from(o.digest())}throw Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(e,...t)=>{let r=nh[e];if(void 0===r){let i=await nf.sha256(Uint8Array.from(e,e=>e.charCodeAt(0)));r=iF(i,i),nh[e]=r}return nf.sha256(r,...t)},taggedHashSync:(e,...t)=>{if("function"!=typeof i)throw new iM("sha256Sync is undefined, you need to set it");let r=nh[e];if(void 0===r){let n=i(Uint8Array.from(e,e=>e.charCodeAt(0)));r=iF(n,n),nh[e]=r}return i(r,...t)},_JacobianPoint:iV};Object.defineProperties(nf,{sha256Sync:{configurable:!1,get:()=>i,set(e){i||(i=e)}},hmacSha256Sync:{configurable:!1,get:()=>n,set(e){n||(n=e)}}}),Error("timeout while waiting for mutex to become available"),Error("mutex already locked");let nv=Error("request for lock canceled");class nm{constructor(e,t=nv){this._value=e,this._cancelError=t,this._weightedQueues=[],this._weightedWaiters=[]}acquire(e=1){if(e<=0)throw Error(`invalid weight ${e}: must be positive`);return new Promise((t,r)=>{this._weightedQueues[e-1]||(this._weightedQueues[e-1]=[]),this._weightedQueues[e-1].push({resolve:t,reject:r}),this._dispatch()})}runExclusive(e,t=1){var r,i,n,s;return r=this,i=void 0,n=void 0,s=function*(){let[r,i]=yield this.acquire(t);try{return yield e(r)}finally{i()}},new(n||(n=Promise))(function(e,t){function o(e){try{c(s.next(e))}catch(r){t(r)}}function a(e){try{c(s.throw(e))}catch(r){t(r)}}function c(t){var r;t.done?e(t.value):((r=t.value)instanceof n?r:new n(function(e){e(r)})).then(o,a)}c((s=s.apply(r,i||[])).next())})}waitForUnlock(e=1){if(e<=0)throw Error(`invalid weight ${e}: must be positive`);return new Promise(t=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),this._weightedWaiters[e-1].push(t),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatch()}release(e=1){if(e<=0)throw Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatch()}cancel(){this._weightedQueues.forEach(e=>e.forEach(e=>e.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var e;for(let t=this._value;t>0;t--){let r=null===(e=this._weightedQueues[t-1])||void 0===e?void 0:e.shift();if(!r)continue;let i=this._value,n=t;this._value-=t,t=this._value+1,r.resolve([i,this._newReleaser(n)])}this._drainUnlockWaiters()}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){for(let e=this._value;e>0;e--)this._weightedWaiters[e-1]&&(this._weightedWaiters[e-1].forEach(e=>e()),this._weightedWaiters[e-1]=[])}}class ng{constructor(e){this._semaphore=new nm(1,e)}acquire(){var e,t,r,i;return e=this,t=void 0,r=void 0,i=function*(){let[,e]=yield this._semaphore.acquire();return e},new(r||(r=Promise))(function(n,s){function o(e){try{c(i.next(e))}catch(t){s(t)}}function a(e){try{c(i.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((i=i.apply(e,t||[])).next())})}runExclusive(e){return this._semaphore.runExclusive(()=>e())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}var nw=r(86266),nb=r(34155),nS=r(48764).Buffer,nk=Object.create,nN=Object.defineProperty,nE=Object.getOwnPropertyDescriptor,nO=Object.getOwnPropertyNames,nA=Object.getPrototypeOf,nK=Object.prototype.hasOwnProperty,nB=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),nR=(e,t,r,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let n of nO(t))nK.call(e,n)||n===r||nN(e,n,{get:()=>t[n],enumerable:!(i=nE(t,n))||i.enumerable});return e},nT=(e,t,r)=>(r=null!=e?nk(nA(e)):{},nR(!t&&e&&e.__esModule?r:nN(r,"default",{value:e,enumerable:!0}),e)),nU=nB((e,t)=>{t.exports={webcrypto:window.crypto}}),nP=nB((e,t)=>{!function(){var e="input is invalid type",r="object"==typeof window,i=r?window:{};i.JS_SHA3_NO_WINDOW&&(r=!1);var n=!r&&"object"==typeof self;!i.JS_SHA3_NO_NODE_JS&&"object"==typeof nb&&nb.versions&&nb.versions.node?i=global:n&&(i=self);var s=!i.JS_SHA3_NO_COMMON_JS&&"object"==typeof t&&t.exports,o="function"==typeof define&&define.amd,a=!i.JS_SHA3_NO_ARRAY_BUFFER&&"u">typeof ArrayBuffer,c="0123456789abcdef".split(""),d=[4,1024,262144,67108864],l=[0,8,16,24],u=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648],p=[224,256,384,512],y=[128,256],h=["hex","buffer","arrayBuffer","array","digest"],f={128:168,256:136};(i.JS_SHA3_NO_NODE_JS||!Array.isArray)&&(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),a&&(i.JS_SHA3_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)&&(ArrayBuffer.isView=function(e){return"object"==typeof e&&e.buffer&&e.buffer.constructor===ArrayBuffer});for(var v=function(e,t,r){return function(i){return new U(e,t,e).update(i)[r]()}},m=function(e,t,r){return function(i,n){return new U(e,t,n).update(i)[r]()}},g=function(e,t,r){return function(t,i,n,s){return N["cshake"+e].update(t,i,n,s)[r]()}},w=function(e,t,r){return function(t,i,n,s){return N["kmac"+e].update(t,i,n,s)[r]()}},b=function(e,t,r,i){for(var n=0;n<h.length;++n){var s=h[n];e[s]=t(r,i,s)}return e},S=function(e,t){var r=v(e,t,"hex");return r.create=function(){return new U(e,t,e)},r.update=function(e){return r.create().update(e)},b(r,v,e,t)},k=[{name:"keccak",padding:[1,256,65536,16777216],bits:p,createMethod:S},{name:"sha3",padding:[6,1536,393216,100663296],bits:p,createMethod:S},{name:"shake",padding:[31,7936,2031616,520093696],bits:y,createMethod:function(e,t){var r=m(e,t,"hex");return r.create=function(r){return new U(e,t,r)},r.update=function(e,t){return r.create(t).update(e)},b(r,m,e,t)}},{name:"cshake",padding:d,bits:y,createMethod:function(e,t){var r=f[e],i=g(e,t,"hex");return i.create=function(i,n,s){return n||s?new U(e,t,i).bytepad([n,s],r):N["shake"+e].create(i)},i.update=function(e,t,r,n){return i.create(t,r,n).update(e)},b(i,g,e,t)}},{name:"kmac",padding:d,bits:y,createMethod:function(e,t){var r=f[e],i=w(e,t,"hex");return i.create=function(i,n,s){return new P(e,t,n).bytepad(["KMAC",s],r).bytepad([i],r)},i.update=function(e,t,r,n){return i.create(e,r,n).update(t)},b(i,w,e,t)}}],N={},E=[],O=0;O<k.length;++O)for(var A=k[O],K=A.bits,B=0;B<K.length;++B){var R=A.name+"_"+K[B];if(E.push(R),N[R]=A.createMethod(K[B],A.padding),"sha3"!==A.name){var T=A.name+K[B];E.push(T),N[T]=N[R]}}function U(e,t,r){this.blocks=[],this.s=[],this.padding=t,this.outputBits=r,this.reset=!0,this.finalized=!1,this.block=0,this.start=0,this.blockCount=1600-(e<<1)>>5,this.byteCount=this.blockCount<<2,this.outputBlocks=r>>5,this.extraBytes=(31&r)>>3;for(var i=0;i<50;++i)this.s[i]=0}function P(e,t,r){U.call(this,e,t,r)}U.prototype.update=function(t){if(this.finalized)throw Error("finalize already called");var r,i=typeof t;if("string"!==i){if("object"===i){if(null===t)throw Error(e);if(a&&t.constructor===ArrayBuffer)t=new Uint8Array(t);else if(!Array.isArray(t)&&(!a||!ArrayBuffer.isView(t)))throw Error(e)}else throw Error(e);r=!0}for(var n,s,o=this.blocks,c=this.byteCount,d=t.length,u=this.blockCount,p=0,y=this.s;p<d;){if(this.reset)for(this.reset=!1,o[0]=this.block,n=1;n<u+1;++n)o[n]=0;if(r)for(n=this.start;p<d&&n<c;++p)o[n>>2]|=t[p]<<l[3&n++];else for(n=this.start;p<d&&n<c;++p)(s=t.charCodeAt(p))<128?o[n>>2]|=s<<l[3&n++]:s<2048?(o[n>>2]|=(192|s>>6)<<l[3&n++],o[n>>2]|=(128|63&s)<<l[3&n++]):s<55296||s>=57344?(o[n>>2]|=(224|s>>12)<<l[3&n++],o[n>>2]|=(128|s>>6&63)<<l[3&n++],o[n>>2]|=(128|63&s)<<l[3&n++]):(s=65536+((1023&s)<<10|1023&t.charCodeAt(++p)),o[n>>2]|=(240|s>>18)<<l[3&n++],o[n>>2]|=(128|s>>12&63)<<l[3&n++],o[n>>2]|=(128|s>>6&63)<<l[3&n++],o[n>>2]|=(128|63&s)<<l[3&n++]);if(this.lastByteIndex=n,n>=c){for(this.start=n-c,this.block=o[u],n=0;n<u;++n)y[n]^=o[n];x(y),this.reset=!0}else this.start=n}return this},U.prototype.encode=function(e,t){var r=255&e,i=1,n=[r];for(e>>=8,r=255&e;r>0;)n.unshift(r),e>>=8,r=255&e,++i;return t?n.push(i):n.unshift(i),this.update(n),n.length},U.prototype.encodeString=function(t){var r,i=typeof t;if("string"!==i){if("object"===i){if(null===t)throw Error(e);if(a&&t.constructor===ArrayBuffer)t=new Uint8Array(t);else if(!Array.isArray(t)&&(!a||!ArrayBuffer.isView(t)))throw Error(e)}else throw Error(e);r=!0}var n=0,s=t.length;if(r)n=s;else for(var o=0;o<t.length;++o){var c=t.charCodeAt(o);c<128?n+=1:c<2048?n+=2:c<55296||c>=57344?n+=3:(c=65536+((1023&c)<<10|1023&t.charCodeAt(++o)),n+=4)}return n+=this.encode(8*n),this.update(t),n},U.prototype.bytepad=function(e,t){for(var r=this.encode(t),i=0;i<e.length;++i)r+=this.encodeString(e[i]);var n=t-r%t,s=[];return s.length=n,this.update(s),this},U.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex,r=this.blockCount,i=this.s;if(e[t>>2]|=this.padding[3&t],this.lastByteIndex===this.byteCount)for(e[0]=e[r],t=1;t<r+1;++t)e[t]=0;for(e[r-1]|=2147483648,t=0;t<r;++t)i[t]^=e[t];x(i)}},U.prototype.toString=U.prototype.hex=function(){this.finalize();for(var e,t=this.blockCount,r=this.s,i=this.outputBlocks,n=this.extraBytes,s=0,o=0,a="";o<i;){for(s=0;s<t&&o<i;++s,++o)a+=c[(e=r[s])>>4&15]+c[15&e]+c[e>>12&15]+c[e>>8&15]+c[e>>20&15]+c[e>>16&15]+c[e>>28&15]+c[e>>24&15];o%t==0&&(x(r),s=0)}return n&&(a+=c[(e=r[s])>>4&15]+c[15&e],n>1&&(a+=c[e>>12&15]+c[e>>8&15]),n>2&&(a+=c[e>>20&15]+c[e>>16&15])),a},U.prototype.arrayBuffer=function(){this.finalize();var e,t=this.blockCount,r=this.s,i=this.outputBlocks,n=this.extraBytes,s=0,o=0,a=this.outputBits>>3;e=new ArrayBuffer(n?i+1<<2:a);for(var c=new Uint32Array(e);o<i;){for(s=0;s<t&&o<i;++s,++o)c[o]=r[s];o%t==0&&x(r)}return n&&(c[s]=r[s],e=e.slice(0,a)),e},U.prototype.buffer=U.prototype.arrayBuffer,U.prototype.digest=U.prototype.array=function(){this.finalize();for(var e,t,r=this.blockCount,i=this.s,n=this.outputBlocks,s=this.extraBytes,o=0,a=0,c=[];a<n;){for(o=0;o<r&&a<n;++o,++a)e=a<<2,t=i[o],c[e]=255&t,c[e+1]=t>>8&255,c[e+2]=t>>16&255,c[e+3]=t>>24&255;a%r==0&&x(i)}return s&&(e=a<<2,t=i[o],c[e]=255&t,s>1&&(c[e+1]=t>>8&255),s>2&&(c[e+2]=t>>16&255)),c},P.prototype=new U,P.prototype.finalize=function(){return this.encode(this.outputBits,!0),U.prototype.finalize.call(this)};var x=function(e){var t,r,i,n,s,o,a,c,d,l,p,y,h,f,v,m,g,w,b,S,k,N,E,O,A,K,B,R,T,U,P,x,I,C,_,J,D,M,q,V,j,Z,L,W,H,G,F,$,z,X,Y,Q,ee,et,er,ei,en,es,eo,ea,ec,ed,el;for(i=0;i<48;i+=2)n=e[0]^e[10]^e[20]^e[30]^e[40],s=e[1]^e[11]^e[21]^e[31]^e[41],o=e[2]^e[12]^e[22]^e[32]^e[42],a=e[3]^e[13]^e[23]^e[33]^e[43],c=e[4]^e[14]^e[24]^e[34]^e[44],d=e[5]^e[15]^e[25]^e[35]^e[45],l=e[6]^e[16]^e[26]^e[36]^e[46],p=e[7]^e[17]^e[27]^e[37]^e[47],y=e[8]^e[18]^e[28]^e[38]^e[48],h=e[9]^e[19]^e[29]^e[39]^e[49],t=y^(o<<1|a>>>31),r=h^(a<<1|o>>>31),e[0]^=t,e[1]^=r,e[10]^=t,e[11]^=r,e[20]^=t,e[21]^=r,e[30]^=t,e[31]^=r,e[40]^=t,e[41]^=r,t=n^(c<<1|d>>>31),r=s^(d<<1|c>>>31),e[2]^=t,e[3]^=r,e[12]^=t,e[13]^=r,e[22]^=t,e[23]^=r,e[32]^=t,e[33]^=r,e[42]^=t,e[43]^=r,t=o^(l<<1|p>>>31),r=a^(p<<1|l>>>31),e[4]^=t,e[5]^=r,e[14]^=t,e[15]^=r,e[24]^=t,e[25]^=r,e[34]^=t,e[35]^=r,e[44]^=t,e[45]^=r,t=c^(y<<1|h>>>31),r=d^(h<<1|y>>>31),e[6]^=t,e[7]^=r,e[16]^=t,e[17]^=r,e[26]^=t,e[27]^=r,e[36]^=t,e[37]^=r,e[46]^=t,e[47]^=r,t=l^(n<<1|s>>>31),r=p^(s<<1|n>>>31),e[8]^=t,e[9]^=r,e[18]^=t,e[19]^=r,e[28]^=t,e[29]^=r,e[38]^=t,e[39]^=r,e[48]^=t,e[49]^=r,f=e[0],v=e[1],G=e[11]<<4|e[10]>>>28,F=e[10]<<4|e[11]>>>28,R=e[20]<<3|e[21]>>>29,T=e[21]<<3|e[20]>>>29,ea=e[31]<<9|e[30]>>>23,ec=e[30]<<9|e[31]>>>23,Z=e[40]<<18|e[41]>>>14,L=e[41]<<18|e[40]>>>14,C=e[2]<<1|e[3]>>>31,_=e[3]<<1|e[2]>>>31,m=e[13]<<12|e[12]>>>20,g=e[12]<<12|e[13]>>>20,$=e[22]<<10|e[23]>>>22,z=e[23]<<10|e[22]>>>22,U=e[33]<<13|e[32]>>>19,P=e[32]<<13|e[33]>>>19,ed=e[42]<<2|e[43]>>>30,el=e[43]<<2|e[42]>>>30,et=e[5]<<30|e[4]>>>2,er=e[4]<<30|e[5]>>>2,J=e[14]<<6|e[15]>>>26,D=e[15]<<6|e[14]>>>26,w=e[25]<<11|e[24]>>>21,b=e[24]<<11|e[25]>>>21,X=e[34]<<15|e[35]>>>17,Y=e[35]<<15|e[34]>>>17,x=e[45]<<29|e[44]>>>3,I=e[44]<<29|e[45]>>>3,O=e[6]<<28|e[7]>>>4,A=e[7]<<28|e[6]>>>4,ei=e[17]<<23|e[16]>>>9,en=e[16]<<23|e[17]>>>9,M=e[26]<<25|e[27]>>>7,q=e[27]<<25|e[26]>>>7,S=e[36]<<21|e[37]>>>11,k=e[37]<<21|e[36]>>>11,Q=e[47]<<24|e[46]>>>8,ee=e[46]<<24|e[47]>>>8,W=e[8]<<27|e[9]>>>5,H=e[9]<<27|e[8]>>>5,K=e[18]<<20|e[19]>>>12,B=e[19]<<20|e[18]>>>12,es=e[29]<<7|e[28]>>>25,eo=e[28]<<7|e[29]>>>25,V=e[38]<<8|e[39]>>>24,j=e[39]<<8|e[38]>>>24,N=e[48]<<14|e[49]>>>18,E=e[49]<<14|e[48]>>>18,e[0]=f^~m&w,e[1]=v^~g&b,e[10]=O^~K&R,e[11]=A^~B&T,e[20]=C^~J&M,e[21]=_^~D&q,e[30]=W^~G&$,e[31]=H^~F&z,e[40]=et^~ei&es,e[41]=er^~en&eo,e[2]=m^~w&S,e[3]=g^~b&k,e[12]=K^~R&U,e[13]=B^~T&P,e[22]=J^~M&V,e[23]=D^~q&j,e[32]=G^~$&X,e[33]=F^~z&Y,e[42]=ei^~es&ea,e[43]=en^~eo&ec,e[4]=w^~S&N,e[5]=b^~k&E,e[14]=R^~U&x,e[15]=T^~P&I,e[24]=M^~V&Z,e[25]=q^~j&L,e[34]=$^~X&Q,e[35]=z^~Y&ee,e[44]=es^~ea&ed,e[45]=eo^~ec&el,e[6]=S^~N&f,e[7]=k^~E&v,e[16]=U^~x&O,e[17]=P^~I&A,e[26]=V^~Z&C,e[27]=j^~L&_,e[36]=X^~Q&W,e[37]=Y^~ee&H,e[46]=ea^~ed&et,e[47]=ec^~el&er,e[8]=N^~f&m,e[9]=E^~v&g,e[18]=x^~O&K,e[19]=I^~A&B,e[28]=Z^~C&J,e[29]=L^~_&D,e[38]=Q^~W&G,e[39]=ee^~H&F,e[48]=ed^~et&ei,e[49]=el^~er&en,e[0]^=u[i],e[1]^=u[i+1]};if(s)t.exports=N;else{for(O=0;O<E.length;++O)i[E[O]]=N[E[O]];o&&define(function(){return N})}}()}),nx=e=>`/xmtp/0/${e}/proto`,nI=(e,t)=>{let r=[m.getAddress(e),m.getAddress(t)];return r.sort(),nx(`dm-${r.join("-")}`)},nC=e=>nx(`m-${e}`),n_=e=>nx(`contact-${m.getAddress(e)}`),nJ=e=>nx(`intro-${m.getAddress(e)}`),nD=e=>nx(`invite-${m.getAddress(e)}`),nM=e=>nx(`privatestore-${e}`),nq=e=>new Promise(t=>setTimeout(t,e)),nV=e=>!!e;async function nj(e,t,r,i,n=nV,s=1){let o="number"==typeof s?s:1;try{return await e(...t)}catch(a){if(!n(a)||o>r)throw a;return await nq(i),nj(e,t,r,i,n,o+1)}}async function*nZ(e,t){for await(let r of e){let i=await Promise.allSettled(r.map(t)),n=[];for(let s of i)"fulfilled"===s.status?n.push(s.value):console.warn("Failed to process envelope due to reason: ",s.reason);yield n}}function nL(e){return E.fromNumber(e.valueOf()).multiply(1e6)}function nW(e){return new Date(e.divide(1e6).toNumber())}var nH=e=>e&&nL(e).toString(),nG=e=>{if(e)return nW(E.fromString(e))},{b64Decode:nF,b64Encode:n$}=y;function nz(e,t){let r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}var nX=class{topics;client;messages;resolvers;callback;unsubscribeFn;constructor(e,t,r,i){this.messages=[],this.resolvers=[],this.topics=t,this.client=e,this.callback=this.newMessageCallback(r,i)}newMessageCallback(e,t){return async r=>{if(r.message)try{let i=await e(r);if(!i)return;if(t){let n=t(i);n&&this.resubscribeToTopics(n)}let s=this.resolvers.pop();s?s({value:i}):this.messages.unshift(i)}catch(o){console.warn(o)}}}async start(){if(!this.callback)throw Error("Missing callback for stream");this.unsubscribeFn=this.client.apiClient.subscribe({contentTopics:this.topics},async e=>{this.callback&&await this?.callback(e)})}static async create(e,t,r,i){let n=new nX(e,t,r,i);return await n.start(),n}[Symbol.asyncIterator](){return this}async return(){return this.unsubscribeFn&&await this.unsubscribeFn(),this.callback&&(this.callback=void 0,this.resolvers.forEach(e=>e({value:void 0,done:!0}))),{value:void 0,done:!0}}next(){let e=this.messages.pop();return e?Promise.resolve({value:e}):this.callback?new Promise(e=>this.resolvers.unshift(e)):Promise.resolve({value:void 0,done:!0})}async resubscribeToTopics(e){if(!this.callback||!this.unsubscribeFn)throw Error("Missing callback for stream");await this.unsubscribeFn(),this.topics=e,this.unsubscribeFn=this.client.apiClient.subscribe({contentTopics:this.topics},async e=>{this.callback&&await this?.callback(e)})}},nY=class{aes256GcmHkdfSha256;constructor(e){if(!e.aes256GcmHkdfSha256)throw Error("invalid ciphertext");if(e.aes256GcmHkdfSha256.payload.length<16)throw Error(`invalid ciphertext ciphertext length: ${e.aes256GcmHkdfSha256.payload.length}`);if(32!==e.aes256GcmHkdfSha256.hkdfSalt.length)throw Error(`invalid ciphertext salt length: ${e.aes256GcmHkdfSha256.hkdfSalt.length}`);if(12!==e.aes256GcmHkdfSha256.gcmNonce.length)throw Error(`invalid ciphertext nonce length: ${e.aes256GcmHkdfSha256.gcmNonce.length}`);this.aes256GcmHkdfSha256=e.aes256GcmHkdfSha256}toBytes(){return eL.encode(this).finish()}static fromBytes(e){return new nY(eL.decode(e))}},nQ=nT(nU(),1),n0=("object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0)??nQ.webcrypto,n2=new ArrayBuffer(0);async function n1(e){return new Uint8Array(await n0.subtle.digest("SHA-256",e))}async function n3(e,t,r){let i=n0.getRandomValues(new Uint8Array(32)),n=n0.getRandomValues(new Uint8Array(12)),s=await n0.subtle.encrypt(n5(n,r),await n8(t,i),e);return new nY({aes256GcmHkdfSha256:{payload:new Uint8Array(s),hkdfSalt:i,gcmNonce:n}})}async function n6(e,t,r){if(!e.aes256GcmHkdfSha256)throw Error("invalid payload ciphertext");let i=await n0.subtle.decrypt(n5(e.aes256GcmHkdfSha256.gcmNonce,r),await n8(t,e.aes256GcmHkdfSha256.hkdfSalt),e.aes256GcmHkdfSha256.payload);return new Uint8Array(i)}function n5(e,t){let r={name:"AES-GCM",iv:e};return t&&(r.additionalData=t),r}async function n8(e,t){let r=await n0.subtle.importKey("raw",e,"HKDF",!1,["deriveKey"]);return n0.subtle.deriveKey({name:"HKDF",hash:"SHA-256",salt:t,info:n2},r,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}var n4=nf.bytesToHex;function n7(e){e.startsWith("0x")&&(e=e.slice(2));let t=new Uint8Array(e.length/2);for(let r=0;r<t.length;r++){let i=2*r;t[r]=Number.parseInt(e.slice(i,i+2),16)}return t}function n9(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function se(e){if(32!==e.bytes.length)throw Error(`invalid private key length: ${e.bytes.length}`)}var st=class{createdNs;secp256k1;publicKey;constructor(e){if(!e.secp256k1)throw Error("invalid private key");if(se(e.secp256k1),this.secp256k1=e.secp256k1,this.createdNs=e.createdNs,!e.publicKey)throw Error("missing public key");this.publicKey=new sl(e.publicKey)}static async generate(e){let t={bytes:nf.randomPrivateKey()},r=E.fromNumber(new Date().getTime()).mul(1e6),i=await e.signKey(new sd({secp256k1Uncompressed:{bytes:no(t.bytes)},createdNs:r}));return new st({secp256k1:t,createdNs:r,publicKey:i})}generated(){return new Date(this.createdNs.div(1e6).toNumber())}async sign(e){let[t,r]=await nu(e,this.secp256k1.bytes,{recovered:!0,der:!1});return new so({ecdsaCompact:{bytes:t,recovery:r}})}async signKey(e){let t=e.toBytes(),r=await this.sign(await n1(t));return new sl({keyBytes:t,signature:r})}static async signerKey(e,t){return ss(await n1(e.bytesToSign()),t)}sharedSecret(e){return nd(this.secp256k1.bytes,e.secp256k1Uncompressed.bytes,!1)}encrypt(e,t,r){return n3(e,this.sharedSecret(t),r)}decrypt(e,t,r){return n6(e,this.sharedSecret(t),r)}matches(e){return this.publicKey.equals(e)}equals(e){return n9(this.secp256k1.bytes,e.secp256k1.bytes)&&this.publicKey.equals(e.publicKey)}toBytes(){return tG.encode(this).finish()}static fromBytes(e){return new st(tG.decode(e))}static fromLegacyKey(e,t){return new st({createdNs:e.timestamp.mul(1e6),secp256k1:e.secp256k1,publicKey:sl.fromLegacyKey(e.publicKey,t)})}},sr=class{timestamp;secp256k1;publicKey;constructor(e){if(!e.secp256k1)throw Error("invalid private key");if(se(e.secp256k1),this.timestamp=e.timestamp,this.secp256k1=e.secp256k1,!e.publicKey)throw Error("missing public key");this.publicKey=new su(e.publicKey)}static generate(){let e={bytes:nf.randomPrivateKey()},t=E.fromNumber(new Date().getTime());return new sr({secp256k1:e,timestamp:t,publicKey:new su({secp256k1Uncompressed:{bytes:no(e.bytes)},timestamp:t})})}generated(){return new Date(this.timestamp.toNumber())}async sign(e){let[t,r]=await nu(e,this.secp256k1.bytes,{recovered:!0,der:!1});return new so({ecdsaCompact:{bytes:t,recovery:r}})}async signKey(e){let t=await n1(e.bytesToSign());return e.signature=await this.sign(t),e}sharedSecret(e){return nd(this.secp256k1.bytes,e.secp256k1Uncompressed.bytes,!1)}encrypt(e,t,r){return n3(e,this.sharedSecret(t),r)}decrypt(e,t,r){return n6(e,this.sharedSecret(t),r)}matches(e){return this.publicKey.equals(e)}toBytes(){return tQ.encode(this).finish()}static fromBytes(e){return new sr(tQ.decode(e))}};function si(e){if(64!==e.bytes.length)throw Error(`invalid signature length: ${e.bytes.length}`);if(0!==e.recovery&&1!==e.recovery)throw Error(`invalid recovery bit: ${e.recovery}`)}function sn(e,t){return e.recovery===t.recovery&&n9(e.bytes,t.bytes)}function ss(e,t){let r=na(e,t.bytes,t.recovery);return r?new sd({secp256k1Uncompressed:{bytes:r},createdNs:E.fromNumber(0)}):void 0}var so=class{ecdsaCompact;walletEcdsaCompact;constructor(e){if(e.ecdsaCompact)si(e.ecdsaCompact),this.ecdsaCompact=e.ecdsaCompact;else if(e.walletEcdsaCompact)si(e.walletEcdsaCompact),this.walletEcdsaCompact=e.walletEcdsaCompact;else throw Error("invalid signature")}async signerKey(e){return this.ecdsaCompact?st.signerKey(e,this.ecdsaCompact):this.walletEcdsaCompact?sa.signerKey(e,this.walletEcdsaCompact):void 0}getPublicKey(e){let t;if(this.ecdsaCompact)t=na(e,this.ecdsaCompact.bytes,this.ecdsaCompact.recovery);else if(this.walletEcdsaCompact)t=na(e,this.walletEcdsaCompact.bytes,this.walletEcdsaCompact.recovery);else throw Error("invalid v1 signature");return t?new su({secp256k1Uncompressed:{bytes:t},timestamp:E.fromNumber(0)}):void 0}equals(e){return this.ecdsaCompact&&e.ecdsaCompact?sn(this.ecdsaCompact,e.ecdsaCompact):!!this.walletEcdsaCompact&&!!e.walletEcdsaCompact&&sn(this.walletEcdsaCompact,e.walletEcdsaCompact)}toBytes(){return el.encode(this).finish()}static fromBytes(e){return new so(el.decode(e))}},sa=class{wallet;constructor(e){this.wallet=e}static identitySigRequestText(e){return`XMTP : Create Identity
${n4(e)}

For more info: https://xmtp.org/signatures/`}static signerKey(e,t){return ss(n7(g.r(this.identitySigRequestText(e.bytesToSign()))),t)}async signKey(e){let t=e.toBytes(),r=await this.wallet.signMessage(sa.identitySigRequestText(t)),i=w.splitSignature(r),n=n7(i.r),s=n7(i.s),o=new Uint8Array(64);o.set(n),o.set(s,n.length);let a=new so({walletEcdsaCompact:{bytes:o,recovery:i.recoveryParam}});return new sl({keyBytes:t,signature:a})}},sc=new E(1e9).mul(1e9),sd=class{createdNs;secp256k1Uncompressed;constructor(e){if(!e?.secp256k1Uncompressed)throw Error("invalid public key");(function(e){if(65!==e.bytes.length)throw Error(`invalid public key length: ${e.bytes.length}`);if(4!==e.bytes[0])throw Error(`unrecognized public key prefix: ${e.bytes[0]}`)})(e.secp256k1Uncompressed),this.secp256k1Uncompressed=e.secp256k1Uncompressed,this.createdNs=e.createdNs.toUnsigned()}generated(){return new Date(this.timestamp.toNumber())}isFromLegacyKey(){return this.createdNs.lessThan(sc)}get timestamp(){return(this.isFromLegacyKey()?this.createdNs:this.createdNs.div(1e6)).toUnsigned()}verify(e,t){return!!e.ecdsaCompact&&function(e,t,r,i=np){let n,s;try{n=ns(e),t=i6(t)}catch(o){return!1}let{r:a,s:c}=n;if(i.strict&&n.hasHighS())return!1;let d=i9(t);try{s=nn(r)}catch(l){return!1}let{n:u}=iI,p=i7(c,u),y=i8(d*p,u),h=i8(a*p,u),f=iL.BASE.multiplyAndAddUnsafe(s,y,h);if(!f)return!1;let v=i8(f.x,u);return v===a}(e.ecdsaCompact.bytes,t,this.secp256k1Uncompressed.bytes)}async verifyKey(e){if(!e.signature)return!1;let t=await n1(e.bytesToSign());return this.verify(e.signature,t)}equals(e){return n9(this.secp256k1Uncompressed.bytes,e.secp256k1Uncompressed.bytes)}getEthereumAddress(){return b.computeAddress(this.secp256k1Uncompressed.bytes)}toBytes(){return eb.encode(this).finish()}static fromBytes(e){return new sd(eb.decode(e))}},sl=class extends sd{keyBytes;signature;constructor(e){if(!e.keyBytes)throw Error("missing key bytes");if(super(eb.decode(e.keyBytes)),this.keyBytes=e.keyBytes,!e.signature)throw Error("missing key signature");this.signature=new so(e.signature)}get unsignedKey(){return new sd({createdNs:this.createdNs,secp256k1Uncompressed:this.secp256k1Uncompressed})}signerKey(){return this.signature.signerKey(this)}async walletSignatureAddress(){if(!this.signature.walletEcdsaCompact)throw Error("key was not signed by a wallet");let e=await this.signerKey();if(!e)throw Error("key signature not valid");return e.getEthereumAddress()}equals(e){return this.unsignedKey.equals(e.unsignedKey)&&this.signature.equals(e.signature)}bytesToSign(){return this.keyBytes}toBytes(){return eE.encode(this).finish()}static fromBytes(e){return new sl(eE.decode(e))}toLegacyKey(){if(!this.isFromLegacyKey())throw Error("cannot be converted to legacy key");let e=this.signature;return e.walletEcdsaCompact&&(e=new so({ecdsaCompact:e.walletEcdsaCompact})),new su({timestamp:this.timestamp,secp256k1Uncompressed:this.secp256k1Uncompressed,signature:e})}static fromLegacyKey(e,t){if(!e.signature)throw Error("key is not signed");let r=e.signature;return t&&(r=new so({walletEcdsaCompact:r.ecdsaCompact})),new sl({keyBytes:e.bytesToSign(),signature:r})}},su=class extends sd{signature;constructor(e){super({createdNs:e.timestamp.mul(1e6),secp256k1Uncompressed:e.secp256k1Uncompressed}),e.signature&&(!e.signature.ecdsaCompact&&e.signature.walletEcdsaCompact?this.signature=new so({ecdsaCompact:{bytes:e.signature.walletEcdsaCompact.bytes,recovery:e.signature.walletEcdsaCompact.recovery}}):this.signature=new so(e.signature))}get timestamp(){return this.createdNs.div(1e6)}bytesToSign(){return eB.encode({timestamp:this.timestamp,secp256k1Uncompressed:this.secp256k1Uncompressed}).finish()}async signWithWallet(e){let t=await e.signMessage(sa.identitySigRequestText(this.bytesToSign())),r=w.splitSignature(t),i=n7(r.r),n=n7(r.s),s=new Uint8Array(64);s.set(i),s.set(n,i.length),this.signature=new so({ecdsaCompact:{bytes:s,recovery:r.recoveryParam}})}walletSignatureAddress(){if(!this.signature)throw Error("key is not signed");let e=n7(g.r(sa.identitySigRequestText(this.bytesToSign()))),t=this.signature.getPublicKey(e);if(!t)throw Error("key signature is malformed");return t.getEthereumAddress()}toBytes(){return eB.encode(this).finish()}static fromBytes(e){return new su(eB.decode(e))}},sp=class{identityKey;preKey;constructor(e){if(!e.identityKey)throw Error("missing identity key");if(!e.preKey)throw Error("missing pre-key");this.identityKey=new sl(e.identityKey),this.preKey=new sl(e.preKey)}walletSignatureAddress(){return this.identityKey.walletSignatureAddress()}equals(e){return this.identityKey.equals(e.identityKey)&&this.preKey.equals(e.preKey)}toBytes(){return eA.encode(this).finish()}isFromLegacyBundle(){return this.identityKey.isFromLegacyKey()&&this.preKey.isFromLegacyKey()}toLegacyBundle(){return new sy({identityKey:this.identityKey.toLegacyKey(),preKey:this.preKey.toLegacyKey()})}static fromBytes(e){let t=eA.decode(e);return new sp(t)}static fromLegacyBundle(e){return new sp({identityKey:sl.fromLegacyKey(e.identityKey,!0),preKey:sl.fromLegacyKey(e.preKey)})}},sy=class{identityKey;preKey;constructor(e){if(!e.identityKey)throw Error("missing identity key");if(!e.preKey)throw Error("missing pre-key");this.identityKey=new su(e.identityKey),this.preKey=new su(e.preKey)}equals(e){return this.identityKey.equals(e.identityKey)&&this.preKey.equals(e.preKey)}walletSignatureAddress(){return this.identityKey.walletSignatureAddress()}toBytes(){return eP.encode(this).finish()}static fromBytes(e){let t=eP.decode(e);return new sy(t)}},sh=class extends Error{constructor(e){super(`no pre-key matches: ${n4(e.secp256k1Uncompressed.bytes)}`)}},sf=class{identityKey;preKeys;version=2;_publicKeyBundle;constructor(e){if(!e.identityKey)throw Error("missing identity key");this.identityKey=new st(e.identityKey),this.preKeys=(e.preKeys||[]).map(e=>new st(e))}static async generate(e){let t=await st.generate(new sa(e)),r=new sf({identityKey:t,preKeys:[]});return await r.addPreKey(),r}getCurrentPreKey(){return this.preKeys[0]}findPreKey(e){let t=this.preKeys.find(t=>t.matches(e));if(!t)throw new sh(e);return t}async addPreKey(){this._publicKeyBundle=void 0;let e=await st.generate(this.identityKey);this.preKeys.unshift(e)}getPublicKeyBundle(){return this._publicKeyBundle||(this._publicKeyBundle=new sp({identityKey:this.identityKey.publicKey,preKey:this.getCurrentPreKey().publicKey})),this._publicKeyBundle}async sharedSecret(e,t,r){let i,n,s;if(!e.identityKey||!e.preKey)throw Error("invalid peer key bundle");if(!await e.identityKey.verifyKey(e.preKey))throw Error("peer preKey signature invalid");if(!this.identityKey)throw Error("missing identity key");r?(i=(s=this.findPreKey(t)).sharedSecret(e.identityKey),n=this.identityKey.sharedSecret(e.preKey)):(s=this.findPreKey(t),i=this.identityKey.sharedSecret(e.preKey),n=s.sharedSecret(e.identityKey));let o=s.sharedSecret(e.preKey),a=new Uint8Array(i.length+n.length+o.length);return a.set(i,0),a.set(n,i.length),a.set(o,i.length+n.length),a}encode(){return t5.encode({v1:void 0,v2:this}).finish()}equals(e){if(this.preKeys.length!==e.preKeys.length)return!1;for(let t=0;t<this.preKeys.length;t++)if(!this.preKeys[t].equals(e.preKeys[t]))return!1;return this.identityKey.equals(e.identityKey)}static fromLegacyBundle(e){return new sf({identityKey:st.fromLegacyKey(e.identityKey,!0),preKeys:e.preKeys.map(e=>st.fromLegacyKey(e))})}},sv=class{identityKey;preKeys;version=1;_publicKeyBundle;constructor(e){if(!e.identityKey)throw Error("missing identity key");this.identityKey=new sr(e.identityKey),this.preKeys=(e.preKeys||[]).map(e=>new sr(e))}static async generate(e){let t=sr.generate();e&&await t.publicKey.signWithWallet(e);let r=new sv({identityKey:t,preKeys:[]});return await r.addPreKey(),r}getCurrentPreKey(){return this.preKeys[0]}findPreKey(e){let t=this.preKeys.find(t=>t.matches(e));if(!t)throw new sh(e);return t}async addPreKey(){this._publicKeyBundle=void 0;let e=sr.generate();await this.identityKey.signKey(e.publicKey),this.preKeys.unshift(e)}getPublicKeyBundle(){return this._publicKeyBundle||(this._publicKeyBundle=new sy({identityKey:this.identityKey.publicKey,preKey:this.getCurrentPreKey().publicKey})),this._publicKeyBundle}async sharedSecret(e,t,r){let i,n,s;if(!e.identityKey||!e.preKey)throw Error("invalid peer key bundle");if(!await e.identityKey.verifyKey(e.preKey))throw Error("peer preKey signature invalid");if(!this.identityKey)throw Error("missing identity key");r?(i=(s=this.findPreKey(t)).sharedSecret(e.identityKey),n=this.identityKey.sharedSecret(e.preKey)):(s=this.findPreKey(t),i=this.identityKey.sharedSecret(e.preKey),n=s.sharedSecret(e.identityKey));let o=s.sharedSecret(e.preKey),a=new Uint8Array(i.length+n.length+o.length);return a.set(i,0),a.set(n,i.length),a.set(o,i.length+n.length),a}encode(){return t5.encode({v1:this,v2:void 0}).finish()}};function sm(e){let t=t5.decode(e);if(t.v1)return new sv(t.v1);if(t.v2)return new sf(t.v2);throw Error("unknown private key bundle version")}var sg=e=>{if(16!==e.iv.length)throw Error("Invalid iv length");if(65!==e.ephemeralPublicKey.length)throw Error("Invalid ephemPublicKey length");if(e.ciphertext.length<1||e.ciphertext.length%16!=0)throw Error("Invalid ciphertext length");if(32!==e.mac.length)throw Error("Invalid mac length")},sw=class{eciesBytes;signature;ciphertext;constructor({eciesBytes:e,signature:t}){if(!e||!e.length)throw Error("eciesBytes is empty");if(!t)throw Error("signature is undefined");this.eciesBytes=e,this.signature=new so(t),this.ciphertext=ez.decode(e)}toBytes(){return eF.encode(this).finish()}async verify(e){return e.verify(this.signature,await n1(this.eciesBytes))}static fromBytes(e){let t=eF.decode(e);return new sw(t)}static async create(e,t){sg(e);let r=ez.encode(e).finish(),i=await t.sign(await n1(r));return new sw({eciesBytes:r,signature:i})}},sb=class{messageEnvelope;onSend;constructor(e,t){this.messageEnvelope=e,this.onSend=t}async messageID(){if(!this.messageEnvelope.message)throw Error("no envelope message");return n4(await n1(this.messageEnvelope.message))}async send(){await this.onSend()}},sS=class extends Error{code;constructor(e,t){super(t),this.code=e}},sk=e=>{if(e.error)throw new sS(e.error.code,e.error.message);if(!e.result)throw new sS(u.ERROR_CODE_UNSPECIFIED,"No result from Keystore");if("encrypted"in e.result&&!e.result.encrypted)throw Error("Missing ciphertext");if("decrypted"in e.result&&!e.result.decrypted)throw Error("Missing decrypted result");return e.result},sN=(e,t)=>({requests:e.map(e=>{let r=new sy({identityKey:e.header.sender?.identityKey,preKey:e.header.sender?.preKey}),i=t.equals(r);return{payload:e.ciphertext,peerKeys:i?new sy({identityKey:e.header.recipient?.identityKey,preKey:e.header.recipient?.preKey}):r,headerBytes:e.headerBytes,isSender:i}})}),sE=class{authorityId;typeId;versionMajor;versionMinor;constructor(e){this.authorityId=e.authorityId,this.typeId=e.typeId,this.versionMajor=e.versionMajor,this.versionMinor=e.versionMinor}toString(){return`${this.authorityId}/${this.typeId}:${this.versionMajor}.${this.versionMinor}`}sameAs(e){return this.authorityId===e.authorityId&&this.typeId===e.typeId}},sO=new sE({authorityId:"xmtp.org",typeId:"fallback",versionMajor:1,versionMinor:0}),sA=new sE({authorityId:"xmtp.org",typeId:"text",versionMajor:1,versionMinor:0}),sK=class{get contentType(){return sA}encode(e){return{type:sA,parameters:{encoding:"UTF-8"},content:new TextEncoder().encode(e)}}decode(e){let t=e.parameters.encoding;if(t&&"UTF-8"!==t)throw Error(`unrecognized encoding ${t}`);return new TextDecoder().decode(e.content)}},sB=class{peerAddress;createdAt;context=void 0;client;constructor(e,t,r){this.peerAddress=m.getAddress(t),this.client=e,this.createdAt=r}get clientAddress(){return this.client.address}get topic(){return nI(this.peerAddress,this.client.address)}get ephemeralTopic(){return nI(this.peerAddress,this.client.address).replace("/xmtp/0/dm-","/xmtp/0/dmE-")}async messages(e){let t=nI(this.peerAddress,this.client.address),r=await this.client.listEnvelopes(t,this.processEnvelope.bind(this),e);return this.decryptBatch(r,t,!1)}messagesPaginated(e){return this.client.listEnvelopesPaginated(this.topic,this.decodeMessage.bind(this),e)}async decodeMessage(e){if(!e.contentTopic)throw Error("Missing content topic");let t=await this.decryptBatch([await this.processEnvelope(e)],e.contentTopic,!0);if(!t.length)throw Error("No results");return t[0]}async prepareMessage(e,t){let r,i=await this.client.getUserContact(this.peerAddress);if(!i)throw Error(`recipient ${this.peerAddress} is not registered`);i instanceof sy||(i=i.toLegacyBundle()),this.client.contacts.has(this.peerAddress)?r=[this.topic]:(r=[nJ(this.peerAddress),nJ(this.client.address),this.topic],this.client.contacts.add(this.peerAddress));let n=await this.createMessage(await this.client.encodeContent(e,t),i,t?.timestamp),s={contentTopic:this.topic,message:n.toBytes(),timestampNs:nH(n.sent)};return new sb(s,async()=>{await this.client.publishEnvelopes(r.map(e=>({contentTopic:e,message:n.toBytes(),timestamp:n.sent})))})}streamMessages(){return nX.create(this.client,[this.topic],async e=>this.decodeMessage(e))}async processEnvelope({message:e,contentTopic:t}){let r=await sD.fromBytes(nF(e)),{senderAddress:i,recipientAddress:n}=r;if(!i||!n||!t||nI(i,n)!==this.topic)throw Error("Headers do not match intended recipient");return r}streamEphemeral(){return nX.create(this.client,[this.ephemeralTopic],this.decodeMessage.bind(this))}async send(e,t){let r,i=await this.client.getUserContact(this.peerAddress);if(!i)throw Error(`recipient ${this.peerAddress} is not registered`);i instanceof sy||(i=i.toLegacyBundle());let n=t?.ephemeral?this.ephemeralTopic:this.topic;this.client.contacts.has(this.peerAddress)?r=[this.topic]:(r=[nJ(this.peerAddress),nJ(this.client.address),n],this.client.contacts.add(this.peerAddress));let s=t?.contentType||sA,o=await this.client.encodeContent(e,t),a=await this.createMessage(o,i,t?.timestamp);return await this.client.publishEnvelopes(r.map(e=>({contentTopic:e,message:a.toBytes(),timestamp:a.sent}))),sq.fromV1Message(a,e,s,o,r[0],this)}async decryptBatch(e,t,r=!1){let i=(await this.client.keystore.decryptV1(sN(e,this.client.publicKeyBundle))).responses,n=[];for(let s=0;s<i.length;s++){let o=i[s],a=e[s];try{let{decrypted:c}=sk(o);n.push(await this.buildDecodedMessage(a,c,t))}catch(d){if(r)throw d;console.warn("Error decoding content",d)}}return n}async buildDecodedMessage(e,t,r){let{content:i,contentType:n,error:s}=await sV(t,this.client);return sq.fromV1Message(e,i,n,t,r,this,s)}async createMessage(e,t,r){return r=r||new Date,sD.encode(this.client.keystore,e,this.client.publicKeyBundle,t,r)}},sR=class{client;topic;peerAddress;createdAt;context;constructor(e,t,r,i,n){this.topic=t,this.createdAt=i,this.context=n,this.client=e,this.peerAddress=r}get clientAddress(){return this.client.address}async messages(e){let t=await this.client.listEnvelopes(this.topic,this.processEnvelope.bind(this),e);return this.decryptBatch(t,!1)}messagesPaginated(e){return this.client.listEnvelopesPaginated(this.topic,this.decodeMessage.bind(this),e)}get ephemeralTopic(){return this.topic.replace("/xmtp/0/m","/xmtp/0/mE")}streamEphemeral(){return nX.create(this.client,[this.ephemeralTopic],this.decodeMessage.bind(this))}streamMessages(){return nX.create(this.client,[this.topic],this.decodeMessage.bind(this))}async send(e,t){let r=await this.client.encodeContent(e,t),i=await this.createMessage(r,t?.timestamp);await this.client.publishEnvelopes([{contentTopic:t?.ephemeral?this.ephemeralTopic:this.topic,message:i.toBytes(),timestamp:i.sent}]);let n=t?.contentType||sA;return sq.fromV2Message(i,e,n,this.topic,r,this,this.client.address)}async createMessage(e,t){let r={topic:this.topic,createdNs:nL(t||new Date)},i=tv.encode(r).finish(),n=await this.encryptMessage(tJ.encode({payload:e,sender:this.client.signedPublicKeyBundle,signature:await this.client.keystore.signDigest({digest:await n1(nz(i,e)),prekeyIndex:0,identityKey:void 0})}).finish(),i),s={v1:void 0,v2:{headerBytes:i,ciphertext:n}},o=tb.encode(s).finish();return sM.create(s,r,o)}async decryptBatch(e,t=!1){let r=(await this.client.keystore.decryptV2(this.buildDecryptRequest(e))).responses,i=[];for(let n=0;n<r.length;n++){let s=r[n],o=e[n];try{let{decrypted:a}=sk(s);i.push(await this.buildDecodedMessage(o,a))}catch(c){if(t)throw c;console.warn("Error decoding content",c)}}return i}buildDecryptRequest(e){return{requests:e.map(e=>({payload:e.ciphertext,headerBytes:e.headerBytes,contentTopic:this.topic}))}}async encryptMessage(e,t){let{responses:r}=await this.client.keystore.encryptV2({requests:[{payload:e,headerBytes:t,contentTopic:this.topic}]});if(1!==r.length)throw Error("Invalid response length");let{encrypted:i}=sk(r[0]);return i}async buildDecodedMessage(e,t){let r=tJ.decode(t);if(!r.sender?.identityKey||!r.sender?.preKey||!r.signature)throw Error("incomplete signed content");await sT(r);let i=await n1(nz(e.headerBytes,r.payload));if(!new sl(r.sender?.preKey).verify(new so(r.signature),i))throw Error("invalid signature");let n=await new sp(r.sender).walletSignatureAddress(),{content:s,contentType:o,error:a}=await sV(r.payload,this.client);return sq.fromV2Message(e,s,o,this.topic,r.payload,this,n,a)}async prepareMessage(e,t){let r=await this.createMessage(await this.client.encodeContent(e,t),t?.timestamp),i={contentTopic:t?.ephemeral?this.ephemeralTopic:this.topic,message:r.toBytes(),timestampNs:nH(r.sent)};return new sb(i,async()=>{await this.client.publishEnvelopes([{contentTopic:this.topic,message:r.toBytes(),timestamp:r.sent}])})}async processEnvelope(e){if(!e.message||!e.contentTopic)throw Error("empty envelope");let t=nF(e.message.toString()),r=tb.decode(t);if(!r.v2)throw Error("unknown message version");let i=tv.decode(r.v2.headerBytes);if(i.topic!==this.topic)throw Error("topic mismatch");return sM.create(r,i,t)}async decodeMessage(e){if(!e.contentTopic)throw Error("Missing content topic");let t=await this.decryptBatch([await this.processEnvelope(e)],!0);if(!t.length)throw Error("No results");return t[0]}};async function sT(e){let t=e.sender?.preKey;if(!t||!t.signature||!t.keyBytes)throw Error("missing pre-key or pre-key signature");let r=e.sender?.identityKey;if(!r)throw Error("missing identity key in bundle");if(!await new sl(r).verifyKey(new sl(t)))throw Error("pre key not signed by identity key")}async function sU(e,t){if(void 0===e.compression)return;let r={bytes:new Uint8Array(e.content.length)};await sI(e.content).pipeThrough(new DecompressionStream(sx(e.compression))).pipeTo(sC(r,t)),e.content=r.bytes}async function sP(e){if(void 0===e.compression)return;let t={bytes:new Uint8Array(e.content.length/10)};await sI(e.content).pipeThrough(new CompressionStream(sx(e.compression))).pipeTo(sC(t,e.content.length+1e3)),e.content=t.bytes}function sx(e){if(e===l.COMPRESSION_GZIP)return"gzip";if(e===l.COMPRESSION_DEFLATE)return"deflate";throw Error("unrecognized compression algorithm")}function sI(e,t=1024){let r=0;return new ReadableStream({pull(i){if(r>=e.length)return i.close();let n=r+t;n=n<=e.length?n:e.length,i.enqueue(e.subarray(r,n)),r=n}})}function sC(e,t){let r=0;return new WritableStream({write(i){let n=r+i.length;if(n>t)throw Error("maximum output size exceeded");for(;e.bytes.length<n;)e.bytes=function(e,t){let r=2*e.length;r>t&&(r=t);let i=new Uint8Array(r);return i.set(e),i}(e.bytes,t);e.bytes.set(i,r),r=n},close(){r<e.bytes.length&&(e.bytes=e.bytes.subarray(0,r))}})}var s_=e=>{if(e.v1?.ciphertext)return[e.v1.headerBytes,new nY(e.v1.ciphertext)];if(e.v2?.ciphertext)return[e.v2.headerBytes,new nY(e.v2.ciphertext)];throw Error("unknown message version")},sJ=class{headerBytes;ciphertext;contentType;error;id;bytes;constructor(e,t,r){[this.headerBytes,this.ciphertext]=s_(r),this.id=e,this.bytes=t}toBytes(){return this.bytes}},sD=class extends sJ{header;senderAddress;conversation=void 0;constructor(e,t,r,i,n){super(e,t,r),this.senderAddress=n,this.header=i}static async create(e,t,r){if(!t.sender)throw Error("missing message sender");let i=new sy(t.sender).walletSignatureAddress(),n=n4(await n1(r));return new sD(n,r,e,t,i)}get sent(){return new Date(this.header.timestamp.toNumber())}get recipientAddress(){if(this.header?.recipient?.identityKey)return new su(this.header.recipient.identityKey).walletSignatureAddress()}async decrypt(e,t){let r=(await e.decryptV1(sN([this],t))).responses;if(!r.length)throw Error("No response from Keystore");let{decrypted:i}=sk(r[0]);return i}static fromBytes(e){let t=tb.decode(e),[r]=s_(t),i=tp.decode(r);if(!i)throw Error("missing message header");if(!i.sender)throw Error("missing message sender");if(!i.sender.identityKey)throw Error("missing message sender identity key");if(!i.sender.preKey)throw Error("missing message sender pre-key");if(!i.recipient)throw Error("missing message recipient");if(!i.recipient.identityKey)throw Error("missing message recipient identity-key");if(!i.recipient.preKey)throw Error("missing message recipient pre-key");return sD.create(t,i,e)}static async encode(e,t,r,i,n){let s={sender:r,recipient:i,timestamp:E.fromNumber(n.getTime())},o=tp.encode(s).finish(),a=await e.encryptV1({requests:[{recipient:i,headerBytes:o,payload:t}]});if(!a.responses.length)throw Error("No response from Keystore");let{encrypted:c}=sk(a.responses[0]),d={v1:{headerBytes:o,ciphertext:c},v2:void 0},l=tb.encode(d).finish();return sD.create(d,s,l)}},sM=class extends sJ{senderAddress;header;constructor(e,t,r,i){super(e,t,r),this.header=i}static async create(e,t,r){let i=n4(await n1(r));return new sM(i,r,e,t)}get sent(){return nW(this.header.createdNs)}},sq=class{id;messageVersion;senderAddress;recipientAddress;sent;contentTopic;conversation;contentType;content;error;contentBytes;constructor({id:e,messageVersion:t,senderAddress:r,recipientAddress:i,conversation:n,contentBytes:s,contentType:o,contentTopic:a,content:c,sent:d,error:l}){this.id=e,this.messageVersion=t,this.senderAddress=r,this.recipientAddress=i,this.conversation=n,this.contentType=o,this.sent=d,this.error=l,this.content=c,this.contentTopic=a,this.contentBytes=s}toBytes(){return tk.encode({...this,conversation:{topic:this.conversation.topic,context:this.conversation.context??void 0,createdNs:nL(this.conversation.createdAt),peerAddress:this.conversation.peerAddress},sentNs:nL(this.sent)}).finish()}static async fromBytes(e,t){let r=tk.decode(e),i=r.messageVersion;if("v1"!==i&&"v2"!==i)throw Error("Invalid message version");if(!r.conversation)throw Error("No conversation reference found");let{content:n,contentType:s,error:o}=await sV(r.contentBytes,t);return new sq({...r,content:n,contentType:s,error:o,messageVersion:i,sent:nW(r.sentNs),conversation:function(e,t,r){if("v1"===r)return new sB(t,e.peerAddress,nW(e.createdNs));if("v2"===r)return new sR(t,e.topic,e.peerAddress,nW(e.createdNs),e.context);throw Error(`Unknown conversation version ${r}`)}(r.conversation,t,i)})}static fromV1Message(e,t,r,i,n,s,o){let{id:a,senderAddress:c,recipientAddress:d,sent:l}=e;if(!c)throw Error("Sender address is required");return new sq({id:a,messageVersion:"v1",senderAddress:c,recipientAddress:d,sent:l,content:t,contentBytes:i,contentType:r,contentTopic:n,conversation:s,error:o})}static fromV2Message(e,t,r,i,n,s,o,a){let{id:c,sent:d}=e;return new sq({id:c,messageVersion:"v2",senderAddress:o,sent:d,content:t,contentBytes:n,contentType:r,contentTopic:i,conversation:s,error:a})}};async function sV(e,t){let r=tx.decode(e);if(!r.type)throw Error("missing content type");let i,n=new sE(r.type),s;await sU(r,1e3);let o=t.codecFor(n);return o?i=o.decode(r,t):(s=Error("unknown content type "+n),r.fallback&&(i=r.fallback,n=sO)),{content:i,contentType:n,error:s}}var sj=class{authenticator;token;maxAgeMs;constructor(e,t=3590){this.authenticator=e,this.maxAgeMs=1e3*t}async getToken(){return(!this.token||this.token.ageMs>this.maxAgeMs)&&await this.refresh(),this.token.toBase64()}async refresh(){this.token=await this.authenticator.createToken()}},sZ={name:"@xmtp/xmtp-js",version:"9.1.7",description:"XMTP client SDK for interacting with XMTP networks.",type:"module",main:"dist/index.cjs",module:"dist/index.js",types:"dist/index.d.ts",browser:"dist/web/index.js",exports:{".":{types:"./dist/index.d.ts",browser:"./dist/web/index.js",import:"./dist/index.js",require:"./dist/index.cjs"}},scripts:{prebench:"npm run build:bench",bench:"node dist/bench/index.cjs",build:"npm run clean:dist && npm run build:node && npm run build:web","build:bench":"tsup --out-dir dist/bench --entry.0 bench/index.ts --format cjs","build:node":"tsup","build:web":"tsup --platform browser --target esnext","build:docs":"rimraf docs && mkdir -p tmp && cp README.md tmp/ && sed -i.bak '/badge.svg/d' tmp/README.md && typedoc --excludePrivate --readme tmp/README.md src/index.ts",clean:"npm run clean:dist && npm run clean:proto","clean:dist":"rimraf dist","clean:proto":"rimraf -g src/proto/*.ts",package:"npm pack",prepublishOnly:"npm run build","test:setup":"./dev/up","test:teardown":"./dev/down",test:"npm run test:node","test:node":"jest --no-cache --env='node' --testTimeout=30000","test:jsdom":"jest --no-cache --env='./jest.jsdom.env.cjs' --testTimeout=30000","test:cov":"jest --coverage --no-cache --runInBand",lint:"prettier --check . && eslint .",autolint:"prettier --write . && eslint --fix .","semantic-release":"semantic-release"},publishConfig:{access:"public",provenance:!0},files:["dist/index.cjs","dist/index.cjs.map","dist/index.d.ts","dist/index.js","dist/index.js.map","dist/web/index.js","dist/web/index.js.map"],keywords:["xmtp","messaging","web3","sdk","js","javascript","node","nodejs"],author:"XMTP Labs <eng@xmtp.com>",license:"MIT",homepage:"https://github.com/xmtp/xmtp-js",repository:{type:"git",url:"https:git@github.com:xmtp/xmtp-js.git"},bugs:{url:"https://github.com/xmtp/xmtp-js/issues"},release:{branches:["main",{name:"beta",prerelease:!0}]},dependencies:{"@noble/secp256k1":"^1.5.2","@xmtp/proto":"^3.24.0","async-mutex":"^0.4.0",elliptic:"^6.5.4",ethers:"^5.5.3",long:"^5.2.0"},devDependencies:{"@commitlint/cli":"^16.1.0","@commitlint/config-conventional":"^16.0.0","@types/benchmark":"^2.1.2","@types/bl":"^5.0.2","@types/callback-to-async-iterator":"^1.1.4","@types/elliptic":"^6.4.14","@types/jest":"^28.1.3","@types/node":"^18.14.0","@typescript-eslint/eslint-plugin":"^5.38.0","@typescript-eslint/parser":"^5.38.0",benny:"^3.7.1","dd-trace":"^2.12.2",esbuild:"^0.17.16","esbuild-plugin-external-global":"^1.0.1",eslint:"^8.0.1","eslint-config-prettier":"^8.3.0","eslint-config-standard":"^17.0.0","eslint-plugin-import":"^2.26.0","eslint-plugin-jsdoc":"^37.9.1","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.0.0","eslint-plugin-promise":"^6.0.1",husky:"^7.0.4",jest:"^28.1.3","jest-environment-jsdom":"^28.1.3",prettier:"^2.4.0",rimraf:"^5.0.0","semantic-release":"^21.0.3","ts-jest":"^28.0.0","ts-node":"^10.9.1",tsup:"^6.7.0",typedoc:"^0.22.11",typescript:"^4.4.3"},engines:{node:">=18"}},sL=`
XX    XX MM    MM TTTTTT PPPPPP   DDDDD   EEEEEEE VV     VV 
 XX  XX  MMM  MMM   TT   PP   PP  DD  DD  EE      VV     VV 
  XXXX   MM MM MM   TT   PPPPPP   DD   DD EEEEE    VV   VV  
 XX  XX  MM    MM   TT   PP       DD   DD EE        VV VV   
XX    XX MM    MM   TT   PP       DDDDDD  EEEEEEE    VVV    

Connected to the XMTP 'dev' network. Use 'production' for production messages.
https://github.com/xmtp/xmtp-js#xmtp-production-and-dev-network-environments
`,{MessageApi:sW,SortDirection:sH}=h,sG={local:"http://localhost:5555",dev:"https://dev.xmtp.network",production:"https://production.xmtp.network"},sF=class extends Error{code;constructor(e,t){super(e),this.code=t}static fromObject(e){return new sF(e.message,e.code)}},s$=e=>!!e&&!!("AbortError"===e.name||e.message.includes("aborted")),sz=e=>!!(e&&"code"in e&&16===e.code),sX=e=>!sz(e),sY=class{pathPrefix;maxRetries;authCache;appVersion;version;constructor(e,t){this.pathPrefix=e,this.maxRetries=t?.maxRetries||5,this.appVersion=t?.appVersion,this.version="xmtp-js/"+sZ.version,e===sG.dev&&console.info(sL)}async _query(e){try{return await nj(sW.Query,[e,{pathPrefix:this.pathPrefix,mode:"cors",headers:this.headers()}],this.maxRetries,100)}catch(t){throw sF.fromObject(t)}}_batchQuery(e){return nj(sW.BatchQuery,[e,{pathPrefix:this.pathPrefix,mode:"cors",headers:this.headers()}],this.maxRetries,100)}async _publish(e,t=0){let r=await this.getToken(),i=this.headers();i.set("Authorization",`Bearer ${r}`);try{return await nj(sW.Publish,[e,{pathPrefix:this.pathPrefix,mode:"cors",headers:i}],this.maxRetries,100,sX)}catch(n){if(sX(n)||t>=1)throw sF.fromObject(n);return await this.authCache?.refresh(),this._publish(e,t+1)}}_subscribe(e,t){let r=new AbortController;return(async()=>{for(;;){let i=new Date().getTime();try{if(await sW.Subscribe(e,t,{pathPrefix:this.pathPrefix,signal:r.signal,mode:"cors",headers:this.headers()}),r.signal.aborted)return;console.info("Stream connection closed. Resubscribing"),new Date().getTime()-i<1e3&&await nq(1e3)}catch(n){if(s$(n)||r.signal.aborted)return;console.info("Stream connection closed. Resubscribing",n.toString()),new Date().getTime()-i<1e3&&await nq(1e3)}}})(),async()=>{r?.abort()}}async query(e,{direction:t=sH.SORT_DIRECTION_ASCENDING,limit:r}){let i=[];for await(let n of this.queryIteratePages(e,{direction:t,pageSize:r&&r<100?r:100}))for(let s of n)if(i.push(s),r&&i.length===r)return i;return i}async *queryIterator(e,t){for await(let r of this.queryIteratePages(e,t))for(let i of r)yield i}async *queryIteratePages({contentTopic:e,startTime:t,endTime:r},{direction:i,pageSize:n=10}){if(!e||!e.length)throw Error("Must specify content topics");let s=nH(t),o=nH(r),a;for(;;){let c=await this._query({contentTopics:[e],startTimeNs:s,endTimeNs:o,pagingInfo:{limit:n,direction:i,cursor:a}});if(!c.envelopes?.length||(yield c.envelopes,!c.pagingInfo?.cursor))return;a=c.pagingInfo?.cursor}}async batchQuery(e){let t=[];for(let r=0;r<e.length;r+=50){let i=e.slice(r,r+50),n=[];for(let s of i)n.push({contentTopics:[s.contentTopic],startTimeNs:nH(s.startTime),endTimeNs:nH(s.endTime),pagingInfo:{limit:s.pageSize||10,direction:s.direction||sH.SORT_DIRECTION_ASCENDING}});let o={requests:n};t.push(o)}let a=await Promise.all(t.map(async e=>this._batchQuery(e))),c=[];for(let d of a){if(!d.responses)throw Error("BatchQueryResponse missing responses");for(let l of d.responses)l.envelopes?c.push(l.envelopes):c.push([])}return c}async publish(e){let t=[];for(let{contentTopic:r,message:i,timestamp:n}of e){if(!r.length)throw Error("Content topic cannot be empty string");if(!i.length)throw Error("0 length messages not allowed");let s=n||new Date;t.push({contentTopic:r,timestampNs:nH(s),message:Uint8Array.from(i)})}return this._publish({envelopes:t})}subscribe(e,t){if(!e.contentTopics.length)throw Error("Must provide list of contentTopics to subscribe to");return this._subscribe(e,t)}getToken(){if(!this.authCache)throw Error("AuthCache is not set on API Client");return this.authCache.getToken()}setAuthenticator(e,t){this.authCache=new sj(e,t)}headers(){let e=new Headers;return e.set("X-Client-Version",this.version),this.appVersion&&e.set("X-App-Version",this.appVersion),e}},sQ=e=>!!(e.recipientAddress&&e.senderAddress),s0=class{conversations;mutex;latestSeen;seenTopics;constructor(){this.conversations=[],this.mutex=new ng,this.seenTopics=new Set}async load(e){let t=await this.mutex.acquire();try{for(let r of(await e({latestSeen:this.latestSeen,existing:this.conversations})))this.seenTopics.has(r.topic)||(this.seenTopics.add(r.topic),this.conversations.push(r),(!this.latestSeen||r.createdAt>this.latestSeen)&&(this.latestSeen=r.createdAt))}finally{t()}return[...this.conversations]}},s2=class{client;v1Cache;v2Mutex;constructor(e){this.client=e,this.v1Cache=new s0,this.v2Mutex=new ng}async list(){let[e,t]=await Promise.all([this.listV1Conversations(),this.listV2Conversations()]),r=e.concat(t);return r.sort((e,t)=>e.createdAt.getTime()-t.createdAt.getTime()),r}async listV1Conversations(){return this.v1Cache.load(async({latestSeen:e})=>Array.from(await this.getIntroductionPeers({startTime:e?new Date(+e-1e4):void 0,direction:sH.SORT_DIRECTION_ASCENDING})).map(([e,t])=>new sB(this.client,e,t)))}async listV2Conversations(){return this.v2Mutex.runExclusive(async()=>{let e=await this.getV2ConversationsFromKeystore(),t=await this.updateV2Conversations(e.reduce((e,t)=>!e||+t.createdAt>+e.createdAt?t:e,void 0)?.createdAt),r=new Set(e.map(e=>e.topic));for(let i of t)r.has(i.topic)||(e.push(i),r.add(i.topic));return e.sort((e,t)=>e.createdAt.getTime()-t.createdAt.getTime()),e})}async getV2ConversationsFromKeystore(){return(await this.client.keystore.getV2Conversations()).map(this.conversationReferenceToV2.bind(this))}async updateV2Conversations(e){let t=await this.client.listInvitations({startTime:e?new Date(+e-1e4):void 0,direction:sH.SORT_DIRECTION_ASCENDING});return this.decodeInvites(t)}async decodeInvites(e,t=!1){let{responses:r}=await this.client.keystore.saveInvites({requests:e.map(e=>({payload:nF(e.message),timestampNs:E.fromString(e.timestampNs),contentTopic:e.contentTopic}))}),i=[];for(let n of r)try{let s=this.saveInviteResponseToConversation(n);i.push(s)}catch(o){if(console.warn("Error saving invite response to conversation: ",o),t)throw o}return i}saveInviteResponseToConversation({result:e,error:t}){if(t||!e||!e.conversation)throw Error(`Error from keystore: ${t?.code} ${t?.message}}`);return this.conversationReferenceToV2(e.conversation)}conversationReferenceToV2(e){return new sR(this.client,e.topic,e.peerAddress,nW(e.createdNs),e.context)}async stream(){let e=new Set,t=nJ(this.client.address),r=nD(this.client.address),i=t=>!e.has(t)&&(e.add(t),!0),n=async e=>{if(e.contentTopic===t){let n=await sD.fromBytes(nF(e.message)),s=this.getPeerAddress(n);return i(s)?(await n.decrypt(this.client.keystore,this.client.publicKeyBundle),new sB(this.client,s,n.sent)):void 0}if(e.contentTopic===r){let o=await this.decodeInvites([e],!0);if(o.length)return o[0]}throw Error("unrecognized invite topic")};return nX.create(this.client,[r,t],n.bind(this))}async streamAllMessages(){let e=nJ(this.client.address),t=nD(this.client.address),r=new Set([e,t]),i=new Map;for(let n of(await this.list()))r.add(n.topic),i.set(n.topic,n);let s=(e,t)=>!r.has(e)&&(i.set(e,t),r.add(e),!0),o=await nX.create(this.client,Array.from(r.values()),async r=>{let n=r.contentTopic;if(!n)return null;if(n===e){let s=await sD.fromBytes(nF(r.message));if(!sQ(s))return null;let o=this.getPeerAddress(s);return new sB(this.client,o,s.sent).decodeMessage(r)}if(n===t)return(await this.decodeInvites([r],!0))[0];let a=i.get(n);if(a instanceof sB||a instanceof sR)return a.decodeMessage(r);throw console.log("Unknown topic"),Error("Unknown topic")},t=>{if(t instanceof sq&&t.contentTopic===e){let i=new sB(this.client,t.recipientAddress===this.client.address?t.senderAddress:t.recipientAddress,t.sent);return s(i.topic,i)?Array.from(r.values()):void 0}if(t instanceof sR)return s(t.topic,t)?Array.from(r.values()):void 0});return async function*(){for await(let e of o)if(e instanceof sq&&(yield e),e instanceof sR)for(let t of(await e.messages()))yield t}()}async getIntroductionPeers(e){let t=await this.client.listEnvelopes(nJ(this.client.address),e=>sD.fromBytes(nF(e.message)),e),r=new Map;for(let i of t){if(!sQ(i))continue;let n=this.getPeerAddress(i);if(n){let s=r.get(n);if(!s||s>i.sent)try{await i.decrypt(this.client.keystore,this.client.publicKeyBundle),r.set(n,i.sent)}catch{continue}}}return r}async newConversation(e,t){let r=await this.client.getUserContact(e);if(!r)throw Error(`Recipient ${e} is not on the XMTP network`);if(e===this.client.address)throw Error("self messaging not supported");if(r instanceof sy&&!t?.conversationId)return new sB(this.client,e,new Date);if(!t?.conversationId){let i=(await this.listV1Conversations()).find(t=>t.peerAddress===e);if(i){if(!this.client.signedPublicKeyBundle.isFromLegacyBundle())throw Error("cannot resume pre-existing V1 conversation; client keys not compatible");if(!(r instanceof sy)&&!r.isFromLegacyBundle())throw Error("cannot resume pre-existing V1 conversation; peer keys not compatible");return i}}r instanceof sy&&(r=sp.fromLegacyBundle(r));let n=r=>{var i;return r.peerAddress===e&&(i=r.context??void 0,t?.conversationId===i?.conversationId)};return this.v2Mutex.runExclusive(async()=>{let e=await this.getV2ConversationsFromKeystore();return e.find(n)||(await this.updateV2Conversations(e[e.length-1]?.createdAt)).find(n)||this.createV2Convo(r,t)})}async createV2Convo(e,t){let r=new Date,{payload:i,conversation:n}=await this.client.keystore.createInvite({recipient:e,context:t,createdNs:nL(r)});if(!i||!n)throw Error("Required field not returned from Keystore");return await this.client.publishEnvelopes([{contentTopic:nD(await e.walletSignatureAddress()),message:i,timestamp:r},{contentTopic:nD(this.client.address),message:i,timestamp:r}]),this.conversationReferenceToV2(n)}getPeerAddress(e){return e.recipientAddress===this.client.address?e.senderAddress:e.recipientAddress}};function s1(e){let t;try{t=rd.decode(e)}catch{let r=eP.decode(e);t={v1:{keyBundle:new sy(r)},v2:void 0}}if(t.v1?.keyBundle)return new sy(t.v1.keyBundle);if(t.v2?.keyBundle)return new sp(t.v2.keyBundle);throw Error("unknown or invalid contact bundle")}var s3=nT(nP(),1),s6=class{walletAddr;createdNs;constructor({walletAddr:e,createdNs:t}){this.walletAddr=e,this.createdNs=t}static create(e,t){return t=t||new Date,new s6({walletAddr:e,createdNs:nL(t)})}static fromBytes(e){let t=eq.decode(e);return new s6(t)}toBytes(){return eq.encode(this).finish()}},s5=class{identityKey;authDataBytes;authDataSignature;_authData;constructor({identityKey:e,authDataBytes:t,authDataSignature:r}){if(!e)throw Error("Missing identity key in token");if(!r)throw Error("Missing authDataSignature in token");this.identityKey=e,this.authDataBytes=t,this.authDataSignature=r}get authData(){return this._authData||(this._authData=s6.fromBytes(this.authDataBytes)),this._authData}get ageMs(){return new Date().valueOf()-this.authData.createdNs.div(1e6).toNumber()}toBytes(){return eD.encode(this).finish()}static fromBytes(e){return new s5(eD.decode(e))}toBase64(){return nS.from(this.toBytes()).toString("base64")}},s8=class{identityKey;constructor(e){if(!e.publicKey.signature)throw Error("Provided public key is not signed");this.identityKey=e}async createToken(e){let t=s6.create(this.identityKey.publicKey.walletSignatureAddress(),e||new Date).toBytes(),r=await this.identityKey.sign(n7((0,s3.keccak256)(t)));return new s5(eD.fromPartial({identityKey:eB.fromPartial(this.identityKey.publicKey),authDataBytes:t,authDataSignature:el.fromPartial(r)}))}},s4=e=>e instanceof s5?e:new s5(e),s7=class{keystore;constructor(e){this.keystore=e}async createToken(e){return s4(await this.keystore.createAuthToken({timestampNs:e?nL(e):void 0}))}},s9=class{configuration;static createConfiguration(){return{type:0,version:0}}constructor(e){this.configuration=e}get backupType(){return 0}},oe=class{configuration;static createConfiguration(e){return{type:1,version:0,topic:"history-v0:"+e}}constructor(e){this.configuration=e}get backupType(){return 1}};async function ot(e,t){let r=await or(e,t);switch(r.type){case 0:return new s9(r);case 1:return new oe(r)}}async function or(e,t){let r;switch((await t()).type){case 0:r=s9.createConfiguration();break;case 1:r=oe.createConfiguration(e)}return r}var oi=class extends Error{},{b64Decode:on}=y,os=class{topic;context;aes256GcmHkdfSha256;constructor({topic:e,context:t,aes256GcmHkdfSha256:r}){if(!e||!e.length)throw Error("Missing topic");if(!r||!r.keyMaterial||!r.keyMaterial.length)throw Error("Missing key material");this.topic=e,this.context=t,this.aes256GcmHkdfSha256=r}static createRandom(e){let t=nC(nS.from(n0.getRandomValues(new Uint8Array(32))).toString("base64").replace(/=*$/g,"").replace("/","-")),r=n0.getRandomValues(new Uint8Array(32));return new os({topic:t,aes256GcmHkdfSha256:{keyMaterial:r},context:e})}toBytes(){return e1.encode(this).finish()}static fromBytes(e){return new os(e1.decode(e))}},oo=class{sender;recipient;createdNs;constructor({sender:e,recipient:t,createdNs:r}){if(!e)throw Error("Missing sender");if(!t)throw Error("Missing recipient");this.sender=new sp(e),this.recipient=new sp(t),this.createdNs=r}toBytes(){return te.encode(this).finish()}static fromBytes(e){return new oo(te.decode(e))}},oa=class{headerBytes;ciphertext;_header;_invitation;constructor({headerBytes:e,ciphertext:t}){if(!e||!e.length)throw Error("Missing header bytes");if(!t)throw Error("Missing ciphertext");this.headerBytes=e,this.ciphertext=new nY(t)}get header(){return this._header||(this._header=oo.fromBytes(this.headerBytes)),this._header}async getInvitation(e){if(this._invitation)return this._invitation;let t=this.header,r=await n6(this.ciphertext,e.identityKey.matches(this.header.sender.identityKey)?await e.sharedSecret(t.recipient,t.sender.preKey,!1):await e.sharedSecret(t.sender,t.recipient.preKey,!0),this.headerBytes);return this._invitation=os.fromBytes(r),this._invitation}toBytes(){return tr.encode(this).finish()}static fromBytes(e){return new oa(tr.decode(e))}},oc=class{v1;constructor({v1:e}){if(e)this.v1=new oa(e);else throw Error("Missing v1 or v2 invitation")}toBytes(){return tn.encode(this).finish()}static fromBytes(e){return new oc(tn.decode(e))}static async fromEnvelope(e){if(!e.message||!e.timestampNs)throw Error("invalid invitation envelope");let t=oc.fromBytes(on(e.message)),r=E.fromString(e.timestampNs),i=t.v1?.header.createdNs;if(!i||!i.equals(r))throw Error("envelope and header timestamp mistmatch");return t}static async createV1({sender:e,recipient:t,created:r,invitation:i}){let n=new oo({sender:e.getPublicKeyBundle(),recipient:t,createdNs:nL(r)}).toBytes(),s=await n3(i.toBytes(),await e.sharedSecret(t,e.getCurrentPreKey().publicKey,!1),n);return new oc({v1:{headerBytes:n,ciphertext:s}})}},od=async(e,t,r,i,n)=>n6(r,await e.sharedSecret(t,e.getCurrentPreKey().publicKey,!n),i),ol=async(e,t,r,i)=>n3(r,await e.sharedSecret(t,e.getCurrentPreKey().publicKey,!1),i),ou=(e,t,r)=>n6(e,t,r),op=(e,t,r)=>n3(e,t,r),oy=(e,t)=>e instanceof sS?e:new sS(t,e.message),oh=e=>({result:e}),of=(e,t,r)=>Promise.all(e.map(async e=>{try{return oh(await t(e))}catch(i){return{error:oy(i,r)}}})),ov=e=>e instanceof sy?e:new sy(e),om=e=>e instanceof sp?e:new sp(e),og=(e,t,r)=>{for(let i of t)if(!e[i])throw new sS(u.ERROR_CODE_INVALID_INPUT,`Missing field ${String(i)}`);for(let n of r){let s=e[n];if(!s||!s?.length)throw new sS(u.ERROR_CODE_INVALID_INPUT,`Missing field ${String(n)}`)}return!0},ow=e=>{if(!e?.aes256GcmHkdfSha256?.keyMaterial)throw new sS(u.ERROR_CODE_INVALID_INPUT,"Missing key material");return e.aes256GcmHkdfSha256.keyMaterial},ob=({invitation:e,createdNs:t,peerAddress:r})=>({context:e.context,topic:e.topic,peerAddress:r,createdNs:t}),oS=e=>!!e.invitation,ok=e=>{let t={};for(let[r,i]of Object.entries(e.topics))oS(i)?t[r]=i:console.warn("Invitation missing from topic data");return t},oN="invitations/v1",oE=class{persistence;mutex;topicMap;constructor(e,t=new Map){this.persistence=e,this.mutex=new ng,this.topicMap=t}static async create(e){if(e){let t=await e.getItem(oN);if(t)try{let r=ok(ig.decode(t));return new oE(e,new Map(Object.entries(r)))}catch(i){console.warn(`Error loading invites from store: ${i}`)}}return new oE(e)}async add(e){await this.mutex.runExclusive(async()=>{let t=!1;for(let r of e)this.topicMap.has(r.invitation.topic)||(this.topicMap.set(r.invitation.topic,r),t=!0);t&&this.persistence&&await this.persistence.setItem(oN,this.toBytes())})}get topics(){return[...this.topicMap.values()]}lookup(e){return this.topicMap.get(e)}toBytes(){return ig.encode({topics:Object.fromEntries(this.topicMap)}).finish()}},oO=new nw.ec("secp256k1"),oA=n0.subtle,oK=nS.from("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141","hex"),oB=nS.alloc(32,0);function oR(e,t){if(!e)throw Error(t||"Assertion failed")}function oT(e){return!!nS.isBuffer(e)&&32===e.length&&e.compare(oB)>0&&0>e.compare(oK)}function oU(e){let t=new Uint8Array(e);return n0.getRandomValues(t),nS.from(t)}async function oP(e){let t=await oA.digest("SHA-512",e);return nS.from(t)}function ox(e){return function(t,r,i){return new Promise(function(n){return oA.importKey("raw",r,{name:"AES-CBC"},!1,[e]).then(function(r){return oA[e]({name:"AES-CBC",iv:t},r,i)}).then(function(e){n(nS.from(new Uint8Array(e)))})})}}var oI=ox("encrypt"),oC=ox("decrypt");async function o_(e,t){let r=await oA.importKey("raw",e,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return nS.from(await oA.sign({name:"HMAC",hash:"SHA-256"},r,t))}async function oJ(e,t,r){return function(e,t){if(e.length!==t.length)return!1;let r=0;for(let i=0;i<e.length;i++)r|=e[i]^t[i];return 0===r}(await o_(e,t),r)}function oD(e){return oR(32===e.length,"Bad private key"),oR(oT(e),"Bad private key"),nS.from(oO.keyFromPrivate(e).getPublic("array"))}function oM(e,t){return new Promise(function(r){oR(nS.isBuffer(e),"Bad private key"),oR(nS.isBuffer(t),"Bad public key"),oR(32===e.length,"Bad private key"),oR(oT(e),"Bad private key"),oR(65===t.length||33===t.length,"Bad public key"),65===t.length&&oR(4===t[0],"Bad public key"),33===t.length&&oR(2===t[0]||3===t[0],"Bad public key");let i=oO.keyFromPrivate(e),n=oO.keyFromPublic(t),s=i.derive(n.getPublic());r(nS.from(s.toArray()))})}async function oq(e,t,r){r=r||{};let i=r?.iv||oU(16),n=r?.ephemPrivateKey||oU(32);for(;!oT(n);){if(r?.ephemPrivateKey)throw Error("ephemPrivateKey is not valid");n=oU(32)}let s=oD(n),o=await oP(await oM(n,e)),a=o.slice(0,32),c=o.slice(32),d=await oI(i,a,t),l=await o_(c,nS.concat([i,s,d]));return{iv:i,ephemeralPublicKey:s,ciphertext:d,mac:l}}async function oV(e,t){let r=await oP(await oM(e,t.ephemeralPublicKey)),i=r.slice(0,32);return oR(await oJ(r.slice(32),nS.concat([t.iv,t.ephemeralPublicKey,t.ciphertext]),t.mac),"Bad mac"),oC(t.iv,i,t.ciphertext)}var{ErrorCode:oj}=v,oZ=new TextEncoder().encode("__XMTP__INVITATION__SALT__XMTP__");async function oL(e,t){let r=await n0.subtle.importKey("raw",e,"HKDF",!1,["deriveKey"]);return n0.subtle.deriveKey({name:"HKDF",hash:"SHA-256",salt:oZ,info:t},r,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}var oW=class{v1Keys;v2Keys;inviteStore;authenticator;accountAddress;constructor(e,t){this.v1Keys=e,this.v2Keys=sf.fromLegacyBundle(e),this.inviteStore=t,this.authenticator=new s8(e.identityKey)}static async create(e,t){return new oW(e,await oE.create(t))}async decryptV1(e){let t=await of(e.requests,async e=>{og(e,["payload","peerKeys"],["headerBytes"]);let{payload:t,peerKeys:r,headerBytes:i,isSender:n}=e;return{decrypted:await od(this.v1Keys,ov(r),t,i,n)}},u.ERROR_CODE_UNSPECIFIED);return rk.fromPartial({responses:t})}async decryptV2(e){let t=await of(e.requests,async e=>{og(e,["payload"],["headerBytes"]);let{payload:t,headerBytes:r,contentTopic:i}=e,n=this.inviteStore.lookup(i);if(!n)throw new sS(u.ERROR_CODE_NO_MATCHING_PREKEY,"no topic key");return{decrypted:await ou(t,ow(n.invitation),r)}},oj.ERROR_CODE_UNSPECIFIED);return rk.fromPartial({responses:t})}async encryptV1(e){let t=await of(e.requests,async e=>{og(e,["payload","recipient"],["headerBytes"]);let{recipient:t,payload:r,headerBytes:i}=e;return{encrypted:await ol(this.v1Keys,ov(t),r,i)}},oj.ERROR_CODE_UNSPECIFIED);return r_.fromPartial({responses:t})}async createAuthToken({timestampNs:e}){return this.authenticator.createToken(e?nW(e):void 0)}async encryptV2(e){let t=await of(e.requests,async e=>{og(e,["payload"],["headerBytes"]);let{payload:t,headerBytes:r,contentTopic:i}=e,n=this.inviteStore.lookup(i);if(!n)throw new sS(oj.ERROR_CODE_NO_MATCHING_PREKEY,"no topic key");return{encrypted:await op(t,ow(n.invitation),r)}},oj.ERROR_CODE_INVALID_INPUT);return r_.fromPartial({responses:t})}async saveInvites(e){let t=[],r=await of(e.requests,async({payload:e,timestampNs:r})=>{let i=oc.fromBytes(e);if(i.v1){if(!i.v1.header.createdNs.equals(r))throw Error("envelope and header timestamp mismatch");let n=i.v1.header.sender.equals(this.v2Keys.getPublicKeyBundle()),s={invitation:await i.v1.getInvitation(this.v2Keys),createdNs:i.v1.header.createdNs,peerAddress:n?await i.v1.header.recipient.walletSignatureAddress():await i.v1.header.sender.walletSignatureAddress()};return t.push(s),{conversation:ob(s)}}},oj.ERROR_CODE_INVALID_INPUT);return await this.inviteStore.add(t),r8.fromPartial({responses:r})}async createInvite(e){try{og(e,["recipient"],[]);let t=nW(e.createdNs),r=om(e.recipient),i=await this.v2Keys.sharedSecret(r,this.v2Keys.getCurrentPreKey().publicKey,!1),n=[this.accountAddress,await r.walletSignatureAddress()].sort(),s=(e.context?.conversationId||"")+n.join(),o=new TextEncoder().encode(s),a=n4(await o_(nS.from(i),nS.from(o))),c=await oL(i,new TextEncoder().encode(["0",...n].join("|"))),d=new Uint8Array(await n0.subtle.exportKey("raw",c)),l=new os({topic:nC(a),aes256GcmHkdfSha256:{keyMaterial:d},context:e.context}),u=await oc.createV1({sender:this.v2Keys,recipient:r,created:t,invitation:l}),p={invitation:l,createdNs:e.createdNs,peerAddress:await r.walletSignatureAddress()};return await this.inviteStore.add([p]),rY.fromPartial({conversation:ob(p),payload:u.toBytes()})}catch(y){throw oy(y,oj.ERROR_CODE_INVALID_INPUT)}}async signDigest(e){og(e,["digest"],[]);let{digest:t,identityKey:r,prekeyIndex:i}=e,n;if(r)n=this.v1Keys.identityKey;else if("u">typeof i&&Number.isInteger(i)){if(!(n=this.v1Keys.preKeys[i]))throw new sS(oj.ERROR_CODE_NO_MATCHING_PREKEY,"no prekey found")}else throw new sS(oj.ERROR_CODE_INVALID_INPUT,"must specifify identityKey or prekeyIndex");return n.sign(t)}async getV2Conversations(){let e=this.inviteStore.topics.map(e=>ob(e));return e.sort((e,t)=>e.createdNs.div(1e6).sub(t.createdNs.div(1e6)).toNumber()),e}async getPublicKeyBundle(){return this.v1Keys.getPublicKeyBundle()}async getPrivateKeyBundle(){return this.v1Keys}async getAccountAddress(){return this.accountAddress||(this.accountAddress=await this.v2Keys.getPublicKeyBundle().walletSignatureAddress()),this.accountAddress}lookupTopic(e){return this.inviteStore.lookup(e)}},oH=class{apiClient;constructor(e){this.apiClient=e}async getItem(e){for await(let t of this.apiClient.queryIterator({contentTopic:this.buildTopic(e)},{pageSize:1,direction:d.SORT_DIRECTION_DESCENDING}))if(t.message)try{let r=nF(t.message.toString());return Uint8Array.from(r)}catch(i){console.log(i)}return null}async setItem(e,t){await this.apiClient.publish([{contentTopic:this.buildTopic(e),message:Uint8Array.from(t)}])}setAuthenticator(e){this.apiClient.setAuthenticator(e)}buildTopic(e){return nM(e)}},oG=class{store;constructor(){this.store=new Map}get length(){return this.store.size}clear(){this.store=new Map}getItem(e){return this.validateString(e),this.store.has(e)?String(this.store.get(e)):null}key(e){if(void 0===e)throw TypeError("Failed to execute 'key' on 'Storage': 1 argument required, but only 0 present.");let t=[...this.store.keys()];return e>=t.length?null:t[e]}removeItem(e){this.validateString(e),this.store.delete(e)}setItem(e,t){this.validateString(e),this.validateString(t),this.store.set(String(e),String(t))}validateString(e){if("string"!=typeof e)throw TypeError("Key must be a string")}},oF=class{storage;constructor(){this.storage="u">typeof localStorage?localStorage:new oG}async getItem(e){let t=this.storage.getItem(e);return null===t?null:Uint8Array.from(nS.from(t,"binary"))}async setItem(e,t){this.storage.setItem(e,nS.from(t).toString("binary"))}},o$=class{prefix;persistence;constructor(e,t){this.prefix=e,this.persistence=t}getItem(e){return this.persistence.getItem(this.buildKey(e))}setItem(e,t){return this.persistence.setItem(this.buildKey(e),t)}buildKey(e){return this.prefix+e}},oz=class{persistence;privateKey;privateKeyBytes;publicKey;constructor(e,t){this.persistence=e,this.privateKey=t,this.privateKeyBytes=nS.from(t.secp256k1.bytes),this.publicKey=oD(this.privateKeyBytes)}async getItem(e){let t=await this.persistence.getItem(e);return t?this.decrypt(t):null}async setItem(e,t){await this.persistence.setItem(e,await this.encrypt(t))}async encrypt(e){let t=await oq(this.publicKey,nS.from(e));return this.serializeEcies(t)}async decrypt(e){let t=await oV(this.privateKeyBytes,await this.deserializeEcies(e));return Uint8Array.from(t)}async serializeEcies(e){return(await sw.create(e,this.privateKey)).toBytes()}async deserializeEcies(e){let t=sw.fromBytes(e);if(!await t.verify(this.privateKey.publicKey))throw Error("signature validation failed");let r=t.ciphertext;return{ciphertext:nS.from(r.ciphertext),mac:nS.from(r.mac),iv:nS.from(r.iv),ephemeralPublicKey:nS.from(r.ephemeralPublicKey)}}},oX=async(e,t)=>{if(!e.persistConversations)return;let r=`xmtp/${e.env}/${await t.identityKey.publicKey.walletSignatureAddress()}/`;return new o$(r,new oz(new oF,t.identityKey))},oY="key_bundle",oQ=class{persistence;signer;preEnableIdentityCallback;constructor(e,t,r){this.signer=e,this.persistence=t,this.preEnableIdentityCallback=r}async getStorageAddress(e){let t=await this.signer.getAddress();return`${t=m.getAddress(t)}/${e}`}async loadPrivateKeyBundle(){let e=await this.persistence.getItem(await this.getStorageAddress(oY));if(!e)return null;let[t,r]=await this.fromEncryptedBytes(this.signer,Uint8Array.from(e));return r&&await this.storePrivateKeyBundle(t),t}async storePrivateKeyBundle(e){let t=await this.getStorageAddress(oY),r=await this.toEncryptedBytes(e,this.signer);"function"==typeof this.persistence.setAuthenticator&&this.persistence.setAuthenticator(new s8(e.identityKey)),await this.persistence.setItem(t,r)}async toEncryptedBytes(e,t){let r=e.encode(),i=n0.getRandomValues(new Uint8Array(32)),n=o2(i),s=await t.getAddress();this.preEnableIdentityCallback&&await this.preEnableIdentityCallback();let o=await t.signMessage(n),a=S.verifyMessage(n,o);if(a!==s&&(o=await t.signMessage(n),console.log("invalid signature, retrying"),(a=S.verifyMessage(n,o))!==s))throw Error("invalid signature");let c=await n3(r,n7(o));return t9.encode({v1:{walletPreKey:i,ciphertext:c}}).finish()}async fromEncryptedBytes(e,t){let[r,i]=function(e){try{let t=t9.decode(e);if(t.v1)return[t.v1,!1]}catch{return[t4.decode(e),!0]}throw Error("unrecognized encrypted private key bundle version")}(t);if(!r.walletPreKey)throw Error("missing wallet pre-key");if(!r.ciphertext?.aes256GcmHkdfSha256)throw Error("missing bundle ciphertext");this.preEnableIdentityCallback&&await this.preEnableIdentityCallback();let n=n7(await e.signMessage(o2(r.walletPreKey)));try{let s=await n6(new nY(r.ciphertext),n),[o,a]=o0(s);return[o,i||a]}catch{if(65!==n.length)throw Error("Expected 65 bytes before trying a different recovery byte");let c=n[n.length-1],d=n.slice(0,n.length-1),[l,u]=o0(await n6(new nY(r.ciphertext),d=new Uint8Array(c<27?[...d,c+27]:[...d,c-27])));return[l,i||u]}}};function o0(e){try{let t=sm(e);if(t instanceof sf)throw Error("V2 bundles not supported yet");return[t,!1]}catch{let r=t3.decode(e);return[new sv(r),!0]}}function o2(e){return`XMTP : Enable Identity
${n4(e)}

For more info: https://xmtp.org/signatures/`}var o1=class{async newKeystore(e,t,r){if(!r)throw new oi("Wallet required to generate new keys");e.preCreateIdentityCallback&&await e.preCreateIdentityCallback();let i=await sv.generate(r);return await new oQ(r,new oH(t),e.preEnableIdentityCallback).storePrivateKeyBundle(i),oW.create(i,await oX(e,i))}},o3=class{async newKeystore(e,t,r){if(!r)throw new oi("No wallet provided");let i=await new oQ(r,new oH(t),e.preEnableIdentityCallback).loadPrivateKeyBundle();if(!i)throw new oi("No keys found");return oW.create(i,await oX(e,i))}},o6=class{async newKeystore(e){let{privateKeyOverride:t}=e;if(!t)throw new oi("No private key override provided");let r=sm(t);if(r instanceof sf)throw Error("V2 private key bundle found. Only V1 supported");return oW.create(r,await oX(e,r))}},{Compression:o5}=f,{b64Decode:o8}=y,o4=class{address;keystore;apiClient;contacts;publicKeyBundle;knownPublicKeyBundles;_backupClient;_conversations;_codecs;_maxContentSize;constructor(e,t,r,i){this.contacts=new Set,this.knownPublicKeyBundles=new Map,this.keystore=i,this.publicKeyBundle=e,this.address=e.walletSignatureAddress(),this._conversations=new s2(this),this._codecs=new Map,this._maxContentSize=104857600,this.apiClient=t,this._backupClient=r}get conversations(){return this._conversations}get backupType(){return this._backupClient.backupType}get signedPublicKeyBundle(){return sp.fromLegacyBundle(this.publicKeyBundle)}static async create(e,t){var r;let i,n;let s=(r=t,i={privateKeyOverride:void 0,env:"dev",apiUrl:void 0,codecs:[new sK],maxContentSize:104857600,persistConversations:!0,skipContactPublishing:!1,keystoreProviders:[new o6,new o3,new o1]},r?.codecs&&(r.codecs=i.codecs.concat(r.codecs)),{...i,...r}),o=(n=s.apiUrl||sG[s.env],new sY(n,{appVersion:s.appVersion})),a=await ae(s,o,e),c=new sy(await a.getPublicKeyBundle()),d=c.walletSignatureAddress();o.setAuthenticator(new s7(a));let l=await o4.setupBackupClient(d,s.env),u=new o4(c,o,l,a);return await u.init(s),u}static async getKeys(e,t){let r=await (await o4.create(e,t)).keystore.getPrivateKeyBundle();return new sv(r).encode()}static async setupBackupClient(e,t){return ot(e,async()=>Promise.resolve({type:"local"===t?1:0}))}async init(e){e.codecs.forEach(e=>{this.registerCodec(e)}),this._maxContentSize=e.maxContentSize,e.skipContactPublishing||await this.ensureUserContactPublished(e.publishLegacyContact)}async close(){}async ensureUserContactPublished(e=!1){let t=await o7(this.apiClient,this.address);t&&t instanceof sp&&this.signedPublicKeyBundle.equals(t)||(await this.publishUserContact(!0),e||await this.publishUserContact(e))}async publishUserContact(e=!1){var t;await this.publishEnvelopes([{contentTopic:n_(this.address),message:(t=e?this.publicKeyBundle:this.signedPublicKeyBundle)instanceof sy?rd.encode({v1:{keyBundle:t},v2:void 0}).finish():rd.encode({v1:void 0,v2:{keyBundle:t}}).finish()}])}async getUserContact(e){e=m.getAddress(e);let t=this.knownPublicKeyBundles.get(e);if(t)return t;let r=await o7(this.apiClient,e);return r&&this.knownPublicKeyBundles.set(e,r),r}async getUserContacts(e){let t=e.map(e=>m.getAddress(e)),r=new Map,i=[];for(let n of t){let s=this.knownPublicKeyBundles.get(n);s?r.set(n,s):(r.set(n,void 0),i.push(n))}let o=await o9(this.apiClient,i);for(let a=0;a<o.length;a++){let c=i[a],d=o[a];r.set(c,d),d&&this.knownPublicKeyBundles.set(c,d)}return t.map(e=>r.get(e))}forgetContact(e){e=m.getAddress(e),this.knownPublicKeyBundles.delete(e)}async canMessage(e){try{return Array.isArray(e)?(await this.getUserContacts(e)).map(e=>!!e):await this.getUserContact(e)!==void 0}catch{return!1}}static async canMessage(e,t){let r=t?.apiUrl||sG[t?.env||"dev"];if(Array.isArray(e))return(await o9(new sY(r,{appVersion:t?.appVersion}),e.map(e=>m.getAddress(e)))).map(e=>!!e);try{e=m.getAddress(e)}catch{return!1}return await o7(new sY(r,{appVersion:t?.appVersion}),e)!==void 0}validateEnvelope(e){let t=e.message;if(!e.contentTopic)throw Error("Missing content topic");if(!t||!t.length)throw Error("Cannot publish empty message")}async publishEnvelopes(e){for(let t of e)this.validateEnvelope(t);await this.apiClient.publish(e)}registerCodec(e){let t=e.contentType,r=`${t.authorityId}/${t.typeId}`;this._codecs.set(r,e)}codecFor(e){let t=`${e.authorityId}/${e.typeId}`,r=this._codecs.get(t);if(r&&!(e.versionMajor>r.contentType.versionMajor))return r}async encodeContent(e,t){let r=t?.contentType||sA,i=this.codecFor(r);if(!i)throw Error("unknown content type "+r);let n=i.encode(e,this);return t?.contentFallback&&(n.fallback=t.contentFallback),"number"==typeof t?.compression&&(n.compression=t.compression),await sP(n),tx.encode(n).finish()}listInvitations(e){return this.listEnvelopes(nD(this.address),async e=>e,e)}async listEnvelopes(e,t,r){r||(r={});let{startTime:i,endTime:n,limit:s}=r,o=await this.apiClient.query({contentTopic:e,startTime:i,endTime:n},{direction:r.direction||d.SORT_DIRECTION_ASCENDING,limit:s}),a=[];for(let c of o)if(c.message)try{let l=await t(c);a.push(l)}catch(u){console.warn("Error in listEnvelopes mapper",u)}return a}listEnvelopesPaginated(e,t,r){return nZ(this.apiClient.queryIteratePages({contentTopic:e,startTime:r?.startTime,endTime:r?.endTime},{direction:r?.direction,pageSize:r?.pageSize||100}),t)}};async function o7(e,t){for await(let r of e.queryIterator({contentTopic:n_(t)},{pageSize:5,direction:sH.SORT_DIRECTION_DESCENDING})){if(!r.message)continue;let i=s1(o8(r.message.toString())),n;try{n=await i?.walletSignatureAddress()}catch{n=void 0}if(n===t)return i}}async function o9(e,t){let r=await e.batchQuery(t.map(n_).map(e=>({contentTopic:e,pageSize:5,direction:sH.SORT_DIRECTION_DESCENDING})));return Promise.all(t.map(async(e,t)=>{let i=r[t];if(i){for(let n of i)if(n.message)try{let s=s1(o8(n.message.toString())),o=await s?.walletSignatureAddress();if(e===o)return s;console.info("Received contact bundle with incorrect address")}catch(a){console.info("Invalid contact bundle",a)}}}))}async function ae(e,t,r){for(let i of e.keystoreProviders)try{return await i.newKeystore(e,t,r??void 0)}catch(n){if(n instanceof oi)continue;throw n}throw Error("No keystore providers available")}new sE({authorityId:"xmtp.com",typeId:"typingNotification",versionMajor:1,versionMinor:0}),new sE({authorityId:"xmtp.org",typeId:"composite",versionMajor:1,versionMinor:0})}}]);