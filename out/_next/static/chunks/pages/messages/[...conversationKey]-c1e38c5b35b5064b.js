(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7095],{22622:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/messages/[...conversationKey]",function(){return n(73266)}])},92864:function(e,t,n){"use strict";var a=n(85893),r=n(37331),s=n(39321),i=n(9187),l=n(13250),o=n(86501),u=n(15209),d=n(54524),p=n(65475),c=n(4242),y=n(21273);let m=e=>{let{setFollowing:t,profile:n}=e,m=(0,u.qr)(e=>e.userSigNonce),f=(0,u.qr)(e=>e.setUserSigNonce),h=(0,u.qr)(e=>e.currentProfile),{address:b}=(0,d.mA)(),{isLoading:x,signTypedDataAsync:v}=(0,d.yw)({onError:i.Z}),g=()=>{t(!0),o.Am.success("Followed successfully!")},w=e=>{e.modify({id:"Profile:".concat(null==n?void 0:n.id),fields:{isFollowedByMe:()=>!0}})},{isLoading:T,write:M}=(0,d.GG)({address:s.Nm,abi:r.g,functionName:"followWithSig",mode:"recklesslyUnprepared",onSuccess:g,onError:i.Z}),{broadcast:j,loading:N}=(0,l.Z)({onCompleted:g}),[k,{loading:I}]=(0,y.Rs)({onCompleted:async e=>{let{createFollowTypedData:t}=e,{id:n,typedData:a}=t,{deadline:r}=a.value;try{let s=await v((0,p.Z)(JSON.parse(JSON.stringify(a))));f(m+1);let{profileIds:i,datas:l}=a.value,{v:o,r:u,s:d}=(0,c.Z)(s),y={follower:b,profileIds:i,datas:l,sig:{v:o,r:u,s:d,deadline:r}};null==M||M({recklesslySetUnpreparedArgs:[y]});let{data:{broadcast:h}}=await j({request:{id:n,signature:s}});"reason"in h&&(null==M||M({recklesslySetUnpreparedArgs:[y]}))}catch(x){}},onError:i.Z,update:w}),[Z,{loading:S}]=(0,y.RI)({onCompleted:g,onError:i.Z,update:w}),E=async e=>{let{data:t}=await Z({variables:e});(null==t?void 0:t.proxyAction)||k({variables:{request:{follow:[{profile:null==n?void 0:n.id}]},options:{overrideSigNonce:m}}})},C=()=>{if(!h)return o.Am.error("Please Connect Your Wallet");if(null==n?void 0:n.followModule){var e;k({variables:{options:{overrideSigNonce:m},request:{follow:[{profile:null==n?void 0:n.id,followModule:(null==n?void 0:null===(e=n.followModule)||void 0===e?void 0:e.__typename)==="ProfileFollowModuleSettings"?{profileFollowModule:{profileId:null==h?void 0:h.id}}:null}]}}})}else E({request:{follow:{freeFollow:{profileId:null==n?void 0:n.id}}}})};return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("div",{children:(0,a.jsx)("button",{onClick:C,disabled:I||S||x||T||N,className:"py-1 px-1 drop-shadow-xl rounded-full border-2 border-black text-xs mt-2 hover:text-[#fff] hover:bg-[#57B8FF] transition cursor-pointer bg-blue-500 text-[#000000] font-semibold",children:"Follow"})})})};t.Z=m},7960:function(e,t,n){"use strict";n.d(t,{Z:function(){return h}});var a=n(85893);let r=[{inputs:[{internalType:"address",name:"hub",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"BlockNumberInvalid",type:"error"},{inputs:[],name:"InitParamsInvalid",type:"error"},{inputs:[],name:"Initialized",type:"error"},{inputs:[],name:"NotHub",type:"error"},{inputs:[],name:"NotOwnerOrApproved",type:"error"},{inputs:[],name:"SignatureExpired",type:"error"},{inputs:[],name:"SignatureInvalid",type:"error"},{inputs:[],name:"TokenDoesNotExist",type:"error"},{inputs:[],name:"ZeroSpender",type:"error"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"approved",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"operator",type:"address"},{indexed:!1,internalType:"bool",name:"approved",type:"bool"}],name:"ApprovalForAll",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[],name:"HUB",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"approve",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"burn",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"},{components:[{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"},{internalType:"uint256",name:"deadline",type:"uint256"}],internalType:"struct DataTypes.EIP712Signature",name:"sig",type:"tuple"}],name:"burnWithSig",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"delegatee",type:"address"}],name:"delegate",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"delegator",type:"address"},{internalType:"address",name:"delegatee",type:"address"},{components:[{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"},{internalType:"uint256",name:"deadline",type:"uint256"}],internalType:"struct DataTypes.EIP712Signature",name:"sig",type:"tuple"}],name:"delegateBySig",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"exists",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"getApproved",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"blockNumber",type:"uint256"}],name:"getDelegatedSupplyByBlockNumber",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"getDomainSeparator",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"user",type:"address"},{internalType:"uint256",name:"blockNumber",type:"uint256"}],name:"getPowerByBlockNumber",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"profileId",type:"uint256"}],name:"initialize",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"operator",type:"address"}],name:"isApprovedForAll",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"}],name:"mint",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"mintTimestampOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"ownerOf",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"},{components:[{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"},{internalType:"uint256",name:"deadline",type:"uint256"}],internalType:"struct DataTypes.EIP712Signature",name:"sig",type:"tuple"}],name:"permit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"operator",type:"address"},{internalType:"bool",name:"approved",type:"bool"},{components:[{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"},{internalType:"uint256",name:"deadline",type:"uint256"}],internalType:"struct DataTypes.EIP712Signature",name:"sig",type:"tuple"}],name:"permitForAll",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"bytes",name:"_data",type:"bytes"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"operator",type:"address"},{internalType:"bool",name:"approved",type:"bool"}],name:"setApprovalForAll",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"sigNonces",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"index",type:"uint256"}],name:"tokenByIndex",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"tokenDataOf",outputs:[{components:[{internalType:"address",name:"owner",type:"address"},{internalType:"uint96",name:"mintTimestamp",type:"uint96"}],internalType:"struct IERC721Time.TokenData",name:"",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"uint256",name:"index",type:"uint256"}],name:"tokenOfOwnerByIndex",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"tokenURI",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"transferFrom",outputs:[],stateMutability:"nonpayable",type:"function"}];var s=n(9187),i=n(4242),l=n(15209),o=n(13250),u=n(64146),d=n(67294),p=n(54524),c=n(65475),y=n(86501),m=n(21273);let f=e=>{let{setFollowing:t,profile:n}=e,f=(0,l.qr)(e=>e.currentProfile),[h,b]=(0,d.useState)(!1),{isLoading:x,signTypedDataAsync:v}=(0,p.yw)({onError:s.Z}),{data:g}=(0,p.mx)(),w=async(e,t)=>{let{tokenId:n,deadline:a}=t.value,{v:s,r:l,s:o}=(0,i.Z)(e),d=new u.Contract(t.domain.verifyingContract,r,g);await d.burnWithSig(n,{v:s,r:l,s:o,deadline:a})},{broadcast:T}=(0,o.Z)({onCompleted:()=>{t(!1)}}),[M,{loading:j}]=(0,m.i0)({onCompleted:async e=>{let{createUnfollowTypedData:t}=e;try{let{typedData:n,id:a}=t,r=await v((0,c.Z)(n));b(!0);try{var s;let{data:i}=await T({request:{id:a,signature:r}});(null==i?void 0:null===(s=i.broadcast)||void 0===s?void 0:s.reason)&&await w(r,n),y.Am.success("Unfollowed succesfully")}catch(l){y.Am.error("User rejected request")}finally{b(!1)}}catch(o){}},onError:s.Z}),N=()=>{if(!f)return y.Am.error("Please connect your wallet");M({variables:{request:{profile:null==n?void 0:n.id}}})};return(0,a.jsx)("div",{children:(0,a.jsx)("button",{onClick:N,className:"active:bg-violet-600 py-1 px-1 drop-shadow-xl rounded-full border-2 border-black text-xs mt-2 border hover:text-white hover:bg-[#57B8FF] transition cursor-pointer bg-blue-500 text-[#000000] font-semibold",children:"Unfollow"})})};var h=f},8974:function(e,t,n){"use strict";var a=n(85893),r=n(86010);let s=e=>{let{slug:t,prefix:n,className:s=""}=e;return(0,a.jsxs)("span",{className:(0,r.Z)("text-black bg-clip-text bg-gradient-to-r text-xs from-brand-600 dark:from-brand-400 to-pink-600 dark:to-pink-400",s),children:[n,t]})};t.Z=s},4242:function(e,t,n){"use strict";var a=n(16441);let r=e=>a.splitSignature(e);t.Z=r},59355:function(e,t,n){"use strict";n.d(t,{b:function(){return a}});let a=e=>e.stopPropagation()},73266:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eA}});var a=n(85893),r=n(11281),s=n(92864),i=n(7960),l=n(11163),o=n(67294),u=n(47516),d=n(72329);let p=e=>{let{profile:t}=e,n=(0,l.useRouter)(),[r,p]=(0,o.useState)(!0),c=()=>{n.push("/messages")};return((0,o.useEffect)(()=>{var e;p(null!==(e=null==t?void 0:t.isFollowedByMe)&&void 0!==e&&e)},[null==t?void 0:t.isFollowedByMe,t]),t)?(0,a.jsxs)("div",{className:"flex sticky items-center rounded-xl justify-between bg-blue-500 border-4 border-grey-700 py-4 px-3 ",children:[(0,a.jsx)("div",{className:"flex rounded-xl items-center",children:(0,a.jsx)(u.gbs,{onClick:c,className:"mr-1 text-blue h-6 w-6 cursor-pointer"})}),(0,a.jsx)("img",{src:(0,d.Z)(t),className:"mr-2 h-12 w-12 rounded-full border-2 ",alt:null==t?void 0:t.handle}),r?(0,a.jsx)(i.Z,{profile:t,setFollowing:p}):(0,a.jsx)(s.Z,{profile:t,setFollowing:p})]}):null};var c=n(9747),y=n(11761),m=n(4346),f=n(39321),h=n(15209),b=n(17990),x=n(86625);let v=(e,t)=>{let n=(0,b.G)(e=>e.client),a=(0,b.G)(t=>t.conversations.get(e)),r=(0,b.G)(e=>e.addConversation),s=(0,h.qr)(e=>e.currentProfile),[i,l]=(0,o.useState)(),u=()=>{l(!1)};return(0,o.useEffect)(()=>{if(!t||!n)return;if(a){l(!1);return}let s=async()=>{var a;let s=null===(a=(0,x.M)(e))||void 0===a?void 0:a.conversationId,i=await m.Client.canMessage(t.ownedBy,{env:f.Jy});if(l(!i),!i||!s)return;let o=await n.conversations.newConversation(t.ownedBy,{conversationId:s,metadata:{}});r(e,o)};s()},[t,a]),(0,o.useEffect)(()=>{s||u()},[s]),{selectedConversation:a,missingXmtpAuth:i}},g=(e,t,n)=>{var a;let r=(0,b.G)(t=>t.messages.get(e)),s=(0,b.G)(e=>e.addMessages),[i,l]=(0,o.useState)(new Map);return(0,o.useEffect)(()=>{if(!t)return;let a=async()=>{let a=await t.messages({direction:m.SortDirection.SORT_DIRECTION_DESCENDING,limit:f.b_,endTime:n});a.length>0?(s(e,a),a.length<f.b_?(i.set(e,!1),l(new Map(i))):(i.set(e,!0),l(new Map(i)))):(i.set(e,!1),l(new Map(i)))};a()},[t,e,n]),{messages:r,hasMore:null!==(a=i.get(e))&&void 0!==a&&a}},w=e=>{let t=(0,o.useCallback)(async(t,n)=>{if(!e)return!1;try{await e.send(t,n)}catch(a){return!1}return!0},[e]);return{sendMessage:t}},T=(e,t,n)=>{let a=(0,b.G)(e=>e.addMessages),[r,s]=(0,o.useState)();(0,o.useEffect)(()=>{if(!t)return;let i=async()=>{r&&await r.return()},l=async()=>{i();let r=await t.streamMessages();for await(let l of(s(r),r)){let o=a(e,[l]);o>0&&n&&n()}};return l(),()=>{i()}},[t])},M=/^(.*)\/lens\.dev\/dm\/(.*)-(.*)$/,j=e=>{let t=e.match(M);if(!t||4!==t.length)return null;let[,n,a,r]=Array.from(t);return{peerAddress:n,members:[a,r],conversationId:"".concat(f.Yg,"/").concat(a,"-").concat(r)}};var N=n(50680),k=n(29780),I=n(61286),Z=n(33962);let S=()=>{let[e,t]=(0,o.useState)({width:void 0,height:void 0});return(0,o.useEffect)(()=>{let e=()=>{t({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),e};var E=n(86501),C=n(52743);let A=e=>{let{sendMessage:t,conversationKey:n,disabledInput:r}=e,[s,i]=(0,o.useState)(""),[l,u]=(0,o.useState)(!1),{width:d}=S(),p=!r&&!l&&s.length>0,c=async()=>{if(!p)return;u(!0);let e=await t(s);e?i(""):E.ZP.error("Error sending message"),u(!1)};(0,o.useEffect)(()=>{i("")},[n]);let y=e=>{"Enter"===e.key&&c()};return(0,a.jsxs)("div",{className:"flex space-x-4 p-4",children:[(0,a.jsx)(I.I,{type:"text",placeholder:"Type Something",value:s,disabled:r,onKeyDown:y,onChange:e=>i(e.target.value)}),(0,a.jsx)(k.z,{disabled:!p,onClick:c,variant:"primary","aria-label":"Send message",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[Number(d)>f.c1?(0,a.jsx)("span",{children:"Send"}):null,!l&&(0,a.jsx)(C.Z,{className:"h-5 w-5"}),l&&(0,a.jsx)(Z.$,{size:"sm",className:"h-5 w-5"})]})})]})};var _=n(4693),P=n(41664),D=n.n(P);let F=e=>{let{...t}=e;return t.display.slice(1).toLowerCase(),(0,a.jsx)("span",{className:"inline-flex items-center space-x-1",children:(0,a.jsx)("span",{children:(0,a.jsx)(D(),{href:"/search?q=".concat(t.display.slice(1),"&type=pubs&src=link_click"),onClick:e=>{e.stopPropagation()},children:t.display})})})};class z extends _.M{replaceWith(e,t){return(0,o.createElement)(F,t,e)}asTag(){return"a"}match(e){return this.doMatch(e,/\B(#\w*[A-Za-z]+\w*\b)(?!;)/,e=>({display:e[0]}))}}class B extends _.M{replaceWith(e){return(0,a.jsx)("b",{children:e})}asTag(){return"b"}match(e){return this.doMatch(e,/\*\*([^**]*?)\*\*/u,e=>({match:e[1]}))}}class Y extends _.M{replaceWith(e){return(0,a.jsx)("code",{className:"text-sm bg-gray-300 rounded-lg dark:bg-gray-700 px-[5px] py-[2px]",children:e})}asTag(){return"code"}match(e){return this.doMatch(e,/`(.*?)`/u,e=>({match:e[1]}),!0)}}class q extends _.M{replaceWith(e){return(0,a.jsx)("i",{children:e})}asTag(){return"i"}match(e){return this.doMatch(e,/\*([^**]*?)\*/u,e=>({match:e[1]}))}}var O=n(57632);let L=(e,t)=>{let n="_"+e+"-"+(0,O.Z)().slice(-7);return(0,a.jsx)("a",{href:e,target:"_blank",rel:"noopener noreferrer",children:t},n)};class W extends _.M{replaceWith(e,t){return L(t.href,t.title)}asTag(){return"a"}match(e){return this.doMatch(e,/\[(.*?)\]\((.*?)\)/u,e=>({href:e[2],title:e[1]}))}}class G extends _.M{replaceWith(e){return(0,a.jsx)("span",{className:"py-1.5 pl-2 text-gray-700 border-l-4 dark:text-gray-400 dark:border-gray-700",children:e})}asTag(){return"span"}match(e){return this.doMatch(e,/^> (.*$)/,e=>({match:e[1]}))}}class U extends _.M{replaceWith(e){return(0,a.jsx)("s",{children:e})}asTag(){return"s"}match(e){return this.doMatch(e,/~~(.*?)~~/u,e=>({match:e[1]}))}}var R=n(8974),K=n(29451),$=n(59355),H=n(34155),X=n(56371);let J=e=>{let{href:t,title:n=t}=e,r=null==n?void 0:n.slice(1);if(!r)return null;let s={__typename:"Profile",handle:r,name:null,id:null};return(0,a.jsx)(D(),{href:"/u/".concat([X.id]),onClick:$.b,children:(null==s||s.handle,(0,a.jsx)(R.Z,{slug:(0,K.Z)(r),prefix:"@"}))})};class Q extends _.M{replaceWith(e,t){return(0,o.createElement)(J,t,e)}asTag(){let e=null===H.title||void 0===H.title?void 0:H.title.slice(1);return"".concat((0,a.jsx)(D(),{href:"/u/".concat([X.id]),onClick:$.b,children:(0,a.jsx)(R.Z,{slug:e,prefix:"@"})}))}match(e){return this.doMatch(e,/@[\w.-]+/,e=>({display:e[0]}))}}let V=function(e){var t,n;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.map(e=>e.source).join(null!==(t=a.join)&&void 0!==t?t:"");return a.capture?r="(".concat(r,")"):a.nonCapture&&(r="(?:".concat(r,")")),a.match&&(r+=a.match),RegExp(r,null!==(n=a.flags)&&void 0!==n?n:"")},ee=/[\w!$%&'()*+,./;=[\\\]~\u0400-\u04FF\-]*/u,et=V([/(https?:\/\/)?/],{capture:!0}),en=V([/(?:[\da-z](?:[\d_a-z-]*[\da-z])?\.)*/,/(?:[\da-z](?:[\da-z-]*[\da-z])?\.)/,/(?:[a-z](?:[\da-z-]*[\da-z])?)/],{capture:!0}),ea=V([/\//,V([/[\d!$%&'*+,./:;=@[\]_a-z|~-]*/,/[\d+/a-z-]/],{match:"*",nonCapture:!0})],{capture:!0,match:"?"}),er=V([/\?/,V([ee,/[\d&=_a-z]/],{match:"?",nonCapture:!0})],{capture:!0,match:"?"}),es=V([/#/,V([ee,/[\da-z]/],{match:"?",nonCapture:!0})],{capture:!0,match:"?"}),ei=V([et,en,ea,er,es],{flags:"i"}),el=e=>{let{children:t,url:n}=e,r=n,s=null===H.title||void 0===H.title?void 0:H.title.slice(1);return r.match(/^https?:\/\//)||(r="/u/".concat((0,K.Z)(s))),(0,a.jsx)("a",{href:r,target:"_blank",onClick:e=>e.stopPropagation(),rel:"noopener",children:t})};class eo extends _.M{replaceWith(e,t){return(0,o.createElement)(el,t,e)}asTag(){return"a"}match(e){let t=this.doMatch(e,ei,this.handleMatches,!0);if(null==t?void 0:t.valid){let{host:n}=t;n.slice(n.lastIndexOf(".")+1).toLowerCase()}return t}handleMatches(e){return{url:e[0],host:e[3]}}}let eu=e=>null==e?void 0:e.replace(/\n\s*\n/g,"\n\n").trim();var ed=n(63108);let ep=e=>{let{children:t,className:n="",matchOnlyUrl:r}=e,s=[new Y("mdCode"),new W("mdLink"),new eo("url"),new z("hashtag"),new Q("mention"),new B("mdBold"),new q("mdItalic"),new U("mdStrike"),new G("mdQuote")];return(0,a.jsx)(ed.wZ,{className:n,content:eu(t),escapeHtml:!0,allowList:["b","i","a","br","code","span"],matchers:r?[new eo("url")]:s,onClick:e=>e.stopPropagation()})};var ec=n(53854),ey=n(86010),em=n(27484),ef=n.n(em),eh=n(58533);let eb=e=>e?ef()(e).format("hh:mm a - MM/DD/YY"):"",ex=(e,t)=>ef()(e).format("YYYYMMDD")===ef()(t).format("YYYYMMDD"),ev=e=>ef()(e).format("MMMM D, YYYY"),eg=e=>{var t,n;let{message:r,profile:s,currentProfile:i}=e,l=null==i?void 0:i.ownedBy;return(0,a.jsxs)("div",{className:(0,ey.Z)(l===r.senderAddress?"items-end mr-4":"items-start","flex flex-col mx-auto bg-blu-300 mb-4"),children:[(0,a.jsxs)("div",{className:"flex max-w-[60%]",children:[l!==r.senderAddress&&(0,a.jsx)("img",{src:(0,d.Z)(s),className:"h-12 w-12 border-2 bg-gray-200 rounded-full mr-2",alt:null==s?void 0:s.handle}),(0,a.jsx)("div",{className:(0,ey.Z)(l===r.senderAddress?"bg-blue-400":"bg-blue-500"," border-2 border-black pt-1 rounded-3xl w-full"),children:(0,a.jsx)("span",{className:(0,ey.Z)(l===r.senderAddress&&"text-black","block text-sm break-words font-semibold p-2 px-4 py-2 rounded-3xl w-full linkify-message"),children:r.error?"Error: ".concat(null===(t=r.error)||void 0===t?void 0:t.message):null!==(n=(0,a.jsx)(ep,{matchOnlyUrl:!0,children:r.content}))&&void 0!==n?n:""})})]}),(0,a.jsx)("div",{className:(0,ey.Z)(l!==r.senderAddress?"ml-12":""),children:(0,a.jsx)("span",{className:"text-xs place-self-end text-gray-800",title:eb(r.sent),children:ef()(r.sent).fromNow()})})]})},ew=e=>{let{children:t}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"grow h-0.5 bg-gray-300/25"}),t,(0,a.jsx)("div",{className:"grow h-0.5 bg-gray-300/25"})]})},eT=e=>{let{date:t}=e;return(0,a.jsx)("div",{className:"flex align-items-center items-center p-4 pt-0 pl-2",children:(0,a.jsx)(ew,{children:(0,a.jsx)("span",{className:"mx-11 flex-none text-gray-700 text-sm font-bold",children:ev(t)})})})},eM=()=>(0,a.jsxs)(y.Z,{as:"aside",className:"mb-2 mr-4 border-gray-700 !bg-gray-300 !bg-opacity-20 space-y-2.5 p-5",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 font-bold",children:[(0,a.jsx)(ec.qX6,{className:"w-5 h-5"}),(0,a.jsx)("p",{children:"This fren hasn't enabled DMs yet"})]}),(0,a.jsx)("p",{className:"text-sm leading-[22px]",children:"You can't send them a message until they enable DMs."})]}),ej=()=>(0,a.jsx)("div",{className:"flex align-items-center justify-center mt-6 pb-4",children:(0,a.jsx)("span",{className:"text-gray-500 text-sm font-bold",children:"This is the beginning of the conversation"})}),eN=()=>(0,a.jsx)("div",{className:"p-1 mt-6 text-center text-gray-500 font-bold text-sm",children:"Loading..."}),ek=e=>{let t,{messages:n,fetchNextMessages:r,profile:s,currentProfile:i,hasMore:l,missingXmtpAuth:o}=e;return(0,a.jsx)("div",{className:"flex-grow flex h-[75%]",children:(0,a.jsx)("div",{className:"relative w-full h-full pl-4 flex",children:(0,a.jsxs)("div",{id:"scrollableMessageListDiv",className:"flex flex-col-reverse h-full overflow-y-auto w-full",children:[o&&(0,a.jsx)(eM,{}),(0,a.jsx)(eh.Z,{dataLength:n.length,next:r,className:"flex flex-col-reverse overflow-y-hidden overflow-x-hidden",inverse:!0,endMessage:(0,a.jsx)(ej,{}),hasMore:l,loader:(0,a.jsx)(eN,{}),scrollableTarget:"scrollableMessageListDiv",children:null==n?void 0:n.map((e,n)=>{let r=!!t&&!ex(t,e.sent),l=(0,a.jsxs)("div",{children:[(0,a.jsx)(eg,{currentProfile:i,profile:s,message:e}),r?(0,a.jsx)(eT,{date:t}):null]},"".concat(e.id,"_").concat(n));return t=e.sent,l})})]})})})};var eI=(0,o.memo)(ek),eZ=n(35532),eS=n(30545);let eE=e=>{var t;let{conversationKey:n}=e,s=(0,h.qr)(e=>e.currentProfile),i=(0,b.G)(e=>e.messageProfiles.get(n)),{selectedConversation:l,missingXmtpAuth:u}=v(n,i),[d,m]=(0,o.useState)(new Map),{messages:x,hasMore:M}=g(n,l,d.get(n));T(n,l);let{sendMessage:j}=w(l),k=(0,o.useCallback)(()=>{if(M&&Array.isArray(x)&&x.length>0){let e=x[x.length-1].sent,t=d.get(n);(!t||e<=t)&&(d.set(n,e),m(new Map(d)))}},[n,M,x,d]);if(!s)return(0,a.jsx)(N.default,{});let I=null!==(t=null==i?void 0:i.name)&&void 0!==t?t:null==i?void 0:i.handle;return I?"".concat(I," • ").concat(f.iC):f.iC,(0,a.jsxs)("div",{children:[(0,a.jsx)(r.Z,{title:"Messages • ".concat(null==i?void 0:i.name," ").concat(f.iC)}),(0,a.jsx)(eS.Z,{}),(0,a.jsx)(eZ.Z,{className:"hidden md:hidden sm:hidden xs:hidden",selectedConversationKey:n}),(0,a.jsx)("div",{className:" flex-auto xs:w-[100vh] w-full h-full mb-0 sm:w-[100vh] md:h-[100vh] xl:h-[100vh]",children:(0,a.jsx)(y.Z,{className:"flex-1 overflow-x-auto overflow-y-auto w-full h-full !rounded-tr-lg !rounded-br-lg ",children:u||i&&s&&l?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p,{profile:i}),(0,a.jsx)(eI,{currentProfile:s,profile:i,fetchNextMessages:k,messages:null!=x?x:[],hasMore:M,missingXmtpAuth:null!=u&&u}),(0,a.jsx)(A,{sendMessage:j,conversationKey:n,disabledInput:null!=u&&u})]}):(0,a.jsx)("div",{className:"flex h-full flex-grow justify-center items-center",children:(0,a.jsx)(c.Z,{message:"Loading messages"})})})})]})},eC=()=>{let e=(0,h.qr)(e=>{var t;return null===(t=e.currentProfile)||void 0===t?void 0:t.id}),{query:{conversationKey:t}}=(0,l.useRouter)();if(!t||!e||!Array.isArray(t))return(0,a.jsx)(N.default,{});let n=t.join("/"),r=j(n);if(!r)return(0,a.jsx)(N.default,{});let{members:s}=r,i=s.find(t=>t!==e);return i?(0,a.jsx)(eE,{conversationKey:n}):(0,a.jsx)(N.default,{})};var eA=eC},13250:function(e,t,n){"use strict";var a=n(86501),r=n(50319),s=n(76781);let i=e=>{let{onCompleted:t,update:n}=e,i={notMined:"A previous transaction may not been mined yet or you have passed in a invalid nonce. You must wait for that to be mined before doing another action, please try again in a few moments. Nonce out of sync."},[l,{data:o,loading:u}]=function(e){let t={...e};return r.D(s.VP,t)}({onCompleted:t,update:n,onError:e=>{e.message===i.notMined&&a.ZP.error(e.message)}});return{broadcast:e=>{let{request:t}=e;return l({variables:{request:t}})},data:o,loading:u}};t.Z=i}},function(e){e.O(0,[3714,8766,7025,2692,4980,2013,5445,9866,3874,4482,6556,7856,6552,8179,3987,1664,9869,713,6064,5006,8359,7410,9717,5167,9774,2888,179],function(){return e(e.s=22622)}),_N_E=e.O()}]);