(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7095],{22622:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/messages/[...conversationKey]",function(){return n(55679)}])},92864:function(e,t,n){"use strict";var a=n(85893),s=n(37331),l=n(34625),r=n(9187),i=n(13250),o=n(86501),d=n(92882),u=n(31618),p=n(64911),c=n(4242),y=n(21273);let m=e=>{let{setFollowing:t,profile:n}=e,m=(0,d.qr)(e=>e.userSigNonce),f=(0,d.qr)(e=>e.setUserSigNonce),v=(0,d.qr)(e=>e.currentProfile),{address:g}=(0,u.mA)(),{isLoading:h,signTypedDataAsync:b}=(0,u.yw)({onError:r.Z}),x=()=>{t(!0),o.Am.success("Followed successfully!")},w=e=>{e.modify({id:"Profile:".concat(null==n?void 0:n.id),fields:{isFollowedByMe:()=>!0}})},{isLoading:T,write:j}=(0,u.GG)({address:l.Nm,abi:s.g,functionName:"followWithSig",onSuccess:x,onError:r.Z}),{broadcast:C,loading:M}=(0,i.Z)({onCompleted:x}),[N,{loading:A}]=(0,y.Rs)({onCompleted:async e=>{let{createFollowTypedData:t}=e,{id:n,typedData:a}=t,{deadline:s}=a.value;try{let l=await b((0,p.Z)(JSON.parse(JSON.stringify(a))));f(m+1);let{profileIds:r,datas:i}=a.value,{v:o,r:d,s:u}=(0,c.Z)(l),y={follower:g,profileIds:r,datas:i,sig:{v:o,r:d,s:u,deadline:s}};null==j||j({args:[y]});let{data:{broadcast:v}}=await C({request:{id:n,signature:l}});"reason"in v&&(null==j||j({args:[y]}))}catch(h){}},onError:r.Z,update:w}),[k,{loading:Z}]=(0,y.RI)({onCompleted:x,onError:r.Z,update:w}),I=async e=>{let{data:t}=await k({variables:e});(null==t?void 0:t.proxyAction)||N({variables:{request:{follow:[{profile:null==n?void 0:n.id}]},options:{overrideSigNonce:m}}})},E=()=>{if(!v)return o.Am.error("Please Connect Your Wallet");if(null==n?void 0:n.followModule){var e;N({variables:{options:{overrideSigNonce:m},request:{follow:[{profile:null==n?void 0:n.id,followModule:(null==n?void 0:null===(e=n.followModule)||void 0===e?void 0:e.__typename)==="ProfileFollowModuleSettings"?{profileFollowModule:{profileId:null==v?void 0:v.id}}:null}]}}})}else I({request:{follow:{freeFollow:{profileId:null==n?void 0:n.id}}}})};return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("div",{children:(0,a.jsx)("button",{onClick:E,disabled:A||Z||h||T||M,className:"lg:text-md xl:text-md font-helvetica mt-2 cursor-pointer rounded-full border-2 border-black bg-blue-500 px-1 py-1 text-xs font-semibold text-[#000000] drop-shadow-xl transition hover:bg-[#57B8FF] hover:text-[#fff]",children:"Follow"})})})};t.Z=m},7960:function(e,t,n){"use strict";n.d(t,{Z:function(){return g}});var a=n(85893);let s=[{inputs:[{internalType:"address",name:"hub",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"BlockNumberInvalid",type:"error"},{inputs:[],name:"InitParamsInvalid",type:"error"},{inputs:[],name:"Initialized",type:"error"},{inputs:[],name:"NotHub",type:"error"},{inputs:[],name:"NotOwnerOrApproved",type:"error"},{inputs:[],name:"SignatureExpired",type:"error"},{inputs:[],name:"SignatureInvalid",type:"error"},{inputs:[],name:"TokenDoesNotExist",type:"error"},{inputs:[],name:"ZeroSpender",type:"error"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"approved",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"operator",type:"address"},{indexed:!1,internalType:"bool",name:"approved",type:"bool"}],name:"ApprovalForAll",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[],name:"HUB",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"approve",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"burn",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"},{components:[{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"},{internalType:"uint256",name:"deadline",type:"uint256"}],internalType:"struct DataTypes.EIP712Signature",name:"sig",type:"tuple"}],name:"burnWithSig",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"delegatee",type:"address"}],name:"delegate",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"delegator",type:"address"},{internalType:"address",name:"delegatee",type:"address"},{components:[{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"},{internalType:"uint256",name:"deadline",type:"uint256"}],internalType:"struct DataTypes.EIP712Signature",name:"sig",type:"tuple"}],name:"delegateBySig",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"exists",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"getApproved",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"blockNumber",type:"uint256"}],name:"getDelegatedSupplyByBlockNumber",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"getDomainSeparator",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"user",type:"address"},{internalType:"uint256",name:"blockNumber",type:"uint256"}],name:"getPowerByBlockNumber",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"profileId",type:"uint256"}],name:"initialize",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"operator",type:"address"}],name:"isApprovedForAll",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"}],name:"mint",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"mintTimestampOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"ownerOf",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"},{components:[{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"},{internalType:"uint256",name:"deadline",type:"uint256"}],internalType:"struct DataTypes.EIP712Signature",name:"sig",type:"tuple"}],name:"permit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"operator",type:"address"},{internalType:"bool",name:"approved",type:"bool"},{components:[{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"},{internalType:"uint256",name:"deadline",type:"uint256"}],internalType:"struct DataTypes.EIP712Signature",name:"sig",type:"tuple"}],name:"permitForAll",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"bytes",name:"_data",type:"bytes"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"operator",type:"address"},{internalType:"bool",name:"approved",type:"bool"}],name:"setApprovalForAll",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"sigNonces",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"index",type:"uint256"}],name:"tokenByIndex",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"tokenDataOf",outputs:[{components:[{internalType:"address",name:"owner",type:"address"},{internalType:"uint96",name:"mintTimestamp",type:"uint96"}],internalType:"struct IERC721Time.TokenData",name:"",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"uint256",name:"index",type:"uint256"}],name:"tokenOfOwnerByIndex",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"tokenURI",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"transferFrom",outputs:[],stateMutability:"nonpayable",type:"function"}];var l=n(9187),r=n(4242),i=n(92882),o=n(13250),d=n(66214),u=n(67294),p=n(31618),c=n(64911),y=n(86501),m=n(21273),f=n(52942);let v=e=>{let{setFollowing:t,profile:n}=e,v=(0,i.qr)(e=>e.currentProfile),[g,h]=(0,u.useState)(!1),{isLoading:b,signTypedDataAsync:x}=(0,p.yw)({onError:l.Z}),{data:w}=(0,f.Z)(),T=async(e,t)=>{let{tokenId:n,deadline:a}=t.value,{v:l,r:i,s:o}=(0,r.Z)(e),u=new d.CH(t.domain.verifyingContract,s,w);await u.burnWithSig(n,{v:l,r:i,s:o,deadline:a})},{broadcast:j}=(0,o.Z)({onCompleted:()=>{t(!1)}}),[C,{loading:M}]=(0,m.i0)({onCompleted:async e=>{let{createUnfollowTypedData:t}=e;try{let{typedData:n,id:a}=t,s=await x((0,c.Z)(n));h(!0);try{var l;let{data:r}=await j({request:{id:a,signature:s}});(null==r?void 0:null===(l=r.broadcast)||void 0===l?void 0:l.reason)&&await T(s,n),y.Am.success("Unfollowed succesfully")}catch(i){y.Am.error("User rejected request")}finally{h(!1)}}catch(o){}},onError:l.Z}),N=()=>{if(!v)return y.Am.error("Please connect your wallet");C({variables:{request:{profile:null==n?void 0:n.id}}})};return(0,a.jsx)("div",{children:(0,a.jsx)("button",{onClick:N,className:"lg:text-md xl:text-md font-helvetica mt-2 cursor-pointer rounded-full border-2 border-black bg-blue-500 p-3 px-1 py-1 text-xs font-semibold text-[#000000] drop-shadow-xl transition hover:bg-[#57B8FF] hover:text-white active:bg-violet-600",children:"Unfollow"})})};var g=v},64911:function(e,t){"use strict";let n=(e,t)=>{let{[t]:n,...a}=e;return a},a=e=>{let{domain:t,types:a,value:s}=e;return{primaryType:Object.keys(n(a,"__typename"))[0],domain:n(t,"__typename"),types:n(a,"__typename"),message:n(s,"__typename")}};t.Z=a},9187:function(e,t,n){"use strict";var a=n(86501),s=n(34625);let l=e=>{var t,n,l;a.ZP.error(null!==(l=null!==(n=null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.message)&&void 0!==n?n:null==e?void 0:e.message)&&void 0!==l?l:s.c9)};t.Z=l},4242:function(e,t,n){"use strict";var a=n(93445);let s=e=>a.splitSignature(e);t.Z=s},62641:function(e,t,n){"use strict";n.d(t,{l:function(){return u}});var a=n(25232),s=n(34625),l=n(6154),r=n(57632);let i="image/jpeg",o=async()=>{var e,t,n;let r=await l.Z.get(s.Kl),i=new a.S3({endpoint:s.qD,credentials:{accessKeyId:null===(e=r.data)||void 0===e?void 0:e.accessKeyId,secretAccessKey:null===(t=r.data)||void 0===t?void 0:t.secretAccessKey,sessionToken:null===(n=r.data)||void 0===n?void 0:n.sessionToken},region:"us-west-2",maxAttempts:3});return i.middlewareStack.addRelativeTo(e=>async t=>{let{response:n}=await e(t);return null===n.body&&(n.body=new Uint8Array),{response:n}},{name:"nullFetchResponseBodyMiddleware",toMiddleware:"deserializerMiddleware",relation:"after",override:!0}),i},d=async e=>{try{let t=Array.from(e),n=await o(),a=await Promise.all(t.map(async(t,a)=>{let l=e[a],o={Bucket:s.DG.LENSTER_MEDIA,Key:(0,r.Z)()};await n.putObject({...o,Body:l,ContentType:l.type});let d=await n.headObject(o),u=d.Metadata;return{original:{url:"ipfs://".concat(null==u?void 0:u["ipfs-hash"]),mimeType:l.type||i}}}));return a}catch(l){return[]}},u=async e=>{try{let t=await d([e]),n=t[0];return{original:{url:n.original.url,mimeType:e.type||i}}}catch(a){return console.error("Failed to upload file to IPFS",a),{original:{url:"",mimeType:e.type||i}}}};t.Z=d},55679:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eP}});var a,s,l=n(85893),r=n(11281),i=n(22257),o=n(7925),d=n(81137),u=n(29451),p=n(43799),c=n(67294),y=n(10116);let m=e=>{let t=(0,y.G)(e=>e.client),n=(0,y.G)(e=>e.conversations),a=(0,y.G)(e=>e.addConversation),[s,l]=(0,c.useState)(!1),r=async(l,r,i)=>{let o;if(!t||!e)return!1;if(s||n.has(e))o=n.get(e);else{var d,u;let c=null==e?void 0:e.split("/")[0],y=null!==(u=null===(d=(0,p.M)(e))||void 0===d?void 0:d.conversationId)&&void 0!==u?u:"";o=""!==y?await t.conversations.newConversation(c,{conversationId:y,metadata:{}}):await t.conversations.newConversation(c),a(e,o)}if(!o)return!1;try{await o.send(l,{contentType:r,contentFallback:i})}catch(m){return console.error("Failed to send message",m),!1}return!0};return(0,c.useEffect)(()=>{let a=async()=>{if(t&&!n.has(e)){let a=null==e?void 0:e.split("/")[0],s=await t.canMessage(a);if(l(!s),!s||!a)return!1}};a()},[e,t]),{sendMessage:r,missingXmtpAuth:s}};var f=n(67871),v=n(11163),g=n(7960),h=n(92864),b=n(30052),x=n(67909);let w=e=>{var t,n,a;let{profile:s,conversationKey:r}=e,p=(0,v.useRouter)(),[w,T]=(0,c.useState)(!0),j=(0,y.G)(e=>e.unsyncProfile),C=(0,y.G)(e=>e.ensNames),M=C.get(null!==(t=null==r?void 0:r.split("/")[0])&&void 0!==t?t:""),N=null!==(a=M&&(0,o.Z)(null!==(n=null==r?void 0:r.split("/")[0])&&void 0!==n?n:""))&&void 0!==a?a:"",{sendMessage:A}=m(null!=r?r:""),[k,Z]=(0,c.useState)(!1),I=(0,c.useCallback)(e=>{var t;T(e),j(null!==(t=null==s?void 0:s.id)&&void 0!==t?t:"")},[T,j,null==s?void 0:s.id]),E=()=>{p.push("/messages")};return((0,c.useEffect)(()=>{var e;T(null!==(e=null==s?void 0:s.isFollowedByMe)&&void 0!==e&&e)},[null==s?void 0:s.isFollowedByMe]),s||r)?(0,l.jsxs)("div",{className:"divider flex items-center justify-between rounded-xl border px-4 py-2",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(f.Z,{onClick:E,className:"mr-1 h-6 w-6 cursor-pointer lg:hidden"}),(null==s?void 0:s.id)?(0,l.jsx)(x.Z,{profile:s}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(b.E,{src:M?N:(0,i.Z)(s),loading:"lazy",className:"mr-4 h-10 w-10 rounded-full border bg-gray-200 dark:border-gray-700",height:40,width:40,alt:(0,u.Z)("")}),null!=M?M:(0,d.Z)(null!=r?r:"")]})]}),w?(0,l.jsx)(g.Z,{profile:s,setFollowing:I}):(0,l.jsx)(h.Z,{profile:s,setFollowing:I})]}):null};var T=n(9747),j=n(34625),C=n(1257);let M=(e,t)=>{var n;let a=(0,y.G)(e=>e.conversations),s=(0,y.G)(t=>t.messages.get(e)),l=(0,y.G)(e=>e.addMessages),[r,i]=(0,c.useState)(new Map);return(0,c.useEffect)(()=>{let n=a.get(e);if(!n)return;let s=async()=>{let a=await n.messages({direction:C.Sr.SORT_DIRECTION_DESCENDING,limit:j.b_,endTime:t});a.length>0?(l(e,a),a.length<j.b_?(r.set(e,!1),i(new Map(r))):(r.set(e,!0),i(new Map(r)))):(r.set(e,!1),i(new Map(r)))};s()},[e,t]),{messages:s,hasMore:null!==(n=r.get(e))&&void 0!==n&&n}};var N=n(66949),A=n(57632);let k=e=>"status"in e,Z=(e,t)=>{let n=(0,y.G)(e=>e.client),a=(0,y.G)(e=>e.conversations),s=(0,y.G)(e=>e.addConversation),[l,r]=(0,c.useState)(!1),i=(0,c.useRef)([]),o=(0,c.useRef)(!1),d=async(r,u,c)=>{var y,m,f,v,g,h;let b,x;if(!n||!e)return!1;if(l||a.has(e))b=a.get(e);else{let w=null==e?void 0:e.split("/")[0],T=null!==(v=null===(f=(0,p.M)(e))||void 0===f?void 0:f.conversationId)&&void 0!==v?v:"";b=""!==T?await n.conversations.newConversation(w,{conversationId:T,metadata:{}}):await n.conversations.newConversation(w),s(e,b)}if(!b)return!1;let j=new Date,C=b.clientAddress,M=null!==(g=null==c?void 0:c.id)&&void 0!==g?g:(0,A.Z)(),N=M,k={status:"pending",id:N,content:"string"==typeof r?r:void 0,contentType:u,options:c,sent:j,senderAddress:C,render:null==c?void 0:c.renderPreview};if(null==t||null===(y=t.onQueue)||void 0===y||y.call(t,k),o.current){let{promise:Z,resolve:I}=function(){let e=()=>{},t=()=>{},n=new Promise((n,a)=>{t=n,e=a});return{promise:n,reject:e,resolve:t}}();return i.current.push({message:k,resolve:I}),Z}if(o.current=!0,null==c?void 0:c.preparedMessage)x=c.preparedMessage;else{let E="string"==typeof r?r:await r();x=await b.prepareMessage(E,{contentType:u,contentFallback:null==c?void 0:c.fallback})}N=await x.messageID();let S=-1,D=i.current.find((e,t)=>{if(e.message.id===M)return S=t,!0});D&&i.current.splice(S,1,{message:{...D.message,id:N},resolve:D.resolve}),null==t||null===(m=t.onUpdate)||void 0===m||m.call(t,M,{...k,id:N});try{await x.send()}catch(L){return console.error("Failed to send message",L),null==t||null===(h=t.onUpdate)||void 0===h||h.call(t,N,{status:"failed",id:N,content:r,contentType:u,sent:j,senderAddress:C,options:c,cancel:()=>{var e;null==t||null===(e=t.onCancel)||void 0===e||e.call(t,N)},retry:async()=>{await d(r,u,{...t,id:N,preparedMessage:x})}}),!1}finally{if(o.current=!1,i.current.length>0){let F=i.current.shift();F.resolve(await d(F.message.content,F.message.contentType,{...F.message.options,id:F.message.id}))}}return!0};return(0,c.useEffect)(()=>{let t=async()=>{if(n&&!a.has(e)){let t=null==e?void 0:e.split("/")[0],s=await n.canMessage(t);if(r(!s),!s||!t)return!1}};t()},[e,n]),{sendMessage:d,missingXmtpAuth:l}},I=(e,t)=>{let n=(0,y.G)(e=>e.conversations),a=(0,y.G)(e=>e.addMessages),s=(0,c.useRef)(),l=(0,c.useRef)(async e=>{s.current&&(s.current=void 0),void 0!==e&&(await e).return()});(0,c.useEffect)(()=>{let r=n.get(e);if(!r)return;let i=s.current,o=l.current,d=async()=>{if(!s.current)try{for await(let n of(s.current=r.streamMessages(),await (i=s.current))){let l=a(e,[n]);l>0&&t&&t()}}catch(d){throw o(i),d}};return d(),()=>{o(i)}},[e])};var E=n(50680),S=n(92882),D=n(92359),L=n(86501),F=n(45341),P=n(24678),R=n(73445),O=n(782);let _=(e,t)=>t instanceof Map?{dataType:"Map",value:[...t]}:t,U=(e,t)=>"object"==typeof t&&null!==t&&"Map"===t.dataType?new Map(t.value):t,B=(0,R.Ue)((0,O.tJ)(e=>({cachedAttachments:new Map,cacheAttachment:(t,n)=>{e(e=>{let{cachedAttachments:a}=e;return a.set(t,n),{cachedAttachments:a}})}}),{name:F.d.AttachmentCache,storage:{getItem:async e=>JSON.parse(await (0,P.U2)(e)||"{}",U),async setItem(e,t){let n=JSON.stringify({state:{...t.state,cachedAttachments:t.state.cachedAttachments}},_);await (0,P.t8)(e,n)},async removeItem(e){await (0,P.IV)(e)}}})),G=(0,R.Ue)((0,O.tJ)(e=>({loadedAttachmentURLs:[],addLoadedAttachmentURL:t=>e(e=>{let{loadedAttachmentURLs:n}=e;return n.push(t),{loadedAttachmentURLs:n}})}),{name:F.d.AttachmentStore}));var q=n(5678),Y=n(88559),K=n(41664),z=n.n(K),J=n(48764).Buffer;let Q=new WeakMap,H=e=>["image/png","image/jpeg","image/gif"].includes(e),W=e=>{let{attachment:t}=e;t.data instanceof Uint8Array||(t.data=Uint8Array.from(Object.values(t.data))),Q.get(t.data)||Q.set(t.data,URL.createObjectURL(new Blob([J.from(t.data)],{type:t.mimeType})));let n=Q.get(t.data);return H(t.mimeType)?(0,l.jsx)(b.E,{className:"max-h-48 rounded object-contain",src:n,alt:t.filename}):(0,l.jsx)(z(),{target:"_blank",rel:"noreferrer noopener",href:n,children:t.filename})};var V=n(5362),X=n(7814),$=n(57292),ee=n(61286),et=n(29780),en=n(62641);let ea=e=>{let{onDismiss:t,dismissDisabled:n,attachment:a}=e;return(0,l.jsxs)("div",{className:"relative ml-12 inline-block rounded pt-6",children:[(0,l.jsx)("button",{disabled:n,type:"button",className:"absolute top-2 rounded-full bg-gray-900 p-1.5 opacity-75",onClick:t,children:(0,l.jsx)(V.Z,{className:"h-4 w-4 text-white"})}),(0,l.jsx)(W,{attachment:a})]})},es=e=>{let{attachment:t}=e;return(0,l.jsx)("div",{className:"mt-1 space-y-1",children:(0,l.jsx)(W,{attachment:t})})},el=e=>{let{sendMessage:t,conversationKey:n,disabledInput:a}=e,[s,r]=(0,c.useState)(""),[i,o]=(0,c.useState)(!1),[d,u]=(0,c.useState)(null),{width:p}=(0,q.iP)(),m=(0,y.N)(e=>e.unsentMessages.get(n)),f=(0,y.N)(e=>e.setUnsentMessage),v=(0,c.useRef)(null),g=G(e=>e.addLoadedAttachmentURL),h=B(e=>e.cacheAttachment),b=!a&&(d||s.length>0),x=()=>{u(null);let e=v.current;e&&(e.value="")},w=async()=>{if(!b)return;o(!0);let e=Promise.resolve(null),a=Promise.resolve(null);d&&(e=t(async()=>{let e=await Y.RemoteAttachmentCodec.encodeEncrypted(d,new Y.AttachmentCodec),t=new File([e.payload],"XMTPEncryptedContent",{type:d.mimeType}),n=await (0,en.l)(t),a=(0,D.Z)(n.original.url),s={url:a,contentDigest:e.digest,salt:e.salt,nonce:e.nonce,secret:e.secret,scheme:"https://",filename:d.filename,contentLength:d.data.byteLength};return g(a),h(a,d),s},Y.ContentTypeRemoteAttachment,{fallback:'[Attachment] Cannot display "'.concat(d.filename,'". This app does not support attachments yet.'),renderPreview:(0,l.jsx)(es,{attachment:d})}),u(null)),s.length>0&&(a=t(s,C.Ip),r(""),f(n,null));let i=await e;null!==i&&(i||L.ZP.error("Error sending attachment"));let p=await a;null!==p&&(p||L.ZP.error("Error sending message")),o(!1)};(0,q.rf)(()=>{r(null!=m?m:"")},[n]);let T=e=>{f(n,e),r(e)},M=e=>{"Enter"===e.key&&w()},N=async e=>{var t;if(null===(t=e.target.files)||void 0===t?void 0:t.length){let n=e.target.files[0],a=new FileReader;a.addEventListener("load",async function(){let e=a.result;if(!(e instanceof ArrayBuffer))return;let t={filename:n.name,mimeType:n.type,data:new Uint8Array(e)};u(t)}),a.readAsArrayBuffer(n)}else u(null)};return(0,l.jsxs)("div",{className:"bg-brand-100/75 mb-16 rounded-xl border",children:[d&&!i?(0,l.jsx)(ea,{onDismiss:x,dismissDisabled:!b,attachment:d}):null,(0,l.jsxs)("div",{className:"flex space-x-4 p-4",children:[(0,l.jsxs)("label",{className:"flex cursor-pointer items-center",children:[(0,l.jsx)(X.Z,{className:"text-brand-900 h-6 w-5"}),(0,l.jsx)("input",{ref:v,type:"file",accept:".png, .jpg, .jpeg, .gif",className:"hidden w-full",onChange:N})]}),(0,l.jsx)(ee.I,{type:"text",placeholder:"Type Something",value:s,disabled:a,onKeyDown:M,onChange:e=>T(e.target.value)}),(0,l.jsx)(et.z,{disabled:!b,onClick:w,variant:"primary","aria-label":"Send message",children:(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[Number(p)>j.c1?(0,l.jsx)("span",{children:"Send"}):null,(0,l.jsx)($.Z,{className:"h-5 w-5"})]})})]})]})};var er=n(48900),ei=n(86010),eo=n(27484),ed=n.n(eo),eu=n(5276),ep=n(27102),ec=n(14382),ey=n(33962);(a=s||(s={})).UNLOADED="unloaded",a.LOADING="loading",a.LOADED="loaded";let em=e=>{let{remoteAttachment:t,profile:n,sentByMe:a,preview:r}=e,[i,o]=(0,c.useState)(s.UNLOADED),[d,u]=(0,c.useState)(null),{client:p}=(0,ec.Z)(),y=G(e=>e.loadedAttachmentURLs),m=G(e=>e.addLoadedAttachmentURL),f=B(e=>e.cachedAttachments),v=B(e=>e.cacheAttachment),g=(0,c.useMemo)(()=>{let e=f.get(null==t?void 0:t.url);return e?null:!n||n.isFollowedByMe||a?(null==t?void 0:t.contentLength)>104857600&&!a?"Large attachments are not loaded automatically.":null:"Attachments are not loaded automatically from people you don’t follow."},[n,a,f,t]),h=(0,c.useCallback)(async function(){let e=f.get(null==t?void 0:t.url);if(e){u(e),o(s.LOADED);return}if(o(s.LOADING),!p)return;let n=await Y.RemoteAttachmentCodec.load(t,p);u(n),o(s.LOADED),v(t.url,n),m(t.url)},[p,t,m,f,v]);return(0,c.useEffect)(()=>{(async function(){g||await h()})()},[h,p,t,y,n,f,g]),(0,l.jsxs)("div",{className:"mt-1 space-y-1",children:[d?(0,l.jsx)(W,{attachment:d}):null,i===s.LOADING&&(0,l.jsx)(ey.$,{className:"mx-28 my-4 h-48 w-48",size:"sm"}),i===s.UNLOADED&&(0,l.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,l.jsx)("p",{className:"text-gray-500",children:g}),(0,l.jsx)("button",{className:"text-brand-700 inline-block text-xs",onClick:h,children:"View"})]})]})},ef=e=>{let{message:t,profile:n,sentByMe:a,preview:s}=e,r=(0,c.useRef)(),i=k(t);if(i&&t.render&&!r)return r;if(t.contentType.sameAs(Y.ContentTypeRemoteAttachment))return(0,l.jsx)(em,{remoteAttachment:t.content,profile:n,sentByMe:a,preview:r.current});let o=t.content.match(/(https?:\/\/.*)/),d=o?o[0]:null;return d?(0,l.jsx)("div",{children:(0,l.jsx)(ep.Z,{children:t.content})}):(0,l.jsx)(ep.Z,{children:t.content})};var ev=n(11761),eg=n(20445),eh=n(82911),eb=n(50321);let ex=e=>(0,l.jsxs)("svg",{...e,viewBox:"0 0 22 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,l.jsx)("path",{d:"M14.4753 8.51567C14.6897 9.31587 14.4311 10.0804 13.8976 10.2234C13.3641 10.3663 12.7579 9.83351 12.5434 9.03331C12.329 8.23311 12.5877 7.46854 13.1211 7.3256C13.6546 7.18266 14.2609 7.71547 14.4753 8.51567Z",fill:"currentColor"}),(0,l.jsx)("path",{d:"M8.67989 10.0689C8.8943 10.8691 8.63566 11.6337 8.10219 11.7766C7.56873 11.9195 6.96245 11.3867 6.74804 10.5865C6.53363 9.78633 6.79227 9.02176 7.32574 8.87882C7.8592 8.73588 8.46548 9.26869 8.67989 10.0689Z",fill:"currentColor"}),(0,l.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M13.608 1.81525C12.4288 1.9672 10.9309 2.36692 8.83706 2.92795C6.74324 3.48899 5.24617 3.89178 4.14897 4.34979C3.07186 4.79941 2.48597 5.26096 2.12941 5.87854C1.77286 6.49612 1.66608 7.23429 1.81525 8.3919C1.9672 9.57111 2.36692 11.069 2.92795 13.1628C3.48899 15.2566 3.89178 16.7537 4.34979 17.8509C4.79941 18.928 5.26096 19.5139 5.87854 19.8705C6.49612 20.227 7.23429 20.3338 8.3919 20.1846C9.57111 20.0327 11.069 19.633 13.1628 19.0719C15.2566 18.5109 16.7537 18.1081 17.8509 17.6501C18.928 17.2005 19.5139 16.7389 19.8705 16.1214C20.227 15.5038 20.3338 14.7656 20.1846 13.608C20.0327 12.4288 19.633 10.9309 19.0719 8.83706C18.5109 6.74324 18.1081 5.24617 17.6501 4.14897C17.2005 3.07186 16.7389 2.48597 16.1214 2.12941C15.5038 1.77286 14.7656 1.66608 13.608 1.81525ZM13.4163 0.327552C14.7404 0.156932 15.8555 0.243899 16.8714 0.830375C17.8872 1.41685 18.5201 2.33915 19.0343 3.57114C19.5357 4.77217 19.963 6.36709 20.5061 8.39374L20.5356 8.50378C21.0786 10.5305 21.506 12.1254 21.6723 13.4163C21.843 14.7404 21.756 15.8555 21.1695 16.8713C20.583 17.8872 19.6607 18.5201 18.4288 19.0343C17.2277 19.5357 15.6328 19.963 13.6062 20.5061L13.4961 20.5356C11.4694 21.0786 9.87443 21.506 8.58361 21.6723C7.25954 21.843 6.14435 21.756 5.12854 21.1695C4.11274 20.583 3.47982 19.6607 2.96555 18.4288C2.46419 17.2277 2.03684 15.6328 1.49381 13.6061L1.46431 13.496C0.921257 11.4693 0.493887 9.87442 0.327552 8.58361C0.156932 7.25954 0.243899 6.14435 0.830375 5.12854C1.41685 4.11274 2.33915 3.47982 3.57114 2.96555C4.77218 2.46419 6.36711 2.03685 8.39378 1.49382L8.50388 1.46431C10.5305 0.921257 12.1255 0.493887 13.4163 0.327552ZM16.1788 12.3408C16.4669 12.6384 16.4592 13.1133 16.1616 13.4014C15.9916 13.5659 15.8128 13.7245 15.6256 13.8765L15.844 14.3214C16.397 15.448 15.9213 16.8093 14.787 17.3463C13.6751 17.8726 12.3467 17.4084 11.8047 16.3041L11.5315 15.7476C10.2117 15.998 8.90915 15.956 7.7302 15.6605C7.32842 15.5598 7.08434 15.1525 7.18505 14.7507C7.28575 14.3489 7.6931 14.1049 8.09488 14.2056C9.2252 14.4889 10.5232 14.4924 11.841 14.1393C13.1587 13.7862 14.2811 13.1341 15.1183 12.3236C15.4159 12.0355 15.8907 12.0432 16.1788 12.3408ZM13.0048 15.3449L13.1512 15.6432C13.3319 16.0112 13.7746 16.1659 14.1452 15.9905C14.5232 15.8116 14.6818 15.3579 14.4975 14.9824L14.3707 14.7241C13.9417 14.963 13.4851 15.1715 13.0048 15.3449Z",fill:"currentColor"})]}),ew=(e,t)=>ed()(e).format("YYYYMMDD")===ed()(t).format("YYYYMMDD"),eT=e=>ed()(e).format("MMMM D, YYYY"),ej=e=>{let{url:t,message:n,profile:a,currentProfile:s}=e,r=null==s?void 0:s.ownedBy,o=null;if(k(n))switch(n.status){case"failed":o=(0,l.jsx)(eb.Z,{width:14,height:14});break;case"pending":o=(0,l.jsx)(eg.Z,{width:14,height:14})}else o=(0,l.jsx)(eh.Z,{width:14,height:14});let d=null;if(k(n))switch(n.status){case"failed":d=(0,l.jsxs)("span",{className:"flex items-center gap-1 text-red-500",children:["Not delivered •",(0,l.jsx)("span",{className:"cursor-pointer underline",onClick:n.retry,children:"Retry"}),"•",(0,l.jsx)("span",{className:"cursor-pointer underline",onClick:n.cancel,children:"Cancel"})]});break;case"pending":d=ed()(n.sent).fromNow()}else d=ed()(n.sent).fromNow();return(0,l.jsxs)("div",{className:(0,ei.Z)(r===n.senderAddress?"mr-4 items-end":"items-start","mx-auto mb-4 flex flex-col"),children:[(0,l.jsxs)("div",{className:"flex max-w-[60%]",children:[r!==n.senderAddress&&(0,l.jsx)(b.E,{src:(0,i.Z)(a),className:"mr-2 h-10 w-10 rounded-full border bg-gray-200 dark:border-gray-700",alt:(0,u.Z)(null==a?void 0:a.handle)}),(0,l.jsx)("div",{className:(0,ei.Z)(r===n.senderAddress?"bg-brand-500":"bg-gray-100 dark:bg-blue-500","w-full rounded-lg px-4 py-2 text-xs font-bold"),children:(0,l.jsx)("span",{className:(0,ei.Z)(r===n.senderAddress&&"text-black","linkify-message block break-words text-xs font-bold"),children:(0,l.jsx)(ef,{message:n,profile:a,sentByMe:r==n.senderAddress,preview:!0})})})]}),(0,l.jsx)("div",{className:(0,ei.Z)(r!==n.senderAddress?"ml-12":""),children:(0,l.jsxs)("span",{className:(0,ei.Z)(r===n.senderAddress?"flex-row":"flex-row-reverse","flex items-center gap-1 text-xs text-gray-400"),title:(0,er.Z)(n.sent),children:[o,d]})})]})},eC=e=>{let{children:t}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"h-0.5 grow bg-gray-300/25"}),t,(0,l.jsx)("div",{className:"h-0.5 grow bg-gray-300/25"})]})},eM=e=>{let{date:t}=e;return(0,l.jsx)("div",{className:"align-items-center flex items-center p-4 pl-2 pt-0",children:(0,l.jsx)(eC,{children:(0,l.jsx)("span",{className:"mx-11 flex-none text-sm font-bold text-gray-300",children:eT(t)})})})},eN=()=>(0,l.jsxs)(ev.Z,{as:"aside",className:"mb-2 mr-4 space-y-2.5 border-gray-400 !bg-gray-300/20 p-5",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2 font-bold",children:[(0,l.jsx)(ex,{className:"h-5 w-5"}),(0,l.jsx)("p",{children:"This fren hasn enabled DMs yet"})]}),(0,l.jsx)("p",{className:"text-sm leading-[22px]",children:"You can send them a message until they enable DMs."})]}),eA=()=>(0,l.jsx)("div",{className:"align-items-center mt-6 flex justify-center pb-4",children:(0,l.jsx)("span",{className:"text-sm font-bold text-gray-300",children:"This is the beginning of the conversation"})}),ek=()=>(0,l.jsx)("div",{className:"mt-6 p-1 text-center text-sm font-bold text-gray-300",children:"Loading..."}),eZ=e=>{var t,n,a;let s,{conversationKey:r,messages:i,fetchNextMessages:d,profile:u,currentProfile:p,hasMore:m,missingXmtpAuth:f}=e,v=(0,c.useRef)(null),{observe:g}=(0,eu.Y)({onChange:e=>{let{inView:t}=e;t&&d()}});(0,c.useEffect)(()=>{var e;null===(e=v.current)||void 0===e||e.scrollTo(0,v.current.scrollHeight)},[r]);let h=(0,y.G)(e=>e.ensNames),b=h.get(null!==(t=null==r?void 0:r.split("/")[0])&&void 0!==t?t:""),x=null!==(a=b&&(0,o.Z)(null!==(n=null==r?void 0:r.split("/")[0])&&void 0!==n?n:""))&&void 0!==a?a:"";return(0,l.jsx)("div",{className:"flex grow overflow-y-hidden",children:(0,l.jsx)("div",{className:"relative flex h-full w-full pl-4",children:(0,l.jsxs)("div",{className:"flex h-full w-full flex-col-reverse overflow-y-hidden",children:[f&&(0,l.jsx)(eN,{}),(0,l.jsxs)("span",{ref:v,className:"flex flex-col-reverse overflow-y-auto overflow-x-hidden",children:[null==i?void 0:i.map((e,t)=>{let n=!!s&&!ew(s,e.sent),a=(0,l.jsxs)("div",{ref:t===i.length-1?g:null,children:[(0,l.jsx)(ej,{url:x,currentProfile:p,profile:u,message:e}),n?(0,l.jsx)(eM,{date:s}):null]},"".concat(e.id,"_").concat(t));return s=e.sent,a}),m?(0,l.jsx)(ek,{}):(0,l.jsx)(eA,{})]})]})})})};var eI=(0,c.memo)(eZ),eE=n(98320),eS=n(31586),eD=n(21094);let eL=e=>{var t;let{conversationKey:n}=e,a=(0,S.qr)(e=>e.currentProfile),{profile:s}=(0,N.x)(null==a?void 0:a.id,n),i=(0,y.G)(e=>e.queuedMessages.get(n)),o=(0,y.G)(e=>e.addQueuedMessage),d=(0,y.G)(e=>e.removeQueuedMessage),p=(0,y.G)(e=>e.updateQueuedMessage),[m,f]=(0,c.useState)(new Map),{messages:v,hasMore:g}=M(n,m.get(n));I(n);let h=(0,c.useCallback)(e=>{o(n,e)},[o,n]),b=(0,c.useCallback)(e=>{d(n,e)},[d,n]),x=(0,c.useCallback)((e,t)=>{p(n,e,t)},[p,n]),{missingXmtpAuth:C,sendMessage:A}=Z(n,{onQueue:h,onCancel:b,onUpdate:x}),k=(0,c.useMemo)(()=>{let e=(null!=i?i:[]).reduce((e,t)=>{let n=null==v?void 0:v.some(e=>e.id===t.id);return n?e:[...e,t]},[]);return[...e,...null!=v?v:[]]},[v,i]);(0,c.useEffect)(()=>{if(i)for(let e of i){let t="";if(null==v||v.some(n=>{if(n.id===e.id)return t=n.id,!0}),t){d(n,t);continue}}},[v]);let D=(0,c.useCallback)(()=>{if(g&&Array.isArray(v)&&v.length>0){let e=v[v.length-1].sent,t=m.get(n);(!t||e<=t)&&(m.set(n,e),f(new Map(m)))}},[n,g,v,m]);if(!a)return(0,l.jsx)(E.default,{});let L=null!==(t=(0,eS.Z)(null==s?void 0:s.name))&&void 0!==t?t:(0,u.Z)(null==s?void 0:s.handle),F=L?"".concat(L," • ").concat(j.iC):j.iC;return(0,l.jsxs)(eD.Me,{classNameChild:"gap-1",children:[(0,l.jsx)(r.Z,{title:F}),(0,l.jsx)(eE.Z,{className:"xs:hidden hidden sm:hidden md:hidden lg:block",selectedConversationKey:n}),(0,l.jsx)(eD.VK,{className:"xs:mx-2 mb-5 sm:mx-2 md:col-span-8",children:(0,l.jsx)(ev.Z,{className:"flex h-[87vh] flex-col justify-between",children:C||a?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(w,{profile:s,conversationKey:n}),(0,l.jsx)(eI,{conversationKey:n,currentProfile:a,profile:s,fetchNextMessages:D,messages:k,hasMore:g,missingXmtpAuth:null!=C&&C}),(0,l.jsx)(el,{sendMessage:A,conversationKey:n,disabledInput:null!=C&&C})]}):(0,l.jsx)("div",{className:"flex items-center justify-center",children:(0,l.jsx)(T.Z,{message:"Loading messages"})})})})]})},eF=()=>{let e=(0,S.qr)(e=>{var t;return null===(t=e.currentProfile)||void 0===t?void 0:t.id}),{query:{conversationKey:t}}=(0,v.useRouter)();if(!t||!e||!Array.isArray(t))return(0,l.jsx)(E.default,{});let n=t.join("/"),a=(0,p.M)(n);if(!a)return(0,l.jsx)(E.default,{});let{members:s}=a,r=s.find(t=>t!==e);return s.length>1&&!r?(0,l.jsx)(E.default,{}):(0,l.jsx)(eL,{conversationKey:n})};var eP=eF},92359:function(e,t,n){"use strict";var a=n(34625),s=n(5996);let l=e=>{let t="".concat(s.Gs,"/"),n="".concat(a.C7,"/");return e?e.replace(/^Qm[1-9A-Za-z]{44}/gm,"".concat(t,"/").concat(e)).replace("https://ipfs.io/ipfs",t).replace("https://ipfs.infura.io/ipfs",t).replace("https://lens.ipfs.infura.io/ipfs",t).replace("https://ipfs-infura.io/ipfs",t).replace("https://lens.ipfs-infura.io/ipfs",t).replace("https://lenshareapp.ipfs-infura.io/ipfs",t).replace("https://lenshareapp.ipfs-infura.io",t).replace("ipfs://",t).replace("ipfs://ipfs/",t).replace("ipfs://ipfs",t).replace("ar://",n).replace("https://lp-playback.com/hls","".concat(n,"/").concat(e)).replace("https://lp-playback.com/hls",n).replace("https://lp-playback.com","".concat(n,"/").concat(e)).replace("https://lp-playback.com",n):e};t.Z=l},13250:function(e,t,n){"use strict";var a=n(86501),s=n(50319),l=n(68980);let r=e=>{let{onCompleted:t,update:n}=e,r={notMined:"A previous transaction may not been mined yet or you have passed in a invalid nonce. You must wait for that to be mined before doing another action, please try again in a few moments. Nonce out of sync."},[i,{data:o,loading:d}]=function(e){let t={...e};return s.D(l.VPH,t)}({onCompleted:t,update:n,onError:e=>{e.message===r.notMined&&a.ZP.error(e.message)}});return{broadcast:e=>{let{request:t}=e;return i({variables:{request:t}})},data:o,loading:d}};t.Z=r},54287:function(){},86243:function(){}},function(e){e.O(0,[9498,3874,6556,8179,1664,1618,1098,1257,5675,2697,8451,1889,3775,2438,7536,5678,1318,6214,1039,2224,4794,6781,7635,7331,7253,9774,2888,179],function(){return e(e.s=22622)}),_N_E=e.O()}]);