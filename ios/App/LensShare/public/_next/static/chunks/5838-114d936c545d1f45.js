(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5838],{36008:function(e,t,l){"use strict";l.d(t,{Z:function(){return tc}});var a=l(85893),n=l(847),r=l(5649),i=l(68980),s=l(36571),o=l(84260),c=l(86010),d=l(32998),u=l(5152),m=l.n(u),p=l(11163),h=l(67294),x=l(86501),g=l(67946),v=l(92882),y=l(20269),b=l(48113),f=l(5678),w=l(57632),N=l(31618),j=l(29780),C=l(11761),D=l(61286),S=l(64208),_=l(93300),M=l(20445),T=l(5362),k=l(78680),R=l(53854);let E=()=>{let e=(0,b.l)(e=>e.setShowPollEditor),t=(0,b.l)(e=>e.pollConfig),l=(0,b.l)(e=>e.setPollConfig),n=(0,b.l)(e=>e.resetPollConfig),[r,i]=(0,h.useState)(!1);return(0,a.jsxs)(C.Z,{className:"m-5 px-5 py-3",forceRounded:!0,children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,a.jsx)(R.ZES,{className:"text-brand h-4 w-4"}),(0,a.jsx)("b",{children:"Poll"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)(j.z,{variant:"primary",size:"sm",icon:(0,a.jsx)(M.Z,{className:"h-4 w-4"}),onClick:()=>i(!0),outline:!0,children:[t.length," "]}),(0,a.jsx)(S.u,{title:"Poll length",icon:(0,a.jsx)(M.Z,{className:"text-brand h-5 w-5"}),show:r,onClose:()=>i(!1),children:(0,a.jsxs)("div",{className:"p-5",children:[(0,a.jsx)(D.I,{label:"Poll length (days)",type:"number",value:t.length,min:1,max:30,onChange:e=>l({...t,length:Number(e.target.value)})}),(0,a.jsxs)("div",{className:"flex space-x-2 pt-5",children:[(0,a.jsx)(j.z,{className:"ml-auto",variant:"danger",onClick:()=>{l({...t,length:7}),i(!1)},outline:!0,children:"Cancel"}),(0,a.jsx)(j.z,{className:"ml-auto",variant:"primary",onClick:()=>i(!1),children:"Save"})]})]})}),(0,a.jsx)(_.u,{placement:"top",content:"Delete",children:(0,a.jsx)("button",{className:"flex",onClick:()=>{n(),e(!1)},children:(0,a.jsx)(T.Z,{className:"h-5 w-5 text-red-400"})})})]})]}),(0,a.jsxs)("div",{className:"mt-3 space-y-2",children:[t.choices.map((e,n)=>(0,a.jsx)("div",{className:"flex items-center space-x-2 text-sm",children:(0,a.jsx)(D.I,{placeholder:"Choice ".concat(n+1),value:e,onChange:e=>{let a=[...t.choices];a[n]=e.target.value,l({...t,choices:a})},iconRight:n>1&&(0,a.jsx)("button",{className:"flex",onClick:()=>{let e=[...t.choices];e.splice(n,1),l({...t,choices:e})},children:(0,a.jsx)(T.Z,{className:"h-5 w-5 text-red-500"})})})},n)),5!==t.choices.length&&(0,a.jsxs)("button",{className:"text-brand mt-2 flex items-center space-x-2 text-sm",onClick:()=>{let e=[...t.choices];e.push(""),l({...t,choices:e})},children:[(0,a.jsx)(k.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Add another option"})]})]})]})};var O=l(50185),A=l(73935);class P extends d.TextNode{static getType(){return"mention"}static clone(e){return new P(e.__mention,e.__text,e.__key)}static importJSON(e){let t=Z(e.mentionName);return t.setTextContent(e.text),t.setFormat(e.format),t.setDetail(e.detail),t.setMode(e.mode),t.setStyle(e.style),t}exportJSON(){return{...super.exportJSON(),mentionName:this.__mention,type:"mention",version:1}}createDOM(e){let t=super.createDOM(e);return t.style.cssText="",t.className="",t}exportDOM(){let e=document.createElement("span");return e.textContent=this.__text,{element:e}}static importDOM(){return{span:e=>e.hasAttribute("data-lexical-mention")?{conversion:I,priority:1}:null}}isTextEntity(){return!0}constructor(e,t,l){super(null!=t?t:"@".concat(e),l),this.__mention="@".concat(e)}}let Z=e=>{let t=new P(e);return t.setMode("segmented").toggleDirectionless(),t},I=e=>{let{textContent:t}=e;if(null!==t){let l=Z(t);return{node:l}}return null};var L=l(29451),F=l(7925),V=l(31586),B=l(92359),z=l(45706);let q="\\.,\\+\\*\\?\\$\\@\\|#{}\\(\\)\\^\\-\\[\\]\\\\/!%'\"~=<>_:;",U={NAME:"\\b[A-Z][^\\s"+q+"]",PUNCTUATION:q}.PUNCTUATION,G="[^@"+U+"\\s]",W=RegExp("(^|\\s|\\()([@]((?:"+G+"(?:\\.[ |$]| |["+U+"]|)){0,75}))$"),$=RegExp("(^|\\s|\\()([@]((?:"+G+"){0,50}))$"),H=(e,t)=>{let l=W.exec(e);if(null===l&&(l=$.exec(e)),null!==l){let a=l[1],n=l[3];if(n.length>=t)return{leadOffset:l.index+a.length,matchingString:n,replaceableString:l[2]}}return null},J=e=>{let t=H(e,1);return t};class Y extends O.MenuOption{constructor(e,t,l,a){super(t),this.id=e,this.name=t,this.handle=a,this.picture=l}}let X=e=>{let{isSelected:t,onClick:l,onMouseEnter:n,option:r}=e;return(0,a.jsx)("li",{tabIndex:-1,className:"cursor-pointer",ref:r.setRefElement,role:"option",onMouseEnter:n,onClick:l,"aria-selected":t,"aria-hidden":"true",children:(0,a.jsxs)("div",{className:(0,c.Z)({"bg-gray-200 dark:bg-gray-800":t},"m-1.5 flex items-center space-x-2 rounded-xl px-3 py-1 hover:bg-gray-200 dark:text-white dark:hover:bg-gray-800"),children:[(0,a.jsx)("img",{className:"h-7 w-7 rounded-full",height:"32",width:"32",src:r.picture,alt:r.handle}),(0,a.jsxs)("div",{className:"flex flex-col truncate",children:[(0,a.jsx)("div",{className:"flex items-center space-x-1 text-sm",children:(0,a.jsx)("span",{children:r.name})}),(0,a.jsx)("span",{className:"text-xs",children:(0,L.Z)(r.handle)})]})]})},r.key)},K=()=>{let[e,t]=(0,h.useState)(null),[l,n]=(0,h.useState)([]),[s]=(0,o.useLexicalComposerContext)(),[c]=(0,i.mpp)(),d=e=>{let t=null==e?void 0:e.picture;if(t&&t.hasOwnProperty("original")){var l;let a=e.picture;return null===(l=a.original)||void 0===l?void 0:l.url}if(t&&t.hasOwnProperty("uri")){let n=e.picture;return null==n?void 0:n.uri}return(0,F.Z)(null==e?void 0:e.ownedBy)};(0,f.rf)(()=>{e&&c({variables:{request:{type:i.qkC.Profile,query:e,limit:5}}}).then(e=>{let{data:t}=e,l=null==t?void 0:t.search,a=l&&l.hasOwnProperty("items")?null==l?void 0:l.items:[],r=a.map(e=>({id:null==e?void 0:e.id,name:(0,V.Z)(null==e?void 0:e.name),handle:null==e?void 0:e.handle,picture:d(e)}));n(r)})},[e]);let u=(0,O.useBasicTypeaheadTriggerMatch)("/",{minLength:0}),m=(0,h.useMemo)(()=>l.map(e=>{let{id:t,name:l,picture:a,handle:n}=e;return new Y(t,null!=l?l:n,(0,z.Z)((0,B.Z)(a),r.pA),n)}).slice(0,5),[l]),p=(0,h.useCallback)((e,t,l)=>{s.update(()=>{let a=Z(e.handle);t&&t.replace(a),a.select().insertText(" "),l()})},[s]),x=(0,h.useCallback)(e=>{let t=J(e),l=u(e,s);return!l&&t?t:null},[u,s]);return(0,a.jsx)(O.LexicalTypeaheadMenuPlugin,{onQueryChange:t,onSelectOption:p,triggerFn:x,options:m,menuRenderFn:(e,t)=>{let{selectedIndex:n,selectOptionAndCleanUp:r,setHighlightedIndex:i}=t;return e.current&&l.length?A.createPortal((0,a.jsx)("div",{className:"bg-brand sticky z-40 mt-8 w-52 min-w-full rounded-xl border bg-white dark:bg-gray-900/70 shadow-sm dark:border-gray-700 dark:bg-gray-900",children:(0,a.jsx)("ul",{className:"divide-y dark:divide-gray-700",children:m.map((e,t)=>(0,a.jsx)(X,{index:t,isSelected:n===t,onClick:()=>{i(t),r(e)},onMouseEnter:()=>{i(t)},option:e},e.key))})}),e.current):null}})};var Q=l(32358);let ee=/((https?:\/\/(www\.)?)|(www\.))[\w#%+.:=@~-]{1,256}\.[\d()A-Za-z]{1,6}\b([\w#%&()+./:=?@~-]*)/,et=/(([^\s"(),.:;<>@[\\\]]+(\.[^\s"(),.:;<>@[\\\]]+)*)|(".+"))@((\[(?:\d{1,3}\.){3}\d{1,3}])|(([\dA-Za-z\-]+\.)+[A-Za-z]{2,}))/,el=[e=>{let t=ee.exec(e);if(null===t)return null;let l=t[0];return{index:t.index,length:l.length,text:l,url:l.startsWith("http")?l:"https://".concat(l)}},e=>{let t=et.exec(e);return t&&{index:t.index,length:t[0].length,text:t[0],url:"mailto:".concat(t[0])}}],ea=()=>(0,a.jsx)(Q.AutoLinkPlugin,{matchers:el});class en extends O.MenuOption{constructor(e,t,l){super(e),this.title=e,this.emoji=t,this.keywords=l.keywords||[]}}let er=e=>{let{index:t,isSelected:l,onClick:n,onMouseEnter:r,option:i}=e,{key:s,title:o,emoji:d,setRefElement:u}=i;return(0,a.jsx)("li",{tabIndex:-1,className:(0,c.Z)({"dropdown-active":l},"m-2 cursor-pointer rounded-lg p-2 outline-none"),ref:u,role:"option",id:"typeahead-item-"+t,onMouseEnter:r,onClick:n,"aria-selected":l,"aria-hidden":"true",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-base",children:d}),(0,a.jsx)("span",{className:"text-sm capitalize",children:o.split("_").join(" ")})]})},s)},ei=()=>{let[e]=(0,o.useLexicalComposerContext)(),[t,l]=(0,h.useState)(null),[n,r]=(0,h.useState)([]),i=(0,h.useMemo)(()=>null!==n?n.map(e=>{let{emoji:t,aliases:l,tags:a}=e;return new en(l[0],t,{keywords:[...l,...a]})}):[],[n]),s=(0,O.useBasicTypeaheadTriggerMatch)(":",{minLength:0}),c=(0,h.useMemo)(()=>i.filter(e=>null!==t?(!!RegExp(t,"gi").exec(e.title)||null!==e.keywords)&&e.keywords.some(e=>RegExp(t,"gi").exec(e)):i).slice(0,5),[i,t]),u=(0,h.useCallback)((t,l,a)=>{e.update(()=>{let e=(0,d.$getSelection)();(0,d.$isRangeSelection)(e)&&null!==t&&(l&&l.remove(),e.insertNodes([(0,d.$createTextNode)(t.emoji)]),a())})},[e]);return(0,a.jsx)(O.LexicalTypeaheadMenuPlugin,{onQueryChange:l,onSelectOption:u,triggerFn:s,options:c,menuRenderFn:(e,t)=>{let{selectedIndex:l,selectOptionAndCleanUp:n,setHighlightedIndex:r}=t;return null===e.current||0===c.length?null:e.current&&c.length?A.createPortal((0,a.jsx)("ul",{className:"mt-7 w-52 rounded-xl border bg-white dark:bg-gray-900/70 shadow-sm dark:border-gray-700 dark:bg-gray-900",children:c.map((e,t)=>(0,a.jsx)("div",{children:(0,a.jsx)(er,{index:t,isSelected:l===t,onClick:()=>{r(t),n(e)},onMouseEnter:()=>{r(t)},option:e})},e.key))}),e.current):null}})};class es extends d.TextNode{static getType(){return"emoji"}static clone(e){return new es(e.__className,e.__text,e.__key)}createDOM(e){let t=document.createElement("span"),l=super.createDOM(e);return t.className=this.__className,l.className="emoji-inner",t.appendChild(l),t}updateDOM(e,t,l){let a=t.firstChild;return null===a||(super.updateDOM(e,a,l),!1)}static importJSON(e){let t=eo(e.className,e.text);return t.setFormat(e.format),t.setDetail(e.detail),t.setMode(e.mode),t.setStyle(e.style),t}exportJSON(){return{...super.exportJSON(),className:this.getClassName(),type:"emoji"}}getClassName(){let e=this.getLatest();return e.__className}constructor(e,t,l){super(t,l),this.__className=e}}let eo=(e,t)=>new es(e,t).setMode("token"),ec=new Map([[":)",["emoji happysmile","\uD83D\uDE42"]],[":(",["emoji sadsmile","\uD83D\uDE41"]],[";)",["emoji winksmile","\uD83D\uDE09"]],[":D",["emoji bigsmile","\uD83D\uDE03"]],[":P",["emoji tongue","\uD83D\uDE1B"]],[":O",["emoji shock","\uD83D\uDE2E"]],[":|",["emoji neutral","\uD83D\uDE10"]],[":*",["emoji kiss","\uD83D\uDE18"]],[":$",["emoji blush","\uD83D\uDE33"]],[":@",["emoji angry","\uD83D\uDE20"]],[":S",["emoji smirk","\uD83D\uDE0F"]],[":L",["emoji sealed","\uD83C\uDF38"]],["<3",["emoji heart","\uD83D\uDC9C"]]]),ed=e=>{let t=e.getTextContent();for(let l=0;l<t.length;l++){let a=ec.get(t[l])||ec.get(t.slice(l,l+2));if(void 0!==a){let n;let[r,i]=a;0===l?[n]=e.splitText(l+2):[,n]=e.splitText(l,l+2);let s=eo(r,i);return n.replace(s),s}}return null},eu=e=>{let t=e;for(;null!==t;){if(!t.isSimpleText())return;t=ed(t)}},em=e=>{(0,f.rf)(()=>{if(!e.hasNodes([es]))throw Error("EmojisPlugin: EmojiNode not registered on editor");return e.registerNodeTransform(d.TextNode,eu)},[e])},ep=()=>{let[e]=(0,o.useLexicalComposerContext)();return em(e),null};var eh=l(76969);let ex=e=>{let{onPaste:t}=e,[l]=(0,o.useLexicalComposerContext)();return(0,f.rf)(()=>(0,eh.mergeRegister)(l.registerCommand(d.PASTE_COMMAND,e=>{if(e){let{dataTransfer:l,clipboardData:a}=e;if(null==a?void 0:a.getData("Text"))return!1;if(l&&l.files.length){let{files:n}=l;t&&t(n)}return!0}return!1},d.COMMAND_PRIORITY_NORMAL)),[l,t]),null},eg=()=>{let[e]=(0,o.useLexicalComposerContext)(),[t,l]=(0,h.useState)(e),[n,r]=(0,h.useState)(!1),[i,s]=(0,h.useState)(!1),[c,u]=(0,h.useState)(!1),m=(0,h.useCallback)(()=>{let e=(0,d.$getSelection)();(0,d.$isRangeSelection)(e)&&(r(e.hasFormat("bold")),s(e.hasFormat("italic")),u(e.hasFormat("code")))},[]);return(0,f.rf)(()=>e.registerCommand(d.SELECTION_CHANGE_COMMAND,(e,t)=>(m(),l(t),!1),d.COMMAND_PRIORITY_CRITICAL),[e,m]),(0,a.jsx)("div",{className:"divider flex items-center justify-between px-5 py-2 text-black dark:text-white",children:(0,a.jsxs)("div",{className:"toolbar-icons flex w-full space-x-1",children:[(0,a.jsx)("button",{className:n?"bg-brand-100":"",title:"Bold",onClick:()=>{t.dispatchCommand(d.FORMAT_TEXT_COMMAND,"bold")},children:(0,a.jsx)("i",{className:"toolbar-icon bold text-brand"})}),(0,a.jsx)("button",{className:i?"bg-brand-100":"",title:"Italic",onClick:()=>{t.dispatchCommand(d.FORMAT_TEXT_COMMAND,"italic")},children:(0,a.jsx)("i",{className:"toolbar-icon italic"})}),(0,a.jsx)("button",{className:c?"bg-brand-100":"",title:"Code",onClick:()=>{t.dispatchCommand(d.FORMAT_TEXT_COMMAND,"code")},children:(0,a.jsx)("i",{className:"toolbar-icon code"})})]})})};var ev=l(41741),ey=l(11600),eb=l(6898),ef=l(50627),ew=l(4506),eN=l(87632),ej=l(71954),eC=l(86146);let eD=[...s.TEXT_FORMAT_TRANSFORMERS],eS=()=>{let e=(0,b.l)(e=>e.setPublicationContent),t=(0,b.l)(e=>e.showPollEditor),l=(0,b.l)(e=>e.showSpaceEditor),n=(0,b.l)(e=>e.attachments),{handleUploadAttachments:r}=(0,ey.Z)(),[i]=(0,o.useLexicalComposerContext)(),c=async e=>{if(4===n.length||n.length+e.length>4)return x.Am.error("Please choose either 1 video or up to 4 photos.");e&&await r(e)};return(0,h.useEffect)(()=>i.registerCommand(d.INSERT_PARAGRAPH_COMMAND,()=>(i.dispatchCommand(d.INSERT_LINE_BREAK_COMMAND,!1),!0),d.COMMAND_PRIORITY_NORMAL),[i]),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(ei,{}),(0,a.jsx)(eg,{}),(0,a.jsx)(eC.RichTextPlugin,{contentEditable:(0,a.jsx)(eb.ContentEditable,{className:"my-4 block min-h-[65px] rounded-lg bg-white dark:bg-gray-900/70 overflow-auto px-5"}),placeholder:(0,a.jsx)("div",{className:"pointer-events-none absolute top-[65px] bg-white dark:bg-gray-900/70 whitespace-nowrap px-5 text-gray-400",children:l?"What do you want to talk about?":t?"Ask a question...":" New Post?"}),ErrorBoundary:()=>(0,a.jsx)("div",{children:ev.D.SomethingWentWrong})}),(0,a.jsx)(ej.OnChangePlugin,{onChange:t=>{t.read(()=>{let t=(0,s.$convertToMarkdownString)(eD);e(t)})}}),(0,a.jsx)(ep,{}),(0,a.jsx)(ea,{}),(0,a.jsx)(ew.HistoryPlugin,{}),(0,a.jsx)(ef.HashtagPlugin,{}),(0,a.jsx)(K,{}),(0,a.jsx)(ex,{onPaste:c}),(0,a.jsx)(eN.MarkdownShortcutPlugin,{transformers:eD})]})};var e_=l(66252),eM=l(96806),eT=l(52815),ek=l(52942),eR=l(10985),eE=l(2677),eO=l(48764).Buffer;let eA="2Km7bBvxqZOmfzYksdcepn58KBe",eP="8e8884f5ce9793101a44e58518f8e395";if(!eA||!eP)throw Error("Must define INFURA_PROJECT_ID and INFURA_SECRET in the .env to run this");let eZ=(0,eE.Ue)({host:"ipfs.infura.io",port:5001,protocol:"https",headers:{authorization:"Basic ".concat(eO.from("".concat(eA,":").concat(eP),"utf-8").toString("base64"))}}),eI=async e=>{let t=await eZ.add(JSON.stringify(e));return console.log("upload result ipfs",t),t};var eL=l(69111);let eF=async(e,t,l)=>{let a='<svg width="500" height="500" viewBox="0 0 500 500" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <style>\n      .content {\n        font: normal 14px sans-serif;\n        color: black;\n      }\n      .timestamp {\n        font: normal 13px sans-serif;\n        color: white;\n        opacity: 70%;\n      }\n      .username {\n        font: bold 15px sans-serif;\n        color: white;\n      }\n    </style>\n    <g clip-path="url(#clip0_1_2)">\n    <path d="M475 0H25C11.1929 0 0 11.1929 0 25V475C0 488.807 11.1929 500 25 500H475C488.807 500 500 488.807 500 475V25C500 11.1929 488.807 0 475 0Z" fill="white"/>\n    <foreignObject x="30" y="90" width="440" height="300">\n    <p class="content" xmlns="http://www.w3.org/1999/xhtml">'.concat((0,eL.encode)(e,{mode:"nonAsciiPrintable",level:"xml"}),'}</p>\n    </foreignObject>\n    <path d="M0 25C0 11.1929 11.1929 0 25 0H475C488.807 0 500 11.1929 500 25V78H0V25Z" fill="#ec1e25" fill-opacity="0.90"/>\n    <path d="M500.06 474.236C500.026 488.043 488.806 499.208 474.999 499.174L24.9999 498.062C11.193 498.027 0.0276556 486.807 0.0617778 473L0.192759 420L500.191 421.236L500.06 474.236Z" fill="#ec1e25" fill-opacity="0.90"/>\n    <foreignObject x="350" y="440" width="440" height="300">\n    <p class="timestamp" xmlns="http://www.w3.org/1999/xhtml">').concat(l,'</p>\n    </foreignObject>\n    <foreignObject x="30" y="15" width="440" height="300">\n    <p class="username" xmlns="http://www.w3.org/1999/xhtml">@').concat(t,'</p>\n    </foreignObject>\n    </g>\n    <defs>\n    <clipPath id="clip0_1_2">\n    <rect width="500" height="500" fill="white"/>\n    </clipPath>\n    </defs>\n</svg>\n'),n=new Blob([a],{type:"image/svg+xml"}),r=new File([n],"post.svg",{lastModified:new Date().getTime(),type:n.type}),i=await eI(r);return i||""},eV=()=>{var e;return(null==navigator?void 0:null===(e=navigator.languages)||void 0===e?void 0:e.length)?navigator.languages[0]:navigator.language};var eB=l(64911),ez=l(66167),eq=l(33962),eU=l(23277),eG=l(78780),eW=l(73435),e$=l(22292);let eH={namespace:"composer",theme:{text:{bold:"bold",italic:"italic",code:"text-sm bg-gray-300 rounded-lg px-[5px] py-[2px]"},link:"text-brand",hashtag:"text-brand"},nodes:[eU.CodeNode,P,eG.HashtagNode,eW.AutoLinkNode,eW.LinkNode,es],editorState:null,onError:e=>{console.error(e)}};var eJ=l(84831),eY=l(51406),eX=l(92321),eK=l(22023);let eQ=(e,t)=>{let{collectLimit:l,followerOnlyCollect:a,timeLimit:n,amount:r,referralFee:s,recipients:o}=e,c={collectLimit:l,followerOnly:a,endTimestamp:n?(0,eK.u4)(1):null},d={amount:r,referralFee:s};switch(e.type){case i.pYo.SimpleCollectModule:return{simpleCollectModule:{...c,...r&&{fee:{...d,recipient:null==t?void 0:t.ownedBy}}}};case i.pYo.MultirecipientFeeCollectModule:return{multirecipientFeeCollectModule:{...c,...d,recipients:o}};default:return{revertCollectModule:!0}}};var e0=l(6154);let e1=()=>{let e=(0,v.qr)(e=>e.currentProfile),t=(0,b.l)(e=>e.pollConfig),l=(0,b.l)(e=>e.publicationContent),a=async()=>{try{let a=await (0,e0.Z)({url:"".concat(r.sf,"/createPoll"),method:"POST",data:{isMainnet:r.M8,title:"Poll by @".concat(null==e?void 0:e.handle),description:l,choices:t.choices,length:t.length}});return"".concat(l,"\n\n").concat(a.data.snapshotUrl)}catch(n){throw n}};return[a]};var e5=l(45341);let e2=()=>{let e=localStorage.getItem(e5.d.AccessToken);return{accessToken:e,isMainnet:r.M8}},e9=()=>{let e=async()=>{try{let e=await (0,e0.Z)({url:"".concat(r.LW,"/createSpace"),method:"POST",data:e2()});return e.data}catch(t){throw t}};return[e]};var e8=l(38564),e4=l(89814),e3=l(61998),e6=l(48974),e7=l(20674),te=l(70769);let tt=m()(()=>l.e(5911).then(l.bind(l,35911)),{loadableGenerated:{webpack:()=>[35911]},loading:()=>(0,a.jsx)("div",{className:"shimmer mb-1 h-5 w-5 rounded-lg"})}),tl=m()(()=>Promise.all([l.e(9090),l.e(6418)]).then(l.bind(l,46418)),{loadableGenerated:{webpack:()=>[46418]},loading:()=>(0,a.jsx)("div",{className:"shimmer mb-1 h-5 w-5 rounded-lg"})}),ta=m()(()=>Promise.all([l.e(9090),l.e(5514)]).then(l.bind(l,85514)),{loadableGenerated:{webpack:()=>[85514]},loading:()=>(0,a.jsx)("div",{className:"shimmer mb-1 h-5 w-5 rounded-lg"})}),tn=m()(()=>Promise.all([l.e(9090),l.e(5266)]).then(l.bind(l,5266)),{loadableGenerated:{webpack:()=>[5266]},loading:()=>(0,a.jsx)("div",{className:"shimmer mb-1 h-5 w-5 rounded-lg"})}),tr=m()(()=>Promise.all([l.e(9090),l.e(7039)]).then(l.bind(l,97039)),{loadableGenerated:{webpack:()=>[97039]},loading:()=>(0,a.jsx)("div",{className:"shimmer mb-1 h-5 w-5 rounded-lg"})}),ti=m()(()=>Promise.all([l.e(3874),l.e(9090),l.e(7994)]).then(l.bind(l,47994)),{loadableGenerated:{webpack:()=>[47994]},loading:()=>(0,a.jsx)("div",{className:"shimmer mb-1 h-5 w-5 rounded-lg"})}),ts=m()(()=>l.e(1289).then(l.bind(l,81289)),{loadableGenerated:{webpack:()=>[81289]},loading:()=>(0,a.jsx)("div",{className:"shimmer mb-1 h-5 w-5 rounded-lg"})}),to=e=>{var t,l,u,m;let{publication:D,profile:S,onDetail:_}=e,{push:M}=(0,p.useRouter)(),{cache:T}=(0,e_.x)(),k=(0,v.qr)(e=>e.currentProfile),{setShowNewModal:R,showNewModal:O,modalPublicationType:A}=(0,eM.u)(),P=(0,eM.u)(e=>e.setShowNewSpacesModal),Z=(0,eM.u)(e=>e.showNewSpacesModal),{userSigNonce:I,setUserSigNonce:L}=(0,te.p)(e=>e),{publicationContent:F,setPublicationContent:V,quotedPublication:B,setQuotedPublication:z,audioPublication:q,attachments:U,setAttachments:G,addAttachments:W,isUploading:$,videoThumbnail:H,setVideoThumbnail:J,videoDurationInSeconds:Y,showPollEditor:X,setShowPollEditor:K,resetPollConfig:Q,showSpaceEditor:ee,setShowSpaceEditor:et,pollConfig:el}=(0,b.l)(e=>e),{txnQueue:ea,setTxnQueue:en}=(0,v.nN)(e=>e),{collectModule:er,reset:ei}=(0,y.S)(e=>e),{selectedReferenceModule:es,onlyFollowers:eo,degreesOfSeparation:ec}=(0,v.HB)(e=>e),{restricted:ed,followToView:eu,collectToView:em,superfluidToView:ep,reset:eh}=(0,eT.s)(e=>e),[ex,eg]=(0,h.useState)(!1),[ey,eb]=(0,h.useState)(""),[ef]=(0,o.useLexicalComposerContext)(),ew=(0,N.t_)(),{data:eN}=(0,ek.Z)(),[ej]=e1(),[eC]=e9(),[eD,eE]=(0,h.useState)(!1),[eO,eA]=(0,h.useState)(!1),[eP,eZ]=(0,h.useState)(!1),[eI,eL]=(0,h.useState)(""),eU=Boolean(D),eG=r.cV.includes(null===(t=U[0])||void 0===t?void 0:t.original.mimeType),eW=r.Xe.includes(null===(l=U[0])||void 0===l?void 0:l.original.mimeType),e$=null==k?void 0:null===(u=k.dispatcher)||void 0===u?void 0:u.canUseRelay,eH=null==k?void 0:null===(m=k.dispatcher)||void 0===m?void 0:m.sponsor,eK=e=>{"RelayError"!==e&&(eg(!1),ef.update(()=>{(0,d.$getRoot)().clear()}),V(""),z(null),K(!1),Q(),G([]),J({url:"",type:"",uploading:!1}),ei(),eh(),eU||R(!1,i.mnY.Post),P(!1),er.type,i._9N.DegreesOfSeparationReferenceModule,U.length,U.length>0&&U.map(e=>e.original.mimeType))},e0=e=>{eg(!1)};(0,f.rf)(()=>{eb("")},[q]),(0,f.qR)(()=>{ef.update(()=>{(0,s.$convertFromMarkdownString)(F)})});let e5=e=>{let{txHash:t,txId:l}=e;return{id:(0,w.Z)(),...eU&&{parent:D.id},type:eU?g.As.NewComment:g.As.NewPost,txHash:t,txId:l,content:F,attachments:U,title:q.title,cover:q.cover,author:q.author}},{signTypedDataAsync:e2}=(0,N.yw)({onError:e0}),{error:to,write:tc}=(0,N.GG)({address:r.Nm,abi:e7.O,functionName:eU?"comment":"post",onSuccess:e=>{let{hash:t}=e;eK(),L(I+1),en([e5({txHash:t}),...ea])},onError:e=>{e0(e),L(I-1)}}),[td]=(0,i.PFI)({onCompleted:e=>{if(eK(),(null==e?void 0:e.broadcastDataAvailability.__typename)==="RelayError")return x.ZP.error(ev.D.SomethingWentWrong);(null==e?void 0:e.broadcastDataAvailability.__typename)==="CreateDataAvailabilityPublicationResult"&&M("/post/".concat(null==e?void 0:e.broadcastDataAvailability.id))},onError:e0}),[tu]=(0,i.lAu)({onCompleted:e=>{let{broadcast:t}=e;eK(t.__typename),"RelayerResult"===t.__typename&&en([e5({txId:t.txId}),...ea])}}),[tm]=(0,i.XqK)({onCompleted:e=>{(null==e?void 0:e.publication)&&T.modify({fields:{publications(){T.writeQuery({data:{publication:null==e?void 0:e.publication},query:i.HfI})}}})}}),tp=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{id:l,typedData:a}=e,n=await e2((0,eB.Z)(a));if(t)return await td({variables:{request:{id:l,signature:n}}});let{data:r}=await tu({variables:{request:{id:l,signature:n}}});if((null==r?void 0:r.broadcast.__typename)==="RelayError")return tc({args:[a.value]})},[th]=(0,i.k9)({onCompleted:async e=>{let{createCommentTypedData:t}=e;return await tp(t)},onError:e0}),[tx]=(0,i.uNF)({onCompleted:async e=>{let{createPostTypedData:t}=e;return await tp(t)},onError:e0}),[tg]=(0,i.DD2)({onCompleted:async e=>{let{createDataAvailabilityPostTypedData:t}=e;return await tp(t,!0)}}),[tv]=(0,i.ZSw)({onCompleted:async e=>{let{createDataAvailabilityCommentTypedData:t}=e;return await tp(t,!0)}}),[ty]=(0,i.PIL)({onCompleted:e=>{let{createCommentViaDispatcher:t}=e;eK(t.__typename),"RelayerResult"===t.__typename&&en([e5({txId:t.txId}),...ea])},onError:e0}),[tb]=(0,i.CXe)({onCompleted:e=>{let{createPostViaDispatcher:t}=e;eK(t.__typename),"RelayerResult"===t.__typename&&en([e5({txId:t.txId}),...ea])},onError:e0}),[tf]=(0,i.AgJ)({onCompleted:e=>{var t;if((null==e?void 0:null===(t=e.createDataAvailabilityPostViaDispatcher)||void 0===t?void 0:t.__typename)!=="RelayError"&&"CreateDataAvailabilityPublicationResult"===e.createDataAvailabilityPostViaDispatcher.__typename){eK();let{id:l}=e.createDataAvailabilityPostViaDispatcher;M("/post/".concat(l))}},onError:e0}),[tw]=(0,i.Hz4)({onCompleted:e=>{var t;if((null==e?void 0:null===(t=e.createDataAvailabilityCommentViaDispatcher)||void 0===t?void 0:t.__typename)!=="RelayError"&&"CreateDataAvailabilityPublicationResult"===e.createDataAvailabilityCommentViaDispatcher.__typename){eK();let{id:l}=e.createDataAvailabilityCommentViaDispatcher;tm({variables:{request:{publicationId:l}}})}},onError:e0}),tN=async e=>{var t,l;let a={request:e};if(eU){let{data:n}=await tw({variables:a});(null==n?void 0:null===(l=n.createDataAvailabilityCommentViaDispatcher)||void 0===l?void 0:l.__typename)==="RelayError"&&await tv({variables:a});return}let{data:r}=await tf({variables:a});(null==r?void 0:null===(t=r.createDataAvailabilityPostViaDispatcher)||void 0===t?void 0:t.__typename)==="RelayError"&&await tg({variables:a})},tj=async e=>{var t,l;let a={options:{overrideSigNonce:I},request:e};if(eU){let{data:n}=await ty({variables:{request:e}});return(null==n?void 0:null===(l=n.createCommentViaDispatcher)||void 0===l?void 0:l.__typename)==="RelayError"?await th({variables:a}):void 0}let{data:r}=await tb({variables:{request:e}});if((null==r?void 0:null===(t=r.createPostViaDispatcher)||void 0===t?void 0:t.__typename)==="RelayError")return await tx({variables:a})},tC=()=>{var e;return U.length>0?eG?i.D2x.Audio:r.JF.includes(null===(e=U[0])||void 0===e?void 0:e.original.mimeType)?i.D2x.Image:eW?i.D2x.Video:i.D2x.TextOnly:i.D2x.TextOnly},tD=()=>{if(U.length>0&&(eG||eW)){var e;return null===(e=U[0])||void 0===e?void 0:e.original.url}return null},tS=()=>{var e;return eG?q.cover:eW?H.url:null===(e=U[0])||void 0===e?void 0:e.original.url},t_=()=>{var e;return eG?q.coverMimeType:null===(e=U[0])||void 0===e?void 0:e.original.mimeType},tM=()=>eW?"Video":eU?"Comment":"Post",tT=async e=>{if(!k||!eN)return x.ZP.error(ev.D.SignWallet);let t=await n.LensGatedSDK.create({provider:ew,signer:eN,env:r._s});await t.connect({address:k.ownedBy,env:r._s});let l={thisPublication:!0},a={profileId:k.id},i={};em&&eu?i={and:{criteria:[{collect:l},{follow:a}]}}:em?i={collect:l}:eu&&(i={follow:a});let{contentURI:s}=await t.gated.encryptMetadata(e,k.id,i,async e=>await (0,eR.Z)(e));return s},tk=async e=>await (0,eR.Z)(e),tR=async()=>{if(!k)return x.ZP.error(ev.D.SignWallet);if(eU&&D.isDataAvailability&&!eH)return x.ZP.error("Momoka is currently in beta - during this time certain actions are not available to all profiles.");try{var e,t,l;if(eg(!0),eG){eb("");let a=eX.q.safeParse(q);if(!a.success){let n=a.error.issues[0];return eb(n.message)}}if(0===F.length&&0===U.length)return eb("".concat(eU?"Comment":"Post"," should not be empty!"));eb("");let s=null;U.length||er.type===i.pYo.RevertCollectModule||(s=await eF(F,k.handle,new Date().toLocaleString()));let o=null;Z&&(o=await eC());let c=[{traitType:"type",displayType:i.kLb.String,value:null===(e=tC())||void 0===e?void 0:e.toLowerCase()},...Z?[{traitType:"audioSpace",displayType:i.kLb.String,value:JSON.stringify({id:o,host:k.ownedBy})}]:[],...B?[{traitType:"quotedPublicationId",displayType:i.kLb.String,value:B.id}]:[],...eG?[{traitType:"author",displayType:i.kLb.String,value:q.author}]:[],...eW?[{traitType:"durationInSeconds",displayType:i.kLb.String,value:Y}]:[]],d=U.map(e=>({item:e.original.url,cover:tS(),type:e.original.mimeType,altTag:e.original.altTag})),u=F;X&&(u=await ej());let m={version:"2.0.0",metadata_id:(0,w.Z)(),content:u,external_url:"https://lenshareapp.xyz/u/".concat(null==k?void 0:k.id),image:d.length>0?tS():s,imageMimeType:d.length>0?t_():s?"image/svg+xml":null,name:eG?q.title:"".concat(tM()," by @").concat(null==k?void 0:k.handle),animation_url:tD(),mainContentFocus:tC(),attributes:c,media:d,locale:eV(),appId:r.iC},p=er.type===i.pYo.RevertCollectModule,h=!ed&&(eU?D.isDataAvailability&&p:p),g=null;console.log("restricted",ed),g=ed?await tT(m):await tk(m);let v={profileId:null==k?void 0:k.id,contentURI:"ar://".concat(g),...eU&&{publicationId:"Mirror"===D.__typename?null==D?void 0:null===(t=D.mirrorOf)||void 0===t?void 0:t.id:null==D?void 0:D.id},collectModule:eQ(er,k),referenceModule:es===i._9N.FollowerOnlyReferenceModule?{followerOnlyReferenceModule:!!eo}:{degreesOfSeparationReferenceModule:{commentsRestricted:!0,mirrorsRestricted:!0,degreesOfSeparation:ec}}},y={from:null==k?void 0:k.id,...eU&&{commentOn:"Mirror"===D.__typename?null==D?void 0:null===(l=D.mirrorOf)||void 0===l?void 0:l.id:null==D?void 0:D.id},contentURI:"ar://".concat(g)};if(e$){if(h&&eH)return await tN(y);return await tj(v)}if(eU)return await th({variables:{options:{overrideSigNonce:I},request:v}});return await tx({variables:{options:{overrideSigNonce:I},request:v}})}catch(b){e0(b)}},tE=e=>{let t={id:(0,w.Z)(),previewItem:e.images.original.url,original:{url:e.images.original.url,mimeType:"image/gif",altTag:e.title}};W([t])},tO=!!X&&(!el.choices.length||el.choices.some(e=>!e.length));return(0,a.jsxs)(C.Z,{className:(0,c.Z)({"!rounded-b-xl !rounded-t-none border-none":!eU},"pb-3"),children:[to&&(0,a.jsx)(ez.B,{className:"!rounded-none",title:"Transaction failed!",error:to}),(0,a.jsx)(eS,{}),ey&&(0,a.jsx)("div",{className:"mt-1 px-5 pb-3 text-sm font-bold text-red-500",children:ey}),X&&(0,a.jsx)(E,{}),B?(0,a.jsx)(eY.Z,{className:"m-5",zeroPadding:!0,children:(0,a.jsx)(e8.Z,{profile:S,publication:B,isNew:!0})}):null,Z?(0,a.jsx)(ts,{children:(0,a.jsx)("div",{className:"ml-auto pt-2 sm:pt-0",children:(0,a.jsx)(j.z,{disabled:ex,icon:ex?(0,a.jsx)(eq.$,{size:"xs"}):(0,a.jsx)(e4.Z,{className:"h-4 w-4"}),onClick:tR,children:"Create spaces"})})}):(0,a.jsxs)("div",{className:"block items-center px-5 sm:flex",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(tt,{}),(0,a.jsx)(tl,{setGifAttachment:e=>tE(e)}),!(null==D?void 0:D.isDataAvailability)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ta,{}),(0,a.jsx)(tn,{}),(0,a.jsx)(tr,{})]}),(0,a.jsx)(ti,{})]}),(0,a.jsx)("div",{className:"ml-auto pt-2 sm:pt-0",children:(0,a.jsx)(j.z,{disabled:ex||$||tO||H.uploading,icon:ex?(0,a.jsx)(eq.$,{size:"xs"}):eU?(0,a.jsx)(e3.Z,{className:"h-4 w-4"}):(0,a.jsx)(e6.Z,{className:"h-4 w-4"}),onClick:tR,children:eU?"Comment":"Post"})})]}),(0,a.jsx)("div",{className:"px-5",children:(0,a.jsx)(eJ.Z,{attachments:U,isNew:!0})})]})};var tc=(e=>{let t=t=>(0,a.jsx)(e$.LexicalComposer,{initialConfig:{...eH},children:(0,a.jsx)(e,{...t})});return t})(to)},39059:function(e,t,l){"use strict";l.d(t,{cp:function(){return s},l0:function(){return o},w5:function(){return i}});var a=l(85893),n=l(56312),r=l(87536);let i=e=>{let{schema:t,...l}=e;return(0,r.cI)({...l,resolver:(0,n.F)(t)})},s=e=>{let{name:t}=e,{formState:{errors:l}}=(0,r.Gc)();if(!t)return null;let n=l[t];return n?(0,a.jsx)("div",{className:"mt-1 text-sm font-bold text-red-500",children:n.message}):null},o=e=>{let{form:t,onSubmit:l,children:n,className:i=""}=e;return(0,a.jsx)(r.RV,{...t,children:(0,a.jsx)("form",{onSubmit:t.handleSubmit(l),children:(0,a.jsx)("fieldset",{className:"flex flex-col ".concat(i),disabled:t.formState.isSubmitting,children:n})})})}},61286:function(e,t,l){"use strict";l.d(t,{I:function(){return d}});var a=l(85893),n=l(86010),r=l(5152),i=l.n(r),s=l(67294),o=l(39059);let c=i()(()=>Promise.all([l.e(2697),l.e(2252)]).then(l.bind(l,22252)),{loadableGenerated:{webpack:()=>[22252]}}),d=(0,s.forwardRef)(function(e,t){let{label:l,prefix:r,type:i="text",iconLeft:d,iconRight:u,error:m,className:p="",helper:h,...x}=e,g=(0,s.useId)(),v=["text-zinc-500 [&>*]:peer-focus:text-brand [&>*]:h-5",{"!text-red-500 [&>*]:peer-focus:!text-red-500":m}];return(0,a.jsxs)("label",{className:"w-full",htmlFor:g,children:[l&&(0,a.jsxs)("div",{className:"mb-1 flex items-center space-x-1.5",children:[(0,a.jsx)("div",{className:"font-medium text-gray-800 dark:text-gray-200",children:l}),(0,a.jsx)(c,{content:h})]}),(0,a.jsxs)("div",{className:"flex",children:[r&&(0,a.jsx)("span",{className:"lt-text-gray-500 inline-flex items-center rounded-l-xl border border-r-0 border-gray-300 bg-gray-100 px-3 dark:border-gray-700",children:r}),(0,a.jsxs)("div",{className:(0,n.Z)({"bg-gray-500/20 opacity-60":x.disabled},m?"!border-red-500":"focus-within:ring-1",r?"rounded-r-xl":"rounded-xl","focus-within:border-brand-500 focus-within:ring-brand-400 flex w-full items-center border border-gray-300 bg-white dark:bg-gray-900/70 p-3 dark:border-gray-700 dark:bg-gray-100"),children:[(0,a.jsx)("input",{id:g,className:(0,n.Z)({"placeholder:text-red-500":m},r?"rounded-r-xl":"rounded-xl","peer w-full border-none bg-transparent outline-none focus:ring-0",p),type:i,ref:t,...x}),(0,a.jsx)("span",{tabIndex:-1,className:(0,n.Z)({"order-first pl-3":d},v),children:d}),(0,a.jsx)("span",{tabIndex:-1,className:(0,n.Z)({"order-last pr-3":u},v),children:u})]})]}),x.name&&(0,a.jsx)(o.cp,{name:x.name})]})})},67946:function(e,t,l){"use strict";var a,n,r,i,s,o,c,d;l.d(t,{As:function(){return a},Es:function(){return r},T0:function(){return i}}),(s=a||(a={})).NewPost="NEW_POST",s.NewComment="NEW_COMMENT",(o=n||(n={})).All="ALL",o.Mentions="MENTIONS",o.Comments="COMMENTS",o.Likes="LIKES",o.Collects="COLLECTS",(c=r||(r={})).Feed="FEED",c.Replies="REPLIES",c.Media="MEDIA",c.Collects="COLLECTS",c.Nft="NFT",c.Subscribers="SUBSCRIBERS",c.Superfluid="SUBSCRIBERSFEED",(d=i||(i={})).All="All",d.Lens="Lens",d.Other="Other",d.Requests="Requests"},10985:function(e,t,l){"use strict";var a=l(5649),n=l(6154),r=l(86501),i=l(41741);let s=async e=>{try{let t=await (0,n.Z)(a.wb,{method:"POST",headers:{"Content-Type":"application/json"},data:e}),{id:l}=null==t?void 0:t.data;return l}catch(s){throw console.error("Failed to upload to Arweave",s),r.ZP.error(i.D.SomethingWentWrong),Error(i.D.SomethingWentWrong)}};t.Z=s},52815:function(e,t,l){"use strict";l.d(t,{s:function(){return n}});var a=l(73445);let n=(0,a.ZP)((e,t)=>({restricted:!1,setRestricted:t=>e(()=>({restricted:t})),collectToView:!1,setCollectToView:t=>e(()=>({collectToView:t})),followToView:!1,setFollowToView:t=>e(()=>({followToView:t})),superfluidToView:!1,setSuperfluidToView:t=>e(()=>({superfluidToView:t})),hasConditions:()=>{let{followToView:e,collectToView:l,superfluidToView:a}=t();return e||l||a},reset:()=>e(()=>({restricted:!1,collectToView:!1,followToView:!1,superfluidToView:!1}))}))},20269:function(e,t,l){"use strict";l.d(t,{S:function(){return i}});var a=l(68980),n=l(73445);let r={type:a.pYo.RevertCollectModule,amount:null,referralFee:0,collectLimit:null,timeLimit:!1,recipients:[],followerOnlyCollect:!1},i=(0,n.Ue)(e=>({collectModule:r,setCollectModule:t=>e(()=>({collectModule:t})),reset:()=>e(()=>({collectModule:r}))}))},11600:function(e,t,l){"use strict";var a=l(48113),n=l(67294),r=l(86501),i=l(57632),s=l(62641);let o=()=>{let e=(0,a.l)(e=>e.addAttachments),t=(0,a.l)(e=>e.updateAttachments),l=(0,a.l)(e=>e.removeAttachments),o=(0,a.l)(e=>e.setIsUploading),c=(0,n.useCallback)(async a=>{o(!0);let n=Array.from(a),c=[],d=n.map(e=>{let t=(0,i.Z)();return c.push(t),{id:t,file:e,previewItem:URL.createObjectURL(e),original:{url:URL.createObjectURL(e),mimeType:e.type}}}),u=n.map(e=>{let t=e.type.includes("image"),l=e.type.includes("video"),a=e.type.includes("audio");return t&&e.size>5e7?(r.Am.error("Image size should be less than 50MB"),!1):l&&e.size>2e8?(r.Am.error("Video size should be less than 200MB"),!1):!a||!(e.size>1e8)||(r.Am.error("Audio size should be less than 100MB"),!1)});e(d);let m=[];try{if(u.includes(!1))return o(!1),l(c),[];let p=await (0,s.Z)(a);p&&(m=d.map((e,t)=>({...e,original:{url:p[t].original.url,mimeType:p[t].original.mimeType}})),t(m))}catch(h){console.error("Failed to upload attachments",h),l(c),r.Am.error("Something went wrong while uploading!")}return o(!1),m},[e,l,t,o]);return{handleUploadAttachments:c}};t.Z=o},63897:function(){}}]);