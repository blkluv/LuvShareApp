(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6729],{64985:function(e,t,r){"use strict";r.d(t,{Mk:function(){return c}});var i=r(62461),s=r(62810),a=r(67294),n=r(94464),o=["roomState"],c=function(){var e=(0,i.u)(),t=(0,s._)(e,2),r=t[0],c=r.roomState,d=(0,s.a)(r,o),l=t[1],p=(0,a.useState)(""),u=(0,s._)(p,2),h=u[0],m=u[1],f=(0,a.useState)(!1),g=(0,s._)(f,2),_=g[0],v=g[1],y=(0,i.a)(),b=(0,s._)(y,2),w=b[0],S=b[1],R=function(e){v(!0);try{"ROOM"===c&&(n.m.setDisplayName(e),console.log("DisplayName Broadcasted to everyone")),l((0,i._)((0,i._)({},d),{},{roomState:c})),S(function(t){return(0,i._)((0,i._)({},t),{},{displayName:e})})}catch(t){throw m(t),Error(t)}finally{v(!1)}},C=function(e){if("ROOM"!==c)throw Error("You can only change your avatar in the room");n.m.changeAvatarUrl(e),S(function(t){return(0,i._)((0,i._)({},t),{},{avatarUrl:e})})},D=function(e,t){console.log("useAppUtils | sending data",t),n.m.sendData(e,t)};return R.isCallable="ROOM"===c,C.isCallable="LOBBY"===c||"ROOM"===c,D.isCallable="ROOM"===c,{setDisplayName:R,error:h,isLoading:_,displayName:w.displayName,changeAvatarUrl:C,sendData:D}}},62461:function(e,t,r){"use strict";r.d(t,{_:function(){return c},a:function(){return f},b:function(){return u},c:function(){return n},d:function(){return a},e:function(){return h},i:function(){return d},u:function(){return p}});var i=r(48583),s=r(15103);function a(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function n(e,t,r){return(t=a(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var d={roomState:"IDLE",roomId:""},l=(0,s.cn)(d),p=function(){return(0,i.KO)(l)},u=function(){return(0,i.Dv)(l)},h={meId:"",displayName:"",role:"",avatarUrl:""},m=(0,s.cn)(h),f=function(){return(0,i.KO)(m)}},62810:function(e,t,r){"use strict";function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var i,s,a,n,o=[],c=!0,d=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(i=a.call(r)).done)&&(o.push(i.value),o.length!==t);c=!0);}catch(l){d=!0,s=l}finally{try{if(!c&&null!=r.return&&(n=r.return(),Object(n)!==n))return}finally{if(d)throw s}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){if(null==e)return{};var r,i,s=function(e,t){if(null==e)return{};var r,i,s={},a=Object.keys(e);for(i=0;i<a.length;i++)r=a[i],t.indexOf(r)>=0||(s[r]=e[r]);return s}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)r=a[i],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}r.d(t,{_:function(){return s},a:function(){return a}})},55417:function(e,t,r){"use strict";r.d(t,{UA:function(){return v},QV:function(){return y},OR:function(){return _},LV:function(){return g},P0:function(){return b},NW:function(){return w}});var i=r(62461),s=r(67294),a=r(94464);function n(){n=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},a=s.iterator||"@@iterator",o=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function d(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(l){d=function(e,t,r){return e[t]=r}}function p(e,t,r,s){var a,n,o=Object.create((t&&t.prototype instanceof m?t:m).prototype);return i(o,"_invoke",{value:(a=new D(s||[]),n="suspendedStart",function(t,i){if("executing"===n)throw Error("Generator is already running");if("completed"===n){if("throw"===t)throw i;return T()}for(a.method=t,a.arg=i;;){var s=a.delegate;if(s){var o=function e(t,r){var i=r.method,s=t.iterator[i];if(void 0===s)return r.delegate=null,"throw"===i&&t.iterator.return&&(r.method="return",r.arg=void 0,e(t,r),"throw"===r.method)||"return"!==i&&(r.method="throw",r.arg=TypeError("The iterator does not provide a '"+i+"' method")),h;var a=u(s,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var n=a.arg;return n?n.done?(r[t.resultName]=n.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,h):n:(r.method="throw",r.arg=TypeError("iterator result is not an object"),r.delegate=null,h)}(s,a);if(o){if(o===h)continue;return o}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===n)throw n="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);n="executing";var c=u(e,r,a);if("normal"===c.type){if(n=a.done?"completed":"suspendedYield",c.arg===h)continue;return{value:c.arg,done:a.done}}"throw"===c.type&&(n="completed",a.method="throw",a.arg=c.arg)}})}),o}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(i){return{type:"throw",arg:i}}}e.wrap=p;var h={};function m(){}function f(){}function g(){}var _={};d(_,a,function(){return this});var v=Object.getPrototypeOf,y=v&&v(v(P([])));y&&y!==t&&r.call(y,a)&&(_=y);var b=g.prototype=m.prototype=Object.create(_);function w(e){["next","throw","return"].forEach(function(t){d(e,t,function(e){return this._invoke(t,e)})})}function S(e,t){var s;i(this,"_invoke",{value:function(i,a){function n(){return new t(function(s,n){!function i(s,a,n,o){var c=u(e[s],e,a);if("throw"!==c.type){var d=c.arg,l=d.value;return l&&"object"==typeof l&&r.call(l,"__await")?t.resolve(l.__await).then(function(e){i("next",e,n,o)},function(e){i("throw",e,n,o)}):t.resolve(l).then(function(e){d.value=e,n(d)},function(e){return i("throw",e,n,o)})}o(c.arg)}(i,a,s,n)})}return s=s?s.then(n,n):n()}})}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function P(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function t(){for(;++i<e.length;)if(r.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return s.next=s}}return{next:T}}function T(){return{value:void 0,done:!0}}return f.prototype=g,i(b,"constructor",{value:g,configurable:!0}),i(g,"constructor",{value:f,configurable:!0}),f.displayName=d(g,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,d(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},w(S.prototype),d(S.prototype,o,function(){return this}),e.AsyncIterator=S,e.async=function(t,r,i,s,a){void 0===a&&(a=Promise);var n=new S(p(t,r,i,s),a);return e.isGeneratorFunction(r)?n:n.next().then(function(e){return e.done?e.value:n.next()})},w(b),d(b,c,"Generator"),d(b,a,function(){return this}),d(b,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t=Object(e),r=[];for(var i in t)r.push(i);return r.reverse(),function e(){for(;r.length;){var i=r.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},e.values=P,D.prototype={constructor:D,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(r,i){return n.type="throw",n.arg=e,t.next=r,i&&(t.method="next",t.arg=void 0),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s],n=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var o=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(o&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(o){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i];if(s.tryLoc<=this.prev&&r.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var a=s;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var n=a?a.completion:{};return n.type=e,n.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(n)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if("throw"===i.type){var s=i.arg;C(r)}return s}}throw Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},e}function o(e,t,r,i,s,a,n){try{var o=e[a](n),c=o.value}catch(d){r(d);return}o.done?t(c):Promise.resolve(c).then(i,s)}function c(e){return function(){var t=this,r=arguments;return new Promise(function(i,s){var a=e.apply(t,r);function n(e){o(a,i,s,n,c,"next",e)}function c(e){o(a,i,s,n,c,"throw",e)}n(void 0)})}}var d=r(62810),l=r(15103),p=r(48583),u={},h=(0,l.cn)(u),m=function(){return(0,p.b9)(h)},f=["roomState"];function g(){var e=(0,i.u)(),t=(0,d._)(e,2),r=t[0],n=r.roomState,o=(0,d.a)(r,f),c=t[1],l=(0,i.a)(),p=(0,d._)(l,2),u=p[0],h=p[1],m=function(e){a.m.initialize(e);var t=a.m.getMeId();h(function(e){return(0,i._)((0,i._)({},e),{},{meId:t})})},g="IDLE"!==n;return m.isCallable=!g,(0,s.useEffect)(function(){a.m.on("app:initialized",function(){c((0,i._)((0,i._)({},o),{},{roomState:"INIT"}))}),a.m.on("room:me-role-update",function(e){h(function(t){return(0,i._)((0,i._)({},t),{},{role:e})})})},[]),{initialize:m,isInitialized:g,roomState:n,me:u}}var _=function(e,t){(0,s.useEffect)(function(){return a.m.on(e,t),function(){a.m.off(e,t)}},[])},v=function(){var e,t,r,o=(0,s.useState)(!1),l=(0,d._)(o,2),p=l[0],u=l[1],h=(0,i.b)().roomState,f=m(),g=(e=c(n().mark(function e(t,r){return n().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("changing room's controls"),e.prev=1,u(!0),e.next=5,a.m.changeRoomControls({type:t,value:r});case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),console.log({error:e.t0});case 10:return e.prev=10,u(!1),e.finish(10);case 13:case"end":return e.stop()}},e,null,[[1,7,10,13]])})),function(t,r){return e.apply(this,arguments)}),v=(t=c(n().mark(function e(t,r){return n().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("changing peer's role"),e.prev=1,u(!0),e.next=5,a.m.changePeerRole({peerId:t,role:r});case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),console.log({error:e.t0});case 10:return e.prev=10,u(!1),e.finish(10);case 13:case"end":return e.stop()}},e,null,[[1,7,10,13]])})),function(e,r){return t.apply(this,arguments)}),y=function(e){try{u(!0),a.m.changePeerControls(e)}catch(t){console.log("useAcl(): ",{error:t})}finally{u(!1)}},b=(r=c(n().mark(function e(t){return n().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.m.kickPeer(t);case 2:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)});return v.isCallable="ROOM"===h&&!p,g.isCallable="ROOM"===h&&!p,y.isCallable="ROOM"===h&&!p,b.isCallable="ROOM"===h&&!p,_("room:peer-role-update",function(e,t){f(function(r){return(0,i._)((0,i._)({},r),{},(0,i.c)({},e,(0,i._)((0,i._)({},r[e]),{},{role:t})))})}),{changePeerRole:v,changeRoomControls:g,changePeerControls:y,kickPeer:b}},y=function(){var e,t,r,o,l,p=(0,s.useState)(""),u=(0,d._)(p,2),h=u[0],m=u[1],f=(0,s.useState)(!1),g=(0,d._)(f,2),_=g[0],v=g[1],y=(0,s.useState)(null),b=(0,d._)(y,2),w=b[0],S=b[1],R=(0,s.useState)(!1),C=(0,d._)(R,2),D=C[0],P=C[1],T=(0,i.u)(),k=(0,d._)(T,1)[0],E=(0,s.useState)([]),x=(0,d._)(E,2),I=x[0],L=x[1],O=(e=c(n().mark(function e(t){var r;return n().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return v(!0),e.prev=1,e.next=4,a.m.fetchAudioStream(t);case 4:return r=e.sent,v(!1),S(r),e.abrupt("return",r);case 10:return e.prev=10,e.t0=e.catch(1),v(!1),m(e.t0),e.abrupt("return");case 15:return e.prev=15,v(!1),e.finish(15);case 18:case"end":return e.stop()}},e,null,[[1,10,15,18]])})),function(t){return e.apply(this,arguments)}),M=function(){v(!0);try{a.m.stopAudioStream(),v(!1),S(null),P(!1)}catch(e){v(!1),m(e)}},j=(t=c(n().mark(function e(t,r){return n().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(v(!0),e.prev=1,t){e.next=4;break}throw Error("No audio stream");case 4:a.m.produceAudio(t,r),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),v(!1),m(e.t0);case 11:case"end":return e.stop()}},e,null,[[1,7]])})),function(e,r){return t.apply(this,arguments)}),A=function(){v(!0);try{a.m.stopProducingAudio(),P(!1),v(!1)}catch(e){v(!1),m(e)}},N=(r=c(n().mark(function e(t){return n().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return v(!0),e.prev=1,e.next=4,a.m.createMicConsumer(t);case 4:e.next=10;break;case 6:e.prev=6,e.t0=e.catch(1),v(!1),m(e.t0);case 10:case"end":return e.stop()}},e,null,[[1,6]])})),function(e){return r.apply(this,arguments)}),F=(o=c(n().mark(function e(t){return n().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:v(!0);try{a.m.closeMicConsumer(t)}catch(r){v(!1),m(r)}case 2:case"end":return e.stop()}},e)})),function(e){return o.apply(this,arguments)}),B=(l=c(n().mark(function e(){var t;return n().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.m.enumerateMicDevices();case 2:return L(t=e.sent),e.abrupt("return",t);case 5:case"end":return e.stop()}},e)})),function(){return l.apply(this,arguments)});return B.isCallable=!0,O.isCallable=!_,j.isCallable="ROOM"===k.roomState,A.isCallable=D,M.isCallable=w||D,N.isCallable=!0,F.isCallable=!0,(0,s.useEffect)(function(){a.m.on("room:mic-produce-start",function(){v(!1),P(!0)}),a.m.on("room:mic-produce-stop",function(){v(!1),P(!1)}),a.m.on("room:me-left",function(){S(null),v(!1),P(!1)})},[]),{stream:w,isLoading:_,isProducing:D,fetchAudioStream:O,produceAudio:j,stopProducingAudio:A,stopAudioStream:M,createMicConsumer:N,closeMicConsumer:F,error:h,micDevices:I,enumerateMicDevices:B,isAudioOn:!!w}},b=function(){var e=(0,p.KO)(h),t=(0,d._)(e,2),r=t[0],n=t[1];return(0,s.useEffect)(function(){a.m.on("room:joined",function(e){var t={};Object.values(Object.fromEntries(e)).forEach(function(e){t[e.peerId]={peerId:e.peerId,role:e.role,mic:null,cam:null,displayName:e.displayName,avatarUrl:e.avatarUrl}}),n(t)}),a.m.on("room:peer-joined",function(e){var t=e.peerId,r=e.role,s=e.displayName,a=e.avatarUrl;console.log("@huddle01/react | room:peer-left");var o={peerId:t,role:r,mic:null,cam:null,displayName:s,avatarUrl:a};n(function(e){return(0,i._)((0,i._)({},e),{},(0,i.c)({},t,o))})}),a.m.on("room:peer-produce-start",function(e){var t=e.peerId,r=e.mediaType,s=e.track;console.log("@huddle01/react | room:peer-produce-start"),n(function(e){var a=e[t],n=(0,d.a)(e,[t].map(i.d));return(0,i._)((0,i._)({},n),{},(0,i.c)({},t,(0,i._)((0,i._)({},a),{},(0,i.c)({},r,s))))})}),a.m.on("room:peer-produce-stop",function(e){var t=e.peerId,r=e.mediaType;console.log("@huddle01/react | room:peer-produce-stop"),n(function(e){var s=e[t],a=(0,d.a)(e,[t].map(i.d));return(0,i._)((0,i._)({},a),{},(0,i.c)({},t,(0,i._)((0,i._)({},s),{},(0,i.c)({},r,null))))})}),a.m.on("room:peer-left",function(e){console.log("@huddle01/react | room:peer-left"),n(function(t){var r=(0,i._)({},t);return delete r[e],r})}),a.m.on("room:peer-avatar-update",function(e){var t=e.peerId,r=e.avatarUrl;n(function(e){return(0,i._)((0,i._)({},e),{},(0,i.c)({},t,(0,i._)((0,i._)({},e[t]),{},{avatarUrl:r})))})})},[]),_("room:peer-name-update",function(e,t){n(function(r){return(0,i._)((0,i._)({},r),{},(0,i.c)({},e,(0,i._)((0,i._)({},r[e]),{},{displayName:t})))})}),{peers:r}},w=function(){var e=(0,s.useState)(null),t=(0,d._)(e,2),r=t[0],n=t[1],o=(0,s.useState)(!1),c=(0,d._)(o,2),l=c[0],p=c[1],h=(0,i.u)(),f=(0,d._)(h,2),g=f[0],_=g.roomId,v=g.roomState,y=f[1],b=(0,i.a)(),w=(0,d._)(b,2),S=w[0],R=w[1],C=m(),D=function(){p(!0),a.m.joinRoom()},P=function(){a.m.leaveRoom(),y(function(e){return(0,i._)((0,i._)({},e),{},{roomState:"INIT"})})},T=function(){a.m.endRoom(),y(function(e){return(0,i._)((0,i._)({},e),{},{roomState:"INIT"})})};return D.isCallable="LOBBY"===v,P.isCallable="ROOM"===v,T.isCallable="ROOM"===v&&"host"===S.role,(0,s.useEffect)(function(){a.m.on("room:joined",function(){p(!1),y(function(e){return(0,i._)((0,i._)({},e),{},{roomState:"ROOM"})})}),a.m.on("room:failed",function(e){p(!1),n(e)}),a.m.on("room:me-left",function(){y(i.i),R(function(e){return(0,i._)((0,i._)({},i.e),{},{meId:e.meId})}),C(u)})},[]),{roomId:_,isLoading:l,isRoomJoined:P.isCallable,joinRoom:D,leaveRoom:P,endRoom:T,error:r}}},47329:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;let s=i(r(11227)),a="awaitqueue";t.Logger=class{constructor(e){e?(this._debug=(0,s.default)(`${a}:${e}`),this._warn=(0,s.default)(`${a}:WARN:${e}`),this._error=(0,s.default)(`${a}:ERROR:${e}`)):(this._debug=(0,s.default)(a),this._warn=(0,s.default)(`${a}:WARN`),this._error=(0,s.default)(`${a}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}},32186:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AwaitQueue=t.AwaitQueueRemovedTaskError=t.AwaitQueueStoppedError=void 0;let i=r(47329),s=new i.Logger;class a extends Error{constructor(e){super(null!=e?e:"AwaitQueue stopped"),this.name="AwaitQueueStoppedError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,a)}}t.AwaitQueueStoppedError=a;class n extends Error{constructor(e){super(null!=e?e:"AwaitQueue task removed"),this.name="AwaitQueueRemovedTaskError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,n)}}t.AwaitQueueRemovedTaskError=n,t.AwaitQueue=class{constructor(){this.pendingTasks=new Map,this.nextTaskId=0,this.stopping=!1}get size(){return this.pendingTasks.size}async push(e,t){if(t=null!=t?t:e.name,s.debug(`push() [name:${t}]`),"function"!=typeof e)throw TypeError("given task is not a function");if(t)try{Object.defineProperty(e,"name",{value:t})}catch(r){}return new Promise((r,i)=>{let a={id:this.nextTaskId++,task:e,name:t,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:e=>{if(a.completed)return;a.completed=!0,this.pendingTasks.delete(a.id),s.debug(`resolving task [name:${a.name}]`),r(e);let[t]=this.pendingTasks.values();t&&!t.executedAt&&this.execute(t)},reject:e=>{if(!a.completed&&(a.completed=!0,this.pendingTasks.delete(a.id),s.debug(`rejecting task [name:${a.name}]: %s`,String(e)),i(e),!this.stopping)){let[t]=this.pendingTasks.values();t&&!t.executedAt&&this.execute(t)}}};this.pendingTasks.set(a.id,a),1===this.pendingTasks.size&&this.execute(a)})}stop(){for(let e of(s.debug("stop()"),this.stopping=!0,this.pendingTasks.values()))s.debug(`stop() | stopping task [name:${e.name}]`),e.reject(new a);this.stopping=!1}remove(e){s.debug(`remove() [taskIdx:${e}]`);let t=Array.from(this.pendingTasks.values())[e];if(!t){s.debug(`stop() | no task with given idx [taskIdx:${e}]`);return}t.reject(new n)}dump(){let e=Date.now(),t=0;return Array.from(this.pendingTasks.values()).map(r=>({idx:t++,task:r.task,name:r.name,enqueuedTime:r.executedAt?r.executedAt-r.enqueuedAt:e-r.enqueuedAt,executionTime:r.executedAt?e-r.executedAt:0}))}async execute(e){if(s.debug(`execute() [name:${e.name}]`),e.executedAt)throw Error("task already being executed");e.executedAt=Date.now();try{let t=await e.task();e.resolve(t)}catch(r){e.reject(r)}}}},59435:function(e){function t(e,t,r,i){return Math.round(e/r)+" "+i+(t>=1.5*r?"s":"")}e.exports=function(e,r){r=r||{};var i,s,a=typeof e;if("string"===a&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"weeks":case"week":case"w":return 6048e5*r;case"days":case"day":case"d":return 864e5*r;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*r;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*r;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}(e);if("number"===a&&isFinite(e))return r.long?(i=Math.abs(e))>=864e5?t(e,i,864e5,"day"):i>=36e5?t(e,i,36e5,"hour"):i>=6e4?t(e,i,6e4,"minute"):i>=1e3?t(e,i,1e3,"second"):e+" ms":(s=Math.abs(e))>=864e5?Math.round(e/864e5)+"d":s>=36e5?Math.round(e/36e5)+"h":s>=6e4?Math.round(e/6e4)+"m":s>=1e3?Math.round(e/1e3)+"s":e+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},11227:function(e,t,r){let i;var s=r(34155);t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;let r="color: "+this.color;t.splice(1,0,r,"color: inherit");let i=0,s=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(i++,"%c"===e&&(s=i))}),t.splice(s,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(r){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(r){}return!e&&void 0!==s&&"env"in s&&(e=s.env.DEBUG),e},t.useColors=function(){return"undefined"!=typeof window&&!!window.process&&("renderer"===window.process.type||!!window.process.__nwjs)||!("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(i=!1,()=>{i||(i=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(82447)(t);let{formatters:a}=e.exports;a.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}},82447:function(e,t,r){e.exports=function(e){function t(e){let r,s,a;let n=null;function o(...e){if(!o.enabled)return;let i=o,s=Number(new Date),a=s-(r||s);i.diff=a,i.prev=r,i.curr=s,r=s,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let n=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(r,s)=>{if("%%"===r)return"%";n++;let a=t.formatters[s];if("function"==typeof a){let o=e[n];r=a.call(i,o),e.splice(n,1),n--}return r}),t.formatArgs.call(i,e);let c=i.log||t.log;c.apply(i,e)}return o.namespace=e,o.useColors=t.useColors(),o.color=t.selectColor(e),o.extend=i,o.destroy=t.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==n?n:(s!==t.namespaces&&(s=t.namespaces,a=t.enabled(e)),a),set:e=>{n=e}}),"function"==typeof t.init&&t.init(o),o}function i(e,r){let i=t(this.namespace+(void 0===r?":":r)+e);return i.log=this.log,i}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){let e=[...t.names.map(s),...t.skips.map(s).map(e=>"-"+e)].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];let i=("string"==typeof e?e:"").split(/[\s,]+/),s=i.length;for(r=0;r<s;r++)i[r]&&("-"===(e=i[r].replace(/\*/g,".*?"))[0]?t.skips.push(RegExp("^"+e.slice(1)+"$")):t.names.push(RegExp("^"+e+"$")))},t.enabled=function(e){let r,i;if("*"===e[e.length-1])return!0;for(r=0,i=t.skips.length;r<i;r++)if(t.skips[r].test(e))return!1;for(r=0,i=t.names.length;r<i;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(59435),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(r=>{t[r]=e[r]}),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let i=0;i<e.length;i++)r=(r<<5)-r+e.charCodeAt(i)|0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},57855:function(e,t,r){let i=r(11227)("h264-profile-level-id");i.log=console.info.bind(console),t.ProfileConstrainedBaseline=1,t.ProfileBaseline=2,t.ProfileMain=3,t.ProfileConstrainedHigh=4,t.ProfileHigh=5,t.Level1_b=0,t.Level1=10,t.Level1_1=11,t.Level1_2=12,t.Level1_3=13,t.Level2=20,t.Level2_1=21,t.Level2_2=22,t.Level3=30,t.Level3_1=31,t.Level3_2=32,t.Level4=40,t.Level4_1=41,t.Level4_2=42,t.Level5=50,t.Level5_1=51,t.Level5_2=52;class s{constructor(e,t){this.profile=e,this.level=t}}t.ProfileLevelId=s;let a=new s(1,31);class n{constructor(e){this._mask=~d("x",e),this._maskedValue=d("1",e)}isMatch(e){return this._maskedValue===(e&this._mask)}}class o{constructor(e,t,r){this.profile_idc=e,this.profile_iop=t,this.profile=r}}let c=[new o(66,new n("x1xx0000"),1),new o(77,new n("1xxx0000"),1),new o(88,new n("11xx0000"),1),new o(66,new n("x0xx0000"),2),new o(88,new n("10xx0000"),2),new o(77,new n("0x0x0000"),3),new o(100,new n("00000000"),5),new o(100,new n("00001100"),4)];function d(e,t){return(t[0]===e)<<7|(t[1]===e)<<6|(t[2]===e)<<5|(t[3]===e)<<4|(t[4]===e)<<3|(t[5]===e)<<2|(t[6]===e)<<1|(t[7]===e)<<0}function l(e={}){let t=e["level-asymmetry-allowed"];return 1===t||"1"===t}t.parseProfileLevelId=function(e){let t;if("string"!=typeof e||6!==e.length)return null;let r=parseInt(e,16);if(0===r)return null;let a=255&r,n=r>>8&255,o=r>>16&255;switch(a){case 11:t=(16&n)!=0?0:11;break;case 10:case 12:case 13:case 20:case 21:case 22:case 30:case 31:case 32:case 40:case 41:case 42:case 50:case 51:case 52:t=a;break;default:return i("parseProfileLevelId() | unrecognized level_idc:%s",a),null}for(let d of c)if(o===d.profile_idc&&d.profile_iop.isMatch(n))return new s(d.profile,t);return i("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination"),null},t.profileLevelIdToString=function(e){let t;if(0==e.level)switch(e.profile){case 1:return"42f00b";case 2:return"42100b";case 3:return"4d100b";default:return i("profileLevelIdToString() | Level 1_b not is allowed for profile:%s",e.profile),null}switch(e.profile){case 1:t="42e0";break;case 2:t="4200";break;case 3:t="4d00";break;case 4:t="640c";break;case 5:t="6400";break;default:return i("profileLevelIdToString() | unrecognized profile:%s",e.profile),null}let r=e.level.toString(16);return 1===r.length&&(r=`0${r}`),`${t}${r}`},t.parseSdpProfileLevelId=function(e={}){let r=e["profile-level-id"];return r?t.parseProfileLevelId(r):a},t.isSameProfile=function(e={},r={}){let i=t.parseSdpProfileLevelId(e),s=t.parseSdpProfileLevelId(r);return Boolean(i&&s&&i.profile===s.profile)},t.generateProfileLevelIdForAnswer=function(e={},r={}){var a,n;if(!e["profile-level-id"]&&!r["profile-level-id"])return i("generateProfileLevelIdForAnswer() | no profile-level-id in local and remote params"),null;let o=t.parseSdpProfileLevelId(e),c=t.parseSdpProfileLevelId(r);if(!o)throw TypeError("invalid local_profile_level_id");if(!c)throw TypeError("invalid remote_profile_level_id");if(o.profile!==c.profile)throw TypeError("H264 Profile mismatch");let d=l(e)&&l(r),p=o.level,u=c.level,h=(a=p,n=u,(0===a?10!==n&&0!==n:0===n?10!==a:a<n)?a:n),m=d?p:h;return i("generateProfileLevelIdForAnswer() | result: [profile:%s, level:%s]",o.profile,m),t.profileLevelIdToString(new s(o.profile,m))}},59514:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Consumer=void 0;let i=r(38562),s=r(54493),a=r(99992),n=new i.Logger("Consumer");class o extends s.EnhancedEventEmitter{constructor({id:e,localId:t,producerId:r,rtpReceiver:i,track:a,rtpParameters:o,appData:c}){super(),this._closed=!1,this._observer=new s.EnhancedEventEmitter,n.debug("constructor()"),this._id=e,this._localId=t,this._producerId=r,this._rtpReceiver=i,this._track=a,this._rtpParameters=o,this._paused=!a.enabled,this._appData=c||{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(n.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(n.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new a.InvalidStateError("closed");return new Promise((e,t)=>{this.safeEmit("@getstats",e,t)})}pause(){if(n.debug("pause()"),this._closed){n.error("pause() | Consumer closed");return}if(this._paused){n.debug("pause() | Consumer is already paused");return}this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause")}resume(){if(n.debug("resume()"),this._closed){n.error("resume() | Consumer closed");return}if(!this._paused){n.debug("resume() | Consumer is already resumed");return}this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")}onTrackEnded(){n.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch(e){}}}t.Consumer=o},31623:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataConsumer=void 0;let i=r(38562),s=r(54493),a=new i.Logger("DataConsumer");class n extends s.EnhancedEventEmitter{constructor({id:e,dataProducerId:t,dataChannel:r,sctpStreamParameters:i,appData:n}){super(),this._closed=!1,this._observer=new s.EnhancedEventEmitter,a.debug("constructor()"),this._id=e,this._dataProducerId=t,this._dataChannel=r,this._sctpStreamParameters=i,this._appData=n||{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(e){this._dataChannel.binaryType=e}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(a.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(a.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(a.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",e=>{if(this._closed)return;let{error:t}=e;t||(t=Error("unknown DataChannel error")),"sctp-failure"===t.errorDetail?a.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):a.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)}),this._dataChannel.addEventListener("close",()=>{this._closed||(a.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",e=>{this._closed||this.safeEmit("message",e.data)})}}t.DataConsumer=n},25504:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataProducer=void 0;let i=r(38562),s=r(54493),a=r(99992),n=new i.Logger("DataProducer");class o extends s.EnhancedEventEmitter{constructor({id:e,dataChannel:t,sctpStreamParameters:r,appData:i}){super(),this._closed=!1,this._observer=new s.EnhancedEventEmitter,n.debug("constructor()"),this._id=e,this._dataChannel=t,this._sctpStreamParameters=r,this._appData=i||{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(e){this._dataChannel.bufferedAmountLowThreshold=e}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(n.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(n.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(e){if(n.debug("send()"),this._closed)throw new a.InvalidStateError("closed");this._dataChannel.send(e)}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(n.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",e=>{if(this._closed)return;let{error:t}=e;t||(t=Error("unknown DataChannel error")),"sctp-failure"===t.errorDetail?n.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):n.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)}),this._dataChannel.addEventListener("close",()=>{this._closed||(n.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||n.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}}t.DataProducer=o},43120:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Device=t.detectDevice=void 0;let n=r(42238),o=r(38562),c=r(54493),d=r(99992),l=a(r(13347)),p=a(r(45280)),u=r(35202),h=r(32960),m=r(66656),f=r(75372),g=r(5697),_=r(20564),v=r(61419),y=r(29862),b=r(32205),w=r(37392),S=r(23433),R=r(44770),C=new o.Logger("Device");function D(){if("object"==typeof navigator&&"ReactNative"===navigator.product){if(C.debug("detectDevice() | React-Native detected"),"undefined"==typeof RTCPeerConnection){C.warn("detectDevice() | unsupported react-native-webrtc without RTCPeerConnection, forgot to call registerGlobals()?");return}return"undefined"!=typeof RTCRtpTransceiver?(C.debug("detectDevice() | ReactNative UnifiedPlan handler chosen"),"ReactNativeUnifiedPlan"):(C.debug("detectDevice() | ReactNative PlanB handler chosen"),"ReactNative")}if("object"==typeof navigator&&"string"==typeof navigator.userAgent){let e=navigator.userAgent,t=new n.UAParser(e);C.debug("detectDevice() | browser detected [ua:%s, parsed:%o]",e,t.getResult());let r=t.getBrowser(),i=r.name?.toLowerCase()??"",s=parseInt(r.major??"0"),a=t.getEngine(),o=a.name?.toLowerCase()??"",c=t.getOS(),d=c.name?.toLowerCase()??"",l=parseFloat(c.version??"0"),p="ios"===d,u=["chrome","chromium","mobile chrome","chrome webview","chrome headless"].includes(i),h=["firefox","mobile firefox","mobile focus"].includes(i),m=["safari","mobile safari"].includes(i),f=["edge"].includes(i);if((u||f)&&!p&&s>=111)return"Chrome111";if(u&&!p&&s>=74||f&&!p&&s>=88)return"Chrome74";if(u&&!p&&s>=70)return"Chrome70";if(u&&!p&&s>=67)return"Chrome67";else if(u&&!p&&s>=55)return"Chrome55";else if(h&&!p&&s>=60)return"Firefox60";else if(h&&p&&l>=14.3)return"Safari12";else if(m&&s>=12&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";else if(m&&s>=11)return"Safari11";else if(f&&!p&&s>=11&&s<=18)return"Edge11";else if("webkit"===o&&p&&l>=14.3&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";else if("blink"===o){let g=e.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(!g)return"Chrome111";{let _=Number(g[1]);return _>=111?"Chrome111":_>=74?"Chrome74":_>=70?"Chrome70":_>=67?"Chrome67":"Chrome55"}}else{C.warn("detectDevice() | browser not supported [name:%s, version:%s]",i,s);return}}C.warn("detectDevice() | unknown device")}t.detectDevice=D,t.Device=class{constructor({handlerName:e,handlerFactory:t,Handler:r}={}){if(this._loaded=!1,this._observer=new c.EnhancedEventEmitter,C.debug("constructor()"),r){if(C.warn("constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead"),"string"==typeof r)e=r;else throw TypeError("non string Handler option no longer supported, use handlerFactory instead")}if(e&&t)throw TypeError("just one of handlerName or handlerInterface can be given");if(t)this._handlerFactory=t;else{if(e)C.debug("constructor() | handler given: %s",e);else if(e=D())C.debug("constructor() | detected handler: %s",e);else throw new d.UnsupportedError("device not supported");switch(e){case"Chrome111":this._handlerFactory=h.Chrome111.createFactory();break;case"Chrome74":this._handlerFactory=m.Chrome74.createFactory();break;case"Chrome70":this._handlerFactory=f.Chrome70.createFactory();break;case"Chrome67":this._handlerFactory=g.Chrome67.createFactory();break;case"Chrome55":this._handlerFactory=_.Chrome55.createFactory();break;case"Firefox60":this._handlerFactory=v.Firefox60.createFactory();break;case"Safari12":this._handlerFactory=y.Safari12.createFactory();break;case"Safari11":this._handlerFactory=b.Safari11.createFactory();break;case"Edge11":this._handlerFactory=w.Edge11.createFactory();break;case"ReactNativeUnifiedPlan":this._handlerFactory=S.ReactNativeUnifiedPlan.createFactory();break;case"ReactNative":this._handlerFactory=R.ReactNative.createFactory();break;default:throw TypeError(`unknown handlerName "${e}"`)}}let i=this._handlerFactory();this._handlerName=i.name,i.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new d.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new d.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:e}){let t;C.debug("load() [routerRtpCapabilities:%o]",e),e=l.clone(e,void 0);try{if(this._loaded)throw new d.InvalidStateError("already loaded");p.validateRtpCapabilities(e),t=this._handlerFactory();let r=await t.getNativeRtpCapabilities();C.debug("load() | got native RTP capabilities:%o",r),p.validateRtpCapabilities(r),this._extendedRtpCapabilities=p.getExtendedRtpCapabilities(r,e),C.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=p.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=p.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=p.getRecvRtpCapabilities(this._extendedRtpCapabilities),p.validateRtpCapabilities(this._recvRtpCapabilities),C.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=await t.getNativeSctpCapabilities(),C.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),p.validateSctpCapabilities(this._sctpCapabilities),C.debug("load() succeeded"),this._loaded=!0,t.close()}catch(i){throw t&&t.close(),i}}canProduce(e){if(this._loaded){if("audio"!==e&&"video"!==e)throw TypeError(`invalid kind "${e}"`)}else throw new d.InvalidStateError("not loaded");return this._canProduceByKind[e]}createSendTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:s,iceServers:a,iceTransportPolicy:n,additionalSettings:o,proprietaryConstraints:c,appData:d}){return C.debug("createSendTransport()"),this.createTransport({direction:"send",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:s,iceServers:a,iceTransportPolicy:n,additionalSettings:o,proprietaryConstraints:c,appData:d})}createRecvTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:s,iceServers:a,iceTransportPolicy:n,additionalSettings:o,proprietaryConstraints:c,appData:d}){return C.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:s,iceServers:a,iceTransportPolicy:n,additionalSettings:o,proprietaryConstraints:c,appData:d})}createTransport({direction:e,id:t,iceParameters:r,iceCandidates:i,dtlsParameters:s,sctpParameters:a,iceServers:n,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:l,appData:p}){if(this._loaded){if("string"!=typeof t)throw TypeError("missing id");if("object"!=typeof r)throw TypeError("missing iceParameters");if(Array.isArray(i)){if("object"!=typeof s)throw TypeError("missing dtlsParameters");if(a&&"object"!=typeof a)throw TypeError("wrong sctpParameters");if(p&&"object"!=typeof p)throw TypeError("if given, appData must be an object")}else throw TypeError("missing iceCandidates")}else throw new d.InvalidStateError("not loaded");let h=new u.Transport({direction:e,id:t,iceParameters:r,iceCandidates:i,dtlsParameters:s,sctpParameters:a,iceServers:n,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:l,appData:p,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",h),h}}},54493:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnhancedEventEmitter=void 0;let i=r(17187),s=r(38562),a=new s.Logger("EnhancedEventEmitter");class n extends i.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}emit(e,...t){return super.emit(e,...t)}safeEmit(e,...t){let r=super.listenerCount(e);try{return super.emit(e,...t)}catch(i){return a.error("safeEmit() | event listener threw an error [eventName:%s]:%o",e,i),Boolean(r)}}on(e,t){return super.on(e,t),this}off(e,t){return super.off(e,t),this}addListener(e,t){return super.on(e,t),this}prependListener(e,t){return super.prependListener(e,t),this}once(e,t){return super.once(e,t),this}prependOnceListener(e,t){return super.prependOnceListener(e,t),this}removeListener(e,t){return super.off(e,t),this}removeAllListeners(e){return super.removeAllListeners(e),this}listenerCount(e){return super.listenerCount(e)}listeners(e){return super.listeners(e)}rawListeners(e){return super.rawListeners(e)}}t.EnhancedEventEmitter=n},38562:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;let s=i(r(11227)),a="mediasoup-client";t.Logger=class{constructor(e){e?(this._debug=(0,s.default)(`${a}:${e}`),this._warn=(0,s.default)(`${a}:WARN:${e}`),this._error=(0,s.default)(`${a}:ERROR:${e}`)):(this._debug=(0,s.default)(a),this._warn=(0,s.default)(`${a}:WARN`),this._error=(0,s.default)(`${a}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}},26569:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Producer=void 0;let i=r(38562),s=r(54493),a=r(99992),n=new i.Logger("Producer");class o extends s.EnhancedEventEmitter{constructor({id:e,localId:t,rtpSender:r,track:i,rtpParameters:a,stopTracks:o,disableTrackOnPause:c,zeroRtpOnPause:d,appData:l}){super(),this._closed=!1,this._observer=new s.EnhancedEventEmitter,n.debug("constructor()"),this._id=e,this._localId=t,this._rtpSender=r,this._track=i,this._kind=i.kind,this._rtpParameters=a,this._paused=!!c&&!i.enabled,this._maxSpatialLayer=void 0,this._stopTracks=o,this._disableTrackOnPause=c,this._zeroRtpOnPause=d,this._appData=l||{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(n.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(n.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new a.InvalidStateError("closed");return new Promise((e,t)=>{this.safeEmit("@getstats",e,t)})}pause(){if(n.debug("pause()"),this._closed){n.error("pause() | Producer closed");return}this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise((e,t)=>{this.safeEmit("@pause",e,t)}).catch(()=>{}),this._observer.safeEmit("pause")}resume(){if(n.debug("resume()"),this._closed){n.error("resume() | Producer closed");return}this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise((e,t)=>{this.safeEmit("@resume",e,t)}).catch(()=>{}),this._observer.safeEmit("resume")}async replaceTrack({track:e}){if(n.debug("replaceTrack() [track:%o]",e),this._closed){if(e&&this._stopTracks)try{e.stop()}catch(t){}throw new a.InvalidStateError("closed")}if(e&&"ended"===e.readyState)throw new a.InvalidStateError("track ended");if(e===this._track){n.debug("replaceTrack() | same track, ignored");return}await new Promise((t,r)=>{this.safeEmit("@replacetrack",e,t,r)}),this.destroyTrack(),this._track=e,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack()}async setMaxSpatialLayer(e){if(this._closed)throw new a.InvalidStateError("closed");if("video"!==this._kind)throw new a.UnsupportedError("not a video Producer");if("number"!=typeof e)throw TypeError("invalid spatialLayer");e!==this._maxSpatialLayer&&(await new Promise((t,r)=>{this.safeEmit("@setmaxspatiallayer",e,t,r)}).catch(()=>{}),this._maxSpatialLayer=e)}async setRtpEncodingParameters(e){if(this._closed)throw new a.InvalidStateError("closed");if("object"!=typeof e)throw TypeError("invalid params");await new Promise((t,r)=>{this.safeEmit("@setrtpencodingparameters",e,t,r)})}onTrackEnded(){n.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch(e){}}}t.Producer=o},94879:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},37669:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},35202:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return s(t,e),t},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Transport=void 0;let o=r(32186),c=n(r(54375)),d=r(38562),l=r(54493),p=r(99992),u=a(r(13347)),h=a(r(45280)),m=r(26569),f=r(59514),g=r(25504),_=r(31623),v=new d.Logger("Transport");class y{constructor(e){this.consumerOptions=e,this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class b extends l.EnhancedEventEmitter{constructor({direction:e,id:t,iceParameters:r,iceCandidates:i,dtlsParameters:s,sctpParameters:a,iceServers:n,iceTransportPolicy:c,additionalSettings:d,proprietaryConstraints:p,appData:h,handlerFactory:m,extendedRtpCapabilities:f,canProduceByKind:g}){super(),this._closed=!1,this._connectionState="new",this._producers=new Map,this._consumers=new Map,this._dataProducers=new Map,this._dataConsumers=new Map,this._probatorConsumerCreated=!1,this._awaitQueue=new o.AwaitQueue,this._pendingConsumerTasks=[],this._consumerCreationInProgress=!1,this._pendingPauseConsumers=new Map,this._consumerPauseInProgress=!1,this._pendingResumeConsumers=new Map,this._consumerResumeInProgress=!1,this._pendingCloseConsumers=new Map,this._consumerCloseInProgress=!1,this._observer=new l.EnhancedEventEmitter,v.debug("constructor() [id:%s, direction:%s]",t,e),this._id=t,this._direction=e,this._extendedRtpCapabilities=f,this._canProduceByKind=g,this._maxSctpMessageSize=a?a.maxMessageSize:null,delete(d=u.clone(d,{})).iceServers,delete d.iceTransportPolicy,delete d.bundlePolicy,delete d.rtcpMuxPolicy,delete d.sdpSemantics,this._handler=m(),this._handler.run({direction:e,iceParameters:r,iceCandidates:i,dtlsParameters:s,sctpParameters:a,iceServers:n,iceTransportPolicy:c,additionalSettings:d,proprietaryConstraints:p,extendedRtpCapabilities:f}),this._appData=h||{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){if(!this._closed){for(let e of(v.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close(),this._producers.values()))e.transportClosed();for(let t of(this._producers.clear(),this._consumers.values()))t.transportClosed();for(let r of(this._consumers.clear(),this._dataProducers.values()))r.transportClosed();for(let i of(this._dataProducers.clear(),this._dataConsumers.values()))i.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close")}}async getStats(){if(this._closed)throw new p.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:e}){if(v.debug("restartIce()"),this._closed)throw new p.InvalidStateError("closed");if(!e)throw TypeError("missing iceParameters");return this._awaitQueue.push(async()=>await this._handler.restartIce(e),"transport.restartIce()")}async updateIceServers({iceServers:e}={}){if(v.debug("updateIceServers()"),this._closed)throw new p.InvalidStateError("closed");if(!Array.isArray(e))throw TypeError("missing iceServers");return this._awaitQueue.push(async()=>this._handler.updateIceServers(e),"transport.updateIceServers()")}async produce({track:e,encodings:t,codecOptions:r,codec:i,stopTracks:s=!0,disableTrackOnPause:a=!0,zeroRtpOnPause:n=!1,appData:o={}}={}){if(v.debug("produce() [track:%o]",e),this._closed)throw new p.InvalidStateError("closed");if(e){if("send"!==this._direction)throw new p.UnsupportedError("not a sending Transport");if(this._canProduceByKind[e.kind]){if("ended"===e.readyState)throw new p.InvalidStateError("track ended");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("produce"))throw TypeError('no "produce" listener set into this transport');else if(o&&"object"!=typeof o)throw TypeError("if given, appData must be an object")}else throw new p.UnsupportedError(`cannot produce ${e.kind}`)}else throw TypeError("missing track");return this._awaitQueue.push(async()=>{let c;if(t&&!Array.isArray(t))throw TypeError("encodings must be an array");t&&0===t.length?c=void 0:t&&(c=t.map(e=>{let t={active:!0};return!1===e.active&&(t.active=!1),"boolean"==typeof e.dtx&&(t.dtx=e.dtx),"string"==typeof e.scalabilityMode&&(t.scalabilityMode=e.scalabilityMode),"number"==typeof e.scaleResolutionDownBy&&(t.scaleResolutionDownBy=e.scaleResolutionDownBy),"number"==typeof e.maxBitrate&&(t.maxBitrate=e.maxBitrate),"number"==typeof e.maxFramerate&&(t.maxFramerate=e.maxFramerate),"boolean"==typeof e.adaptivePtime&&(t.adaptivePtime=e.adaptivePtime),"string"==typeof e.priority&&(t.priority=e.priority),"string"==typeof e.networkPriority&&(t.networkPriority=e.networkPriority),t}));let{localId:d,rtpParameters:l,rtpSender:p}=await this._handler.send({track:e,encodings:c,codecOptions:r,codec:i});try{h.validateRtpParameters(l);let{id:u}=await new Promise((t,r)=>{this.safeEmit("produce",{kind:e.kind,rtpParameters:l,appData:o},t,r)}),f=new m.Producer({id:u,localId:d,rtpSender:p,track:e,rtpParameters:l,stopTracks:s,disableTrackOnPause:a,zeroRtpOnPause:n,appData:o});return this._producers.set(f.id,f),this.handleProducer(f),this._observer.safeEmit("newproducer",f),f}catch(g){throw this._handler.stopSending(d).catch(()=>{}),g}},"transport.produce()").catch(t=>{if(s)try{e.stop()}catch(r){}throw t})}async consume({id:e,producerId:t,kind:r,rtpParameters:i,streamId:s,appData:a={}}){if(v.debug("consume()"),i=u.clone(i,void 0),this._closed)throw new p.InvalidStateError("closed");if("recv"!==this._direction)throw new p.UnsupportedError("not a receiving Transport");if("string"!=typeof e)throw TypeError("missing id");if("string"!=typeof t)throw TypeError("missing producerId");if("audio"!==r&&"video"!==r)throw TypeError(`invalid kind '${r}'`);if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw TypeError('no "connect" listener set into this transport');if(a&&"object"!=typeof a)throw TypeError("if given, appData must be an object");let n=h.canReceive(i,this._extendedRtpCapabilities);if(!n)throw new p.UnsupportedError("cannot consume this Producer");let o=new y({id:e,producerId:t,kind:r,rtpParameters:i,streamId:s,appData:a});return this._pendingConsumerTasks.push(o),(0,c.default)(()=>{this._closed||!1!==this._consumerCreationInProgress||this.createPendingConsumers()}),o.promise}async produceData({ordered:e=!0,maxPacketLifeTime:t,maxRetransmits:r,label:i="",protocol:s="",appData:a={}}={}){if(v.debug("produceData()"),this._closed)throw new p.InvalidStateError("closed");if("send"!==this._direction)throw new p.UnsupportedError("not a sending Transport");if(this._maxSctpMessageSize){if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("producedata"))throw TypeError('no "producedata" listener set into this transport');if(a&&"object"!=typeof a)throw TypeError("if given, appData must be an object")}else throw new p.UnsupportedError("SCTP not enabled by remote Transport");return(t||r)&&(e=!1),this._awaitQueue.push(async()=>{let{dataChannel:n,sctpStreamParameters:o}=await this._handler.sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:s});h.validateSctpStreamParameters(o);let{id:c}=await new Promise((e,t)=>{this.safeEmit("producedata",{sctpStreamParameters:o,label:i,protocol:s,appData:a},e,t)}),d=new g.DataProducer({id:c,dataChannel:n,sctpStreamParameters:o,appData:a});return this._dataProducers.set(d.id,d),this.handleDataProducer(d),this._observer.safeEmit("newdataproducer",d),d},"transport.produceData()")}async consumeData({id:e,dataProducerId:t,sctpStreamParameters:r,label:i="",protocol:s="",appData:a={}}){if(v.debug("consumeData()"),r=u.clone(r,void 0),this._closed)throw new p.InvalidStateError("closed");if("recv"!==this._direction)throw new p.UnsupportedError("not a receiving Transport");if(this._maxSctpMessageSize){if("string"!=typeof e)throw TypeError("missing id");if("string"!=typeof t)throw TypeError("missing dataProducerId");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw TypeError('no "connect" listener set into this transport');else if(a&&"object"!=typeof a)throw TypeError("if given, appData must be an object")}else throw new p.UnsupportedError("SCTP not enabled by remote Transport");return h.validateSctpStreamParameters(r),this._awaitQueue.push(async()=>{let{dataChannel:n}=await this._handler.receiveDataChannel({sctpStreamParameters:r,label:i,protocol:s}),o=new _.DataConsumer({id:e,dataProducerId:t,dataChannel:n,sctpStreamParameters:r,appData:a});return this._dataConsumers.set(o.id,o),this.handleDataConsumer(o),this._observer.safeEmit("newdataconsumer",o),o},"transport.consumeData()")}async createPendingConsumers(){this._consumerCreationInProgress=!0,this._awaitQueue.push(async()=>{let e;if(0===this._pendingConsumerTasks.length){v.debug("createPendingConsumers() | there is no Consumer to be created");return}let t=[...this._pendingConsumerTasks];this._pendingConsumerTasks=[];let r=[];for(let i of t){let{id:s,kind:a,rtpParameters:n,streamId:o}=i.consumerOptions;r.push({trackId:s,kind:a,rtpParameters:n,streamId:o})}try{let c=await this._handler.receive(r);for(let d=0;d<c.length;++d){let l=t[d],p=c[d],{id:u,producerId:m,kind:g,rtpParameters:_,appData:y}=l.consumerOptions,{localId:b,rtpReceiver:w,track:S}=p,R=new f.Consumer({id:u,localId:b,producerId:m,rtpReceiver:w,track:S,rtpParameters:_,appData:y});this._consumers.set(R.id,R),this.handleConsumer(R),this._probatorConsumerCreated||e||"video"!==g||(e=R),this._observer.safeEmit("newconsumer",R),l.resolve(R)}}catch(D){for(let C of t)C.reject(D)}if(e)try{let P=h.generateProbatorRtpParameters(e.rtpParameters);await this._handler.receive([{trackId:"probator",kind:"video",rtpParameters:P}]),v.debug("createPendingConsumers() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(T){v.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",T)}},"transport.createPendingConsumers()").then(()=>{this._consumerCreationInProgress=!1,this._pendingConsumerTasks.length>0&&this.createPendingConsumers()}).catch(()=>{})}pausePendingConsumers(){this._consumerPauseInProgress=!0,this._awaitQueue.push(async()=>{if(0===this._pendingPauseConsumers.size){v.debug("pausePendingConsumers() | there is no Consumer to be paused");return}let e=Array.from(this._pendingPauseConsumers.values());this._pendingPauseConsumers.clear();try{let t=e.map(e=>e.localId);await this._handler.pauseReceiving(t)}catch(r){v.error("pausePendingConsumers() | failed to pause Consumers:",r)}},"transport.pausePendingConsumers").then(()=>{this._consumerPauseInProgress=!1,this._pendingPauseConsumers.size>0&&this.pausePendingConsumers()}).catch(()=>{})}resumePendingConsumers(){this._consumerResumeInProgress=!0,this._awaitQueue.push(async()=>{if(0===this._pendingResumeConsumers.size){v.debug("resumePendingConsumers() | there is no Consumer to be resumed");return}let e=Array.from(this._pendingResumeConsumers.values());this._pendingResumeConsumers.clear();try{let t=e.map(e=>e.localId);await this._handler.resumeReceiving(t)}catch(r){v.error("resumePendingConsumers() | failed to resume Consumers:",r)}},"transport.resumePendingConsumers").then(()=>{this._consumerResumeInProgress=!1,this._pendingResumeConsumers.size>0&&this.resumePendingConsumers()}).catch(()=>{})}closePendingConsumers(){this._consumerCloseInProgress=!0,this._awaitQueue.push(async()=>{if(0===this._pendingCloseConsumers.size){v.debug("closePendingConsumers() | there is no Consumer to be closed");return}let e=Array.from(this._pendingCloseConsumers.values());this._pendingCloseConsumers.clear();try{await this._handler.stopReceiving(e.map(e=>e.localId))}catch(t){v.error("closePendingConsumers() | failed to close Consumers:",t)}},"transport.closePendingConsumers").then(()=>{this._consumerCloseInProgress=!1,this._pendingCloseConsumers.size>0&&this.closePendingConsumers()}).catch(()=>{})}handleHandler(){let e=this._handler;e.on("@connect",({dtlsParameters:e},t,r)=>{if(this._closed){r(new p.InvalidStateError("closed"));return}this.safeEmit("connect",{dtlsParameters:e},t,r)}),e.on("@connectionstatechange",e=>{e!==this._connectionState&&(v.debug("connection state changed to %s",e),this._connectionState=e,this._closed||this.safeEmit("connectionstatechange",e))})}handleProducer(e){e.on("@close",()=>{this._producers.delete(e.id),this._closed||this._awaitQueue.push(async()=>await this._handler.stopSending(e.localId),"producer @close event").catch(e=>v.warn("producer.close() failed:%o",e))}),e.on("@pause",(t,r)=>{this._awaitQueue.push(async()=>await this._handler.pauseSending(e.localId),"producer @pause event").then(t).catch(r)}),e.on("@resume",(t,r)=>{this._awaitQueue.push(async()=>await this._handler.resumeSending(e.localId),"producer @resume event").then(t).catch(r)}),e.on("@replacetrack",(t,r,i)=>{this._awaitQueue.push(async()=>await this._handler.replaceTrack(e.localId,t),"producer @replacetrack event").then(r).catch(i)}),e.on("@setmaxspatiallayer",(t,r,i)=>{this._awaitQueue.push(async()=>await this._handler.setMaxSpatialLayer(e.localId,t),"producer @setmaxspatiallayer event").then(r).catch(i)}),e.on("@setrtpencodingparameters",(t,r,i)=>{this._awaitQueue.push(async()=>await this._handler.setRtpEncodingParameters(e.localId,t),"producer @setrtpencodingparameters event").then(r).catch(i)}),e.on("@getstats",(t,r)=>{if(this._closed)return r(new p.InvalidStateError("closed"));this._handler.getSenderStats(e.localId).then(t).catch(r)})}handleConsumer(e){e.on("@close",()=>{this._consumers.delete(e.id),this._pendingPauseConsumers.delete(e.id),this._pendingResumeConsumers.delete(e.id),this._closed||(this._pendingCloseConsumers.set(e.id,e),!1===this._consumerCloseInProgress&&this.closePendingConsumers())}),e.on("@pause",()=>{this._pendingResumeConsumers.has(e.id)&&this._pendingResumeConsumers.delete(e.id),this._pendingPauseConsumers.set(e.id,e),(0,c.default)(()=>{this._closed||!1!==this._consumerPauseInProgress||this.pausePendingConsumers()})}),e.on("@resume",()=>{this._pendingPauseConsumers.has(e.id)&&this._pendingPauseConsumers.delete(e.id),this._pendingResumeConsumers.set(e.id,e),(0,c.default)(()=>{this._closed||!1!==this._consumerResumeInProgress||this.resumePendingConsumers()})}),e.on("@getstats",(t,r)=>{if(this._closed)return r(new p.InvalidStateError("closed"));this._handler.getReceiverStats(e.localId).then(t).catch(r)})}handleDataProducer(e){e.on("@close",()=>{this._dataProducers.delete(e.id)})}handleDataConsumer(e){e.on("@close",()=>{this._dataConsumers.delete(e.id)})}}t.Transport=b},99992:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidStateError=t.UnsupportedError=void 0;class r extends Error{constructor(e){super(e),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,r):this.stack=Error(e).stack}}t.UnsupportedError=r;class i extends Error{constructor(e){super(e),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,i):this.stack=Error(e).stack}}t.InvalidStateError=i},32960:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome111=void 0;let n=a(r(70766)),o=r(38562),c=a(r(13347)),d=a(r(45280)),l=a(r(82267)),p=a(r(29072)),u=a(r(58954)),h=r(99992),m=r(89316),f=r(37910),g=r(82770),_=new o.Logger("Chrome111"),v={OS:1024,MIS:1024};class y extends m.HandlerInterface{static createFactory(){return()=>new y}constructor(){super(),this._closed=!1,this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome111"}close(){if(_.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}}async getNativeRtpCapabilities(){_.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");let t=await e.createOffer();try{e.close()}catch(r){}let i=n.parse(t.sdp),s=l.extractRtpCapabilities({sdpObject:i});return u.addNackSuppportForOpus(s),s}catch(o){try{e.close()}catch(a){}throw o}}async getNativeSctpCapabilities(){return _.debug("getNativeSctpCapabilities()"),{numStreams:v}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:s,iceServers:a,iceTransportPolicy:n,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:l}){this.assertNotClosed(),_.debug("run()"),this._direction=e,this._remoteSdp=new f.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:s}),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",l),video:d.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:d.getSendingRemoteRtpParameters("audio",l),video:d.getSendingRemoteRtpParameters("video",l)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a||[],iceTransportPolicy:n||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(_.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){this.assertNotClosed(),_.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),_.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady){if("send"===this._direction){let t=await this._pc.createOffer({iceRestart:!0});_.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let r={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{let i={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();_.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:i}){if(this.assertNotClosed(),this.assertSendDirection(),_.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1){t.forEach((e,t)=>{e.rid=`r${t}`});let s=1,a=1;for(let o of t){let u=o.scalabilityMode?(0,g.parse)(o.scalabilityMode).temporalLayers:3;u>a&&(a=u)}for(let h of t)h.rid=`r${s++}`,h.scalabilityMode=`L1T${a}`}let m=c.clone(this._sendingRtpParametersByKind[e.kind],{});m.codecs=d.reduceCodecs(m.codecs,i);let f=c.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});f.codecs=d.reduceCodecs(f.codecs,i);let v=this._remoteSdp.getNextMediaSectionIdx(),y=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t}),b=await this._pc.createOffer(),w=n.parse(b.sdp);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:w}),_.debug("send() | calling pc.setLocalDescription() [offer:%o]",b),await this._pc.setLocalDescription(b);let S=y.mid;m.mid=S,w=n.parse(this._pc.localDescription.sdp);let R=w.media[v.idx];if(m.rtcp.cname=l.getCname({offerMediaObject:R}),t){if(1===t.length){let C=p.getRtpEncodings({offerMediaObject:R});Object.assign(C[0],t[0]),m.encodings=C}else m.encodings=t}else m.encodings=p.getRtpEncodings({offerMediaObject:R});this._remoteSdp.send({offerMediaObject:R,reuseMid:v.reuseMid,offerRtpParameters:m,answerRtpParameters:f,codecOptions:r,extmapAllowMixed:!0});let D={type:"answer",sdp:this._remoteSdp.getSdp()};return _.debug("send() | calling pc.setRemoteDescription() [answer:%o]",D),await this._pc.setRemoteDescription(D),this._mapMidTransceiver.set(S,y),{localId:S,rtpParameters:m,rtpSender:y.sender}}async stopSending(e){if(this.assertSendDirection(),_.debug("stopSending() [localId:%s]",e),this._closed)return;let t=this._mapMidTransceiver.get(e);if(!t)throw Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender);let r=this._remoteSdp.closeMediaSection(t.mid);if(r)try{t.stop()}catch(i){}let s=await this._pc.createOffer();_.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let a={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),_.debug("pauseSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);let r=await this._pc.createOffer();_.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);let i={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),_.debug("resumeSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw Error("associated RTCRtpTransceiver not found");t.direction="sendonly";let r=await this._pc.createOffer();_.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);let i={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?_.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):_.debug("replaceTrack() [localId:%s, no track]",e);let r=this._mapMidTransceiver.get(e);if(!r)throw Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),_.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let r=this._mapMidTransceiver.get(e);if(!r)throw Error("associated RTCRtpTransceiver not found");let i=r.sender.getParameters();i.encodings.forEach((e,r)=>{r<=t?e.active=!0:e.active=!1}),await r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let s=await this._pc.createOffer();_.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let a={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),_.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let r=this._mapMidTransceiver.get(e);if(!r)throw Error("associated RTCRtpTransceiver not found");let i=r.sender.getParameters();i.encodings.forEach((e,r)=>{i.encodings[r]={...e,...t}}),await r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let s=await this._pc.createOffer();_.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let a={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:s}){this.assertNotClosed(),this.assertSendDirection();let a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:s};_.debug("sendDataChannel() [options:%o]",a);let o=this._pc.createDataChannel(i,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%v.MIS,!this._hasDataChannelMediaSection){let c=await this._pc.createOffer(),d=n.parse(c.sdp),l=d.media.find(e=>"application"===e.type);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),_.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c),this._remoteSdp.sendSctpAssociation({offerMediaObject:l});let p={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p),this._hasDataChannelMediaSection=!0}let u={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:u}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();let t=[],r=new Map;for(let i of e){let{trackId:s,kind:a,rtpParameters:o,streamId:c}=i;_.debug("receive() [trackId:%s, kind:%s]",s,a);let d=o.mid||String(this._mapMidTransceiver.size);r.set(s,d),this._remoteSdp.receive({mid:d,kind:a,offerRtpParameters:o,streamId:c||o.rtcp.cname,trackId:s})}let p={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",p),await this._pc.setRemoteDescription(p);let u=await this._pc.createAnswer(),h=n.parse(u.sdp);for(let m of e){let{trackId:f,rtpParameters:g}=m,v=r.get(f),y=h.media.find(e=>String(e.mid)===v);l.applyCodecParameters({offerRtpParameters:g,answerMediaObject:y})}for(let b of(u={type:"answer",sdp:n.write(h)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h}),_.debug("receive() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),e)){let{trackId:w}=b,S=r.get(w),R=this._pc.getTransceivers().find(e=>e.mid===S);if(R)this._mapMidTransceiver.set(S,R),t.push({localId:S,track:R.receiver.track,rtpReceiver:R.receiver});else throw Error("new RTCRtpTransceiver not found")}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(let t of e){_.debug("stopReceiving() [localId:%s]",t);let r=this._mapMidTransceiver.get(t);if(!r)throw Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(r.mid)}let i={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();for(let a of(_.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s),e))this._mapMidTransceiver.delete(a)}async pauseReceiving(e){for(let t of(this.assertNotClosed(),this.assertRecvDirection(),e)){_.debug("pauseReceiving() [localId:%s]",t);let r=this._mapMidTransceiver.get(t);if(!r)throw Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(t)}let i={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();_.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async resumeReceiving(e){for(let t of(this.assertNotClosed(),this.assertRecvDirection(),e)){_.debug("resumeReceiving() [localId:%s]",t);let r=this._mapMidTransceiver.get(t);if(!r)throw Error("associated RTCRtpTransceiver not found");r.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(t)}let i={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();_.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertNotClosed(),this.assertRecvDirection();let{streamId:i,ordered:s,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:i,ordered:s,maxPacketLifeTime:a,maxRetransmits:o,protocol:r};_.debug("receiveDataChannel() [options:%o]",c);let d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();let l={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);let p=await this._pc.createAnswer();if(!this._transportReady){let u=n.parse(p.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:u})}_.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setLocalDescription(p),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=n.parse(this._pc.localDescription.sdp));let r=l.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new h.InvalidStateError("method called in a closed handler")}assertSendDirection(){if("send"!==this._direction)throw Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw Error('method can just be called for handlers with "recv" direction')}}t.Chrome111=y},20564:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome55=void 0;let n=a(r(70766)),o=r(38562),c=r(99992),d=a(r(13347)),l=a(r(45280)),p=a(r(82267)),u=a(r(89875)),h=r(89316),m=r(37910),f=new o.Logger("Chrome55"),g={OS:1024,MIS:1024};class _ extends h.HandlerInterface{static createFactory(){return()=>new _}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome55"}close(){if(f.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){f.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{let t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(r){}let i=n.parse(t.sdp),s=p.extractRtpCapabilities({sdpObject:i});return s}catch(o){try{e.close()}catch(a){}throw o}}async getNativeSctpCapabilities(){return f.debug("getNativeSctpCapabilities()"),{numStreams:g}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:s,iceServers:a,iceTransportPolicy:n,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){f.debug("run()"),this._direction=e,this._remoteSdp=new m.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:s,planB:!0}),this._sendingRtpParametersByKind={audio:l.getSendingRtpParameters("audio",d),video:l.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:l.getSendingRemoteRtpParameters("audio",d),video:l.getSendingRemoteRtpParameters("video",d)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a||[],iceTransportPolicy:n||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(f.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){f.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(f.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady){if("send"===this._direction){let t=await this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let r={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{let i={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:i}){let s;this.assertSendDirection(),f.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),i&&f.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addStream(this._sendStream);let a=await this._pc.createOffer(),o=n.parse(a.sdp),c=d.clone(this._sendingRtpParametersByKind[e.kind],{});c.codecs=l.reduceCodecs(c.codecs);let h=d.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(h.codecs=l.reduceCodecs(h.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),"video"===e.kind&&t&&t.length>1&&(f.debug("send() | enabling simulcast"),s=(o=n.parse(a.sdp)).media.find(e=>"video"===e.type),u.addLegacySimulcast({offerMediaObject:s,track:e,numStreams:t.length}),a={type:"offer",sdp:n.write(o)}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a),s=(o=n.parse(this._pc.localDescription.sdp)).media.find(t=>t.type===e.kind),c.rtcp.cname=p.getCname({offerMediaObject:s}),c.encodings=u.getRtpEncodings({offerMediaObject:s,track:e}),t)for(let m=0;m<c.encodings.length;++m)t[m]&&Object.assign(c.encodings[m],t[m]);if(c.encodings.length>1&&"video/vp8"===c.codecs[0].mimeType.toLowerCase())for(let g of c.encodings)g.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:s,offerRtpParameters:c,answerRtpParameters:h,codecOptions:r});let _={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_);let v=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(v,e),{localId:v,rtpParameters:c}}async stopSending(e){this.assertSendDirection(),f.debug("stopSending() [localId:%s]",e);let t=this._mapSendLocalIdTrack.get(e);if(!t)throw Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);let r=await this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(i){if(0===this._sendStream.getTracks().length){f.warn("stopSending() | ignoring expected error due no sending tracks: %s",i.toString());return}throw i}if("stable"===this._pc.signalingState)return;let s={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){throw new c.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new c.UnsupportedError(" not implemented")}async setRtpEncodingParameters(e,t){throw new c.UnsupportedError("not supported")}async getSenderStats(e){throw new c.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:s}){this.assertSendDirection();let a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:s};f.debug("sendDataChannel() [options:%o]",a);let o=this._pc.createDataChannel(i,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%g.MIS,!this._hasDataChannelMediaSection){let c=await this._pc.createOffer(),d=n.parse(c.sdp),l=d.media.find(e=>"application"===e.type);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c),this._remoteSdp.sendSctpAssociation({offerMediaObject:l});let p={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p),this._hasDataChannelMediaSection=!0}let u={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:u}}async receive(e){this.assertRecvDirection();let t=[];for(let r of e){let{trackId:i,kind:s,rtpParameters:a,streamId:o}=r;f.debug("receive() [trackId:%s, kind:%s]",i,s),this._remoteSdp.receive({mid:s,kind:s,offerRtpParameters:a,streamId:o||a.rtcp.cname,trackId:i})}let c={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let d=await this._pc.createAnswer(),l=n.parse(d.sdp);for(let u of e){let{kind:h,rtpParameters:m}=u,g=l.media.find(e=>String(e.mid)===h);p.applyCodecParameters({offerRtpParameters:m,answerMediaObject:g})}for(let _ of(d={type:"answer",sdp:n.write(l)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d),e)){let{kind:v,trackId:y,rtpParameters:b}=_,w=_.streamId||b.rtcp.cname,S=this._pc.getRemoteStreams().find(e=>e.id===w),R=S.getTrackById(y);if(!R)throw Error("remote track not found");this._mapRecvLocalIdInfo.set(y,{mid:v,rtpParameters:b}),t.push({localId:y,track:R})}return t}async stopReceiving(e){for(let t of(this.assertRecvDirection(),e)){f.debug("stopReceiving() [localId:%s]",t);let{mid:r,rtpParameters:i}=this._mapRecvLocalIdInfo.get(t)||{};this._mapRecvLocalIdInfo.delete(t),this._remoteSdp.planBStopReceiving({mid:r,offerRtpParameters:i})}let s={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);let a=await this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){throw new c.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();let{streamId:i,ordered:s,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:i,ordered:s,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:o,protocol:r};f.debug("receiveDataChannel() [options:%o]",c);let d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});let l={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);let p=await this._pc.createAnswer();if(!this._transportReady){let u=n.parse(p.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:u})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setLocalDescription(p),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=n.parse(this._pc.localDescription.sdp));let r=p.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw Error('method can just be called for handlers with "recv" direction')}}t.Chrome55=_},5697:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome67=void 0;let n=a(r(70766)),o=r(38562),c=a(r(13347)),d=a(r(45280)),l=a(r(82267)),p=a(r(89875)),u=r(89316),h=r(37910),m=new o.Logger("Chrome67"),f={OS:1024,MIS:1024};class g extends u.HandlerInterface{static createFactory(){return()=>new g}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome67"}close(){if(m.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){m.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{let t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(r){}let i=n.parse(t.sdp),s=l.extractRtpCapabilities({sdpObject:i});return s}catch(o){try{e.close()}catch(a){}throw o}}async getNativeSctpCapabilities(){return m.debug("getNativeSctpCapabilities()"),{numStreams:f}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:s,iceServers:a,iceTransportPolicy:n,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:l}){m.debug("run()"),this._direction=e,this._remoteSdp=new h.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:s,planB:!0}),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",l),video:d.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:d.getSendingRemoteRtpParameters("audio",l),video:d.getSendingRemoteRtpParameters("video",l)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a||[],iceTransportPolicy:n||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(m.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){m.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(m.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady){if("send"===this._direction){let t=await this._pc.createOffer({iceRestart:!0});m.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let r={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{let i={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();m.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:i}){let s;this.assertSendDirection(),m.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),i&&m.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addTrack(e,this._sendStream);let a=await this._pc.createOffer(),o=n.parse(a.sdp),u=c.clone(this._sendingRtpParametersByKind[e.kind],{});u.codecs=d.reduceCodecs(u.codecs);let h=c.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(h.codecs=d.reduceCodecs(h.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),"video"===e.kind&&t&&t.length>1&&(m.debug("send() | enabling simulcast"),s=(o=n.parse(a.sdp)).media.find(e=>"video"===e.type),p.addLegacySimulcast({offerMediaObject:s,track:e,numStreams:t.length}),a={type:"offer",sdp:n.write(o)}),m.debug("send() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a),s=(o=n.parse(this._pc.localDescription.sdp)).media.find(t=>t.type===e.kind),u.rtcp.cname=l.getCname({offerMediaObject:s}),u.encodings=p.getRtpEncodings({offerMediaObject:s,track:e}),t)for(let f=0;f<u.encodings.length;++f)t[f]&&Object.assign(u.encodings[f],t[f]);if(u.encodings.length>1&&"video/vp8"===u.codecs[0].mimeType.toLowerCase())for(let g of u.encodings)g.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:s,offerRtpParameters:u,answerRtpParameters:h,codecOptions:r});let _={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("send() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_);let v=String(this._nextSendLocalId);this._nextSendLocalId++;let y=this._pc.getSenders().find(t=>t.track===e);return this._mapSendLocalIdRtpSender.set(v,y),{localId:v,rtpParameters:u,rtpSender:y}}async stopSending(e){this.assertSendDirection(),m.debug("stopSending() [localId:%s]",e);let t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw Error("associated RTCRtpSender not found");this._pc.removeTrack(t),t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);let r=await this._pc.createOffer();m.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(i){if(0===this._sendStream.getTracks().length){m.warn("stopSending() | ignoring expected error due no sending tracks: %s",i.toString());return}throw i}if("stable"===this._pc.signalingState)return;let s={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){this.assertSendDirection(),t?m.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):m.debug("replaceTrack() [localId:%s, no track]",e);let r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw Error("associated RTCRtpSender not found");let i=r.track;await r.replaceTrack(t),i&&this._sendStream.removeTrack(i),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,t){this.assertSendDirection(),m.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw Error("associated RTCRtpSender not found");let i=r.getParameters();i.encodings.forEach((e,r)=>{r<=t?e.active=!0:e.active=!1}),await r.setParameters(i)}async setRtpEncodingParameters(e,t){this.assertSendDirection(),m.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw Error("associated RTCRtpSender not found");let i=r.getParameters();i.encodings.forEach((e,r)=>{i.encodings[r]={...e,...t}}),await r.setParameters(i)}async getSenderStats(e){this.assertSendDirection();let t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:s}){this.assertSendDirection();let a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:s};m.debug("sendDataChannel() [options:%o]",a);let o=this._pc.createDataChannel(i,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%f.MIS,!this._hasDataChannelMediaSection){let c=await this._pc.createOffer(),d=n.parse(c.sdp),l=d.media.find(e=>"application"===e.type);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),m.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c),this._remoteSdp.sendSctpAssociation({offerMediaObject:l});let p={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p),this._hasDataChannelMediaSection=!0}let u={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:u}}async receive(e){this.assertRecvDirection();let t=[];for(let r of e){let{trackId:i,kind:s,rtpParameters:a,streamId:o}=r;m.debug("receive() [trackId:%s, kind:%s]",i,s),this._remoteSdp.receive({mid:s,kind:s,offerRtpParameters:a,streamId:o||a.rtcp.cname,trackId:i})}let c={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let d=await this._pc.createAnswer(),p=n.parse(d.sdp);for(let u of e){let{kind:h,rtpParameters:f}=u,g=p.media.find(e=>String(e.mid)===h);l.applyCodecParameters({offerRtpParameters:f,answerMediaObject:g})}for(let _ of(d={type:"answer",sdp:n.write(p)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:p}),m.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d),e)){let{kind:v,trackId:y,rtpParameters:b}=_,w=this._pc.getReceivers().find(e=>e.track&&e.track.id===y);if(!w)throw Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(y,{mid:v,rtpParameters:b,rtpReceiver:w}),t.push({localId:y,track:w.track,rtpReceiver:w})}return t}async stopReceiving(e){for(let t of(this.assertRecvDirection(),e)){m.debug("stopReceiving() [localId:%s]",t);let{mid:r,rtpParameters:i}=this._mapRecvLocalIdInfo.get(t)||{};this._mapRecvLocalIdInfo.delete(t),this._remoteSdp.planBStopReceiving({mid:r,offerRtpParameters:i})}let s={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);let a=await this._pc.createAnswer();m.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){this.assertRecvDirection();let{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)||{};if(!t)throw Error("associated RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();let{streamId:i,ordered:s,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:i,ordered:s,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:o,protocol:r};m.debug("receiveDataChannel() [options:%o]",c);let d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});let l={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);let p=await this._pc.createAnswer();if(!this._transportReady){let u=n.parse(p.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:u})}m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setLocalDescription(p),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=n.parse(this._pc.localDescription.sdp));let r=l.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw Error('method can just be called for handlers with "recv" direction')}}t.Chrome67=g},75372:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome70=void 0;let n=a(r(70766)),o=r(38562),c=a(r(13347)),d=a(r(45280)),l=a(r(82267)),p=a(r(29072)),u=r(89316),h=r(37910),m=r(82770),f=new o.Logger("Chrome70"),g={OS:1024,MIS:1024};class _ extends u.HandlerInterface{static createFactory(){return()=>new _}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome70"}close(){if(f.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){f.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");let t=await e.createOffer();try{e.close()}catch(r){}let i=n.parse(t.sdp),s=l.extractRtpCapabilities({sdpObject:i});return s}catch(o){try{e.close()}catch(a){}throw o}}async getNativeSctpCapabilities(){return f.debug("getNativeSctpCapabilities()"),{numStreams:g}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:s,iceServers:a,iceTransportPolicy:n,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:l}){f.debug("run()"),this._direction=e,this._remoteSdp=new h.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:s}),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",l),video:d.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:d.getSendingRemoteRtpParameters("audio",l),video:d.getSendingRemoteRtpParameters("video",l)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a||[],iceTransportPolicy:n||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(f.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){f.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(f.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady){if("send"===this._direction){let t=await this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let r={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{let i={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:i}){let s;this.assertSendDirection(),f.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);let a=c.clone(this._sendingRtpParametersByKind[e.kind],{});a.codecs=d.reduceCodecs(a.codecs,i);let o=c.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});o.codecs=d.reduceCodecs(o.codecs,i);let u=this._remoteSdp.getNextMediaSectionIdx(),h=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]}),g=await this._pc.createOffer(),_=n.parse(g.sdp);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:_}),t&&t.length>1&&(f.debug("send() | enabling legacy simulcast"),s=(_=n.parse(g.sdp)).media[u.idx],p.addLegacySimulcast({offerMediaObject:s,numStreams:t.length}),g={type:"offer",sdp:n.write(_)});let v=!1,y=(0,m.parse)((t||[{}])[0].scalabilityMode);if(t&&1===t.length&&y.spatialLayers>1&&"video/vp9"===a.codecs[0].mimeType.toLowerCase()&&(f.debug("send() | enabling legacy simulcast for VP9 SVC"),v=!0,s=(_=n.parse(g.sdp)).media[u.idx],p.addLegacySimulcast({offerMediaObject:s,numStreams:y.spatialLayers}),g={type:"offer",sdp:n.write(_)}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",g),await this._pc.setLocalDescription(g),t){f.debug("send() | applying given encodings");let b=h.sender.getParameters();for(let w=0;w<(b.encodings||[]).length;++w){let S=b.encodings[w],R=t[w];if(!R)break;b.encodings[w]=Object.assign(S,R)}await h.sender.setParameters(b)}let C=h.mid;if(a.mid=C,s=(_=n.parse(this._pc.localDescription.sdp)).media[u.idx],a.rtcp.cname=l.getCname({offerMediaObject:s}),a.encodings=p.getRtpEncodings({offerMediaObject:s}),t)for(let D=0;D<a.encodings.length;++D)t[D]&&Object.assign(a.encodings[D],t[D]);if(v&&(a.encodings=[a.encodings[0]]),a.encodings.length>1&&("video/vp8"===a.codecs[0].mimeType.toLowerCase()||"video/h264"===a.codecs[0].mimeType.toLowerCase()))for(let P of a.encodings)P.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:s,reuseMid:u.reuseMid,offerRtpParameters:a,answerRtpParameters:o,codecOptions:r});let T={type:"answer",sdp:this._remoteSdp.getSdp()};return f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",T),await this._pc.setRemoteDescription(T),this._mapMidTransceiver.set(C,h),{localId:C,rtpParameters:a,rtpSender:h.sender}}async stopSending(e){this.assertSendDirection(),f.debug("stopSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender);let r=this._remoteSdp.closeMediaSection(t.mid);if(r)try{t.stop()}catch(i){}let s=await this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let a={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._mapMidTransceiver.delete(e)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){this.assertSendDirection(),t?f.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):f.debug("replaceTrack() [localId:%s, no track]",e);let r=this._mapMidTransceiver.get(e);if(!r)throw Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertSendDirection(),f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let r=this._mapMidTransceiver.get(e);if(!r)throw Error("associated RTCRtpTransceiver not found");let i=r.sender.getParameters();i.encodings.forEach((e,r)=>{r<=t?e.active=!0:e.active=!1}),await r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let s=await this._pc.createOffer();f.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let a={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async setRtpEncodingParameters(e,t){this.assertSendDirection(),f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let r=this._mapMidTransceiver.get(e);if(!r)throw Error("associated RTCRtpTransceiver not found");let i=r.sender.getParameters();i.encodings.forEach((e,r)=>{i.encodings[r]={...e,...t}}),await r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let s=await this._pc.createOffer();f.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let a={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async getSenderStats(e){this.assertSendDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:s}){this.assertSendDirection();let a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:s};f.debug("sendDataChannel() [options:%o]",a);let o=this._pc.createDataChannel(i,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%g.MIS,!this._hasDataChannelMediaSection){let c=await this._pc.createOffer(),d=n.parse(c.sdp),l=d.media.find(e=>"application"===e.type);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c),this._remoteSdp.sendSctpAssociation({offerMediaObject:l});let p={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p),this._hasDataChannelMediaSection=!0}let u={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:u}}async receive(e){this.assertRecvDirection();let t=[],r=new Map;for(let i of e){let{trackId:s,kind:a,rtpParameters:o,streamId:c}=i;f.debug("receive() [trackId:%s, kind:%s]",s,a);let d=o.mid||String(this._mapMidTransceiver.size);r.set(s,d),this._remoteSdp.receive({mid:d,kind:a,offerRtpParameters:o,streamId:c||o.rtcp.cname,trackId:s})}let p={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",p),await this._pc.setRemoteDescription(p);let u=await this._pc.createAnswer(),h=n.parse(u.sdp);for(let m of e){let{trackId:g,rtpParameters:_}=m,v=r.get(g),y=h.media.find(e=>String(e.mid)===v);l.applyCodecParameters({offerRtpParameters:_,answerMediaObject:y})}for(let b of(u={type:"answer",sdp:n.write(h)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h}),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),e)){let{trackId:w}=b,S=r.get(w),R=this._pc.getTransceivers().find(e=>e.mid===S);if(!R)throw Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(S,R),t.push({localId:S,track:R.receiver.track,rtpReceiver:R.receiver})}return t}async stopReceiving(e){for(let t of(this.assertRecvDirection(),e)){f.debug("stopReceiving() [localId:%s]",t);let r=this._mapMidTransceiver.get(t);if(!r)throw Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(r.mid)}let i={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();for(let a of(f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s),e))this._mapMidTransceiver.delete(a)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){this.assertRecvDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();let{streamId:i,ordered:s,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:i,ordered:s,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:o,protocol:r};f.debug("receiveDataChannel() [options:%o]",c);let d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();let l={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);let p=await this._pc.createAnswer();if(!this._transportReady){let u=n.parse(p.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:u})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setLocalDescription(p),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=n.parse(this._pc.localDescription.sdp));let r=l.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw Error('method can just be called for handlers with "recv" direction')}}t.Chrome70=_},66656:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome74=void 0;let n=a(r(70766)),o=r(38562),c=a(r(13347)),d=a(r(45280)),l=a(r(82267)),p=a(r(29072)),u=a(r(58954)),h=r(99992),m=r(89316),f=r(37910),g=r(82770),_=new o.Logger("Chrome74"),v={OS:1024,MIS:1024};class y extends m.HandlerInterface{static createFactory(){return()=>new y}constructor(){super(),this._closed=!1,this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome74"}close(){if(_.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}}async getNativeRtpCapabilities(){_.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");let t=await e.createOffer();try{e.close()}catch(r){}let i=n.parse(t.sdp),s=l.extractRtpCapabilities({sdpObject:i});return u.addNackSuppportForOpus(s),s}catch(o){try{e.close()}catch(a){}throw o}}async getNativeSctpCapabilities(){return _.debug("getNativeSctpCapabilities()"),{numStreams:v}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:s,iceServers:a,iceTransportPolicy:n,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:l}){_.debug("run()"),this._direction=e,this._remoteSdp=new f.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:s}),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",l),video:d.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:d.getSendingRemoteRtpParameters("audio",l),video:d.getSendingRemoteRtpParameters("video",l)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a||[],iceTransportPolicy:n||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(_.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){this.assertNotClosed(),_.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),_.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady){if("send"===this._direction){let t=await this._pc.createOffer({iceRestart:!0});_.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let r={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{let i={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();_.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:i}){let s;this.assertNotClosed(),this.assertSendDirection(),_.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1&&t.forEach((e,t)=>{e.rid=`r${t}`});let a=c.clone(this._sendingRtpParametersByKind[e.kind],{});a.codecs=d.reduceCodecs(a.codecs,i);let o=c.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});o.codecs=d.reduceCodecs(o.codecs,i);let u=this._remoteSdp.getNextMediaSectionIdx(),h=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t}),m=await this._pc.createOffer(),f=n.parse(m.sdp);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:f});let v=!1,y=(0,g.parse)((t||[{}])[0].scalabilityMode);t&&1===t.length&&y.spatialLayers>1&&"video/vp9"===a.codecs[0].mimeType.toLowerCase()&&(_.debug("send() | enabling legacy simulcast for VP9 SVC"),v=!0,s=(f=n.parse(m.sdp)).media[u.idx],p.addLegacySimulcast({offerMediaObject:s,numStreams:y.spatialLayers}),m={type:"offer",sdp:n.write(f)}),_.debug("send() | calling pc.setLocalDescription() [offer:%o]",m),await this._pc.setLocalDescription(m);let b=h.mid;if(a.mid=b,s=(f=n.parse(this._pc.localDescription.sdp)).media[u.idx],a.rtcp.cname=l.getCname({offerMediaObject:s}),t){if(1===t.length){let w=p.getRtpEncodings({offerMediaObject:s});Object.assign(w[0],t[0]),v&&(w=[w[0]]),a.encodings=w}else a.encodings=t}else a.encodings=p.getRtpEncodings({offerMediaObject:s});if(a.encodings.length>1&&("video/vp8"===a.codecs[0].mimeType.toLowerCase()||"video/h264"===a.codecs[0].mimeType.toLowerCase()))for(let S of a.encodings)S.scalabilityMode?S.scalabilityMode=`L1T${y.temporalLayers}`:S.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:s,reuseMid:u.reuseMid,offerRtpParameters:a,answerRtpParameters:o,codecOptions:r,extmapAllowMixed:!0});let R={type:"answer",sdp:this._remoteSdp.getSdp()};return _.debug("send() | calling pc.setRemoteDescription() [answer:%o]",R),await this._pc.setRemoteDescription(R),this._mapMidTransceiver.set(b,h),{localId:b,rtpParameters:a,rtpSender:h.sender}}async stopSending(e){if(this.assertSendDirection(),_.debug("stopSending() [localId:%s]",e),this._closed)return;let t=this._mapMidTransceiver.get(e);if(!t)throw Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender);let r=this._remoteSdp.closeMediaSection(t.mid);if(r)try{t.stop()}catch(i){}let s=await this._pc.createOffer();_.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let a={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),_.debug("pauseSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);let r=await this._pc.createOffer();_.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);let i={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),_.debug("resumeSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw Error("associated RTCRtpTransceiver not found");t.direction="sendonly";let r=await this._pc.createOffer();_.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);let i={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?_.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):_.debug("replaceTrack() [localId:%s, no track]",e);let r=this._mapMidTransceiver.get(e);if(!r)throw Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),_.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let r=this._mapMidTransceiver.get(e);if(!r)throw Error("associated RTCRtpTransceiver not found");let i=r.sender.getParameters();i.encodings.forEach((e,r)=>{r<=t?e.active=!0:e.active=!1}),await r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let s=await this._pc.createOffer();_.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let a={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),_.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let r=this._mapMidTransceiver.get(e);if(!r)throw Error("associated RTCRtpTransceiver not found");let i=r.sender.getParameters();i.encodings.forEach((e,r)=>{i.encodings[r]={...e,...t}}),await r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let s=await this._pc.createOffer();_.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let a={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:s}){this.assertNotClosed(),this.assertSendDirection();let a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:s};_.debug("sendDataChannel() [options:%o]",a);let o=this._pc.createDataChannel(i,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%v.MIS,!this._hasDataChannelMediaSection){let c=await this._pc.createOffer(),d=n.parse(c.sdp),l=d.media.find(e=>"application"===e.type);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),_.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c),this._remoteSdp.sendSctpAssociation({offerMediaObject:l});let p={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p),this._hasDataChannelMediaSection=!0}let u={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:u}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();let t=[],r=new Map;for(let i of e){let{trackId:s,kind:a,rtpParameters:o,streamId:c}=i;_.debug("receive() [trackId:%s, kind:%s]",s,a);let d=o.mid||String(this._mapMidTransceiver.size);r.set(s,d),this._remoteSdp.receive({mid:d,kind:a,offerRtpParameters:o,streamId:c||o.rtcp.cname,trackId:s})}let p={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",p),await this._pc.setRemoteDescription(p);let u=await this._pc.createAnswer(),h=n.parse(u.sdp);for(let m of e){let{trackId:f,rtpParameters:g}=m,v=r.get(f),y=h.media.find(e=>String(e.mid)===v);l.applyCodecParameters({offerRtpParameters:g,answerMediaObject:y})}for(let b of(u={type:"answer",sdp:n.write(h)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h}),_.debug("receive() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),e)){let{trackId:w}=b,S=r.get(w),R=this._pc.getTransceivers().find(e=>e.mid===S);if(R)this._mapMidTransceiver.set(S,R),t.push({localId:S,track:R.receiver.track,rtpReceiver:R.receiver});else throw Error("new RTCRtpTransceiver not found")}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(let t of e){_.debug("stopReceiving() [localId:%s]",t);let r=this._mapMidTransceiver.get(t);if(!r)throw Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(r.mid)}let i={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();for(let a of(_.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s),e))this._mapMidTransceiver.delete(a)}async pauseReceiving(e){for(let t of(this.assertNotClosed(),this.assertRecvDirection(),e)){_.debug("pauseReceiving() [localId:%s]",t);let r=this._mapMidTransceiver.get(t);if(!r)throw Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(t)}let i={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();_.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async resumeReceiving(e){for(let t of(this.assertNotClosed(),this.assertRecvDirection(),e)){_.debug("resumeReceiving() [localId:%s]",t);let r=this._mapMidTransceiver.get(t);if(!r)throw Error("associated RTCRtpTransceiver not found");r.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(t)}let i={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();_.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertNotClosed(),this.assertRecvDirection();let{streamId:i,ordered:s,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:i,ordered:s,maxPacketLifeTime:a,maxRetransmits:o,protocol:r};_.debug("receiveDataChannel() [options:%o]",c);let d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();let l={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);let p=await this._pc.createAnswer();if(!this._transportReady){let u=n.parse(p.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:u})}_.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setLocalDescription(p),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=n.parse(this._pc.localDescription.sdp));let r=l.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new h.InvalidStateError("method called in a closed handler")}assertSendDirection(){if("send"!==this._direction)throw Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw Error('method can just be called for handlers with "recv" direction')}}t.Chrome74=y},37392:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Edge11=void 0;let n=r(38562),o=r(99992),c=a(r(13347)),d=a(r(45280)),l=a(r(63635)),p=r(89316),u=new n.Logger("Edge11");class h extends p.HandlerInterface{static createFactory(){return()=>new h}constructor(){super(),this._rtpSenders=new Map,this._rtpReceivers=new Map,this._nextSendLocalId=0,this._transportReady=!1}get name(){return"Edge11"}close(){u.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(t){}try{this._dtlsTransport.stop()}catch(r){}for(let i of this._rtpSenders.values())try{i.stop()}catch(s){}for(let a of this._rtpReceivers.values())try{a.stop()}catch(n){}this.emit("@close")}async getNativeRtpCapabilities(){return u.debug("getNativeRtpCapabilities()"),l.getCapabilities()}async getNativeSctpCapabilities(){return u.debug("getNativeSctpCapabilities()"),{numStreams:{OS:0,MIS:0}}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:s,iceServers:a,iceTransportPolicy:n,additionalSettings:o,proprietaryConstraints:l,extendedRtpCapabilities:p}){u.debug("run()"),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",p),video:d.getSendingRtpParameters("video",p)},this._remoteIceParameters=t,this._remoteIceCandidates=r,this._remoteDtlsParameters=i,this._cname=`CNAME-${c.generateRandomNumber()}`,this.setIceGatherer({iceServers:a,iceTransportPolicy:n}),this.setIceTransport(),this.setDtlsTransport()}async updateIceServers(e){throw new o.UnsupportedError("not supported")}async restartIce(e){if(u.debug("restartIce()"),this._remoteIceParameters=e,this._transportReady){for(let t of(u.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,e,"controlling"),this._remoteIceCandidates))this._iceTransport.addRemoteCandidate(t);this._iceTransport.addRemoteCandidate({})}}async getTransportStats(){return this._iceTransport.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:i}){u.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),u.debug("send() | calling new RTCRtpSender()");let s=new RTCRtpSender(e,this._dtlsTransport),a=c.clone(this._sendingRtpParametersByKind[e.kind],{});a.codecs=d.reduceCodecs(a.codecs,i);let n=a.codecs.some(e=>/.+\/rtx$/i.test(e.mimeType));for(let o of(t||(t=[{}]),t))o.ssrc=c.generateRandomNumber(),n&&(o.rtx={ssrc:c.generateRandomNumber()});a.encodings=t,a.rtcp={cname:this._cname,reducedSize:!0,mux:!0};let p=l.mangleRtpParameters(a);u.debug("send() | calling rtpSender.send() [params:%o]",p),await s.send(p);let h=String(this._nextSendLocalId);return this._nextSendLocalId++,this._rtpSenders.set(h,s),{localId:h,rtpParameters:a,rtpSender:s}}async stopSending(e){u.debug("stopSending() [localId:%s]",e);let t=this._rtpSenders.get(e);if(!t)throw Error("RTCRtpSender not found");this._rtpSenders.delete(e);try{u.debug("stopSending() | calling rtpSender.stop()"),t.stop()}catch(r){throw u.warn("stopSending() | rtpSender.stop() failed:%o",r),r}}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){t?u.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):u.debug("replaceTrack() [localId:%s, no track]",e);let r=this._rtpSenders.get(e);if(!r)throw Error("RTCRtpSender not found");r.setTrack(t)}async setMaxSpatialLayer(e,t){u.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let r=this._rtpSenders.get(e);if(!r)throw Error("RTCRtpSender not found");let i=r.getParameters();i.encodings.forEach((e,r)=>{r<=t?e.active=!0:e.active=!1}),await r.setParameters(i)}async setRtpEncodingParameters(e,t){u.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let r=this._rtpSenders.get(e);if(!r)throw Error("RTCRtpSender not found");let i=r.getParameters();i.encodings.forEach((e,r)=>{i.encodings[r]={...e,...t}}),await r.setParameters(i)}async getSenderStats(e){let t=this._rtpSenders.get(e);if(!t)throw Error("RTCRtpSender not found");return t.getStats()}async sendDataChannel(e){throw new o.UnsupportedError("not implemented")}async receive(e){let t=[];for(let r of e){let{trackId:i,kind:s}=r;u.debug("receive() [trackId:%s, kind:%s]",i,s)}for(let a of(this._transportReady||await this.setupTransport({localDtlsRole:"server"}),e)){let{trackId:n,kind:o,rtpParameters:c}=a;u.debug("receive() | calling new RTCRtpReceiver()");let d=new RTCRtpReceiver(this._dtlsTransport,o);d.addEventListener("error",e=>{u.error('rtpReceiver "error" event [event:%o]',e)});let p=l.mangleRtpParameters(c);u.debug("receive() | calling rtpReceiver.receive() [params:%o]",p),await d.receive(p),this._rtpReceivers.set(n,d),t.push({localId:n,track:d.track,rtpReceiver:d})}return t}async stopReceiving(e){for(let t of e){u.debug("stopReceiving() [localId:%s]",t);let r=this._rtpReceivers.get(t);if(!r)throw Error("RTCRtpReceiver not found");this._rtpReceivers.delete(t);try{u.debug("stopReceiving() | calling rtpReceiver.stop()"),r.stop()}catch(i){u.warn("stopReceiving() | rtpReceiver.stop() failed:%o",i)}}}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){let t=this._rtpReceivers.get(e);if(!t)throw Error("RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel(e){throw new o.UnsupportedError("not implemented")}setIceGatherer({iceServers:e,iceTransportPolicy:t}){let r=new RTCIceGatherer({iceServers:e||[],gatherPolicy:t||"all"});r.addEventListener("error",e=>{u.error('iceGatherer "error" event [event:%o]',e)});try{r.gather()}catch(i){u.debug("setIceGatherer() | iceGatherer.gather() failed: %s",i.toString())}this._iceGatherer=r}setIceTransport(){let e=new RTCIceTransport(this._iceGatherer);e.addEventListener("statechange",()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}),e.addEventListener("icestatechange",()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}),e.addEventListener("candidatepairchange",e=>{u.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)}),this._iceTransport=e}setDtlsTransport(){let e=new RTCDtlsTransport(this._iceTransport);e.addEventListener("statechange",()=>{u.debug('dtlsTransport "statechange" event [state:%s]',e.state)}),e.addEventListener("dtlsstatechange",()=>{u.debug('dtlsTransport "dtlsstatechange" event [state:%s]',e.state),"closed"===e.state&&this.emit("@connectionstatechange","closed")}),e.addEventListener("error",e=>{u.error('dtlsTransport "error" event [event:%o]',e)}),this._dtlsTransport=e}async setupTransport({localDtlsRole:e}){u.debug("setupTransport()");let t=this._dtlsTransport.getLocalParameters();for(let r of(t.role=e,await new Promise((e,r)=>{this.safeEmit("@connect",{dtlsParameters:t},e,r)}),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling"),this._remoteIceCandidates))this._iceTransport.addRemoteCandidate(r);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter(e=>"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0}}t.Edge11=h},61419:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Firefox60=void 0;let n=a(r(70766)),o=r(38562),c=r(99992),d=a(r(13347)),l=a(r(45280)),p=a(r(82267)),u=a(r(29072)),h=r(89316),m=r(37910),f=r(82770),g=new o.Logger("Firefox60"),_={OS:16,MIS:2048};class v extends h.HandlerInterface{static createFactory(){return()=>new v}constructor(){super(),this._closed=!1,this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Firefox60"}close(){if(g.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}}async getNativeRtpCapabilities(){g.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");let r=t.captureStream(),i=r.getVideoTracks()[0];try{e.addTransceiver("audio",{direction:"sendrecv"});let s=e.addTransceiver(i,{direction:"sendrecv"}),a=s.sender.getParameters();a.encodings=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}],await s.sender.setParameters(a);let o=await e.createOffer();try{t.remove()}catch(c){}try{i.stop()}catch(d){}try{e.close()}catch(l){}let u=n.parse(o.sdp),h=p.extractRtpCapabilities({sdpObject:u});return h}catch(v){try{t.remove()}catch(m){}try{i.stop()}catch(f){}try{e.close()}catch(_){}throw v}}async getNativeSctpCapabilities(){return g.debug("getNativeSctpCapabilities()"),{numStreams:_}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:s,iceServers:a,iceTransportPolicy:n,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){this.assertNotClosed(),g.debug("run()"),this._direction=e,this._remoteSdp=new m.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:s}),this._sendingRtpParametersByKind={audio:l.getSendingRtpParameters("audio",d),video:l.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:l.getSendingRemoteRtpParameters("audio",d),video:l.getSendingRemoteRtpParameters("video",d)},this._pc=new RTCPeerConnection({iceServers:a||[],iceTransportPolicy:n||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(g.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){throw this.assertNotClosed(),new c.UnsupportedError("not supported")}async restartIce(e){if(this.assertNotClosed(),g.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady){if("send"===this._direction){let t=await this._pc.createOffer({iceRestart:!0});g.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let r={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{let i={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();g.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:i}){this.assertNotClosed(),this.assertSendDirection(),g.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&(t=d.clone(t,[])).length>1&&(t.forEach((e,t)=>{e.rid=`r${t}`}),t.reverse());let s=d.clone(this._sendingRtpParametersByKind[e.kind],{});s.codecs=l.reduceCodecs(s.codecs,i);let a=d.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});a.codecs=l.reduceCodecs(a.codecs,i);let o=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});if(t){let c=o.sender.getParameters();c.encodings=t,await o.sender.setParameters(c)}let h=await this._pc.createOffer(),m=n.parse(h.sdp);this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:m});let _=(0,f.parse)((t||[{}])[0].scalabilityMode);g.debug("send() | calling pc.setLocalDescription() [offer:%o]",h),await this._pc.setLocalDescription(h);let v=o.mid;s.mid=v,m=n.parse(this._pc.localDescription.sdp);let y=m.media[m.media.length-1];if(s.rtcp.cname=p.getCname({offerMediaObject:y}),t){if(1===t.length){let b=u.getRtpEncodings({offerMediaObject:y});Object.assign(b[0],t[0]),s.encodings=b}else s.encodings=t.reverse()}else s.encodings=u.getRtpEncodings({offerMediaObject:y});if(s.encodings.length>1&&("video/vp8"===s.codecs[0].mimeType.toLowerCase()||"video/h264"===s.codecs[0].mimeType.toLowerCase()))for(let w of s.encodings)w.scalabilityMode?w.scalabilityMode=`L1T${_.temporalLayers}`:w.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:y,offerRtpParameters:s,answerRtpParameters:a,codecOptions:r,extmapAllowMixed:!0});let S={type:"answer",sdp:this._remoteSdp.getSdp()};return g.debug("send() | calling pc.setRemoteDescription() [answer:%o]",S),await this._pc.setRemoteDescription(S),this._mapMidTransceiver.set(v,o),{localId:v,rtpParameters:s,rtpSender:o.sender}}async stopSending(e){if(this.assertSendDirection(),g.debug("stopSending() [localId:%s]",e),this._closed)return;let t=this._mapMidTransceiver.get(e);if(!t)throw Error("associated transceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.disableMediaSection(t.mid);let r=await this._pc.createOffer();g.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);let i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),g.debug("pauseSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);let r=await this._pc.createOffer();g.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);let i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),g.debug("resumeSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);let r=await this._pc.createOffer();g.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);let i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?g.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):g.debug("replaceTrack() [localId:%s, no track]",e);let r=this._mapMidTransceiver.get(e);if(!r)throw Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),g.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let r=this._mapMidTransceiver.get(e);if(!r)throw Error("associated transceiver not found");let i=r.sender.getParameters();t=i.encodings.length-1-t,i.encodings.forEach((e,r)=>{r>=t?e.active=!0:e.active=!1}),await r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let s=await this._pc.createOffer();g.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let a={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),g.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let r=this._mapMidTransceiver.get(e);if(!r)throw Error("associated RTCRtpTransceiver not found");let i=r.sender.getParameters();i.encodings.forEach((e,r)=>{i.encodings[r]={...e,...t}}),await r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let s=await this._pc.createOffer();g.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let a={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:s}){this.assertNotClosed(),this.assertSendDirection();let a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:s};g.debug("sendDataChannel() [options:%o]",a);let o=this._pc.createDataChannel(i,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%_.MIS,!this._hasDataChannelMediaSection){let c=await this._pc.createOffer(),d=n.parse(c.sdp),l=d.media.find(e=>"application"===e.type);this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:d}),g.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c),this._remoteSdp.sendSctpAssociation({offerMediaObject:l});let p={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p),this._hasDataChannelMediaSection=!0}let u={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:u}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();let t=[],r=new Map;for(let i of e){let{trackId:s,kind:a,rtpParameters:o,streamId:c}=i;g.debug("receive() [trackId:%s, kind:%s]",s,a);let d=o.mid||String(this._mapMidTransceiver.size);r.set(s,d),this._remoteSdp.receive({mid:d,kind:a,offerRtpParameters:o,streamId:c||o.rtcp.cname,trackId:s})}let l={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);let u=await this._pc.createAnswer(),h=n.parse(u.sdp);for(let m of e){let{trackId:f,rtpParameters:_}=m,v=r.get(f),y=h.media.find(e=>String(e.mid)===v);p.applyCodecParameters({offerRtpParameters:_,answerMediaObject:y}),u={type:"answer",sdp:n.write(h)}}for(let b of(this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:h}),g.debug("receive() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),e)){let{trackId:w}=b,S=r.get(w),R=this._pc.getTransceivers().find(e=>e.mid===S);if(!R)throw Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(S,R),t.push({localId:S,track:R.receiver.track,rtpReceiver:R.receiver})}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(let t of e){g.debug("stopReceiving() [localId:%s]",t);let r=this._mapMidTransceiver.get(t);if(!r)throw Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(r.mid)}let i={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();for(let a of(g.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s),e))this._mapMidTransceiver.delete(a)}async pauseReceiving(e){for(let t of(this.assertNotClosed(),this.assertRecvDirection(),e)){g.debug("pauseReceiving() [localId:%s]",t);let r=this._mapMidTransceiver.get(t);if(!r)throw Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(t)}let i={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();g.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async resumeReceiving(e){for(let t of(this.assertNotClosed(),this.assertRecvDirection(),e)){g.debug("resumeReceiving() [localId:%s]",t);let r=this._mapMidTransceiver.get(t);if(!r)throw Error("associated RTCRtpTransceiver not found");r.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(t)}let i={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();g.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){this.assertRecvDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertNotClosed(),this.assertRecvDirection();let{streamId:i,ordered:s,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:i,ordered:s,maxPacketLifeTime:a,maxRetransmits:o,protocol:r};g.debug("receiveDataChannel() [options:%o]",c);let d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();let l={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);let p=await this._pc.createAnswer();if(!this._transportReady){let u=n.parse(p.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:u})}g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setLocalDescription(p),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=n.parse(this._pc.localDescription.sdp));let r=p.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new c.InvalidStateError("method called in a closed handler")}assertSendDirection(){if("send"!==this._direction)throw Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw Error('method can just be called for handlers with "recv" direction')}}t.Firefox60=v},89316:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HandlerInterface=void 0;let i=r(54493);class s extends i.EnhancedEventEmitter{constructor(){super()}}t.HandlerInterface=s},44770:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ReactNative=void 0;let n=a(r(70766)),o=r(38562),c=r(99992),d=a(r(13347)),l=a(r(45280)),p=a(r(82267)),u=a(r(89875)),h=r(89316),m=r(37910),f=new o.Logger("ReactNative"),g={OS:1024,MIS:1024};class _ extends h.HandlerInterface{static createFactory(){return()=>new _}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"ReactNative"}close(){if(f.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){f.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{let t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(r){}let i=n.parse(t.sdp),s=p.extractRtpCapabilities({sdpObject:i});return s}catch(o){try{e.close()}catch(a){}throw o}}async getNativeSctpCapabilities(){return f.debug("getNativeSctpCapabilities()"),{numStreams:g}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:s,iceServers:a,iceTransportPolicy:n,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){f.debug("run()"),this._direction=e,this._remoteSdp=new m.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:s,planB:!0}),this._sendingRtpParametersByKind={audio:l.getSendingRtpParameters("audio",d),video:l.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:l.getSendingRemoteRtpParameters("audio",d),video:l.getSendingRemoteRtpParameters("video",d)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a||[],iceTransportPolicy:n||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(f.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){f.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(f.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady){if("send"===this._direction){let t=await this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let r={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{let i={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:i}){let s;this.assertSendDirection(),f.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),i&&f.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addStream(this._sendStream);let a=await this._pc.createOffer(),o=n.parse(a.sdp),c=d.clone(this._sendingRtpParametersByKind[e.kind],{});c.codecs=l.reduceCodecs(c.codecs);let h=d.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(h.codecs=l.reduceCodecs(h.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),"video"===e.kind&&t&&t.length>1&&(f.debug("send() | enabling simulcast"),s=(o=n.parse(a.sdp)).media.find(e=>"video"===e.type),u.addLegacySimulcast({offerMediaObject:s,track:e,numStreams:t.length}),a={type:"offer",sdp:n.write(o)}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a),s=(o=n.parse(this._pc.localDescription.sdp)).media.find(t=>t.type===e.kind),c.rtcp.cname=p.getCname({offerMediaObject:s}),c.encodings=u.getRtpEncodings({offerMediaObject:s,track:e}),t)for(let m=0;m<c.encodings.length;++m)t[m]&&Object.assign(c.encodings[m],t[m]);if(c.encodings.length>1&&("video/vp8"===c.codecs[0].mimeType.toLowerCase()||"video/h264"===c.codecs[0].mimeType.toLowerCase()))for(let g of c.encodings)g.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:s,offerRtpParameters:c,answerRtpParameters:h,codecOptions:r});let _={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_);let v=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(v,e),{localId:v,rtpParameters:c}}async stopSending(e){this.assertSendDirection(),f.debug("stopSending() [localId:%s]",e);let t=this._mapSendLocalIdTrack.get(e);if(!t)throw Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);let r=await this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(i){if(0===this._sendStream.getTracks().length){f.warn("stopSending() | ignoring expected error due no sending tracks: %s",i.toString());return}throw i}if("stable"===this._pc.signalingState)return;let s={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){throw new c.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new c.UnsupportedError("not implemented")}async setRtpEncodingParameters(e,t){throw new c.UnsupportedError("not implemented")}async getSenderStats(e){throw new c.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:s}){this.assertSendDirection();let a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:s};f.debug("sendDataChannel() [options:%o]",a);let o=this._pc.createDataChannel(i,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%g.MIS,!this._hasDataChannelMediaSection){let c=await this._pc.createOffer(),d=n.parse(c.sdp),l=d.media.find(e=>"application"===e.type);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c),this._remoteSdp.sendSctpAssociation({offerMediaObject:l});let p={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p),this._hasDataChannelMediaSection=!0}let u={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:u}}async receive(e){this.assertRecvDirection();let t=[],r=new Map;for(let i of e){let{trackId:s,kind:a,rtpParameters:o}=i;f.debug("receive() [trackId:%s, kind:%s]",s,a);let c=i.streamId||o.rtcp.cname;f.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),c+=`-hack-${d.generateRandomNumber()}`,r.set(s,c),this._remoteSdp.receive({mid:a,kind:a,offerRtpParameters:o,streamId:c,trackId:s})}let l={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);let u=await this._pc.createAnswer(),h=n.parse(u.sdp);for(let m of e){let{kind:g,rtpParameters:_}=m,v=h.media.find(e=>String(e.mid)===g);p.applyCodecParameters({offerRtpParameters:_,answerMediaObject:v})}for(let y of(u={type:"answer",sdp:n.write(h)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h}),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),e)){let{kind:b,trackId:w,rtpParameters:S}=y,R=r.get(w),C=this._pc.getRemoteStreams().find(e=>e.id===R),D=C.getTrackById(w);if(!D)throw Error("remote track not found");this._mapRecvLocalIdInfo.set(w,{mid:b,rtpParameters:S}),t.push({localId:w,track:D})}return t}async stopReceiving(e){for(let t of(this.assertRecvDirection(),e)){f.debug("stopReceiving() [localId:%s]",t);let{mid:r,rtpParameters:i}=this._mapRecvLocalIdInfo.get(t)||{};this._mapRecvLocalIdInfo.delete(t),this._remoteSdp.planBStopReceiving({mid:r,offerRtpParameters:i})}let s={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);let a=await this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){throw new c.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();let{streamId:i,ordered:s,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:i,ordered:s,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:o,protocol:r};f.debug("receiveDataChannel() [options:%o]",c);let d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});let l={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);let p=await this._pc.createAnswer();if(!this._transportReady){let u=n.parse(p.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:u})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setLocalDescription(p),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=n.parse(this._pc.localDescription.sdp));let r=p.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw Error('method can just be called for handlers with "recv" direction')}}t.ReactNative=_},23433:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ReactNativeUnifiedPlan=void 0;let n=a(r(70766)),o=r(38562),c=a(r(13347)),d=a(r(45280)),l=a(r(82267)),p=a(r(29072)),u=a(r(58954)),h=r(99992),m=r(89316),f=r(37910),g=r(82770),_=new o.Logger("ReactNativeUnifiedPlan"),v={OS:1024,MIS:1024};class y extends m.HandlerInterface{static createFactory(){return()=>new y}constructor(){super(),this._closed=!1,this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"ReactNativeUnifiedPlan"}close(){if(_.debug("close()"),!this._closed){if(this._closed=!0,this._sendStream.release(!1),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}}async getNativeRtpCapabilities(){_.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");let t=await e.createOffer();try{e.close()}catch(r){}let i=n.parse(t.sdp),s=l.extractRtpCapabilities({sdpObject:i});return u.addNackSuppportForOpus(s),s}catch(o){try{e.close()}catch(a){}throw o}}async getNativeSctpCapabilities(){return _.debug("getNativeSctpCapabilities()"),{numStreams:v}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:s,iceServers:a,iceTransportPolicy:n,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:l}){this.assertNotClosed(),_.debug("run()"),this._direction=e,this._remoteSdp=new f.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:s}),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",l),video:d.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:d.getSendingRemoteRtpParameters("audio",l),video:d.getSendingRemoteRtpParameters("video",l)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a||[],iceTransportPolicy:n||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(_.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){this.assertNotClosed(),_.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),_.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady){if("send"===this._direction){let t=await this._pc.createOffer({iceRestart:!0});_.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let r={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{let i={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();_.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:i}){let s;this.assertNotClosed(),this.assertSendDirection(),_.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1&&t.forEach((e,t)=>{e.rid=`r${t}`});let a=c.clone(this._sendingRtpParametersByKind[e.kind],{});a.codecs=d.reduceCodecs(a.codecs,i);let o=c.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});o.codecs=d.reduceCodecs(o.codecs,i);let u=this._remoteSdp.getNextMediaSectionIdx(),h=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t}),m=await this._pc.createOffer(),f=n.parse(m.sdp);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:f});let v=!1,y=(0,g.parse)((t||[{}])[0].scalabilityMode);t&&1===t.length&&y.spatialLayers>1&&"video/vp9"===a.codecs[0].mimeType.toLowerCase()&&(_.debug("send() | enabling legacy simulcast for VP9 SVC"),v=!0,s=(f=n.parse(m.sdp)).media[u.idx],p.addLegacySimulcast({offerMediaObject:s,numStreams:y.spatialLayers}),m={type:"offer",sdp:n.write(f)}),_.debug("send() | calling pc.setLocalDescription() [offer:%o]",m),await this._pc.setLocalDescription(m);let b=h.mid??void 0;if(b||_.warn("send() | missing transceiver.mid (bug in react-native-webrtc, using a workaround"),a.mid=b,s=(f=n.parse(this._pc.localDescription.sdp)).media[u.idx],a.rtcp.cname=l.getCname({offerMediaObject:s}),t){if(1===t.length){let w=p.getRtpEncodings({offerMediaObject:s});Object.assign(w[0],t[0]),v&&(w=[w[0]]),a.encodings=w}else a.encodings=t}else a.encodings=p.getRtpEncodings({offerMediaObject:s});if(a.encodings.length>1&&("video/vp8"===a.codecs[0].mimeType.toLowerCase()||"video/h264"===a.codecs[0].mimeType.toLowerCase()))for(let S of a.encodings)S.scalabilityMode?S.scalabilityMode=`L1T${y.temporalLayers}`:S.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:s,reuseMid:u.reuseMid,offerRtpParameters:a,answerRtpParameters:o,codecOptions:r,extmapAllowMixed:!0});let R={type:"answer",sdp:this._remoteSdp.getSdp()};return _.debug("send() | calling pc.setRemoteDescription() [answer:%o]",R),await this._pc.setRemoteDescription(R),b||(b=h.mid,a.mid=b),this._mapMidTransceiver.set(b,h),{localId:b,rtpParameters:a,rtpSender:h.sender}}async stopSending(e){if(this.assertSendDirection(),this._closed)return;_.debug("stopSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender);let r=this._remoteSdp.closeMediaSection(t.mid);if(r)try{t.stop()}catch(i){}let s=await this._pc.createOffer();_.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let a={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),_.debug("pauseSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);let r=await this._pc.createOffer();_.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);let i={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),_.debug("resumeSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw Error("associated RTCRtpTransceiver not found");t.direction="sendonly";let r=await this._pc.createOffer();_.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);let i={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?_.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):_.debug("replaceTrack() [localId:%s, no track]",e);let r=this._mapMidTransceiver.get(e);if(!r)throw Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),_.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let r=this._mapMidTransceiver.get(e);if(!r)throw Error("associated RTCRtpTransceiver not found");let i=r.sender.getParameters();i.encodings.forEach((e,r)=>{r<=t?e.active=!0:e.active=!1}),await r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let s=await this._pc.createOffer();_.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let a={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),_.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let r=this._mapMidTransceiver.get(e);if(!r)throw Error("associated RTCRtpTransceiver not found");let i=r.sender.getParameters();i.encodings.forEach((e,r)=>{i.encodings[r]={...e,...t}}),await r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let s=await this._pc.createOffer();_.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let a={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:s}){this.assertNotClosed(),this.assertSendDirection();let a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:s};_.debug("sendDataChannel() [options:%o]",a);let o=this._pc.createDataChannel(i,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%v.MIS,!this._hasDataChannelMediaSection){let c=await this._pc.createOffer(),d=n.parse(c.sdp),l=d.media.find(e=>"application"===e.type);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),_.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c),this._remoteSdp.sendSctpAssociation({offerMediaObject:l});let p={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p),this._hasDataChannelMediaSection=!0}let u={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:u}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();let t=[],r=new Map;for(let i of e){let{trackId:s,kind:a,rtpParameters:o,streamId:c}=i;_.debug("receive() [trackId:%s, kind:%s]",s,a);let d=o.mid||String(this._mapMidTransceiver.size);r.set(s,d),this._remoteSdp.receive({mid:d,kind:a,offerRtpParameters:o,streamId:c||o.rtcp.cname,trackId:s})}let p={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",p),await this._pc.setRemoteDescription(p);let u=await this._pc.createAnswer(),h=n.parse(u.sdp);for(let m of e){let{trackId:f,rtpParameters:g}=m,v=r.get(f),y=h.media.find(e=>String(e.mid)===v);l.applyCodecParameters({offerRtpParameters:g,answerMediaObject:y})}for(let b of(u={type:"answer",sdp:n.write(h)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h}),_.debug("receive() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),e)){let{trackId:w}=b,S=r.get(w),R=this._pc.getTransceivers().find(e=>e.mid===S);if(R)this._mapMidTransceiver.set(S,R),t.push({localId:S,track:R.receiver.track,rtpReceiver:R.receiver});else throw Error("new RTCRtpTransceiver not found")}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(let t of e){_.debug("stopReceiving() [localId:%s]",t);let r=this._mapMidTransceiver.get(t);if(!r)throw Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(r.mid)}let i={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();for(let a of(_.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s),e))this._mapMidTransceiver.delete(a)}async pauseReceiving(e){for(let t of(this.assertNotClosed(),this.assertRecvDirection(),e)){_.debug("pauseReceiving() [localId:%s]",t);let r=this._mapMidTransceiver.get(t);if(!r)throw Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(t)}let i={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();_.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async resumeReceiving(e){for(let t of(this.assertNotClosed(),this.assertRecvDirection(),e)){_.debug("resumeReceiving() [localId:%s]",t);let r=this._mapMidTransceiver.get(t);if(!r)throw Error("associated RTCRtpTransceiver not found");r.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(t)}let i={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();_.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertNotClosed(),this.assertRecvDirection();let{streamId:i,ordered:s,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:i,ordered:s,maxPacketLifeTime:a,maxRetransmits:o,protocol:r};_.debug("receiveDataChannel() [options:%o]",c);let d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();let l={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);let p=await this._pc.createAnswer();if(!this._transportReady){let u=n.parse(p.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:u})}_.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setLocalDescription(p),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=n.parse(this._pc.localDescription.sdp));let r=l.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new h.InvalidStateError("method called in a closed handler")}assertSendDirection(){if("send"!==this._direction)throw Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw Error('method can just be called for handlers with "recv" direction')}}t.ReactNativeUnifiedPlan=y},32205:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Safari11=void 0;let n=a(r(70766)),o=r(38562),c=a(r(13347)),d=a(r(45280)),l=a(r(82267)),p=a(r(89875)),u=r(89316),h=r(37910),m=new o.Logger("Safari11"),f={OS:1024,MIS:1024};class g extends u.HandlerInterface{static createFactory(){return()=>new g}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Safari11"}close(){if(m.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){m.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{let t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(r){}let i=n.parse(t.sdp),s=l.extractRtpCapabilities({sdpObject:i});return s}catch(o){try{e.close()}catch(a){}throw o}}async getNativeSctpCapabilities(){return m.debug("getNativeSctpCapabilities()"),{numStreams:f}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:s,iceServers:a,iceTransportPolicy:n,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:l}){m.debug("run()"),this._direction=e,this._remoteSdp=new h.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:s,planB:!0}),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",l),video:d.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:d.getSendingRemoteRtpParameters("audio",l),video:d.getSendingRemoteRtpParameters("video",l)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a||[],iceTransportPolicy:n||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(m.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){m.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(m.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady){if("send"===this._direction){let t=await this._pc.createOffer({iceRestart:!0});m.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let r={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{let i={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();m.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:i}){let s;this.assertSendDirection(),m.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),i&&m.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addTrack(e,this._sendStream);let a=await this._pc.createOffer(),o=n.parse(a.sdp),u=c.clone(this._sendingRtpParametersByKind[e.kind],{});u.codecs=d.reduceCodecs(u.codecs);let h=c.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(h.codecs=d.reduceCodecs(h.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),"video"===e.kind&&t&&t.length>1&&(m.debug("send() | enabling simulcast"),s=(o=n.parse(a.sdp)).media.find(e=>"video"===e.type),p.addLegacySimulcast({offerMediaObject:s,track:e,numStreams:t.length}),a={type:"offer",sdp:n.write(o)}),m.debug("send() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a),s=(o=n.parse(this._pc.localDescription.sdp)).media.find(t=>t.type===e.kind),u.rtcp.cname=l.getCname({offerMediaObject:s}),u.encodings=p.getRtpEncodings({offerMediaObject:s,track:e}),t)for(let f=0;f<u.encodings.length;++f)t[f]&&Object.assign(u.encodings[f],t[f]);if(u.encodings.length>1&&"video/vp8"===u.codecs[0].mimeType.toLowerCase())for(let g of u.encodings)g.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:s,offerRtpParameters:u,answerRtpParameters:h,codecOptions:r});let _={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("send() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_);let v=String(this._nextSendLocalId);this._nextSendLocalId++;let y=this._pc.getSenders().find(t=>t.track===e);return this._mapSendLocalIdRtpSender.set(v,y),{localId:v,rtpParameters:u,rtpSender:y}}async stopSending(e){this.assertSendDirection();let t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw Error("associated RTCRtpSender not found");t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);let r=await this._pc.createOffer();m.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(i){if(0===this._sendStream.getTracks().length){m.warn("stopSending() | ignoring expected error due no sending tracks: %s",i.toString());return}throw i}if("stable"===this._pc.signalingState)return;let s={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){this.assertSendDirection(),t?m.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):m.debug("replaceTrack() [localId:%s, no track]",e);let r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw Error("associated RTCRtpSender not found");let i=r.track;await r.replaceTrack(t),i&&this._sendStream.removeTrack(i),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,t){this.assertSendDirection(),m.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw Error("associated RTCRtpSender not found");let i=r.getParameters();i.encodings.forEach((e,r)=>{r<=t?e.active=!0:e.active=!1}),await r.setParameters(i)}async setRtpEncodingParameters(e,t){this.assertSendDirection(),m.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw Error("associated RTCRtpSender not found");let i=r.getParameters();i.encodings.forEach((e,r)=>{i.encodings[r]={...e,...t}}),await r.setParameters(i)}async getSenderStats(e){this.assertSendDirection();let t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:s}){this.assertSendDirection();let a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:s};m.debug("sendDataChannel() [options:%o]",a);let o=this._pc.createDataChannel(i,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%f.MIS,!this._hasDataChannelMediaSection){let c=await this._pc.createOffer(),d=n.parse(c.sdp),l=d.media.find(e=>"application"===e.type);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),m.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c),this._remoteSdp.sendSctpAssociation({offerMediaObject:l});let p={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p),this._hasDataChannelMediaSection=!0}let u={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:u}}async receive(e){this.assertRecvDirection();let t=[];for(let r of e){let{trackId:i,kind:s,rtpParameters:a,streamId:o}=r;m.debug("receive() [trackId:%s, kind:%s]",i,s),this._remoteSdp.receive({mid:s,kind:s,offerRtpParameters:a,streamId:o||a.rtcp.cname,trackId:i})}let c={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let d=await this._pc.createAnswer(),p=n.parse(d.sdp);for(let u of e){let{kind:h,rtpParameters:f}=u,g=p.media.find(e=>String(e.mid)===h);l.applyCodecParameters({offerRtpParameters:f,answerMediaObject:g})}for(let _ of(d={type:"answer",sdp:n.write(p)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:p}),m.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d),e)){let{kind:v,trackId:y,rtpParameters:b}=_,w=this._pc.getReceivers().find(e=>e.track&&e.track.id===y);if(!w)throw Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(y,{mid:v,rtpParameters:b,rtpReceiver:w}),t.push({localId:y,track:w.track,rtpReceiver:w})}return t}async stopReceiving(e){for(let t of(this.assertRecvDirection(),e)){m.debug("stopReceiving() [localId:%s]",t);let{mid:r,rtpParameters:i}=this._mapRecvLocalIdInfo.get(t)||{};this._mapRecvLocalIdInfo.delete(t),this._remoteSdp.planBStopReceiving({mid:r,offerRtpParameters:i})}let s={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);let a=await this._pc.createAnswer();m.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async getReceiverStats(e){this.assertRecvDirection();let{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)||{};if(!t)throw Error("associated RTCRtpReceiver not found");return t.getStats()}async pauseReceiving(e){}async resumeReceiving(e){}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();let{streamId:i,ordered:s,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:i,ordered:s,maxPacketLifeTime:a,maxRetransmits:o,protocol:r};m.debug("receiveDataChannel() [options:%o]",c);let d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});let l={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);let p=await this._pc.createAnswer();if(!this._transportReady){let u=n.parse(p.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:u})}m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setLocalDescription(p),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=n.parse(this._pc.localDescription.sdp));let r=l.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw Error('method can just be called for handlers with "recv" direction')}}t.Safari11=g},29862:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Safari12=void 0;let n=a(r(70766)),o=r(38562),c=a(r(13347)),d=a(r(45280)),l=a(r(82267)),p=a(r(29072)),u=a(r(58954)),h=r(99992),m=r(89316),f=r(37910),g=r(82770),_=new o.Logger("Safari12"),v={OS:1024,MIS:1024};class y extends m.HandlerInterface{static createFactory(){return()=>new y}constructor(){super(),this._closed=!1,this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Safari12"}close(){if(_.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}}async getNativeRtpCapabilities(){_.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");let t=await e.createOffer();try{e.close()}catch(r){}let i=n.parse(t.sdp),s=l.extractRtpCapabilities({sdpObject:i});return u.addNackSuppportForOpus(s),s}catch(o){try{e.close()}catch(a){}throw o}}async getNativeSctpCapabilities(){return _.debug("getNativeSctpCapabilities()"),{numStreams:v}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:s,iceServers:a,iceTransportPolicy:n,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:l}){this.assertNotClosed(),_.debug("run()"),this._direction=e,this._remoteSdp=new f.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:s}),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",l),video:d.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:d.getSendingRemoteRtpParameters("audio",l),video:d.getSendingRemoteRtpParameters("video",l)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a||[],iceTransportPolicy:n||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(_.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){this.assertNotClosed(),_.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),_.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady){if("send"===this._direction){let t=await this._pc.createOffer({iceRestart:!0});_.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let r={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{let i={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();_.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:i}){let s;this.assertNotClosed(),this.assertSendDirection(),_.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);let a=c.clone(this._sendingRtpParametersByKind[e.kind],{});a.codecs=d.reduceCodecs(a.codecs,i);let o=c.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});o.codecs=d.reduceCodecs(o.codecs,i);let u=this._remoteSdp.getNextMediaSectionIdx(),h=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]}),m=await this._pc.createOffer(),f=n.parse(m.sdp);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:f});let v=(0,g.parse)((t||[{}])[0].scalabilityMode);t&&t.length>1&&(_.debug("send() | enabling legacy simulcast"),s=(f=n.parse(m.sdp)).media[u.idx],p.addLegacySimulcast({offerMediaObject:s,numStreams:t.length}),m={type:"offer",sdp:n.write(f)}),_.debug("send() | calling pc.setLocalDescription() [offer:%o]",m),await this._pc.setLocalDescription(m);let y=h.mid;if(a.mid=y,s=(f=n.parse(this._pc.localDescription.sdp)).media[u.idx],a.rtcp.cname=l.getCname({offerMediaObject:s}),a.encodings=p.getRtpEncodings({offerMediaObject:s}),t)for(let b=0;b<a.encodings.length;++b)t[b]&&Object.assign(a.encodings[b],t[b]);if(a.encodings.length>1&&("video/vp8"===a.codecs[0].mimeType.toLowerCase()||"video/h264"===a.codecs[0].mimeType.toLowerCase()))for(let w of a.encodings)w.scalabilityMode?w.scalabilityMode=`L1T${v.temporalLayers}`:w.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:s,reuseMid:u.reuseMid,offerRtpParameters:a,answerRtpParameters:o,codecOptions:r});let S={type:"answer",sdp:this._remoteSdp.getSdp()};return _.debug("send() | calling pc.setRemoteDescription() [answer:%o]",S),await this._pc.setRemoteDescription(S),this._mapMidTransceiver.set(y,h),{localId:y,rtpParameters:a,rtpSender:h.sender}}async stopSending(e){if(this.assertSendDirection(),this._closed)return;_.debug("stopSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender);let r=this._remoteSdp.closeMediaSection(t.mid);if(r)try{t.stop()}catch(i){}let s=await this._pc.createOffer();_.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let a={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),_.debug("pauseSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);let r=await this._pc.createOffer();_.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);let i={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),_.debug("resumeSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);let r=await this._pc.createOffer();_.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);let i={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?_.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):_.debug("replaceTrack() [localId:%s, no track]",e);let r=this._mapMidTransceiver.get(e);if(!r)throw Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),_.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let r=this._mapMidTransceiver.get(e);if(!r)throw Error("associated RTCRtpTransceiver not found");let i=r.sender.getParameters();i.encodings.forEach((e,r)=>{r<=t?e.active=!0:e.active=!1}),await r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let s=await this._pc.createOffer();_.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let a={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),_.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let r=this._mapMidTransceiver.get(e);if(!r)throw Error("associated RTCRtpTransceiver not found");let i=r.sender.getParameters();i.encodings.forEach((e,r)=>{i.encodings[r]={...e,...t}}),await r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let s=await this._pc.createOffer();_.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let a={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:s}){this.assertNotClosed(),this.assertSendDirection();let a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:s};_.debug("sendDataChannel() [options:%o]",a);let o=this._pc.createDataChannel(i,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%v.MIS,!this._hasDataChannelMediaSection){let c=await this._pc.createOffer(),d=n.parse(c.sdp),l=d.media.find(e=>"application"===e.type);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),_.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c),this._remoteSdp.sendSctpAssociation({offerMediaObject:l});let p={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p),this._hasDataChannelMediaSection=!0}let u={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:u}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();let t=[],r=new Map;for(let i of e){let{trackId:s,kind:a,rtpParameters:o,streamId:c}=i;_.debug("receive() [trackId:%s, kind:%s]",s,a);let d=o.mid||String(this._mapMidTransceiver.size);r.set(s,d),this._remoteSdp.receive({mid:d,kind:a,offerRtpParameters:o,streamId:c||o.rtcp.cname,trackId:s})}let p={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",p),await this._pc.setRemoteDescription(p);let u=await this._pc.createAnswer(),h=n.parse(u.sdp);for(let m of e){let{trackId:f,rtpParameters:g}=m,v=r.get(f),y=h.media.find(e=>String(e.mid)===v);l.applyCodecParameters({offerRtpParameters:g,answerMediaObject:y})}for(let b of(u={type:"answer",sdp:n.write(h)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h}),_.debug("receive() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),e)){let{trackId:w}=b,S=r.get(w),R=this._pc.getTransceivers().find(e=>e.mid===S);if(!R)throw Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(S,R),t.push({localId:S,track:R.receiver.track,rtpReceiver:R.receiver})}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(let t of e){_.debug("stopReceiving() [localId:%s]",t);let r=this._mapMidTransceiver.get(t);if(!r)throw Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(r.mid)}let i={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();for(let a of(_.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s),e))this._mapMidTransceiver.delete(a)}async pauseReceiving(e){for(let t of(this.assertNotClosed(),this.assertRecvDirection(),e)){_.debug("pauseReceiving() [localId:%s]",t);let r=this._mapMidTransceiver.get(t);if(!r)throw Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(t)}let i={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();_.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async resumeReceiving(e){for(let t of(this.assertNotClosed(),this.assertRecvDirection(),e)){_.debug("resumeReceiving() [localId:%s]",t);let r=this._mapMidTransceiver.get(t);if(!r)throw Error("associated RTCRtpTransceiver not found");r.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(t)}let i={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();_.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertNotClosed(),this.assertRecvDirection();let{streamId:i,ordered:s,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:i,ordered:s,maxPacketLifeTime:a,maxRetransmits:o,protocol:r};_.debug("receiveDataChannel() [options:%o]",c);let d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();let l={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);let p=await this._pc.createAnswer();if(!this._transportReady){let u=n.parse(p.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:u})}_.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setLocalDescription(p),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=n.parse(this._pc.localDescription.sdp));let r=l.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new h.InvalidStateError("method called in a closed handler")}assertSendDirection(){if("send"!==this._direction)throw Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw Error('method can just be called for handlers with "recv" direction')}}t.Safari12=y},63635:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.mangleRtpParameters=t.getCapabilities=void 0;let n=a(r(13347));t.getCapabilities=function(){let e=RTCRtpReceiver.getCapabilities(),t=n.clone(e,{});for(let r of t.codecs){if(r.channels=r.numChannels,delete r.numChannels,r.mimeType=r.mimeType||`${r.kind}/${r.name}`,r.parameters){let i=r.parameters;i.apt&&(i.apt=Number(i.apt)),i["packetization-mode"]&&(i["packetization-mode"]=Number(i["packetization-mode"]))}for(let s of r.rtcpFeedback||[])s.parameter||(s.parameter="")}return t},t.mangleRtpParameters=function(e){let t=n.clone(e,{});for(let r of(t.mid&&(t.muxId=t.mid,delete t.mid),t.codecs))r.channels&&(r.numChannels=r.channels,delete r.channels),r.mimeType&&!r.name&&(r.name=r.mimeType.split("/")[1]),delete r.mimeType;return t}},58954:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addNackSuppportForOpus=void 0,t.addNackSuppportForOpus=function(e){for(let t of e.codecs||[])"audio/opus"!==t.mimeType.toLowerCase()&&"audio/multiopus"!==t.mimeType.toLowerCase()||t.rtcpFeedback?.some(e=>"nack"===e.type&&!e.parameter)||(t.rtcpFeedback||(t.rtcpFeedback=[]),t.rtcpFeedback.push({type:"nack"}))}},76698:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.OfferMediaSection=t.AnswerMediaSection=t.MediaSection=void 0;let n=a(r(70766)),o=a(r(13347));class c{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:i=!1}){if(this._mediaObject={},this._planB=i,e&&this.setIceParameters(e),t){for(let s of(this._mediaObject.candidates=[],t)){let a={};a.component=1,a.foundation=s.foundation,a.ip=s.ip,a.port=s.port,a.priority=s.priority,a.transport=s.protocol,a.type=s.type,s.tcpType&&(a.tcptype=s.tcpType),this._mediaObject.candidates.push(a)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}r&&this.setDtlsRole(r.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return 0===this._mediaObject.port}getObject(){return this._mediaObject}setIceParameters(e){this._mediaObject.iceUfrag=e.usernameFragment,this._mediaObject.icePwd=e.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause(),delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}close(){this.disable(),this._mediaObject.port=0}}function d(e){let t=RegExp("^(audio|video)/(.+)","i"),r=t.exec(e.mimeType);if(!r)throw TypeError("invalid codec.mimeType");return r[2]}t.MediaSection=c,t.AnswerMediaSection=class extends c{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:i,plainRtpParameters:s,planB:a=!1,offerMediaObject:n,offerRtpParameters:c,answerRtpParameters:l,codecOptions:p,extmapAllowMixed:u=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:a}),this._mediaObject.mid=String(n.mid),this._mediaObject.type=n.type,this._mediaObject.protocol=n.protocol,s?(this._mediaObject.connection={ip:s.ip,version:s.ipVersion},this._mediaObject.port=s.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),n.type){case"audio":case"video":for(let h of(this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],l.codecs)){let m={payload:h.payloadType,codec:d(h),rate:h.clockRate};h.channels>1&&(m.encoding=h.channels),this._mediaObject.rtp.push(m);let f=o.clone(h.parameters,{}),g=o.clone(h.rtcpFeedback,[]);if(p){let{opusStereo:_,opusFec:v,opusDtx:y,opusMaxPlaybackRate:b,opusMaxAverageBitrate:w,opusPtime:S,opusNack:R,videoGoogleStartBitrate:C,videoGoogleMaxBitrate:D,videoGoogleMinBitrate:P}=p,T=c.codecs.find(e=>e.payloadType===h.payloadType);switch(h.mimeType.toLowerCase()){case"audio/opus":case"audio/multiopus":void 0!==_&&(T.parameters["sprop-stereo"]=_?1:0,f.stereo=_?1:0),void 0!==v&&(T.parameters.useinbandfec=v?1:0,f.useinbandfec=v?1:0),void 0!==y&&(T.parameters.usedtx=y?1:0,f.usedtx=y?1:0),void 0!==b&&(f.maxplaybackrate=b),void 0!==w&&(f.maxaveragebitrate=w),void 0!==S&&(T.parameters.ptime=S,f.ptime=S),R||(T.rtcpFeedback=T.rtcpFeedback.filter(e=>"nack"!==e.type||e.parameter),g=g.filter(e=>"nack"!==e.type||e.parameter));break;case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":void 0!==C&&(f["x-google-start-bitrate"]=C),void 0!==D&&(f["x-google-max-bitrate"]=D),void 0!==P&&(f["x-google-min-bitrate"]=P)}}let k={payload:h.payloadType,config:""};for(let E of Object.keys(f))k.config&&(k.config+=";"),k.config+=`${E}=${f[E]}`;for(let x of(k.config&&this._mediaObject.fmtp.push(k),g))this._mediaObject.rtcpFb.push({payload:h.payloadType,type:x.type,subtype:x.parameter})}for(let I of(this._mediaObject.payloads=l.codecs.map(e=>e.payloadType).join(" "),this._mediaObject.ext=[],l.headerExtensions)){let L=(n.ext||[]).some(e=>e.uri===I.uri);L&&this._mediaObject.ext.push({uri:I.uri,value:I.id})}if(u&&"extmap-allow-mixed"===n.extmapAllowMixed&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),n.simulcast)for(let O of(this._mediaObject.simulcast={dir1:"recv",list1:n.simulcast.list1},this._mediaObject.rids=[],n.rids||[]))"send"===O.direction&&this._mediaObject.rids.push({id:O.id,direction:"recv"});else if(n.simulcast_03)for(let M of(this._mediaObject.simulcast_03={value:n.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[],n.rids||[]))"send"===M.direction&&this._mediaObject.rids.push({id:M.id,direction:"recv"});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&"video"===this._mediaObject.type&&(this._mediaObject.xGoogleFlag="conference");break;case"application":"number"==typeof n.sctpPort?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=i.port,this._mediaObject.maxMessageSize=i.maxMessageSize):n.sctpmap&&(this._mediaObject.payloads=i.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:i.port,maxMessageSize:i.maxMessageSize})}}setDtlsRole(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass"}}resume(){this._mediaObject.direction="recvonly"}muxSimulcastStreams(e){if(!this._mediaObject.simulcast||!this._mediaObject.simulcast.list1)return;let t={};for(let r of e)r.rid&&(t[r.rid]=r);let i=this._mediaObject.simulcast.list1,s=n.parseSimulcastStreamList(i);for(let a of s)for(let o of a)o.paused=!t[o.scid]?.active;this._mediaObject.simulcast.list1=s.map(e=>e.map(e=>`${e.paused?"~":""}${e.scid}`).join(",")).join(";")}},t.OfferMediaSection=class extends c{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:i,plainRtpParameters:s,planB:a=!1,mid:n,kind:o,offerRtpParameters:c,streamId:l,trackId:p,oldDataChannelSpec:u=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:a}),this._mediaObject.mid=String(n),this._mediaObject.type=o,s?(this._mediaObject.connection={ip:s.ip,version:s.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=s.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},i?this._mediaObject.protocol="UDP/DTLS/SCTP":this._mediaObject.protocol="UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),o){case"audio":case"video":{for(let h of(this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${l||"-"} ${p}`),c.codecs)){let m={payload:h.payloadType,codec:d(h),rate:h.clockRate};h.channels>1&&(m.encoding=h.channels),this._mediaObject.rtp.push(m);let f={payload:h.payloadType,config:""};for(let g of Object.keys(h.parameters))f.config&&(f.config+=";"),f.config+=`${g}=${h.parameters[g]}`;for(let _ of(f.config&&this._mediaObject.fmtp.push(f),h.rtcpFeedback))this._mediaObject.rtcpFb.push({payload:h.payloadType,type:_.type,subtype:_.parameter})}for(let v of(this._mediaObject.payloads=c.codecs.map(e=>e.payloadType).join(" "),this._mediaObject.ext=[],c.headerExtensions))this._mediaObject.ext.push({uri:v.uri,value:v.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";let y=c.encodings[0],b=y.ssrc,w=y.rtx&&y.rtx.ssrc?y.rtx.ssrc:void 0;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],c.rtcp.cname&&this._mediaObject.ssrcs.push({id:b,attribute:"cname",value:c.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:b,attribute:"msid",value:`${l||"-"} ${p}`}),w&&(c.rtcp.cname&&this._mediaObject.ssrcs.push({id:w,attribute:"cname",value:c.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:w,attribute:"msid",value:`${l||"-"} ${p}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${b} ${w}`}));break}case"application":u?(this._mediaObject.payloads=i.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:i.port,maxMessageSize:i.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=i.port,this._mediaObject.maxMessageSize=i.maxMessageSize)}}setDtlsRole(e){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}planBReceive({offerRtpParameters:e,streamId:t,trackId:r}){let i=e.encodings[0],s=i.ssrc,a=i.rtx&&i.rtx.ssrc?i.rtx.ssrc:void 0,n=this._mediaObject.payloads.split(" ");for(let o of e.codecs){if(n.includes(String(o.payloadType)))continue;let c={payload:o.payloadType,codec:d(o),rate:o.clockRate};o.channels>1&&(c.encoding=o.channels),this._mediaObject.rtp.push(c);let l={payload:o.payloadType,config:""};for(let p of Object.keys(o.parameters))l.config&&(l.config+=";"),l.config+=`${p}=${o.parameters[p]}`;for(let u of(l.config&&this._mediaObject.fmtp.push(l),o.rtcpFeedback))this._mediaObject.rtcpFb.push({payload:o.payloadType,type:u.type,subtype:u.parameter})}this._mediaObject.payloads+=` ${e.codecs.filter(e=>!this._mediaObject.payloads.includes(e.payloadType)).map(e=>e.payloadType).join(" ")}`,this._mediaObject.payloads=this._mediaObject.payloads.trim(),e.rtcp.cname&&this._mediaObject.ssrcs.push({id:s,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:s,attribute:"msid",value:`${t||"-"} ${r}`}),a&&(e.rtcp.cname&&this._mediaObject.ssrcs.push({id:a,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:a,attribute:"msid",value:`${t||"-"} ${r}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${s} ${a}`}))}planBStopReceiving({offerRtpParameters:e}){let t=e.encodings[0],r=t.ssrc,i=t.rtx&&t.rtx.ssrc?t.rtx.ssrc:void 0;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter(e=>e.id!==r&&e.id!==i),i&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter(e=>e.ssrcs!==`${r} ${i}`))}}},37910:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteSdp=void 0;let n=a(r(70766)),o=r(38562),c=r(76698),d=new o.Logger("RemoteSdp");t.RemoteSdp=class{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:i,plainRtpParameters:s,planB:a=!1}){if(this._mediaSections=[],this._midToIndex=new Map,this._iceParameters=e,this._iceCandidates=t,this._dtlsParameters=r,this._sctpParameters=i,this._plainRtpParameters=s,this._planB=a,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},e&&e.iceLite&&(this._sdpObject.icelite="ice-lite"),r){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};let n=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:r.fingerprints[n-1].algorithm,hash:r.fingerprints[n-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}s&&(this._sdpObject.origin.address=s.ip,this._sdpObject.origin.ipVer=s.ipVersion)}updateIceParameters(e){for(let t of(d.debug("updateIceParameters() [iceParameters:%o]",e),this._iceParameters=e,this._sdpObject.icelite=e.iceLite?"ice-lite":void 0,this._mediaSections))t.setIceParameters(e)}updateDtlsRole(e){for(let t of(d.debug("updateDtlsRole() [role:%s]",e),this._dtlsParameters.role=e,this._mediaSections))t.setDtlsRole(e)}getNextMediaSectionIdx(){for(let e=0;e<this._mediaSections.length;++e){let t=this._mediaSections[e];if(t.closed)return{idx:e,reuseMid:t.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:e,reuseMid:t,offerRtpParameters:r,answerRtpParameters:i,codecOptions:s,extmapAllowMixed:a=!1}){let n=new c.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:e,offerRtpParameters:r,answerRtpParameters:i,codecOptions:s,extmapAllowMixed:a});t?this._replaceMediaSection(n,t):this._midToIndex.has(n.mid)?this._replaceMediaSection(n):this._addMediaSection(n)}receive({mid:e,kind:t,offerRtpParameters:r,streamId:i,trackId:s}){let a;let n=this._midToIndex.get(e);if(void 0!==n&&(a=this._mediaSections[n]),a)a.planBReceive({offerRtpParameters:r,streamId:i,trackId:s}),this._replaceMediaSection(a);else{a=new c.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:e,kind:t,offerRtpParameters:r,streamId:i,trackId:s});let o=this._mediaSections.find(e=>e.closed);o?this._replaceMediaSection(a,o.mid):this._addMediaSection(a)}}pauseMediaSection(e){let t=this._findMediaSection(e);t.pause()}resumeSendingMediaSection(e){let t=this._findMediaSection(e);t.resume()}resumeReceivingMediaSection(e){let t=this._findMediaSection(e);t.resume()}disableMediaSection(e){let t=this._findMediaSection(e);t.disable()}closeMediaSection(e){let t=this._findMediaSection(e);return e===this._firstMid?(d.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e),this.disableMediaSection(e),!1):(t.close(),this._regenerateBundleMids(),!0)}muxMediaSectionSimulcast(e,t){let r=this._findMediaSection(e);r.muxSimulcastStreams(t),this._replaceMediaSection(r)}planBStopReceiving({mid:e,offerRtpParameters:t}){let r=this._findMediaSection(e);r.planBStopReceiving({offerRtpParameters:t}),this._replaceMediaSection(r)}sendSctpAssociation({offerMediaObject:e}){let t=new c.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:e});this._addMediaSection(t)}receiveSctpAssociation({oldDataChannelSpec:e=!1}={}){let t=new c.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:e});this._addMediaSection(t)}getSdp(){return this._sdpObject.origin.sessionVersion++,n.write(this._sdpObject)}_addMediaSection(e){this._firstMid||(this._firstMid=e.mid),this._mediaSections.push(e),this._midToIndex.set(e.mid,this._mediaSections.length-1),this._sdpObject.media.push(e.getObject()),this._regenerateBundleMids()}_replaceMediaSection(e,t){if("string"==typeof t){let r=this._midToIndex.get(t);if(void 0===r)throw Error(`no media section found for reuseMid '${t}'`);let i=this._mediaSections[r];this._mediaSections[r]=e,this._midToIndex.delete(i.mid),this._midToIndex.set(e.mid,r),this._sdpObject.media[r]=e.getObject(),this._regenerateBundleMids()}else{let s=this._midToIndex.get(e.mid);if(void 0===s)throw Error(`no media section found with mid '${e.mid}'`);this._mediaSections[s]=e,this._sdpObject.media[s]=e.getObject()}}_findMediaSection(e){let t=this._midToIndex.get(e);if(void 0===t)throw Error(`no media section found with mid '${e}'`);return this._mediaSections[t]}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(e=>!e.closed).map(e=>e.mid).join(" "))}}},82267:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.applyCodecParameters=t.getCname=t.extractDtlsParameters=t.extractRtpCapabilities=void 0;let n=a(r(70766));t.extractRtpCapabilities=function({sdpObject:e}){let t=new Map,r=[],i=!1,s=!1;for(let a of e.media){let o=a.type;switch(o){case"audio":if(i)continue;i=!0;break;case"video":if(s)continue;s=!0;break;default:continue}for(let c of a.rtp){let d={kind:o,mimeType:`${o}/${c.codec}`,preferredPayloadType:c.payload,clockRate:c.rate,channels:c.encoding,parameters:{},rtcpFeedback:[]};t.set(d.preferredPayloadType,d)}for(let l of a.fmtp||[]){let p=n.parseParams(l.config),u=t.get(l.payload);u&&(p&&p.hasOwnProperty("profile-level-id")&&(p["profile-level-id"]=String(p["profile-level-id"])),u.parameters=p)}for(let h of a.rtcpFb||[]){let m={type:h.type,parameter:h.subtype};if(m.parameter||delete m.parameter,"*"!==h.payload){let f=t.get(h.payload);if(!f)continue;f.rtcpFeedback.push(m)}else for(let g of t.values())g.kind!==o||/.+\/rtx$/i.test(g.mimeType)||g.rtcpFeedback.push(m)}for(let _ of a.ext||[]){if(_["encrypt-uri"])continue;let v={kind:o,uri:_.uri,preferredId:_.value};r.push(v)}}let y={codecs:Array.from(t.values()),headerExtensions:r};return y},t.extractDtlsParameters=function({sdpObject:e}){let t;let r=(e.media||[]).find(e=>e.iceUfrag&&0!==e.port);if(!r)throw Error("no active media section found");let i=r.fingerprint||e.fingerprint;switch(r.setup){case"active":t="client";break;case"passive":t="server";break;case"actpass":t="auto"}let s={role:t,fingerprints:[{algorithm:i.type,value:i.hash}]};return s},t.getCname=function({offerMediaObject:e}){let t=(e.ssrcs||[]).find(e=>"cname"===e.attribute);return t?t.value:""},t.applyCodecParameters=function({offerRtpParameters:e,answerMediaObject:t}){for(let r of e.codecs){let i=r.mimeType.toLowerCase();if("audio/opus"!==i)continue;let s=(t.rtp||[]).find(e=>e.payload===r.payloadType);if(!s)continue;t.fmtp=t.fmtp||[];let a=t.fmtp.find(e=>e.payload===r.payloadType);a||(a={payload:r.payloadType,config:""},t.fmtp.push(a));let o=n.parseParams(a.config);if("audio/opus"===i){let c=r.parameters["sprop-stereo"];void 0!==c&&(o.stereo=c?1:0)}for(let d of(a.config="",Object.keys(o)))a.config&&(a.config+=";"),a.config+=`${d}=${o[d]}`}}},89875:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addLegacySimulcast=t.getRtpEncodings=void 0,t.getRtpEncodings=function({offerMediaObject:e,track:t}){let r;let i=new Set;for(let s of e.ssrcs||[]){if("msid"!==s.attribute)continue;let a=s.value.split(" ")[1];if(a===t.id){let n=s.id;i.add(n),r||(r=n)}}if(0===i.size)throw Error(`a=ssrc line with msid information not found [track.id:${t.id}]`);let o=new Map;for(let c of e.ssrcGroups||[]){if("FID"!==c.semantics)continue;let[d,l]=c.ssrcs.split(/\s+/);d=Number(d),l=Number(l),i.has(d)&&(i.delete(d),i.delete(l),o.set(d,l))}for(let p of i)o.set(p,null);let u=[];for(let[h,m]of o){let f={ssrc:h};m&&(f.rtx={ssrc:m}),u.push(f)}return u},t.addLegacySimulcast=function({offerMediaObject:e,track:t,numStreams:r}){let i,s,a;if(r<=1)throw TypeError("numStreams must be greater than 1");let n=(e.ssrcs||[]).find(e=>{if("msid"!==e.attribute)return!1;let r=e.value.split(" ")[1];return r===t.id&&(i=e.id,a=e.value.split(" ")[0],!0)});if(!n)throw Error(`a=ssrc line with msid information not found [track.id:${t.id}]`);(e.ssrcGroups||[]).some(e=>{if("FID"!==e.semantics)return!1;let t=e.ssrcs.split(/\s+/);return Number(t[0])===i&&(s=Number(t[1]),!0)});let o=e.ssrcs.find(e=>"cname"===e.attribute&&e.id===i);if(!o)throw Error(`a=ssrc line with cname information not found [track.id:${t.id}]`);let c=o.value,d=[],l=[];for(let p=0;p<r;++p)d.push(i+p),s&&l.push(s+p);e.ssrcGroups=e.ssrcGroups||[],e.ssrcs=e.ssrcs||[],e.ssrcGroups.push({semantics:"SIM",ssrcs:d.join(" ")});for(let u=0;u<d.length;++u){let h=d[u];e.ssrcs.push({id:h,attribute:"cname",value:c}),e.ssrcs.push({id:h,attribute:"msid",value:`${a} ${t.id}`})}for(let m=0;m<l.length;++m){let f=d[m],g=l[m];e.ssrcs.push({id:g,attribute:"cname",value:c}),e.ssrcs.push({id:g,attribute:"msid",value:`${a} ${t.id}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${f} ${g}`})}}},29072:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addLegacySimulcast=t.getRtpEncodings=void 0,t.getRtpEncodings=function({offerMediaObject:e}){let t=new Set;for(let r of e.ssrcs||[]){let i=r.id;t.add(i)}if(0===t.size)throw Error("no a=ssrc lines found");let s=new Map;for(let a of e.ssrcGroups||[]){if("FID"!==a.semantics)continue;let[n,o]=a.ssrcs.split(/\s+/);n=Number(n),o=Number(o),t.has(n)&&(t.delete(n),t.delete(o),s.set(n,o))}for(let c of t)s.set(c,null);let d=[];for(let[l,p]of s){let u={ssrc:l};p&&(u.rtx={ssrc:p}),d.push(u)}return d},t.addLegacySimulcast=function({offerMediaObject:e,numStreams:t}){let r;if(t<=1)throw TypeError("numStreams must be greater than 1");let i=(e.ssrcs||[]).find(e=>"msid"===e.attribute);if(!i)throw Error("a=ssrc line with msid information not found");let[s,a]=i.value.split(" "),n=i.id;(e.ssrcGroups||[]).some(e=>{if("FID"!==e.semantics)return!1;let t=e.ssrcs.split(/\s+/);return Number(t[0])===n&&(r=Number(t[1]),!0)});let o=e.ssrcs.find(e=>"cname"===e.attribute);if(!o)throw Error("a=ssrc line with cname information not found");let c=o.value,d=[],l=[];for(let p=0;p<t;++p)d.push(n+p),r&&l.push(r+p);e.ssrcGroups=[],e.ssrcs=[],e.ssrcGroups.push({semantics:"SIM",ssrcs:d.join(" ")});for(let u=0;u<d.length;++u){let h=d[u];e.ssrcs.push({id:h,attribute:"cname",value:c}),e.ssrcs.push({id:h,attribute:"msid",value:`${s} ${a}`})}for(let m=0;m<l.length;++m){let f=d[m],g=l[m];e.ssrcs.push({id:g,attribute:"cname",value:c}),e.ssrcs.push({id:g,attribute:"msid",value:`${s} ${a}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${f} ${g}`})}}},50960:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return s(t,e),t},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.debug=t.parseScalabilityMode=t.detectDevice=t.Device=t.version=t.types=void 0;let o=n(r(11227));t.debug=o.default;let c=r(43120);Object.defineProperty(t,"Device",{enumerable:!0,get:function(){return c.Device}}),Object.defineProperty(t,"detectDevice",{enumerable:!0,get:function(){return c.detectDevice}});let d=a(r(10053));t.types=d,t.version="3.6.97";var l=r(82770);Object.defineProperty(t,"parseScalabilityMode",{enumerable:!0,get:function(){return l.parse}})},45280:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.canReceive=t.canSend=t.generateProbatorRtpParameters=t.reduceCodecs=t.getSendingRemoteRtpParameters=t.getSendingRtpParameters=t.getRecvRtpCapabilities=t.getExtendedRtpCapabilities=t.validateSctpStreamParameters=t.validateSctpParameters=t.validateNumSctpStreams=t.validateSctpCapabilities=t.validateRtcpParameters=t.validateRtpEncodingParameters=t.validateRtpHeaderExtensionParameters=t.validateRtpCodecParameters=t.validateRtpParameters=t.validateRtpHeaderExtension=t.validateRtcpFeedback=t.validateRtpCodecCapability=t.validateRtpCapabilities=void 0;let n=a(r(57855)),o=a(r(13347));function c(e){let t=RegExp("^(audio|video)/(.+)","i");if("object"!=typeof e)throw TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw TypeError("missing codec.mimeType");let r=t.exec(e.mimeType);if(!r)throw TypeError("invalid codec.mimeType");if(e.kind=r[1].toLowerCase(),e.preferredPayloadType&&"number"!=typeof e.preferredPayloadType)throw TypeError("invalid codec.preferredPayloadType");if("number"!=typeof e.clockRate)throw TypeError("missing codec.clockRate");for(let i of("audio"===e.kind?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"==typeof e.parameters||(e.parameters={}),Object.keys(e.parameters))){let s=e.parameters[i];if(void 0===s&&(e.parameters[i]="",s=""),"string"!=typeof s&&"number"!=typeof s)throw TypeError(`invalid codec parameter [key:${i}s, value:${s}]`);if("apt"===i&&"number"!=typeof s)throw TypeError("invalid codec apt parameter")}for(let a of(e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]),e.rtcpFeedback))d(a)}function d(e){if("object"!=typeof e)throw TypeError("fb is not an object");if(!e.type||"string"!=typeof e.type)throw TypeError("missing fb.type");e.parameter&&"string"==typeof e.parameter||(e.parameter="")}function l(e){if("object"!=typeof e)throw TypeError("ext is not an object");if("audio"!==e.kind&&"video"!==e.kind)throw TypeError("invalid ext.kind");if(!e.uri||"string"!=typeof e.uri)throw TypeError("missing ext.uri");if("number"!=typeof e.preferredId)throw TypeError("missing ext.preferredId");if(e.preferredEncrypt&&"boolean"!=typeof e.preferredEncrypt)throw TypeError("invalid ext.preferredEncrypt");if(e.preferredEncrypt||(e.preferredEncrypt=!1),e.direction&&"string"!=typeof e.direction)throw TypeError("invalid ext.direction");e.direction||(e.direction="sendrecv")}function p(e){if("object"!=typeof e)throw TypeError("params is not an object");if(e.mid&&"string"!=typeof e.mid)throw TypeError("params.mid is not a string");if(!Array.isArray(e.codecs))throw TypeError("missing params.codecs");for(let t of e.codecs)u(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw TypeError("params.headerExtensions is not an array");for(let r of(e.headerExtensions||(e.headerExtensions=[]),e.headerExtensions))h(r);if(e.encodings&&!Array.isArray(e.encodings))throw TypeError("params.encodings is not an array");for(let i of(e.encodings||(e.encodings=[]),e.encodings))m(i);if(e.rtcp&&"object"!=typeof e.rtcp)throw TypeError("params.rtcp is not an object");e.rtcp||(e.rtcp={}),f(e.rtcp)}function u(e){let t=RegExp("^(audio|video)/(.+)","i");if("object"!=typeof e)throw TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw TypeError("missing codec.mimeType");let r=t.exec(e.mimeType);if(!r)throw TypeError("invalid codec.mimeType");if("number"!=typeof e.payloadType)throw TypeError("missing codec.payloadType");if("number"!=typeof e.clockRate)throw TypeError("missing codec.clockRate");let i=r[1].toLowerCase();for(let s of("audio"===i?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"==typeof e.parameters||(e.parameters={}),Object.keys(e.parameters))){let a=e.parameters[s];if(void 0===a&&(e.parameters[s]="",a=""),"string"!=typeof a&&"number"!=typeof a)throw TypeError(`invalid codec parameter [key:${s}s, value:${a}]`);if("apt"===s&&"number"!=typeof a)throw TypeError("invalid codec apt parameter")}for(let n of(e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]),e.rtcpFeedback))d(n)}function h(e){if("object"!=typeof e)throw TypeError("ext is not an object");if(!e.uri||"string"!=typeof e.uri)throw TypeError("missing ext.uri");if("number"!=typeof e.id)throw TypeError("missing ext.id");if(e.encrypt&&"boolean"!=typeof e.encrypt)throw TypeError("invalid ext.encrypt");for(let t of(e.encrypt||(e.encrypt=!1),e.parameters&&"object"==typeof e.parameters||(e.parameters={}),Object.keys(e.parameters))){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw TypeError("invalid header extension parameter")}}function m(e){if("object"!=typeof e)throw TypeError("encoding is not an object");if(e.ssrc&&"number"!=typeof e.ssrc)throw TypeError("invalid encoding.ssrc");if(e.rid&&"string"!=typeof e.rid)throw TypeError("invalid encoding.rid");if(e.rtx&&"object"!=typeof e.rtx)throw TypeError("invalid encoding.rtx");if(e.rtx&&"number"!=typeof e.rtx.ssrc)throw TypeError("missing encoding.rtx.ssrc");if(e.dtx&&"boolean"==typeof e.dtx||(e.dtx=!1),e.scalabilityMode&&"string"!=typeof e.scalabilityMode)throw TypeError("invalid encoding.scalabilityMode")}function f(e){if("object"!=typeof e)throw TypeError("rtcp is not an object");if(e.cname&&"string"!=typeof e.cname)throw TypeError("invalid rtcp.cname");e.reducedSize&&"boolean"==typeof e.reducedSize||(e.reducedSize=!0)}function g(e){if("object"!=typeof e)throw TypeError("numStreams is not an object");if("number"!=typeof e.OS)throw TypeError("missing numStreams.OS");if("number"!=typeof e.MIS)throw TypeError("missing numStreams.MIS")}function _(e){return!!e&&/.+\/rtx$/i.test(e.mimeType)}function v(e,t,{strict:r=!1,modify:i=!1}={}){let s=e.mimeType.toLowerCase(),a=t.mimeType.toLowerCase();if(s!==a||e.clockRate!==t.clockRate||e.channels!==t.channels)return!1;switch(s){case"video/h264":if(r){let o;let c=e.parameters["packetization-mode"]||0,d=t.parameters["packetization-mode"]||0;if(c!==d||!n.isSameProfile(e.parameters,t.parameters))return!1;try{o=n.generateProfileLevelIdForAnswer(e.parameters,t.parameters)}catch(l){return!1}i&&(o?(e.parameters["profile-level-id"]=o,t.parameters["profile-level-id"]=o):(delete e.parameters["profile-level-id"],delete t.parameters["profile-level-id"]))}break;case"video/vp9":if(r){let p=e.parameters["profile-id"]||0,u=t.parameters["profile-id"]||0;if(p!==u)return!1}}return!0}t.validateRtpCapabilities=function(e){if("object"!=typeof e)throw TypeError("caps is not an object");if(e.codecs&&!Array.isArray(e.codecs))throw TypeError("caps.codecs is not an array");for(let t of(e.codecs||(e.codecs=[]),e.codecs))c(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw TypeError("caps.headerExtensions is not an array");for(let r of(e.headerExtensions||(e.headerExtensions=[]),e.headerExtensions))l(r)},t.validateRtpCodecCapability=c,t.validateRtcpFeedback=d,t.validateRtpHeaderExtension=l,t.validateRtpParameters=p,t.validateRtpCodecParameters=u,t.validateRtpHeaderExtensionParameters=h,t.validateRtpEncodingParameters=m,t.validateRtcpParameters=f,t.validateSctpCapabilities=function(e){if("object"!=typeof e)throw TypeError("caps is not an object");if(!e.numStreams||"object"!=typeof e.numStreams)throw TypeError("missing caps.numStreams");g(e.numStreams)},t.validateNumSctpStreams=g,t.validateSctpParameters=function(e){if("object"!=typeof e)throw TypeError("params is not an object");if("number"!=typeof e.port)throw TypeError("missing params.port");if("number"!=typeof e.OS)throw TypeError("missing params.OS");if("number"!=typeof e.MIS)throw TypeError("missing params.MIS");if("number"!=typeof e.maxMessageSize)throw TypeError("missing params.maxMessageSize")},t.validateSctpStreamParameters=function(e){if("object"!=typeof e)throw TypeError("params is not an object");if("number"!=typeof e.streamId)throw TypeError("missing params.streamId");let t=!1;if("boolean"==typeof e.ordered?t=!0:e.ordered=!0,e.maxPacketLifeTime&&"number"!=typeof e.maxPacketLifeTime)throw TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&"number"!=typeof e.maxRetransmits)throw TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(t&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits))throw TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(!t&&(e.maxPacketLifeTime||e.maxRetransmits)&&(e.ordered=!1),e.label&&"string"!=typeof e.label)throw TypeError("invalid params.label");if(e.protocol&&"string"!=typeof e.protocol)throw TypeError("invalid params.protocol")},t.getExtendedRtpCapabilities=function(e,t){let r={codecs:[],headerExtensions:[]};for(let i of t.codecs||[]){if(_(i))continue;let s=(e.codecs||[]).find(e=>v(e,i,{strict:!0,modify:!0}));if(!s)continue;let a={mimeType:s.mimeType,kind:s.kind,clockRate:s.clockRate,channels:s.channels,localPayloadType:s.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:i.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:s.parameters,remoteParameters:i.parameters,rtcpFeedback:function(e,t){let r=[];for(let i of e.rtcpFeedback||[]){let s=(t.rtcpFeedback||[]).find(e=>e.type===i.type&&(e.parameter===i.parameter||!e.parameter&&!i.parameter));s&&r.push(s)}return r}(s,i)};r.codecs.push(a)}for(let n of r.codecs){let o=e.codecs.find(e=>_(e)&&e.parameters.apt===n.localPayloadType),c=t.codecs.find(e=>_(e)&&e.parameters.apt===n.remotePayloadType);o&&c&&(n.localRtxPayloadType=o.preferredPayloadType,n.remoteRtxPayloadType=c.preferredPayloadType)}for(let d of t.headerExtensions){let l=e.headerExtensions.find(e=>{var t;return t=d,(!e.kind||!t.kind||e.kind===t.kind)&&e.uri===t.uri});if(!l)continue;let p={kind:d.kind,uri:d.uri,sendId:l.preferredId,recvId:d.preferredId,encrypt:l.preferredEncrypt,direction:"sendrecv"};switch(d.direction){case"sendrecv":p.direction="sendrecv";break;case"recvonly":p.direction="sendonly";break;case"sendonly":p.direction="recvonly";break;case"inactive":p.direction="inactive"}r.headerExtensions.push(p)}return r},t.getRecvRtpCapabilities=function(e){let t={codecs:[],headerExtensions:[]};for(let r of e.codecs){let i={mimeType:r.mimeType,kind:r.kind,preferredPayloadType:r.remotePayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.localParameters,rtcpFeedback:r.rtcpFeedback};if(t.codecs.push(i),!r.remoteRtxPayloadType)continue;let s={mimeType:`${r.kind}/rtx`,kind:r.kind,preferredPayloadType:r.remoteRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.remotePayloadType},rtcpFeedback:[]};t.codecs.push(s)}for(let a of e.headerExtensions){if("sendrecv"!==a.direction&&"recvonly"!==a.direction)continue;let n={kind:a.kind,uri:a.uri,preferredId:a.recvId,preferredEncrypt:a.encrypt,direction:a.direction};t.headerExtensions.push(n)}return t},t.getSendingRtpParameters=function(e,t){let r={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(let i of t.codecs){if(i.kind!==e)continue;let s={mimeType:i.mimeType,payloadType:i.localPayloadType,clockRate:i.clockRate,channels:i.channels,parameters:i.localParameters,rtcpFeedback:i.rtcpFeedback};if(r.codecs.push(s),i.localRtxPayloadType){let a={mimeType:`${i.kind}/rtx`,payloadType:i.localRtxPayloadType,clockRate:i.clockRate,parameters:{apt:i.localPayloadType},rtcpFeedback:[]};r.codecs.push(a)}}for(let n of t.headerExtensions){if(n.kind&&n.kind!==e||"sendrecv"!==n.direction&&"sendonly"!==n.direction)continue;let o={uri:n.uri,id:n.sendId,encrypt:n.encrypt,parameters:{}};r.headerExtensions.push(o)}return r},t.getSendingRemoteRtpParameters=function(e,t){let r={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(let i of t.codecs){if(i.kind!==e)continue;let s={mimeType:i.mimeType,payloadType:i.localPayloadType,clockRate:i.clockRate,channels:i.channels,parameters:i.remoteParameters,rtcpFeedback:i.rtcpFeedback};if(r.codecs.push(s),i.localRtxPayloadType){let a={mimeType:`${i.kind}/rtx`,payloadType:i.localRtxPayloadType,clockRate:i.clockRate,parameters:{apt:i.localPayloadType},rtcpFeedback:[]};r.codecs.push(a)}}for(let n of t.headerExtensions){if(n.kind&&n.kind!==e||"sendrecv"!==n.direction&&"sendonly"!==n.direction)continue;let o={uri:n.uri,id:n.sendId,encrypt:n.encrypt,parameters:{}};r.headerExtensions.push(o)}if(r.headerExtensions.some(e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.uri))for(let c of r.codecs)c.rtcpFeedback=(c.rtcpFeedback||[]).filter(e=>"goog-remb"!==e.type);else if(r.headerExtensions.some(e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.uri))for(let d of r.codecs)d.rtcpFeedback=(d.rtcpFeedback||[]).filter(e=>"transport-cc"!==e.type);else for(let l of r.codecs)l.rtcpFeedback=(l.rtcpFeedback||[]).filter(e=>"transport-cc"!==e.type&&"goog-remb"!==e.type);return r},t.reduceCodecs=function(e,t){let r=[];if(t){for(let i=0;i<e.length;++i)if(v(e[i],t)){r.push(e[i]),_(e[i+1])&&r.push(e[i+1]);break}if(0===r.length)throw TypeError("no matching codec found")}else r.push(e[0]),_(e[1])&&r.push(e[1]);return r},t.generateProbatorRtpParameters=function(e){p(e=o.clone(e,{}));let t={mid:"probator",codecs:[],headerExtensions:[],encodings:[{ssrc:1234}],rtcp:{cname:"probator"}};return t.codecs.push(e.codecs[0]),t.codecs[0].payloadType=127,t.headerExtensions=e.headerExtensions,t},t.canSend=function(e,t){return t.codecs.some(t=>t.kind===e)},t.canReceive=function(e,t){if(p(e),0===e.codecs.length)return!1;let r=e.codecs[0];return t.codecs.some(e=>e.remotePayloadType===r.payloadType)}},82770:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parse=void 0;let r=RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");t.parse=function(e){let t=r.exec(e||"");return t?{spatialLayers:Number(t[1]),temporalLayers:Number(t[2])}:{spatialLayers:1,temporalLayers:1}}},10053:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(43120),t),s(r(35202),t),s(r(26569),t),s(r(59514),t),s(r(25504),t),s(r(31623),t),s(r(94879),t),s(r(37669),t),s(r(89316),t),s(r(99992),t)},13347:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateRandomNumber=t.clone=void 0,t.clone=function(e,t){return void 0===e?t:JSON.parse(JSON.stringify(e))},t.generateRandomNumber=function(){return Math.round(1e7*Math.random())}},19749:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(6495).Z,s=r(92648).Z,a=r(91598).Z,n=r(17273).Z,o=a(r(67294)),c=s(r(83121)),d=r(2675),l=r(10139),p=r(28730);r(57238);var u=s(r(89824));let h={deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1};function m(e){return void 0!==e.default}function f(e){return"number"==typeof e||void 0===e?e:"string"==typeof e&&/^[0-9]+$/.test(e)?parseInt(e,10):NaN}function g(e,t,r,s,a,n,o){if(!e||e["data-loaded-src"]===t)return;e["data-loaded-src"]=t;let c="decode"in e?e.decode():Promise.resolve();c.catch(()=>{}).then(()=>{if(e.parentNode){if("blur"===r&&n(!0),null==s?void 0:s.current){let t=new Event("load");Object.defineProperty(t,"target",{writable:!1,value:e});let o=!1,c=!1;s.current(i({},t,{nativeEvent:t,currentTarget:e,target:e,isDefaultPrevented:()=>o,isPropagationStopped:()=>c,persist:()=>{},preventDefault:()=>{o=!0,t.preventDefault()},stopPropagation:()=>{c=!0,t.stopPropagation()}}))}(null==a?void 0:a.current)&&a.current(e)}})}let _=o.forwardRef((e,t)=>{var{imgAttributes:r,heightInt:s,widthInt:a,qualityInt:c,className:d,imgStyle:l,blurStyle:p,isLazy:u,fill:h,placeholder:m,loading:f,srcString:_,config:v,unoptimized:y,loader:b,onLoadRef:w,onLoadingCompleteRef:S,setBlurComplete:R,setShowAltText:C,onLoad:D,onError:P}=e,T=n(e,["imgAttributes","heightInt","widthInt","qualityInt","className","imgStyle","blurStyle","isLazy","fill","placeholder","loading","srcString","config","unoptimized","loader","onLoadRef","onLoadingCompleteRef","setBlurComplete","setShowAltText","onLoad","onError"]);return f=u?"lazy":f,o.default.createElement(o.default.Fragment,null,o.default.createElement("img",Object.assign({},T,r,{width:a,height:s,decoding:"async","data-nimg":h?"fill":"1",className:d,loading:f,style:i({},l,p),ref:o.useCallback(e=>{t&&("function"==typeof t?t(e):"object"==typeof t&&(t.current=e)),e&&(P&&(e.src=e.src),e.complete&&g(e,_,m,w,S,R,y))},[_,m,w,S,R,P,y,t]),onLoad:e=>{let t=e.currentTarget;g(t,_,m,w,S,R,y)},onError:e=>{C(!0),"blur"===m&&R(!0),P&&P(e)}})))}),v=o.forwardRef((e,t)=>{let r,s;var a,{src:g,sizes:v,unoptimized:y=!1,priority:b=!1,loading:w,className:S,quality:R,width:C,height:D,fill:P,style:T,onLoad:k,onLoadingComplete:E,placeholder:x="empty",blurDataURL:I,layout:L,objectFit:O,objectPosition:M,lazyBoundary:j,lazyRoot:A}=e,N=n(e,["src","sizes","unoptimized","priority","loading","className","quality","width","height","fill","style","onLoad","onLoadingComplete","placeholder","blurDataURL","layout","objectFit","objectPosition","lazyBoundary","lazyRoot"]);let F=o.useContext(p.ImageConfigContext),B=o.useMemo(()=>{let e=h||F||l.imageConfigDefault,t=[...e.deviceSizes,...e.imageSizes].sort((e,t)=>e-t),r=e.deviceSizes.sort((e,t)=>e-t);return i({},e,{allSizes:t,deviceSizes:r})},[F]),z=N,U=z.loader||u.default;if(delete z.loader,"__next_img_default"in U){if("custom"===B.loader)throw Error('Image with src "'.concat(g,'" is missing "loader" prop.')+"\nRead more: https://nextjs.org/docs/messages/next-image-missing-loader")}else{let $=U;U=e=>{let{config:t}=e,r=n(e,["config"]);return $(r)}}if(L){"fill"===L&&(P=!0);let V={intrinsic:{maxWidth:"100%",height:"auto"},responsive:{width:"100%",height:"auto"}}[L];V&&(T=i({},T,V));let q={responsive:"100vw",fill:"100vw"}[L];q&&!v&&(v=q)}let K="",G=f(C),H=f(D);if("object"==typeof(a=g)&&(m(a)||void 0!==a.src)){let W=m(g)?g.default:g;if(!W.src)throw Error("An object should only be passed to the image component src parameter if it comes from a static image import. It must include src. Received ".concat(JSON.stringify(W)));if(!W.height||!W.width)throw Error("An object should only be passed to the image component src parameter if it comes from a static image import. It must include height and width. Received ".concat(JSON.stringify(W)));if(r=W.blurWidth,s=W.blurHeight,I=I||W.blurDataURL,K=W.src,!P){if(G||H){if(G&&!H){let Z=G/W.width;H=Math.round(W.height*Z)}else if(!G&&H){let Q=H/W.height;G=Math.round(W.width*Q)}}else G=W.width,H=W.height}}let Y=!b&&("lazy"===w||void 0===w);((g="string"==typeof g?g:K).startsWith("data:")||g.startsWith("blob:"))&&(y=!0,Y=!1),B.unoptimized&&(y=!0);let[J,X]=o.useState(!1),[ee,et]=o.useState(!1),er=f(R),ei=Object.assign(P?{position:"absolute",height:"100%",width:"100%",left:0,top:0,right:0,bottom:0,objectFit:O,objectPosition:M}:{},ee?{}:{color:"transparent"},T),es="blur"===x&&I&&!J?{backgroundSize:ei.objectFit||"cover",backgroundPosition:ei.objectPosition||"50% 50%",backgroundRepeat:"no-repeat",backgroundImage:'url("data:image/svg+xml;charset=utf-8,'.concat(d.getImageBlurSvg({widthInt:G,heightInt:H,blurWidth:r,blurHeight:s,blurDataURL:I}),'")')}:{},ea=function(e){let{config:t,src:r,unoptimized:i,width:s,quality:a,sizes:n,loader:o}=e;if(i)return{src:r,srcSet:void 0,sizes:void 0};let{widths:c,kind:d}=function(e,t,r){let{deviceSizes:i,allSizes:s}=e;if(r){let a=/(^|\s)(1?\d?\d)vw/g,n=[];for(let o;o=a.exec(r);o)n.push(parseInt(o[2]));if(n.length){let c=.01*Math.min(...n);return{widths:s.filter(e=>e>=i[0]*c),kind:"w"}}return{widths:s,kind:"w"}}if("number"!=typeof t)return{widths:i,kind:"w"};let d=[...new Set([t,2*t].map(e=>s.find(t=>t>=e)||s[s.length-1]))];return{widths:d,kind:"x"}}(t,s,n),l=c.length-1;return{sizes:n||"w"!==d?n:"100vw",srcSet:c.map((e,i)=>"".concat(o({config:t,src:r,quality:a,width:e})," ").concat("w"===d?e:i+1).concat(d)).join(", "),src:o({config:t,src:r,quality:a,width:c[l]})}}({config:B,src:g,unoptimized:y,width:G,quality:er,sizes:v,loader:U}),en=g,eo={imageSrcSet:ea.srcSet,imageSizes:ea.sizes,crossOrigin:z.crossOrigin},ec=o.useRef(k);o.useEffect(()=>{ec.current=k},[k]);let ed=o.useRef(E);o.useEffect(()=>{ed.current=E},[E]);let el=i({isLazy:Y,imgAttributes:ea,heightInt:H,widthInt:G,qualityInt:er,className:S,imgStyle:ei,blurStyle:es,loading:w,config:B,fill:P,unoptimized:y,placeholder:x,loader:U,srcString:en,onLoadRef:ec,onLoadingCompleteRef:ed,setBlurComplete:X,setShowAltText:et},z);return o.default.createElement(o.default.Fragment,null,o.default.createElement(_,Object.assign({},el,{ref:t})),b?o.default.createElement(c.default,null,o.default.createElement("link",Object.assign({key:"__nimg-"+ea.src+ea.srcSet+ea.sizes,rel:"preload",as:"image",href:ea.srcSet?void 0:ea.src},eo))):null)});t.default=v,("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},2675:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getImageBlurSvg=function(e){let{widthInt:t,heightInt:r,blurWidth:i,blurHeight:s,blurDataURL:a}=e,n=i||t,o=s||r,c=a.startsWith("data:image/jpeg")?"%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'/%3E%3C/feComponentTransfer%3E%":"";return n&&o?"%3Csvg xmlns='http%3A//www.w3.org/2000/svg' viewBox='0 0 ".concat(n," ").concat(o,"'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='").concat(i&&s?"1":"20","'/%3E").concat(c,"%3C/filter%3E%3Cimage preserveAspectRatio='none' filter='url(%23b)' x='0' y='0' height='100%25' width='100%25' href='").concat(a,"'/%3E%3C/svg%3E"):"%3Csvg xmlns='http%3A//www.w3.org/2000/svg'%3E%3Cimage style='filter:blur(20px)' x='0' y='0' height='100%25' width='100%25' href='".concat(a,"'/%3E%3C/svg%3E")}},89824:function(e,t){"use strict";function r(e){let{config:t,src:r,width:i,quality:s}=e;return r.endsWith(".svg")&&!t.dangerouslyAllowSVG?r:"".concat(t.path,"?url=").concat(encodeURIComponent(r),"&w=").concat(i,"&q=").concat(s||75)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r.__next_img_default=!0,t.default=r},25675:function(e,t,r){e.exports=r(19749)},54375:function(e,t,r){/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let i;e.exports="function"==typeof queueMicrotask?queueMicrotask.bind("undefined"!=typeof window?window:r.g):e=>(i||(i=Promise.resolve())).then(e).catch(e=>setTimeout(()=>{throw e},0))},96692:function(e){var t=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=(null!=e.raddr?" raddr %s rport %d":"%v%v")+(null!=e.tcptype?" tcptype %s":"%v"),null!=e.generation&&(t+=" generation %d"),t+=(null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){return"mediaclk:"+((null!=e.id?"id=%s %s":"%v%s")+(null!=e.mediaClockValue?"=%s":"")+(null!=e.rateNumerator?" rate=%s":""))+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(t).forEach(function(e){t[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},70766:function(e,t,r){var i=r(70962),s=r(95776);t.write=s,t.parse=i.parse,t.parseParams=i.parseParams,t.parseFmtpConfig=i.parseFmtpConfig,t.parsePayloads=i.parsePayloads,t.parseRemoteCandidates=i.parseRemoteCandidates,t.parseImageAttributes=i.parseImageAttributes,t.parseSimulcastStreamList=i.parseSimulcastStreamList},70962:function(e,t,r){var i=function(e){return String(Number(e))===e?Number(e):e},s=function(e,t,r,s){if(s&&!r)t[s]=i(e[1]);else for(var a=0;a<r.length;a+=1)null!=e[a+1]&&(t[r[a]]=i(e[a+1]))},a=function(e,t,r){var i=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:i&&!t[e.name]&&(t[e.name]={});var a=e.push?{}:i?t[e.name]:t;s(r.match(e.reg),a,e.names,e.name),e.push&&t[e.push].push(a)},n=r(96692),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],i=t;return e.split(/(\r\n|\r|\n)/).filter(o).forEach(function(e){var t=e[0],s=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),i=r[r.length-1]);for(var o=0;o<(n[t]||[]).length;o+=1){var c=n[t][o];if(c.reg.test(s))return a(c,i,s)}}),t.media=r,t};var c=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=i(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(c,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(i),s=0;s<r.length;s+=3)t.push({component:r[s],ip:r[s+1],port:r[s+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(c,{})})},t.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,r=!1;return"~"!==e[0]?t=i(e):(t=i(e.substring(1,e.length)),r=!0),{scid:t,paused:r}})})}},95776:function(e,t,r){var i=r(96692),s=/%[sdv%]/g,a=function(e){var t=1,r=arguments,i=r.length;return e.replace(s,function(e){if(t>=i)return e;var s=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(s);case"%d":return Number(s);case"%v":return""}})},n=function(e,t,r){var i=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var s=0;s<t.names.length;s+=1){var n=t.names[s];t.name?i.push(r[t.name][n]):i.push(r[t.names[s]])}else i.push(r[t.name]);return a.apply(null,i)},o=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var r=t.outerOrder||o,s=t.innerOrder||c,a=[];return r.forEach(function(t){i[t].forEach(function(r){r.name in e&&null!=e[r.name]?a.push(n(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){a.push(n(t,r,e))})})}),e.media.forEach(function(e){a.push(n("m",i.m[0],e)),s.forEach(function(t){i[t].forEach(function(r){r.name in e&&null!=e[r.name]?a.push(n(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){a.push(n(t,r,e))})})})}),a.join("\r\n")+"\r\n"}},42238:function(e,t,r){var i;!function(s,a){"use strict";var n="function",o="undefined",c="object",d="string",l="major",p="model",u="name",h="type",m="vendor",f="version",g="architecture",_="console",v="mobile",y="tablet",b="smarttv",w="wearable",S="embedded",R="Amazon",C="Apple",D="ASUS",P="BlackBerry",T="Browser",k="Chrome",E="Firefox",x="Google",I="Huawei",L="Microsoft",O="Motorola",M="Opera",j="Samsung",A="Sharp",N="Sony",F="Xiaomi",B="Zebra",z="Facebook",U="Chromium OS",$="Mac OS",V=function(e,t){var r={};for(var i in e)t[i]&&t[i].length%2==0?r[i]=t[i].concat(e[i]):r[i]=e[i];return r},q=function(e){for(var t={},r=0;r<e.length;r++)t[e[r].toUpperCase()]=e[r];return t},K=function(e,t){return typeof e===d&&-1!==G(t).indexOf(G(e))},G=function(e){return e.toLowerCase()},H=function(e,t){if(typeof e===d)return e=e.replace(/^\s\s*/,""),typeof t===o?e:e.substring(0,350)},W=function(e,t){for(var r,i,s,o,d,l,p=0;p<t.length&&!d;){var u=t[p],h=t[p+1];for(r=i=0;r<u.length&&!d&&u[r];)if(d=u[r++].exec(e))for(s=0;s<h.length;s++)l=d[++i],typeof(o=h[s])===c&&o.length>0?2===o.length?typeof o[1]==n?this[o[0]]=o[1].call(this,l):this[o[0]]=o[1]:3===o.length?typeof o[1]!==n||o[1].exec&&o[1].test?this[o[0]]=l?l.replace(o[1],o[2]):a:this[o[0]]=l?o[1].call(this,l,o[2]):a:4===o.length&&(this[o[0]]=l?o[3].call(this,l.replace(o[1],o[2])):a):this[o]=l||a;p+=2}},Z=function(e,t){for(var r in t)if(typeof t[r]===c&&t[r].length>0){for(var i=0;i<t[r].length;i++)if(K(t[r][i],e))return"?"===r?a:r}else if(K(t[r],e))return"?"===r?a:r;return e},Q={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Y={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[f,[u,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[f,[u,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[u,f],[/opios[\/ ]+([\w\.]+)/i],[f,[u,M+" Mini"]],[/\bopr\/([\w\.]+)/i],[f,[u,M]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[u,f],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[f,[u,"UC"+T]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[f,[u,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[f,[u,"WeChat"]],[/konqueror\/([\w\.]+)/i],[f,[u,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[f,[u,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[f,[u,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[u,/(.+)/,"$1 Secure "+T],f],[/\bfocus\/([\w\.]+)/i],[f,[u,E+" Focus"]],[/\bopt\/([\w\.]+)/i],[f,[u,M+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[f,[u,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[f,[u,"Dolphin"]],[/coast\/([\w\.]+)/i],[f,[u,M+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[f,[u,"MIUI "+T]],[/fxios\/([-\w\.]+)/i],[f,[u,E]],[/\bqihu|(qi?ho?o?|360)browser/i],[[u,"360 "+T]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[u,/(.+)/,"$1 "+T],f],[/(comodo_dragon)\/([\w\.]+)/i],[[u,/_/g," "],f],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[u,f],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[u],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[u,z],f],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[u,f],[/\bgsa\/([\w\.]+) .*safari\//i],[f,[u,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[f,[u,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[f,[u,k+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[u,k+" WebView"],f],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[f,[u,"Android "+T]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[u,f],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[f,[u,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[f,u],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[u,[f,Z,{"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[u,f],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[u,"Netscape"],f],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[f,[u,E+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[u,f],[/(cobalt)\/([\w\.]+)/i],[u,[f,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[g,"amd64"]],[/(ia32(?=;))/i],[[g,G]],[/((?:i[346]|x)86)[;\)]/i],[[g,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[g,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[g,"armhf"]],[/windows (ce|mobile); ppc;/i],[[g,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[g,/ower/,"",G]],[/(sun4\w)[;\)]/i],[[g,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[g,G]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[p,[m,j],[h,y]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[p,[m,j],[h,v]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[p,[m,C],[h,v]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[p,[m,C],[h,y]],[/(macintosh);/i],[p,[m,C]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[p,[m,A],[h,v]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[p,[m,I],[h,y]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[p,[m,I],[h,v]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[p,/_/g," "],[m,F],[h,v]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[p,/_/g," "],[m,F],[h,y]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[p,[m,"OPPO"],[h,v]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[p,[m,"Vivo"],[h,v]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[p,[m,"Realme"],[h,v]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[p,[m,O],[h,v]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[p,[m,O],[h,y]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[p,[m,"LG"],[h,y]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[p,[m,"LG"],[h,v]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[p,[m,"Lenovo"],[h,y]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[p,/_/g," "],[m,"Nokia"],[h,v]],[/(pixel c)\b/i],[p,[m,x],[h,y]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[p,[m,x],[h,v]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[p,[m,N],[h,v]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[p,"Xperia Tablet"],[m,N],[h,y]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[p,[m,"OnePlus"],[h,v]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[p,[m,R],[h,y]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[p,/(.+)/g,"Fire Phone $1"],[m,R],[h,v]],[/(playbook);[-\w\),; ]+(rim)/i],[p,m,[h,y]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[p,[m,P],[h,v]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[p,[m,D],[h,y]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[p,[m,D],[h,v]],[/(nexus 9)/i],[p,[m,"HTC"],[h,y]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[m,[p,/_/g," "],[h,v]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[p,[m,"Acer"],[h,y]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[p,[m,"Meizu"],[h,v]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[m,p,[h,v]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[m,p,[h,y]],[/(surface duo)/i],[p,[m,L],[h,y]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[p,[m,"Fairphone"],[h,v]],[/(u304aa)/i],[p,[m,"AT&T"],[h,v]],[/\bsie-(\w*)/i],[p,[m,"Siemens"],[h,v]],[/\b(rct\w+) b/i],[p,[m,"RCA"],[h,y]],[/\b(venue[\d ]{2,7}) b/i],[p,[m,"Dell"],[h,y]],[/\b(q(?:mv|ta)\w+) b/i],[p,[m,"Verizon"],[h,y]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[p,[m,"Barnes & Noble"],[h,y]],[/\b(tm\d{3}\w+) b/i],[p,[m,"NuVision"],[h,y]],[/\b(k88) b/i],[p,[m,"ZTE"],[h,y]],[/\b(nx\d{3}j) b/i],[p,[m,"ZTE"],[h,v]],[/\b(gen\d{3}) b.+49h/i],[p,[m,"Swiss"],[h,v]],[/\b(zur\d{3}) b/i],[p,[m,"Swiss"],[h,y]],[/\b((zeki)?tb.*\b) b/i],[p,[m,"Zeki"],[h,y]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[m,"Dragon Touch"],p,[h,y]],[/\b(ns-?\w{0,9}) b/i],[p,[m,"Insignia"],[h,y]],[/\b((nxa|next)-?\w{0,9}) b/i],[p,[m,"NextBook"],[h,y]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[m,"Voice"],p,[h,v]],[/\b(lvtel\-)?(v1[12]) b/i],[[m,"LvTel"],p,[h,v]],[/\b(ph-1) /i],[p,[m,"Essential"],[h,v]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[p,[m,"Envizen"],[h,y]],[/\b(trio[-\w\. ]+) b/i],[p,[m,"MachSpeed"],[h,y]],[/\btu_(1491) b/i],[p,[m,"Rotor"],[h,y]],[/(shield[\w ]+) b/i],[p,[m,"Nvidia"],[h,y]],[/(sprint) (\w+)/i],[m,p,[h,v]],[/(kin\.[onetw]{3})/i],[[p,/\./g," "],[m,L],[h,v]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[p,[m,B],[h,y]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[p,[m,B],[h,v]],[/smart-tv.+(samsung)/i],[m,[h,b]],[/hbbtv.+maple;(\d+)/i],[[p,/^/,"SmartTV"],[m,j],[h,b]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[m,"LG"],[h,b]],[/(apple) ?tv/i],[m,[p,C+" TV"],[h,b]],[/crkey/i],[[p,k+"cast"],[m,x],[h,b]],[/droid.+aft(\w)( bui|\))/i],[p,[m,R],[h,b]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[p,[m,A],[h,b]],[/(bravia[\w ]+)( bui|\))/i],[p,[m,N],[h,b]],[/(mitv-\w{5}) bui/i],[p,[m,F],[h,b]],[/Hbbtv.*(technisat) (.*);/i],[m,p,[h,b]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[m,H],[p,H],[h,b]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[h,b]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[m,p,[h,_]],[/droid.+; (shield) bui/i],[p,[m,"Nvidia"],[h,_]],[/(playstation [345portablevi]+)/i],[p,[m,N],[h,_]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[p,[m,L],[h,_]],[/((pebble))app/i],[m,p,[h,w]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[p,[m,C],[h,w]],[/droid.+; (glass) \d/i],[p,[m,x],[h,w]],[/droid.+; (wt63?0{2,3})\)/i],[p,[m,B],[h,w]],[/(quest( 2| pro)?)/i],[p,[m,z],[h,w]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[m,[h,S]],[/(aeobc)\b/i],[p,[m,R],[h,S]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[p,[h,v]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[p,[h,y]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[h,y]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[h,v]],[/(android[-\w\. ]{0,9});.+buil/i],[p,[m,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[f,[u,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[f,[u,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[u,f],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[f,u]],os:[[/microsoft (windows) (vista|xp)/i],[u,f],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[u,[f,Z,Q]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[u,"Windows"],[f,Z,Q]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/ios;fbsv\/([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[f,/_/g,"."],[u,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[u,$],[f,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[f,u],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[u,f],[/\(bb(10);/i],[f,[u,P]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[f,[u,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[f,[u,E+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[f,[u,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[f,[u,"watchOS"]],[/crkey\/([\d\.]+)/i],[f,[u,k+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[u,U],f],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[u,f],[/(sunos) ?([\w\.\d]*)/i],[[u,"Solaris"],f],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[u,f]]},J=function(e,t){if(typeof e===c&&(t=e,e=a),!(this instanceof J))return new J(e,t).getResult();var r=typeof s!==o&&s.navigator?s.navigator:a,i=e||(r&&r.userAgent?r.userAgent:""),_=r&&r.userAgentData?r.userAgentData:a,b=t?V(Y,t):Y,w=r&&r.userAgent==i;return this.getBrowser=function(){var e,t={};return t[u]=a,t[f]=a,W.call(t,i,b.browser),t[l]=typeof(e=t[f])===d?e.replace(/[^\d\.]/g,"").split(".")[0]:a,w&&r&&r.brave&&typeof r.brave.isBrave==n&&(t[u]="Brave"),t},this.getCPU=function(){var e={};return e[g]=a,W.call(e,i,b.cpu),e},this.getDevice=function(){var e={};return e[m]=a,e[p]=a,e[h]=a,W.call(e,i,b.device),w&&!e[h]&&_&&_.mobile&&(e[h]=v),w&&"Macintosh"==e[p]&&r&&typeof r.standalone!==o&&r.maxTouchPoints&&r.maxTouchPoints>2&&(e[p]="iPad",e[h]=y),e},this.getEngine=function(){var e={};return e[u]=a,e[f]=a,W.call(e,i,b.engine),e},this.getOS=function(){var e={};return e[u]=a,e[f]=a,W.call(e,i,b.os),w&&!e[u]&&_&&"Unknown"!=_.platform&&(e[u]=_.platform.replace(/chrome os/i,U).replace(/macos/i,$)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(e){return i=typeof e===d&&e.length>350?H(e,350):e,this},this.setUA(i),this};J.VERSION="1.0.35",J.BROWSER=q([u,f,l]),J.CPU=q([g]),J.DEVICE=q([p,m,h,_,v,b,y,w,S]),J.ENGINE=J.OS=q([u,f]),typeof t!==o?(e.exports&&(t=e.exports=J),t.UAParser=J):r.amdO?(i=(function(){return J}).call(t,r,t,e),a!==i&&(e.exports=i)):typeof s!==o&&(s.UAParser=J);var X=typeof s!==o&&(s.jQuery||s.Zepto);if(X&&!X.ua){var ee=new J;X.ua=ee.getResult(),X.ua.get=function(){return ee.getUA()},X.ua.set=function(e){ee.setUA(e);var t=ee.getResult();for(var r in t)X.ua[r]=t[r]}}}("object"==typeof window?window:this)},56312:function(e,t,r){"use strict";r.d(t,{F:function(){return c}});var i=r(87536),s=function(e,t,r){if(e&&"reportValidity"in e){var s=(0,i.U2)(r,t);e.setCustomValidity(s&&s.message||""),e.reportValidity()}},a=function(e,t){var r=function(r){var i=t.fields[r];i&&i.ref&&"reportValidity"in i.ref?s(i.ref,r,e):i.refs&&i.refs.forEach(function(t){return s(t,r,e)})};for(var i in t.fields)r(i)},n=function(e,t){t.shouldUseNativeValidation&&a(e,t);var r={};for(var s in e){var n=(0,i.U2)(t.fields,s);(0,i.t8)(r,s,Object.assign(e[s],{ref:n&&n.ref}))}return r},o=function(e,t){for(var r={};e.length;){var s=e[0],a=s.code,n=s.message,o=s.path.join(".");if(!r[o]){if("unionErrors"in s){var c=s.unionErrors[0].errors[0];r[o]={message:c.message,type:c.code}}else r[o]={message:n,type:a}}if("unionErrors"in s&&s.unionErrors.forEach(function(t){return t.errors.forEach(function(t){return e.push(t)})}),t){var d=r[o].types,l=d&&d[s.code];r[o]=(0,i.KN)(o,t,r,a,l?[].concat(l,s.message):s.message)}e.shift()}return r},c=function(e,t,r){return void 0===r&&(r={}),function(i,s,c){try{return Promise.resolve(function(s,n){try{var o=Promise.resolve(e["sync"===r.mode?"parse":"parseAsync"](i,t)).then(function(e){return c.shouldUseNativeValidation&&a({},c),{errors:{},values:r.rawValues?i:e}})}catch(d){return n(d)}return o&&o.then?o.then(void 0,n):o}(0,function(e){return{values:{},errors:e.isEmpty?{}:n(o(e.errors,!c.shouldUseNativeValidation&&"all"===c.criteriaMode),c)}}))}catch(d){return Promise.reject(d)}}}},94464:function(e,t,r){"use strict";let i,s;r.d(t,{m:function(){return eN}});var a,n,o={};r.r(o),r.d(o,{Decoder:function(){return eg},Encoder:function(){return em},PacketType:function(){return n},protocol:function(){return eh}});var c=r(50960);let d=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((e,t)=>((t&=63)<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),""),l=Object.create(null);l.open="0",l.close="1",l.ping="2",l.pong="3",l.message="4",l.upgrade="5",l.noop="6";let p=Object.create(null);Object.keys(l).forEach(e=>{p[l[e]]=e});let u={type:"error",data:"parser error"},h="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),m="function"==typeof ArrayBuffer,f=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,g=({type:e,data:t},r,i)=>h&&t instanceof Blob?r?i(t):_(t,i):m&&(t instanceof ArrayBuffer||f(t))?r?i(t):_(new Blob([t]),i):i(l[e]+(t||"")),_=(e,t)=>{let r=new FileReader;return r.onload=function(){let e=r.result.split(",")[1];t("b"+(e||""))},r.readAsDataURL(e)};function v(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let w=0;w<y.length;w++)b[y.charCodeAt(w)]=w;let S=e=>{let t=.75*e.length,r=e.length,i,s=0,a,n,o,c;"="===e[e.length-1]&&(t--,"="===e[e.length-2]&&t--);let d=new ArrayBuffer(t),l=new Uint8Array(d);for(i=0;i<r;i+=4)a=b[e.charCodeAt(i)],n=b[e.charCodeAt(i+1)],o=b[e.charCodeAt(i+2)],c=b[e.charCodeAt(i+3)],l[s++]=a<<2|n>>4,l[s++]=(15&n)<<4|o>>2,l[s++]=(3&o)<<6|63&c;return d},R="function"==typeof ArrayBuffer,C=(e,t)=>{if("string"!=typeof e)return{type:"message",data:P(e,t)};let r=e.charAt(0);if("b"===r)return{type:"message",data:D(e.substring(1),t)};let i=p[r];return i?e.length>1?{type:p[r],data:e.substring(1)}:{type:p[r]}:u},D=(e,t)=>{if(!R)return{base64:!0,data:e};{let r=S(e);return P(r,t)}},P=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,T=(e,t)=>{let r=e.length,i=Array(r),s=0;e.forEach((e,a)=>{g(e,!1,e=>{i[a]=e,++s===r&&t(i.join("\x1e"))})})},k=(e,t)=>{let r=e.split("\x1e"),i=[];for(let s=0;s<r.length;s++){let a=C(r[s],t);if(i.push(a),"error"===a.type)break}return i};function E(e){if(e)return function(e){for(var t in E.prototype)e[t]=E.prototype[t];return e}(e)}E.prototype.on=E.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},E.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},E.prototype.off=E.prototype.removeListener=E.prototype.removeAllListeners=E.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,i=this._callbacks["$"+e];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var s=0;s<i.length;s++)if((r=i[s])===t||r.fn===t){i.splice(s,1);break}return 0===i.length&&delete this._callbacks["$"+e],this},E.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=Array(arguments.length-1),r=this._callbacks["$"+e],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(r){r=r.slice(0);for(var i=0,s=r.length;i<s;++i)r[i].apply(this,t)}return this},E.prototype.emitReserved=E.prototype.emit,E.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},E.prototype.hasListeners=function(e){return!!this.listeners(e).length};let x="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function I(e,...t){return t.reduce((t,r)=>(e.hasOwnProperty(r)&&(t[r]=e[r]),t),{})}let L=x.setTimeout,O=x.clearTimeout;function M(e,t){t.useNativeTimers?(e.setTimeoutFn=L.bind(x),e.clearTimeoutFn=O.bind(x)):(e.setTimeoutFn=x.setTimeout.bind(x),e.clearTimeoutFn=x.clearTimeout.bind(x))}class j extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class A extends E{constructor(e){super(),this.writable=!1,M(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,r){return super.emitReserved("error",new j(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return("opening"===this.readyState||"open"===this.readyState)&&(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){let t=C(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){let e=this.opts.hostname;return -1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){let t=function(e){let t="";for(let r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t}(e);return t.length?"?"+t:""}}let N="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),F={},B=0,z=0,U;function $(e){let t="";do t=N[e%64]+t,e=Math.floor(e/64);while(e>0);return t}function V(){let e=$(+new Date);return e!==U?(B=0,U=e):e+"."+$(B++)}for(;z<64;z++)F[N[z]]=z;let q=!1;try{q="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(K){}let G=q;function H(e){let t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||G))return new XMLHttpRequest}catch(r){}if(!t)try{return new x[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(i){}}function W(){}let Z=function(){let e=new H({xdomain:!1});return null!=e.responseType}();class Q extends E{constructor(e,t){super(),M(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.data=void 0!==t.data?t.data:null,this.create()}create(){var e;let t=I(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd;let r=this.xhr=new H(t);try{r.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders)for(let i in r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(i)&&r.setRequestHeader(i,this.opts.extraHeaders[i])}catch(s){}if("POST"===this.method)try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(a){}try{r.setRequestHeader("Accept","*/*")}catch(n){}null===(e=this.opts.cookieJar)||void 0===e||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(r.timeout=this.opts.requestTimeout),r.onreadystatechange=()=>{var e;3===r.readyState&&(null===(e=this.opts.cookieJar)||void 0===e||e.parseCookies(r)),4===r.readyState&&(200===r.status||1223===r.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"==typeof r.status?r.status:0)},0))},r.send(this.data)}catch(o){this.setTimeoutFn(()=>{this.onError(o)},0);return}"undefined"!=typeof document&&(this.index=Q.requestsCount++,Q.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=W,e)try{this.xhr.abort()}catch(t){}"undefined"!=typeof document&&delete Q.requests[this.index],this.xhr=null}}onLoad(){let e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}function Y(){for(let e in Q.requests)Q.requests.hasOwnProperty(e)&&Q.requests[e].abort()}Q.requestsCount=0,Q.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",Y):"function"==typeof addEventListener&&addEventListener("onpagehide"in x?"pagehide":"unload",Y,!1));let J=(()=>{let e="function"==typeof Promise&&"function"==typeof Promise.resolve;return e?e=>Promise.resolve().then(e):(e,t)=>t(e,0)})(),X=x.WebSocket||x.MozWebSocket;r(48764).Buffer;let ee="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),et={websocket:class extends A{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;let e=this.uri(),t=this.opts.protocols,r=ee?{}:I(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=ee?new X(e,t,r):t?new X(e,t):new X(e)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let r=e[t],i=t===e.length-1;g(r,this.supportsBinary,e=>{try{this.ws.send(e)}catch(t){}i&&J(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=V()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}check(){return!!X}},webtransport:class extends A{get name(){return"webtransport"}doOpen(){"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(e=>{let t;let r=e.readable.getReader();this.writer=e.writable.getWriter();let i=()=>{r.read().then(({done:e,value:r})=>{e||(t||1!==r.byteLength||54!==r[0]?(this.onPacket(function(e,t,r){s||(s=new TextDecoder);let i=t||e[0]<48||e[0]>54;return C(i?e:s.decode(e),r)}(r,t,"arraybuffer")),t=!1):t=!0,i())}).catch(e=>{})};i();let a=this.query.sid?`0{"sid":"${this.query.sid}"}`:"0";this.writer.write(new TextEncoder().encode(a)).then(()=>this.onOpen())})}))}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let r=e[t],s=t===e.length-1;!function(e,t){h&&e.data instanceof Blob?e.data.arrayBuffer().then(v).then(t):m&&(e.data instanceof ArrayBuffer||f(e.data))?t(v(e.data)):g(e,!1,e=>{i||(i=new TextEncoder),t(i.encode(e))})}(r,e=>{"message"===r.type&&"string"!=typeof r.data&&e[0]>=48&&e[0]<=54&&this.writer.write(Uint8Array.of(54)),this.writer.write(e).then(()=>{s&&J(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})})}}doClose(){var e;null===(e=this.transport)||void 0===e||e.close()}},polling:class extends A{constructor(e){if(super(e),this.polling=!1,"undefined"!=typeof location){let t="https:"===location.protocol,r=location.port;r||(r=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||r!==e.port}let i=e&&e.forceBase64;this.supportsBinary=Z&&!i,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";let t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){let t=e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)};k(e,this.socket.binaryType).forEach(t),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){let e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,T(e,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=V()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Q(this.uri(),e)}doWrite(e,t){let r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(e,t)=>{this.onError("xhr post error",e,t)})}doPoll(){let e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(e,t)=>{this.onError("xhr poll error",e,t)}),this.pollXhr=e}}},er=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ei=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function es(e){let t=e,r=e.indexOf("["),i=e.indexOf("]");-1!=r&&-1!=i&&(e=e.substring(0,r)+e.substring(r,i).replace(/:/g,";")+e.substring(i,e.length));let s=er.exec(e||""),a={},n=14;for(;n--;)a[ei[n]]=s[n]||"";return -1!=r&&-1!=i&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=function(e,t){let r=t.replace(/\/{2,9}/g,"/").split("/");return("/"==t.slice(0,1)||0===t.length)&&r.splice(0,1),"/"==t.slice(-1)&&r.splice(r.length-1,1),r}(0,a.path),a.queryKey=function(e,t){let r={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(e,t,i){t&&(r[t]=i)}),r}(0,a.query),a}class ea extends E{constructor(e,t={}){super(),this.writeBuffer=[],e&&"object"==typeof e&&(t=e,e=null),e?(e=es(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=es(t.host).host),M(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},r=e.split("&");for(let i=0,s=r.length;i<s;i++){let a=r[i].split("=");t[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return t}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){let t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);let r=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new et[e](r)}open(){let e;if(this.opts.rememberUpgrade&&ea.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else if(0===this.transports.length){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch(t){this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",e=>this.onClose("transport close",e))}probe(e){let t=this.createTransport(e),r=!1;ea.priorWebsocketSuccess=!1;let i=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",e=>{if(!r){if("pong"===e.type&&"probe"===e.data)this.upgrading=!0,this.emitReserved("upgrading",t),t&&(ea.priorWebsocketSuccess="websocket"===t.name,this.transport.pause(()=>{r||"closed"===this.readyState||(d(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}));else{let i=Error("probe error");i.transport=t.name,this.emitReserved("upgradeError",i)}}}))};function s(){r||(r=!0,d(),t.close(),t=null)}let a=e=>{let r=Error("probe error: "+e);r.transport=t.name,s(),this.emitReserved("upgradeError",r)};function n(){a("transport closed")}function o(){a("socket closed")}function c(e){t&&e.name!==t.name&&s()}let d=()=>{t.removeListener("open",i),t.removeListener("error",a),t.removeListener("close",n),this.off("close",o),this.off("upgrading",c)};t.once("open",i),t.once("error",a),t.once("close",n),this.once("close",o),this.once("upgrading",c),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn(()=>{r||t.open()},200):t.open()}onOpen(){if(this.readyState="open",ea.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let e=0,t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":let t=Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){let e=this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1;if(!e)return this.writeBuffer;let t=1;for(let r=0;r<this.writeBuffer.length;r++){let i=this.writeBuffer[r].data;if(i&&(t+="string"==typeof i?function(e){let t=0,r=0;for(let i=0,s=e.length;i<s;i++)(t=e.charCodeAt(i))<128?r+=1:t<2048?r+=2:t<55296||t>=57344?r+=3:(i++,r+=4);return r}(i):Math.ceil(1.33*(i.byteLength||i.size))),r>0&&t>this.maxPayload)return this.writeBuffer.slice(0,r);t+=2}return this.writeBuffer}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,i){if("function"==typeof t&&(i=t,t=void 0),"function"==typeof r&&(i=r,r=null),"closing"===this.readyState||"closed"===this.readyState)return;(r=r||{}).compress=!1!==r.compress;let s={type:e,data:t,options:r};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),i&&this.once("flush",i),this.flush()}close(){let e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return("opening"===this.readyState||"open"===this.readyState)&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}onError(e){ea.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){let t=[],r=0,i=e.length;for(;r<i;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}ea.protocol=4,ea.protocol;let en="function"==typeof ArrayBuffer,eo=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,ec=Object.prototype.toString,ed="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===ec.call(Blob),el="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===ec.call(File);function ep(e){return en&&(e instanceof ArrayBuffer||eo(e))||ed&&e instanceof Blob||el&&e instanceof File}let eu=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],eh=5;(a=n||(n={}))[a.CONNECT=0]="CONNECT",a[a.DISCONNECT=1]="DISCONNECT",a[a.EVENT=2]="EVENT",a[a.ACK=3]="ACK",a[a.CONNECT_ERROR=4]="CONNECT_ERROR",a[a.BINARY_EVENT=5]="BINARY_EVENT",a[a.BINARY_ACK=6]="BINARY_ACK";class em{constructor(e){this.replacer=e}encode(e){return(e.type===n.EVENT||e.type===n.ACK)&&function e(t,r){if(!t||"object"!=typeof t)return!1;if(Array.isArray(t)){for(let i=0,s=t.length;i<s;i++)if(e(t[i]))return!0;return!1}if(ep(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1==arguments.length)return e(t.toJSON(),!0);for(let a in t)if(Object.prototype.hasOwnProperty.call(t,a)&&e(t[a]))return!0;return!1}(e)?this.encodeAsBinary({type:e.type===n.EVENT?n.BINARY_EVENT:n.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===n.BINARY_EVENT||e.type===n.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){let t=function(e){let t=[],r=e.data,i=e;return i.data=function e(t,r){if(!t)return t;if(ep(t)){let i={_placeholder:!0,num:r.length};return r.push(t),i}if(Array.isArray(t)){let s=Array(t.length);for(let a=0;a<t.length;a++)s[a]=e(t[a],r);return s}if("object"==typeof t&&!(t instanceof Date)){let n={};for(let o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=e(t[o],r));return n}return t}(r,t),i.attachments=t.length,{packet:i,buffers:t}}(e),r=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(r),i}}function ef(e){return"[object Object]"===Object.prototype.toString.call(e)}class eg extends E{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);let r=t.type===n.BINARY_EVENT;r||t.type===n.BINARY_ACK?(t.type=r?n.EVENT:n.ACK,this.reconstructor=new e_(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(ep(e)||e.base64){if(this.reconstructor)(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw Error("got binary data when not reconstructing a packet")}else throw Error("Unknown type: "+e)}decodeString(e){let t=0,r={type:Number(e.charAt(0))};if(void 0===n[r.type])throw Error("unknown packet type "+r.type);if(r.type===n.BINARY_EVENT||r.type===n.BINARY_ACK){let i=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);let s=e.substring(i,t);if(s!=Number(s)||"-"!==e.charAt(t))throw Error("Illegal attachments");r.attachments=Number(s)}if("/"===e.charAt(t+1)){let a=t+1;for(;++t;){let o=e.charAt(t);if(","===o||t===e.length)break}r.nsp=e.substring(a,t)}else r.nsp="/";let c=e.charAt(t+1);if(""!==c&&Number(c)==c){let d=t+1;for(;++t;){let l=e.charAt(t);if(null==l||Number(l)!=l){--t;break}if(t===e.length)break}r.id=Number(e.substring(d,t+1))}if(e.charAt(++t)){let p=this.tryParse(e.substr(t));if(eg.isPayloadValid(r.type,p))r.data=p;else throw Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}static isPayloadValid(e,t){switch(e){case n.CONNECT:return ef(t);case n.DISCONNECT:return void 0===t;case n.CONNECT_ERROR:return"string"==typeof t||ef(t);case n.EVENT:case n.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===eu.indexOf(t[0]));case n.ACK:case n.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class e_{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t,r;let i=(t=this.reconPack,r=this.buffers,t.data=function e(t,r){if(!t)return t;if(t&&!0===t._placeholder){let i="number"==typeof t.num&&t.num>=0&&t.num<r.length;if(i)return r[t.num];throw Error("illegal attachments")}if(Array.isArray(t))for(let s=0;s<t.length;s++)t[s]=e(t[s],r);else if("object"==typeof t)for(let a in t)Object.prototype.hasOwnProperty.call(t,a)&&(t[a]=e(t[a],r));return t}(t.data,r),delete t.attachments,t);return this.finishedReconstruction(),i}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function ev(e,t,r){return e.on(t,r),function(){e.off(t,r)}}let ey=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class eb extends E{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let e=this.io;this.subs=[ev(e,"open",this.onopen.bind(this)),ev(e,"packet",this.onpacket.bind(this)),ev(e,"error",this.onerror.bind(this)),ev(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(ey.hasOwnProperty(e))throw Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;let r={type:n.EVENT,data:t};if(r.options={},r.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){let i=this.ids++,s=t.pop();this._registerAckCallback(i,s),r.id=i}let a=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable,o=this.flags.volatile&&(!a||!this.connected);return o||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,t){var r;let i=null!==(r=this.flags.timeout)&&void 0!==r?r:this._opts.ackTimeout;if(void 0===i){this.acks[e]=t;return}let s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let r=0;r<this.sendBuffer.length;r++)this.sendBuffer[r].id===e&&this.sendBuffer.splice(r,1);t.call(this,Error("operation has timed out"))},i);this.acks[e]=(...e)=>{this.io.clearTimeoutFn(s),t.apply(this,[null,...e])}}emitWithAck(e,...t){let r=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise((i,s)=>{t.push((e,t)=>r?e?s(e):i(t):i(e)),this.emit(e,...t)})}_addToQueue(e){let t;"function"==typeof e[e.length-1]&&(t=e.pop());let r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((e,...i)=>{if(r===this._queue[0])return null!==e?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(e)):(this._queue.shift(),t&&t(null,...i)),r.pending=!1,this._drainQueue()}),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||0===this._queue.length)return;let t=this._queue[0];(!t.pending||e)&&(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:n.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){let t=e.nsp===this.nsp;if(t)switch(e.type){case n.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case n.EVENT:case n.BINARY_EVENT:this.onevent(e);break;case n.ACK:case n.BINARY_ACK:this.onack(e);break;case n.DISCONNECT:this.ondisconnect();break;case n.CONNECT_ERROR:this.destroy();let r=Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r)}}onevent(e){let t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){let t=this._anyListeners.slice();for(let r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){let t=this,r=!1;return function(...i){r||(r=!0,t.packet({type:n.ACK,id:e,data:i}))}}onack(e){let t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:n.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){let t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r]){t.splice(r,1);break}}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){let t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r]){t.splice(r,1);break}}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let t=this._anyOutgoingListeners.slice();for(let r of t)r.apply(this,e.data)}}}function ew(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}ew.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=(1&Math.floor(10*t))==0?e-r:e+r}return 0|Math.min(e,this.max)},ew.prototype.reset=function(){this.attempts=0},ew.prototype.setMin=function(e){this.ms=e},ew.prototype.setMax=function(e){this.max=e},ew.prototype.setJitter=function(e){this.jitter=e};class eS extends E{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,M(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(r=t.randomizationFactor)&&void 0!==r?r:.5),this.backoff=new ew({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;let i=t.parser||o;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new ea(this.uri,this.opts);let t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;let i=ev(t,"open",function(){r.onopen(),e&&e()}),s=t=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},a=ev(t,"error",s);if(!1!==this._timeout){let n=this._timeout,o=this.setTimeoutFn(()=>{i(),s(Error("timeout")),t.close()},n);this.opts.autoUnref&&o.unref(),this.subs.push(()=>{this.clearTimeoutFn(o)})}return this.subs.push(i),this.subs.push(a),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");let e=this.engine;this.subs.push(ev(e,"ping",this.onping.bind(this)),ev(e,"data",this.ondata.bind(this)),ev(e,"error",this.onerror.bind(this)),ev(e,"close",this.onclose.bind(this)),ev(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){J(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new eb(this,e,t),this.nsps[e]=r),r}_destroy(e){let t=Object.keys(this.nsps);for(let r of t){let i=this.nsps[r];if(i.active)return}this._close()}_packet(e){let t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let t=this.backoff.duration();this._reconnecting=!0;let r=this.setTimeoutFn(()=>{!e.skipReconnect&&(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open(t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){let e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}let eR={};function eC(e,t){let r;"object"==typeof e&&(t=e,e=void 0),t=t||{};let i=function(e,t="",r){let i=e;r=r||"undefined"!=typeof location&&location,null==e&&(e=r.protocol+"//"+r.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?r.protocol+e:r.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==r?r.protocol+"//"+e:"https://"+e),i=es(e)),!i.port&&(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";let s=-1!==i.host.indexOf(":"),a=s?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+a+":"+i.port+t,i.href=i.protocol+"://"+a+(r&&r.port===i.port?"":":"+i.port),i}(e,t.path||"/socket.io"),s=i.source,a=i.id,n=i.path,o=eR[a]&&n in eR[a].nsps,c=t.forceNew||t["force new connection"]||!1===t.multiplex||o;return c?r=new eS(s,t):(eR[a]||(eR[a]=new eS(s,t)),r=eR[a]),i.query&&!t.query&&(t.query=i.queryKey),r.socket(i.path,t)}Object.assign(eC,{Manager:eS,Socket:eb,io:eC,connect:eC});var eD=r(6154),eP=r(17187),eT=r(1604),ek=async()=>{try{let{data:{result:{data:{json:{accessToken:e}}}}}=await eD.Z.post("https://sdk-prod.iriko.huddle01.com/trpc/auth.guest");return e}catch(t){console.log({error:t})}},eE={cam:[{scaleResolutionDownBy:4,maxBitrate:3e5,rid:"r0",scalabilityMode:"S1T3",maxFramerate:15},{scaleResolutionDownBy:2,maxBitrate:6e5,rid:"r1",scalabilityMode:"S1T3",maxFramerate:30},{scaleResolutionDownBy:1,maxBitrate:9e6,rid:"r2",scalabilityMode:"S1T3",maxFramerate:30}],"share-video":[{maxBitrate:1e6,networkPriority:"high",maxFramerate:30,dtx:!0}],mic:void 0,"share-audio":void 0},ex={audio:{opusStereo:!0,opusFec:!0,opusDtx:!0},video:{videoGoogleStartBitrate:1e3}},eI=class{emitter;constructor(){this.emitter=new eP.EventEmitter}on(e,t){return this.emitter.on(e,t),this}off(e,t){return this.emitter.off(e,t),this}listenerCount(e){return this.emitter.listenerCount(e)}listeners(e){return this.emitter.listeners(e)}emit(e,...t){return this.emitter.emit(e,...t)}safeEmit(e,...t){return this.emitter.emit(e,...t)}once(e,t){return this.emitter.once(e,t),this}removeAllListeners(e){return e?this.emitter.removeAllListeners(e):this.emitter.removeAllListeners(),this}},eL=class{logging=!0;info=(...e)=>{this.logging&&console.info(...e)};warn=(...e)=>{this.logging&&console.warn(...e)};error=(...e)=>{this.logging&&console.error(...e)};disable=()=>this.logging=!1;enable=()=>this.logging=!0};eT.z.object({videoProducer:eT.z.boolean(),audioProducer:eT.z.boolean(),screenShareProducer:eT.z.boolean(),mainChatProducer:eT.z.boolean(),recordingAdmin:eT.z.boolean(),liveStreamingAdmin:eT.z.boolean(),kickUser:eT.z.boolean(),changeRole:eT.z.boolean(),changePermission:eT.z.boolean(),admitPermission:eT.z.boolean(),editName:eT.z.boolean(),editAvatar:eT.z.boolean()});var eO=class{__acl;__logger=new eL;constructor(){this.__acl={videoProducer:!1,audioProducer:!1,screenShareProducer:!1,mainChatProducer:!1,recordingAdmin:!1,liveStreamingAdmin:!1,kickUser:!1,changeRole:!1,changePermission:!1,admitPermission:!1,editName:!1,editAvatar:!1}}setACL=e=>{this.__acl=e,this.__logger.info({this__acl:this.__acl})};updateACL=e=>{this.__acl={...this.__acl,...e}};changePermissionACL=()=>this.__acl.changePermission;getAcl=()=>this.__acl},eM=class extends eI{_me={peerId:"",role:"",displayName:"",avatarUrl:""};_roomId;_socket;_isRecorder=!1;logger=new eL;_acl=new eO;_hostControls={lobbyPreview:!0,audio:!1,roomLock:!0,screenshare:!1,video:!1,chat:!1};constructor(){super()}_handleConnect(){this.emit("lobby:joined",this._roomId),this.logger.info("lobby:joined",this._roomId)}_handleDisconnect(){this.logger.warn("client disconnected")}_handleConnectError=e=>{this.emit("lobby:failed",e),this.logger.error("lobby:failed",e)}},ej=class extends eM{_videoStream;_audioStream;_device;_sendTransport;_recvTransport;_audioProducer;_videoProducer;_shareVideoProducer;_shareAudioProducer;_consumers=new Map;_createConsumersOnJoin=!0;_peers;_peersConsumers=new Map;_turn=[{username:"test-turn",urls:"turn:turn.huddle01.com:443?transport=udp",credential:"test-turn"},{username:"test-turn",urls:"turn:turn.huddle01.com:443?transport=tcp",credential:"test-turn"}];constructor(){super()}_produce=async(e,t,r="*")=>{if(!this._sendTransport){this.logger.warn("produce() | sendTransport is undefined");return}if(!(this._device&&this._device.rtpCapabilities.codecs))return;let i={cam:this._device.rtpCapabilities.codecs.find(e=>"video/h264"===e.mimeType.toLowerCase()&&"42e034"===e.parameters["profile-level-id"]),"share-video":this._device.rtpCapabilities.codecs.find(e=>"video/h264"===e.mimeType.toLowerCase()&&"42e034"===e.parameters["profile-level-id"]),mic:void 0,"share-audio":void 0},s=await this._sendTransport.produce({track:e,encodings:eE[t],codecOptions:ex[e.kind],codec:i[t],stopTracks:!1,zeroRtpOnPause:!0,disableTrackOnPause:!0,appData:{type:t,share:"share-audio"===t||"share-video"===t,targetPeerIds:r}});return s};_produceAudioStream=async(e,t="*")=>{try{if(!e){this.logger.warn("produceAudioStream() | stream is undefined");return}if(this._audioStream||(this._audioStream=e),this._audioProducer){this.logger.warn("handleCreateWebRTC() | Audio Producer already exists");return}let r=e.getAudioTracks()[0];if(!r){this.logger.warn("enableMic() | Track is undefined");return}let i=await this._produce(r,"mic",t);if(!i){this.logger.warn("enableMic() | Producer create error");return}if(!i.track){this.logger.warn("enableMic() | Producer track is undefined");return}this._audioProducer=i,this._audioProducer.on("trackended",()=>{this.logger.warn("produceAudioStream() | trackended for mic"),this._stopAudioProducer().catch(this.logger.error)}),this._audioProducer.on("transportclose",()=>{this.logger.warn("produceAudioStream() | transportclose for mic"),this._stopAudioProducer().catch(this.logger.error)}),this._audioProducer.on("@replacetrack",()=>{this.logger.warn("produceAudioStream() | @replacetrack for mic")}),this._audioProducer.on("@close",()=>{this.logger.warn("produceAudioStream() | @close for mic"),this._stopAudioProducer().catch(this.logger.error)})}catch(s){throw this.logger.error("Error enabling mic",{error:s}),Error("Error enabling mic")}};_produceVideoStream=async(e,t="*")=>{try{if(!e)return this.logger.warn("produceVideoStream() | stream is undefined"),Promise.reject();if(this._videoStream||(this._videoStream=e),this._videoProducer){this.logger.warn("handleCreateWebRTC() | Video Producer already exists");return}let r=e.getVideoTracks()[0];if(!r){this.logger.warn("produceVideoStream() | Track is undefined");return}let i=await this._produce(r,"cam",t);if(!i){this.logger.warn("produceVideoStream() | Producer create error");return}if(!i.track){this.logger.warn("produceVideoStream() | Producer track is undefined");return}this._videoProducer=i,this._videoProducer.on("trackended",()=>{this.logger.warn("enabelCam() | trackended for cam"),this._stopVideoProducer().catch(this.logger.error)}),this._videoProducer.on("transportclose",()=>{this.logger.warn("produceVideoStream() | transportclose for cam"),this._stopVideoProducer().catch(this.logger.error)}),this._videoProducer.on("@replacetrack",(e,t,r)=>{this.logger.warn("produceVideoStream() | @replacetrack for cam")}),this._videoProducer.on("@close",()=>{this.logger.warn("produceVideoStream() | @close for cam"),this._stopVideoProducer().catch(this.logger.error)})}catch(s){this.logger.error("Error enabling cam",{error:s})}};_requestStopAudioProducer=async()=>{try{if(!this._audioProducer){this.logger.error("requestStopAudioProducer() | audioProducer is undefined");return}this._socket.emit("close-producer",{peerId:this._me.peerId,producerId:this._audioProducer.appData.momoProducerId,roomId:this._roomId,appData:{type:"mic"}}),this._audioProducer.close()}catch(e){}};_stopAudioProducer=async()=>{try{if(!this._audioProducer){this.logger.warn("stopAudioProducer() | audioProducer is undefined");return}if(this._audioProducer=void 0,this.emit("room:mic-produce-stop"),!this._audioProducer.appData.momoProducerId){this.logger.warn("stopAudioProducer() | momoProducerId is undefined");return}}catch(e){this.logger.error({error:e})}};_requestStopVideoProducer=async()=>{try{if(!this._videoProducer){this.logger.warn("requestStopVideoProducer() | videoProducer is undefined");return}this._socket.emit("close-producer",{peerId:this._me.peerId,producerId:this._videoProducer.appData.momoProducerId,roomId:this._roomId,appData:{type:"cam"}}),this._videoProducer.close()}catch(e){}};_stopVideoProducer=async()=>{try{if(!this._videoProducer){this.logger.warn("stopVideoProducer() | videoProducer is undefined");return}if(this._videoProducer=void 0,this.emit("room:cam-produce-stop"),this.logger.info("room:cam-produce-stop"),!this._videoProducer.appData.momoProducerId){this.logger.warn("stopVideoProducer() | momoProducerId is undefined");return}}catch(e){}};_handleJoinSuccess=async e=>{this.logger.info("handleJoinSuccess()");try{this._device=new c.Device,await this._device.load({routerRtpCapabilities:e.routerRTPCapabilities}),this._socket.emit("create-webrtc-transport",{peerId:e.peerId,roomId:e.roomId,sctpCapabilities:this._device.sctpCapabilities});let{activeSpeakers:t,roomMetadata:{peerIds:r,peerMetaData:i,roomMetaData:{roomLocked:s,lobbyPreview:a,audioLocked:n,videoLocked:o,chatLocked:d,shareLocked:l,lobbyPeers:p}},permissions:u,role:h}=e;this._me={...this._me,peerId:e.peerId,role:h},this.emit("room:me-role-update",h),this.logger.info("acl() | setACL",u),this._acl.setACL(u),this._hostControls={roomLock:s,audio:n,video:o,chat:d,screenshare:l,lobbyPreview:a};let m={},f={};r.forEach(e=>{let t=i[e];t||this.logger.error("handleJoinSuccess() | No Peer Data Found");let r={peerId:e,role:t.role,displayName:(null==t?void 0:t.displayName)||"No Name Found",avatarUrl:(null==t?void 0:t.avatarUrl)||"/avatars/0.png",joinStatus:"joined:webrtc-creating",isHandRaised:(null==t?void 0:t.isHandRaised)||!1};this._peers.set(r.peerId,r),m={...m,[e]:r},f={...f,[e]:{mic:null,cam:null,"share-audio":null,"share-video":null}}}),this.emit("room:joined",this._peers),this.logger.info("room:joined",this._peers)}catch(g){this.logger.error({err:g})}};_handleProduceSuccess=e=>{let{peerId:t,producerId:r,roomId:i,appData:s}=e;"cam"===s.type?(this._videoProducer.appData.momoProducerId=r,this.emit("room:cam-produce-start"),this.logger.info("room:cam-produce-start")):(this._audioProducer.appData.momoProducerId=r,this.emit("room:mic-produce-start"),this.logger.info("room:mic-produce-start"))};_handleClientConsumer=async e=>{try{if(!this._recvTransport)throw Error("No Recv Transport");let t=e.appData.type,r=`${e.producerId}-${"cam"===e.appData.type||"mic"===e.appData.type?"audio-video":"screenAudio-screenVideo"}`,i=await this._recvTransport.consume({id:e.id,producerId:e.producerId,kind:e.kind,rtpParameters:e.rtpParameters,appData:{...e.appData,peerId:e.producerPeerId},streamId:r});this._consumers.set(i.id,i);let s=this._peersConsumers.get(e.producerPeerId);this._peersConsumers.set(e.producerPeerId,{...s,[e.appData.type]:i.id}),i.id,i.track,e.producerPeerId,e.producerPeerId,e.producerId,i.paused,"cam"===t&&(this.emit("room:peer-produce-start",{peerId:e.producerPeerId,mediaType:"cam",track:i.track}),this.logger.info("room:peer-produce-start",{peerId:e.producerPeerId,mediaType:"cam",track:i.track})),"mic"===t&&(this.emit("room:peer-produce-start",{peerId:e.producerPeerId,mediaType:"mic",track:i.track}),this.logger.info("room:peer-produce-start",{peerId:e.producerPeerId,mediaType:"mic",track:i.track})),this._socket.emit("resume-consumer",{consumerId:i.id,producerPeerId:e.producerPeerId,peerId:this._me.peerId,roomId:this._roomId,mediaType:t}),i.on("transportclose",()=>{this._consumers.delete(i.id),this.logger.warn("client-consumer() | Transport Close"),i.close()}),i.on("trackended",()=>{this.logger.warn("client-consumer() | Tracked Ended")}),i.on("@pause",()=>{this.logger.warn("client-consumer() | @pause")}),i.on("@resume",()=>{this.logger.warn("client-consumer() | @resume")}),i.on("@close",()=>{this.logger.warn("client-consumer() | @close"),this._consumers.delete(i.id)})}catch(a){this.logger.error("Error creating client consumer: ",{error:a,data:e})}};_handleConsumerPaused=e=>{var t;let{appData:r,producerPeerId:i}=e,s=null==(t=this._peersConsumers.get(i))?void 0:t[r.type],a=this._consumers.get(s);if(console.log("handleConsumerPaused",e,{consumer:a}),!a){console.error(`handleConsumerPaused() | No consumer data of type ${r.type} for peer ${i}`);return}a&&a.pause()};_handleConsumerResumed=e=>{var t;let{appData:r,producerPeerId:i}=e,s=null==(t=this._peersConsumers.get(i))?void 0:t[r.type],a=this._consumers.get(s);if(console.log("handleConsumerResumed",e,{consumer:a}),!a){console.error(`handleConsumerResumed() | No consumer data of type ${r.type} for peer ${i}`);return}a&&a.resume()};_handleConsumerClosed=e=>{var t;this.emit("room:peer-produce-stop",{peerId:e.producerPeerId,mediaType:e.appData.type});let{producerPeerId:r,appData:i}=e;if(!e.appData||!e.appData.type){this.logger.error("Need appData and appData.type to close consumer");return}let s=null==(t=this._peersConsumers.get(r))?void 0:t[i.type],a=this._consumers.get(s);if(console.log("_handleConsumerClosed",e,{consumer:a}),a)a.close();else{this.logger.error(`handleConsumerClosed() | No consumer data of type ${i.type} for peer ${r}`);return}};_handleCreateWebRTC=async e=>{if(!this._device){this.logger.error("Device not initialized");return}try{this._sendTransport=this._createDeviceTransport(e,"send"),this._recvTransport=this._createDeviceTransport(e,"recv"),this._videoStream&&this._produceVideoStream(this._videoStream),this._audioStream&&this._produceAudioStream(this._audioStream)}catch(t){console.debug({err:t})}this._createConsumersOnJoin&&this._socket.emit("create-consumers-for-newpeer",{peerId:e.peerId,roomId:e.roomId})};_createDeviceTransport=(e,t)=>{let r;if(void 0===this._device){this.logger.warn("createDeviceTransport() | mediasoup device is undefined");return}if("send"===t?(console.debug("createDeviceTransport() | creating send transport"),r=this._device.createSendTransport({id:e.sendTransportSDPInfo.id,iceParameters:e.sendTransportSDPInfo.iceParameters,iceCandidates:e.sendTransportSDPInfo.iceCandidates,dtlsParameters:e.sendTransportSDPInfo.dtlsParameters,sctpParameters:e.sendTransportSDPInfo.sctpParameters,iceServers:this._turn,proprietaryConstraints:{},appData:{}})):"recv"===t&&(console.debug("createDeviceTransport() | creating recv transport"),r=this._device.createRecvTransport({id:e.recvTransportSDPInfo.id,iceParameters:e.recvTransportSDPInfo.iceParameters,iceCandidates:e.recvTransportSDPInfo.iceCandidates,dtlsParameters:e.recvTransportSDPInfo.dtlsParameters,sctpParameters:e.recvTransportSDPInfo.sctpParameters,iceServers:this._turn,proprietaryConstraints:{},appData:{}})),void 0===r){this.logger.warn("createDeviceTransport() | transport is undefined , transportType is incorrect");return}return r.on("connect",({dtlsParameters:r},i,s)=>{try{this._socket.emit("connect-webrtc-transport",{dtlsParameters:r,transportType:t,peerId:e.peerId,roomId:e.roomId}),i()}catch(a){s(a)}}),r.on("produce",async({kind:t,rtpParameters:i,appData:s},a,n)=>{try{let{id:o}=this._socket.emit("transport-produce",{peerId:e.peerId,roomId:e.roomId,producerData:{kind:t,paused:!1,transportId:null==r?void 0:r.id,rtpParameters:i},appData:{type:s.type,producerPeerId:e.peerId,targetPeerIds:s.targetPeerIds}});a({id:o})}catch(c){console.debug({err:c}),n(c)}}),r.on("producedata",async({sctpStreamParameters:t,label:i,protocol:s,appData:a},n,o)=>{try{let{id:c}=this._socket.emit("transport-produce-data",{peerId:e.peerId,roomId:e.roomId,producerData:{transportId:null==r?void 0:r.id,sctpStreamParameters:{streamId:t.streamId,maxPacketLifeTime:t.maxPacketLifeTime,maxRetransmits:t.maxRetransmits,ordered:t.ordered},label:i,protocol:s,appData:a}});n({id:c})}catch(d){console.debug({error:d}),o(d)}}),r}},eA=class extends ej{constructor(){super(),this._me.peerId=`peerId-${d()}`,this._peers=new Map}async _joinLobby(e,t,r,i="user"){if(this.logger.info("joinLobby() | joining lobby"),!t)throw Error("Error: joinLobby() | No roomId passed");"recorder"===i&&(this._me.peerId=`botId-${d()}`),this._roomId=t;let s=r||await ek();if(!s)throw Error("joinLobby() | HuddleWebClient.ts | No token found");this._socket=eC(`https://sdk-prod.sushi.huddle01.com/${t}`,{reconnectionAttempts:10,auth:t=>t({peerId:this._me.peerId,token:s,projectId:e})}),this._socket.on("connect",()=>this._handleConnect()),this._socket.on("join-success",e=>this._handleJoinSuccess(e)),this._socket.on("disconnect",()=>this._handleDisconnect()),this._socket.on("connect_error",e=>{this._handleConnectError(e)}),this._socket.io.on("reconnect",e=>{this.logger.warn("reconnecting",e)}),this._socket.io.on("reconnect_attempt",e=>{console.log("reconnect_attempt",e)}),this._socket.io.on("reconnect_error",e=>{console.log("reconnect_error",e),this.logger.error({error:e})}),this._socket.io.on("reconnect_failed",()=>{console.log("reconnect_failed")}),this._socket.on("create-webrtc-success",e=>this._handleCreateWebRTC(e)),this._socket.on("transport-produce-success",e=>this._handleProduceSuccess(e)),this._socket.on("create-client-consumer",e=>this._handleClientConsumer(e)),this._socket.on("consumer-closed",e=>this._handleConsumerClosed(e)),this._socket.on("consumer-resumed",e=>this._handleConsumerResumed(e)),this._socket.on("consumer-paused",e=>this._handleConsumerPaused(e)),this._socket.on("new-peer",e=>this._handleNewPeer(e)),this._socket.on("peer-left",e=>this._handlePeerLeft(e)),this._socket.on("meeting-ended",()=>{this._close()}),this._socket.on("kicked",()=>{this._close("You've been kicked from the room")}),this._socket.on("recording-started",()=>{console.log("HuddleWebClient | recording-started"),this.emit("room:recording-started")}),this._socket.on("recording-stopped",()=>{console.log("HuddleWebClient | recording-stopped"),console.log("CLIENT_STOPPED_RECORDING"),this.emit("room:recording-stopped")}),this._socket.on("recording-data",e=>{console.log("RECORDING DATA",{data:e}),this.emit("room:recording-data",e)}),this._socket.on("livestream-started",e=>{console.log("LIVESTREAM STARTED",{data:e})}),this._socket.on("livestream-stopped",()=>{}),this._socket.on("peer-updated-displayName",this.__handlePeerUpdatedHandleName),this._socket.on("update-target-peerIds",this._handleUpdateTargetPeerIds),this._socket.on("peer-updated-avatarUrl",e=>this._handlePeerUpdatedAvatarUrl(e)),this._socket.on("send-data",e=>this.__handlePeerDataRecv(e))}async _joinRoom(e=!0){return console.info(`roomJoinRequest() | Joining room ${this._roomId}`),this._createConsumersOnJoin=e,await this._setDisplayName(this._me.displayName),new Promise((e,t)=>{this._socket.emit("join-request",r=>{r.success?e(r):(this.logger.error("roomJoinRequest() | Error joining room",r.data),this.emit("room:failed",r.data),t(r))})})}_leaveRoom(){this._close()}_endRoom(){if("host"!==this._me.role)throw Error("Not a host");this._socket.emit("endMeeting"),this._close()}_close(e){var t,r,i,s,a,n,o,c;this._socket&&(null==(r=null==(t=this._videoProducer)?void 0:t.track)||r.stop(),null==(s=null==(i=this._audioProducer)?void 0:i.track)||s.stop(),this._videoProducer=null,this._audioProducer=null,this._stopVideoProducer(),this._stopAudioProducer(),null==(a=this._recvTransport)||a.close(),null==(n=this._sendTransport)||n.close(),this._disconnectSocket(),null==(o=this._audioStream)||o.getTracks().forEach(e=>e.stop()),null==(c=this._videoStream)||c.getTracks().forEach(e=>e.stop()),this._audioStream=null,this._videoStream=null,this.logger.info("room:me-left",e),this.emit("room:me-left",e??""))}_disconnectSocket(){this._socket.disconnect()}_handlePeerLeft=({peerId:e})=>{this._peers.delete(e),console.info("_handlePeerLeft() | Peer Left",{peerId:e}),this.emit("room:peer-left",e)};_handleNewPeer=e=>{if(e.peerId===this._me.peerId)return;let t={peerId:e.peerId,displayName:e.displayName,avatarUrl:e.avatarUrl||"",joinStatus:"joined:webrtc-creating",isHandRaised:e.isHandRaised||!1,role:e.role};this.emit("room:peer-joined",t),this._peers.set(e.peerId,t),console.log(e.peerId,{newPeer:t,peers:this._peers})};_handleUpdateTargetPeerIds=e=>{let t;switch(e.mediaType){case"cam":t=this._videoProducer;break;case"mic":t=this._audioProducer}if(t&&Array.isArray(t.appData.targetPeerIds)){if("add"===e.operation)t.appData.targetPeerIds.push(e.consumingPeerId);else if("remove"===e.operation){let r=t.appData.targetPeerIds.indexOf(e.consumingPeerId);r>-1&&t.appData.targetPeerIds.splice(r,1)}}};_startRecording=async e=>{if(!e)throw Error("startRecording() | No sourceUrl provided.");if(e.includes("localhost"))throw Error("startRecording() | Recording cannot be started on localhost.");return console.log("HuddleWebClient | startRecording() | Starting recording",{sourceUrl:e}),new Promise((t,r)=>{this._socket.emit("start-recording",{sourceUrl:e},e=>{e.success?t(e):(this.logger.error("startRecording() | Error starting recording",e.error),r(e))})})};_stopRecording=async(e=!1)=>new Promise((t,r)=>{this._socket.emit("stop-recording",{ipfs:e},e=>{e.success?t(e):(this.logger.error("stopRecording() | Error in stopping recording",e.data),r(e))})});_startStreaming=async e=>{if(!e.sourceUrl)throw Error("startStreaming() | No sourceUrl provided.");if(e.sourceUrl.includes("localhost"))throw Error("startStreaming() | Streaming cannot be started on localhost.");return new Promise((t,r)=>{this._socket.emit("start-livestream",e,e=>{e.success?t(e):(this.logger.error("startStreaming() | Error in starting streaming",e.data),r(e))})})};_stopStreaming=async()=>new Promise((e,t)=>{this._socket.emit("stop-livestream",null,r=>{r.success?e(r):(this.logger.error("stopStreaming() | Error in stopping streaming",r.data),t(r))})});_setDisplayName=e=>{let t={data:{displayName:{name:e}},peerId:this._me.peerId};return new Promise((r,i)=>{this._socket.emit("peer-set-displayName",t,t=>{t.success?r(e):i(t)})})};_createSingleConsumer=e=>{e.producerPeerId!==this._me.peerId&&(console.log("createSingleConsumer() |",e),this._socket.emit("create-single-consumer",e))};_closeSingleConsumer=e=>{let t=this._peersConsumers.get(e.producerPeerId);t&&t[e.mediaType]&&(console.log("HuddleWebCLient | closeSingleConsumer() |",{consumerIdtoCLose:t[e.mediaType]}),this._socket.emit("close-consumer",{peerId:this._me.peerId,roomId:this._roomId,consumerId:t[e.mediaType],mediaType:e.mediaType,producerPeerId:e.producerPeerId}),console.log("closeSingleConsumer() | sent"))};_handlePeerUpdatedAvatarUrl=e=>{let{peerId:t,data:{avatarUrl:r}}=e;this.emit("room:peer-avatar-update",{peerId:t,avatarUrl:r})};__handlePeerUpdatedHandleName=e=>{this.emit("room:peer-name-update",e.peerId,e.data.displayName.name),this.logger.info("room:peer-name-update",e.peerId,e.data.displayName.name)};_kickPeer=async e=>{console.log("Kick Peer Invoked, ",e);let t=new Promise((t,r)=>{this._socket.emit("kick-peer",{peerId:e},e=>{e.success?t(e):r(e)})});return t};handlePeerControls=async e=>{if(!this._acl.getAcl().changePermission){this.logger.error("You do not have the required permissions");return}return await new Promise((t,r)=>{this._socket.emit("peer-controls",e,e=>{e.success?(this.logger.info("Peer Control, Request Success"),t(e)):r(e)})})};handleRoomControls=async e=>{if(!this._acl.getAcl().changePermission){this.logger.error("You do not have permission to change room settings");return}return await new Promise((t,r)=>{this._socket.emit("room-controls",e,i=>{i.success?(this.setIndividualControl(e.type,e.value),t(i)):r(i)})})};setIndividualControl=(e,t)=>{let r={audioLocked:"audio",videoLocked:"video",shareLocked:"screenshare",chatLocked:"chat",roomLocked:"roomLock"};this._hostControls[r[e]]=t};_changeAvatarUrl=e=>{if(!e)throw Error("Avatar Url is required");this.logger.info("changeAvatarUrl() | avatarUrl",e);let t={data:{avatarUrl:e},peerId:this._me.peerId};this._socket.emit("peer-set-avatarUrl",t)};_sendRawData=async e=>(this.logger.info("HuddleWebClient | sending data",e),await new Promise((t,r)=>{this._socket.emit("send-raw-data",e,i=>{i.success?(this.logger.info("HuddleWebClient | data sent successfully",e),t(i)):r(i)})}));__handlePeerDataRecv=e=>{this.logger.info("HuddleWebClient | __handlePeerDataRecv | data received",e),this.emit("room:data-received",e)}},eN=new class extends eA{_projectId;constructor(){super()}getMeId=()=>this._me.peerId;initialize=e=>{if(!e)throw Error("projectId is missing");this._projectId=e,this.emit("app:initialized"),this.logger.info("app:initialized")};joinLobby=async(e,t)=>{if(!this._projectId)throw Error("projectId is missing, please initialize the SDK first");if(!e)throw Error("roomId is missing");await this._joinLobby(this._projectId,e),this._socket.on("peer-control-success",this.handlePeerControlResponse),this._socket.on("room-control-success",this.handleRoomControlResponse),this._socket.on("role-control-success",this.handleRoleControlResponse),this._socket.on("role-change-success",this.handleRoleChangeResponse)};leaveLobby=()=>{this._disconnectSocket()};joinRoom=(e=!0)=>{if(!this._socket)throw Error("Lobby not joined yet, please join lobby first");this._joinRoom(e)};leaveRoom=()=>{this._leaveRoom()};endRoom=()=>{this._endRoom()};enumerateMicDevices=async()=>navigator.mediaDevices.enumerateDevices().then(e=>{let t=e.filter(e=>"audioinput"===e.kind);return t});fetchAudioStream=async e=>{if(this._audioStream)return console.info("Audio stream already exists, returning the same"),this._audioStream;try{return this._audioStream=await navigator.mediaDevices.getUserMedia({audio:!e||{deviceId:{ideal:e}}}),this._audioProducer&&(console.log("Replacing video track..."),this._audioProducer.replaceTrack({track:this._audioStream.getAudioTracks()[0]})),this.emit("app:mic-on",this._audioStream),this.logger.info("app:mic-on",this._audioStream),this._audioStream}catch(t){throw console.error("Audio Request Error; Reason:",t),Error("Unable to fetch audio stream")}};stopAudioStream=()=>{if(this._audioProducer&&(console.log("Audio producer found, stopping audio producer first"),this.stopProducingAudio()),this._audioStream){this._audioStream.getTracks().forEach(e=>e.stop()),this._audioStream=null,this.emit("app:mic-off"),this.logger.info("app:mic-off");return}this.logger.warn("Audio stream not found, fetch audio stream first")};produceAudio(e,t){if(!this._acl.getAcl().audioProducer)throw Error("ACL | produceAudio() | Audio producer not allowed");if(!this._socket)throw Error("Room not joined yet, please join room first");this._produceAudioStream(e,t)}stopProducingAudio=()=>{if(!this._audioProducer)throw Error("Audio producer not found, produce audio first");if(!this._socket)throw Error("Room not joined yet, please join room first");this._requestStopAudioProducer()};createMicConsumer=e=>{if(!this._socket)throw Error("Room not joined yet, please join room first");this._createSingleConsumer({mediaType:"mic",producerPeerId:e})};closeMicConsumer=e=>{if(!e)throw Error("peerId is missing");this._closeSingleConsumer({mediaType:"mic",producerPeerId:e})};enumerateCamDevices=()=>navigator.mediaDevices.enumerateDevices().then(e=>{let t=e.filter(e=>"videoinput"===e.kind);return t});fetchVideoStream=async e=>{if(this._videoStream)return console.info("Video stream already exists, returning the same"),this._videoStream;try{return this._videoStream=await navigator.mediaDevices.getUserMedia({video:!e||{deviceId:{ideal:e}}}),this._videoProducer&&(console.log("Replacing video track..."),this._videoProducer.replaceTrack({track:this._videoStream.getVideoTracks()[0]})),this.emit("app:cam-on",this._videoStream),this.logger.info("app:cam-on",this._videoStream),this._videoStream}catch(t){throw console.error("Video Request Error; Reason:",t),Error("Unable to fetch video stream")}};stopVideoStream=()=>{if(this._videoProducer&&(console.log("Video producer found, stopping video producer first"),this.stopProducingVideo()),this._videoStream){this._videoStream.getTracks().forEach(e=>e.stop()),this._videoStream=null,this.emit("app:cam-off"),this.logger.info("app:cam-off");return}this.logger.warn("Video stream not found, fetch video stream first")};produceVideo(e,t){if(!this._acl.getAcl().videoProducer)throw Error("ACL | produceVideo() | Video producer not allowed");if(!this._socket)throw Error("Room not joined yet, please join room first");this._produceVideoStream(e,t)}stopProducingVideo(){if(!this._videoProducer){console.log("Video not producing yet");return}if(!this._socket)throw Error("Room not joined yet, please join room first");this._requestStopVideoProducer()}createCamConsumer(e){if(!e)throw Error("peerId is missing");this._createSingleConsumer({mediaType:"cam",producerPeerId:e})}closeCamConsumer=e=>{if(!e)throw Error("peerId is missing");this._closeSingleConsumer({mediaType:"cam",producerPeerId:e})};getPeers=()=>{let e=Array.from(this._peers,([e,t])=>t);return console.log("thisPeers:",this._peers),e};getPeer=e=>{let t=this._peers.get(e);if(!t)throw Error("Peer not found");return t};getPeerTracks=e=>{var t,r;let i=this._peers.get(e);if(!i)throw Error(` Peer not found with peerId ${e}`);let s=this._peersConsumers.get(e);console.log({peerConsumerIds:s,_peersConsumers:this._peersConsumers,_consumers:this._consumers});let a=null==(t=this._consumers.get(s.mic))?void 0:t.track,n=null==(r=this._consumers.get(s.cam))?void 0:r.track;return{audio:a,video:n}};startRecording=async e=>{if(!e)throw Error("sourceUrl is missing");return await this._startRecording(e)};stopRecording=(e=!1)=>{this._stopRecording(e)};setDisplayName=async e=>{if(!e)throw Error("displayName is missing");await this._setDisplayName(e)};kickPeer=async e=>{if(!e)throw Error("peerId not sent");await this._kickPeer(e),this.emit("room:peer-kicked",e)};changePeerControls=async e=>{if(!this._acl.getAcl().changePermission){this.logger.error("ACL | changePeerControls() | You do not have the required permissions");return}return await new Promise((t,r)=>{this._socket.emit("peer-controls",e,e=>{e.success?(this.logger.info("Peer Control, Request Success"),t(e)):r(e)})})};sendData=(e,t)=>{console.log("HuddleClient | sending data",t);try{this._sendRawData({recvPeerIds:e,payload:t})}catch(r){throw Error(r)}};changeAvatarUrl=e=>{this._changeAvatarUrl(e)};changeRoomControls=async e=>{if(!this._acl.getAcl().changePermission){this.logger.error("ACL | changeRoomControls() | You do not have permission to change room settings");return}return await new Promise((t,r)=>{this._socket.emit("room-controls",e,i=>{i.success?(this.setIndividualControl(e.type,e.value),t(i)):r(i)})})};changePeerRole=async e=>{if(console.log("changePeerRole"),e.peerId===this._me.peerId&&"listener"===e.role&&console.log("ACL | me listener role",e),!this._acl.getAcl().changeRole&&!(e.peerId===this._me.peerId&&"listener"===e.role)){this.logger.error("ACL | changePeerRole() | You do not have permission to change peer role",e);return}return await new Promise((t,r)=>{this._socket.emit("role-controls",e,e=>{e.success?t(e):(this.logger.error("You do not have permission to change peer role"),r(e))})})};handlePeerControlResponse=async e=>{let{media:t,type:r}=e,i="locked"===r;"video"===t&&(this.stopVideoStream(),i&&this._acl.updateACL({videoProducer:!1})),"audio"===t&&(this.stopAudioStream(),i&&this._acl.updateACL({audioProducer:!1}))};handleRoomControlResponse=async e=>{if(this.setIndividualControl(e.type,e.value),this._acl.getAcl().changePermission)return;if("muteEveryone"===e.type){this.stopAudioStream(),this.logger.info("ACL | Host has Muted Everyone. You Have Been Muted.");return}let{type:t}=e;"audioLocked"===t&&(this._acl.updateACL({audioProducer:!e.value}),e.value&&(this.logger.info("ACL | Host Only Audio Enabled. You Have Been Muted."),this.stopAudioStream())),"videoLocked"===t&&(this._acl.updateACL({videoProducer:!e.value}),e.value&&(this.stopVideoStream(),this.logger.info("ACL | Host Only Video Enabled. Your Video has been Disabled.")))};handleRoleControlResponse=async e=>{this.emit("room:peer-role-update",e.peerId,e.role)};handleRoleChangeResponse=async e=>{console.log("ACL | Me Role Changed Response",e),this._me.role=e.role,this._acl.updateACL(e.acl),this.emit("room:me-role-update",e.role)}}},31930:function(e,t,r){"use strict";r.d(t,{VY:function(){return eB},fC:function(){return eN},xz:function(){return eF}});var i=r(87462),s=r(67294),a=r(36206),n=r(45623),o=r(25360),c=r(77342),d=r(75320),l=r(65936),p=r(78990),u=r(46063),h=r(27552),m=r(95420),f=r(91276),g=r(42043),_=(r(42651),r(29115)),v=r(79698);let y="rovingFocusGroup.onEntryFocus",b={bubbles:!1,cancelable:!0},w="RovingFocusGroup",[S,R,C]=(0,l.B)(w),[D,P]=(0,o.b)(w,[C]),[T,k]=D(w),E=(0,s.forwardRef)((e,t)=>(0,s.createElement)(S.Provider,{scope:e.__scopeRovingFocusGroup},(0,s.createElement)(S.Slot,{scope:e.__scopeRovingFocusGroup},(0,s.createElement)(x,(0,i.Z)({},e,{ref:t}))))),x=(0,s.forwardRef)((e,t)=>{let{__scopeRovingFocusGroup:r,orientation:o,loop:l=!1,dir:u,currentTabStopId:h,defaultCurrentTabStopId:m,onCurrentTabStopIdChange:f,onEntryFocus:g,..._}=e,w=(0,s.useRef)(null),S=(0,n.e)(t,w),C=(0,p.gm)(u),[D=null,P]=(0,c.T)({prop:h,defaultProp:m,onChange:f}),[k,E]=(0,s.useState)(!1),x=(0,v.W)(g),I=R(r),L=(0,s.useRef)(!1),[M,j]=(0,s.useState)(0);return(0,s.useEffect)(()=>{let e=w.current;if(e)return e.addEventListener(y,x),()=>e.removeEventListener(y,x)},[x]),(0,s.createElement)(T,{scope:r,orientation:o,dir:C,loop:l,currentTabStopId:D,onItemFocus:(0,s.useCallback)(e=>P(e),[P]),onItemShiftTab:(0,s.useCallback)(()=>E(!0),[]),onFocusableItemAdd:(0,s.useCallback)(()=>j(e=>e+1),[]),onFocusableItemRemove:(0,s.useCallback)(()=>j(e=>e-1),[])},(0,s.createElement)(d.WV.div,(0,i.Z)({tabIndex:k||0===M?-1:0,"data-orientation":o},_,{ref:S,style:{outline:"none",...e.style},onMouseDown:(0,a.M)(e.onMouseDown,()=>{L.current=!0}),onFocus:(0,a.M)(e.onFocus,e=>{let t=!L.current;if(e.target===e.currentTarget&&t&&!k){let r=new CustomEvent(y,b);if(e.currentTarget.dispatchEvent(r),!r.defaultPrevented){let i=I().filter(e=>e.focusable),s=i.find(e=>e.active),a=i.find(e=>e.id===D),n=[s,a,...i].filter(Boolean),o=n.map(e=>e.ref.current);O(o)}}L.current=!1}),onBlur:(0,a.M)(e.onBlur,()=>E(!1))})))}),I=(0,s.forwardRef)((e,t)=>{let{__scopeRovingFocusGroup:r,focusable:n=!0,active:o=!1,tabStopId:c,...l}=e,p=(0,f.M)(),u=c||p,h=k("RovingFocusGroupItem",r),m=h.currentTabStopId===u,g=R(r),{onFocusableItemAdd:_,onFocusableItemRemove:v}=h;return(0,s.useEffect)(()=>{if(n)return _(),()=>v()},[n,_,v]),(0,s.createElement)(S.ItemSlot,{scope:r,id:u,focusable:n,active:o},(0,s.createElement)(d.WV.span,(0,i.Z)({tabIndex:m?0:-1,"data-orientation":h.orientation},l,{ref:t,onMouseDown:(0,a.M)(e.onMouseDown,e=>{n?h.onItemFocus(u):e.preventDefault()}),onFocus:(0,a.M)(e.onFocus,()=>h.onItemFocus(u)),onKeyDown:(0,a.M)(e.onKeyDown,e=>{if("Tab"===e.key&&e.shiftKey){h.onItemShiftTab();return}if(e.target!==e.currentTarget)return;let t=function(e,t,r){var i;let s=(i=e.key,"rtl"!==r?i:"ArrowLeft"===i?"ArrowRight":"ArrowRight"===i?"ArrowLeft":i);if(!("vertical"===t&&["ArrowLeft","ArrowRight"].includes(s))&&!("horizontal"===t&&["ArrowUp","ArrowDown"].includes(s)))return L[s]}(e,h.orientation,h.dir);if(void 0!==t){e.preventDefault();let r=g().filter(e=>e.focusable),i=r.map(e=>e.ref.current);if("last"===t)i.reverse();else if("prev"===t||"next"===t){var s,a;"prev"===t&&i.reverse();let n=i.indexOf(e.currentTarget);i=h.loop?(s=i,a=n+1,s.map((e,t)=>s[(a+t)%s.length])):i.slice(n+1)}setTimeout(()=>O(i))}})})))}),L={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function O(e){let t=document.activeElement;for(let r of e)if(r===t||(r.focus(),document.activeElement!==t))return}var M=r(88426),j=r(23541),A=r(71930);let N=["Enter"," "],F=["ArrowUp","PageDown","End"],B=["ArrowDown","PageUp","Home",...F],z={ltr:[...N,"ArrowRight"],rtl:[...N,"ArrowLeft"]},U={ltr:["ArrowLeft"],rtl:["ArrowRight"]},$="Menu",[V,q,K]=(0,l.B)($),[G,H]=(0,o.b)($,[K,g.D7,P]),W=(0,g.D7)(),Z=P(),[Q,Y]=G($),[J,X]=G($),ee=e=>{let{__scopeMenu:t,open:r=!1,children:i,dir:a,onOpenChange:n,modal:o=!0}=e,c=W(t),[d,l]=(0,s.useState)(null),u=(0,s.useRef)(!1),h=(0,v.W)(n),m=(0,p.gm)(a);return(0,s.useEffect)(()=>{let e=()=>{u.current=!0,document.addEventListener("pointerdown",t,{capture:!0,once:!0}),document.addEventListener("pointermove",t,{capture:!0,once:!0})},t=()=>u.current=!1;return document.addEventListener("keydown",e,{capture:!0}),()=>{document.removeEventListener("keydown",e,{capture:!0}),document.removeEventListener("pointerdown",t,{capture:!0}),document.removeEventListener("pointermove",t,{capture:!0})}},[]),(0,s.createElement)(g.fC,c,(0,s.createElement)(Q,{scope:t,open:r,onOpenChange:h,content:d,onContentChange:l},(0,s.createElement)(J,{scope:t,onClose:(0,s.useCallback)(()=>h(!1),[h]),isUsingKeyboardRef:u,dir:m,modal:o},i)))},et=(0,s.forwardRef)((e,t)=>{let{__scopeMenu:r,...a}=e,n=W(r);return(0,s.createElement)(g.ee,(0,i.Z)({},n,a,{ref:t}))}),[er,ei]=G("MenuPortal",{forceMount:void 0}),es="MenuContent",[ea,en]=G(es),eo=(0,s.forwardRef)((e,t)=>{let r=ei(es,e.__scopeMenu),{forceMount:a=r.forceMount,...n}=e,o=Y(es,e.__scopeMenu),c=X(es,e.__scopeMenu);return(0,s.createElement)(V.Provider,{scope:e.__scopeMenu},(0,s.createElement)(_.z,{present:a||o.open},(0,s.createElement)(V.Slot,{scope:e.__scopeMenu},c.modal?(0,s.createElement)(ec,(0,i.Z)({},n,{ref:t})):(0,s.createElement)(ed,(0,i.Z)({},n,{ref:t})))))}),ec=(0,s.forwardRef)((e,t)=>{let r=Y(es,e.__scopeMenu),o=(0,s.useRef)(null),c=(0,n.e)(t,o);return(0,s.useEffect)(()=>{let e=o.current;if(e)return(0,j.Ry)(e)},[]),(0,s.createElement)(el,(0,i.Z)({},e,{ref:c,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:(0,a.M)(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)}))}),ed=(0,s.forwardRef)((e,t)=>{let r=Y(es,e.__scopeMenu);return(0,s.createElement)(el,(0,i.Z)({},e,{ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)}))}),el=(0,s.forwardRef)((e,t)=>{let{__scopeMenu:r,loop:o=!1,trapFocus:c,onOpenAutoFocus:d,onCloseAutoFocus:l,disableOutsidePointerEvents:p,onEntryFocus:f,onEscapeKeyDown:_,onPointerDownOutside:v,onFocusOutside:y,onInteractOutside:b,onDismiss:w,disableOutsideScroll:S,...R}=e,C=Y(es,r),D=X(es,r),P=W(r),T=Z(r),k=q(r),[x,I]=(0,s.useState)(null),L=(0,s.useRef)(null),O=(0,n.e)(t,L,C.onContentChange),j=(0,s.useRef)(0),N=(0,s.useRef)(""),z=(0,s.useRef)(0),U=(0,s.useRef)(null),$=(0,s.useRef)("right"),V=(0,s.useRef)(0),K=S?A.Z:s.Fragment,G=S?{as:M.g7,allowPinchZoom:!0}:void 0,H=e=>{var t,r;let i=N.current+e,s=k().filter(e=>!e.disabled),a=document.activeElement,n=null===(t=s.find(e=>e.ref.current===a))||void 0===t?void 0:t.textValue,o=s.map(e=>e.textValue),c=function(e,t,r){var i;let s=t.length>1&&Array.from(t).every(e=>e===t[0]),a=s?t[0]:t,n=r?e.indexOf(r):-1,o=(i=Math.max(n,0),e.map((t,r)=>e[(i+r)%e.length])),c=1===a.length;c&&(o=o.filter(e=>e!==r));let d=o.find(e=>e.toLowerCase().startsWith(a.toLowerCase()));return d!==r?d:void 0}(o,i,n),d=null===(r=s.find(e=>e.textValue===c))||void 0===r?void 0:r.ref.current;!function e(t){N.current=t,window.clearTimeout(j.current),""!==t&&(j.current=window.setTimeout(()=>e(""),1e3))}(i),d&&setTimeout(()=>d.focus())};(0,s.useEffect)(()=>()=>window.clearTimeout(j.current),[]),(0,h.EW)();let Q=(0,s.useCallback)(e=>{var t,r;let i=$.current===(null===(t=U.current)||void 0===t?void 0:t.side);return i&&function(e,t){if(!t)return!1;let r={x:e.clientX,y:e.clientY};return function(e,t){let{x:r,y:i}=e,s=!1;for(let a=0,n=t.length-1;a<t.length;n=a++){let o=t[a].x,c=t[a].y,d=t[n].x,l=t[n].y,p=c>i!=l>i&&r<(d-o)*(i-c)/(l-c)+o;p&&(s=!s)}return s}(r,t)}(e,null===(r=U.current)||void 0===r?void 0:r.area)},[]);return(0,s.createElement)(ea,{scope:r,searchRef:N,onItemEnter:(0,s.useCallback)(e=>{Q(e)&&e.preventDefault()},[Q]),onItemLeave:(0,s.useCallback)(e=>{var t;Q(e)||(null===(t=L.current)||void 0===t||t.focus(),I(null))},[Q]),onTriggerLeave:(0,s.useCallback)(e=>{Q(e)&&e.preventDefault()},[Q]),pointerGraceTimerRef:z,onPointerGraceIntentChange:(0,s.useCallback)(e=>{U.current=e},[])},(0,s.createElement)(K,G,(0,s.createElement)(m.M,{asChild:!0,trapped:c,onMountAutoFocus:(0,a.M)(d,e=>{var t;e.preventDefault(),null===(t=L.current)||void 0===t||t.focus()}),onUnmountAutoFocus:l},(0,s.createElement)(u.XB,{asChild:!0,disableOutsidePointerEvents:p,onEscapeKeyDown:_,onPointerDownOutside:v,onFocusOutside:y,onInteractOutside:b,onDismiss:w},(0,s.createElement)(E,(0,i.Z)({asChild:!0},T,{dir:D.dir,orientation:"vertical",loop:o,currentTabStopId:x,onCurrentTabStopIdChange:I,onEntryFocus:(0,a.M)(f,e=>{D.isUsingKeyboardRef.current||e.preventDefault()})}),(0,s.createElement)(g.VY,(0,i.Z)({role:"menu","aria-orientation":"vertical","data-state":eC(C.open),"data-radix-menu-content":"",dir:D.dir},P,R,{ref:O,style:{outline:"none",...R.style},onKeyDown:(0,a.M)(R.onKeyDown,e=>{let t=e.target,r=t.closest("[data-radix-menu-content]")===e.currentTarget,i=e.ctrlKey||e.altKey||e.metaKey,s=1===e.key.length;r&&("Tab"===e.key&&e.preventDefault(),!i&&s&&H(e.key));let a=L.current;if(e.target!==a||!B.includes(e.key))return;e.preventDefault();let n=k().filter(e=>!e.disabled),o=n.map(e=>e.ref.current);F.includes(e.key)&&o.reverse(),function(e){let t=document.activeElement;for(let r of e)if(r===t||(r.focus(),document.activeElement!==t))return}(o)}),onBlur:(0,a.M)(e.onBlur,e=>{e.currentTarget.contains(e.target)||(window.clearTimeout(j.current),N.current="")}),onPointerMove:(0,a.M)(e.onPointerMove,eT(e=>{let t=e.target,r=V.current!==e.clientX;if(e.currentTarget.contains(t)&&r){let i=e.clientX>V.current?"right":"left";$.current=i,V.current=e.clientX}}))})))))))}),ep=(0,s.forwardRef)((e,t)=>{let{__scopeMenu:r,...a}=e;return(0,s.createElement)(d.WV.div,(0,i.Z)({role:"group"},a,{ref:t}))}),eu=((e,t)=>{let{__scopeMenu:r,...a}=e;return(0,s.createElement)(d.WV.div,(0,i.Z)({},a,{ref:t}))},"MenuItem"),eh="menu.itemSelect",em=(0,s.forwardRef)((e,t)=>{let{disabled:r=!1,onSelect:o,...c}=e,l=(0,s.useRef)(null),p=X(eu,e.__scopeMenu),u=en(eu,e.__scopeMenu),h=(0,n.e)(t,l),m=(0,s.useRef)(!1),f=()=>{let e=l.current;if(!r&&e){let t=new CustomEvent(eh,{bubbles:!0,cancelable:!0});e.addEventListener(eh,e=>null==o?void 0:o(e),{once:!0}),(0,d.jH)(e,t),t.defaultPrevented?m.current=!1:p.onClose()}};return(0,s.createElement)(ef,(0,i.Z)({},c,{ref:h,disabled:r,onClick:(0,a.M)(e.onClick,f),onPointerDown:t=>{var r;null===(r=e.onPointerDown)||void 0===r||r.call(e,t),m.current=!0},onPointerUp:(0,a.M)(e.onPointerUp,e=>{var t;m.current||null===(t=e.currentTarget)||void 0===t||t.click()}),onKeyDown:(0,a.M)(e.onKeyDown,e=>{let t=""!==u.searchRef.current;!r&&(!t||" "!==e.key)&&N.includes(e.key)&&(e.currentTarget.click(),e.preventDefault())})}))}),ef=(0,s.forwardRef)((e,t)=>{let{__scopeMenu:r,disabled:o=!1,textValue:c,...l}=e,p=en(eu,r),u=Z(r),h=(0,s.useRef)(null),m=(0,n.e)(t,h),[f,g]=(0,s.useState)(!1),[_,v]=(0,s.useState)("");return(0,s.useEffect)(()=>{let e=h.current;if(e){var t;v((null!==(t=e.textContent)&&void 0!==t?t:"").trim())}},[l.children]),(0,s.createElement)(V.ItemSlot,{scope:r,disabled:o,textValue:null!=c?c:_},(0,s.createElement)(I,(0,i.Z)({asChild:!0},u,{focusable:!o}),(0,s.createElement)(d.WV.div,(0,i.Z)({role:"menuitem","data-highlighted":f?"":void 0,"aria-disabled":o||void 0,"data-disabled":o?"":void 0},l,{ref:m,onPointerMove:(0,a.M)(e.onPointerMove,eT(e=>{if(o)p.onItemLeave(e);else if(p.onItemEnter(e),!e.defaultPrevented){let t=e.currentTarget;t.focus()}})),onPointerLeave:(0,a.M)(e.onPointerLeave,eT(e=>p.onItemLeave(e))),onFocus:(0,a.M)(e.onFocus,()=>g(!0)),onBlur:(0,a.M)(e.onBlur,()=>g(!1))}))))}),[eg,e_]=((e,t)=>{let{checked:r=!1,onCheckedChange:n,...o}=e;return(0,s.createElement)(ey,{scope:e.__scopeMenu,checked:r},(0,s.createElement)(em,(0,i.Z)({role:"menuitemcheckbox","aria-checked":eD(r)?"mixed":r},o,{ref:t,"data-state":eP(r),onSelect:(0,a.M)(o.onSelect,()=>null==n?void 0:n(!!eD(r)||!r),{checkForDefaultPrevented:!1})})))},G("MenuRadioGroup",{value:void 0,onValueChange:()=>{}})),ev=((e,t)=>{let{value:r,onValueChange:a,...n}=e,o=(0,v.W)(a);return(0,s.createElement)(eg,{scope:e.__scopeMenu,value:r,onValueChange:o},(0,s.createElement)(ep,(0,i.Z)({},n,{ref:t})))},"MenuItemIndicator"),[ey,eb]=G(ev,{checked:!1}),[ew,eS]=((e,t)=>{let{__scopeMenu:r,forceMount:a,...n}=e,o=eb(ev,r);return(0,s.createElement)(_.z,{present:a||eD(o.checked)||!0===o.checked},(0,s.createElement)(d.WV.span,(0,i.Z)({},n,{ref:t,"data-state":eP(o.checked)})))},G("MenuSub")),eR="MenuSubTrigger";function eC(e){return e?"open":"closed"}function eD(e){return"indeterminate"===e}function eP(e){return eD(e)?"indeterminate":e?"checked":"unchecked"}function eT(e){return t=>"mouse"===t.pointerType?e(t):void 0}(e,t)=>{let r=Y(eR,e.__scopeMenu),o=X(eR,e.__scopeMenu),c=eS(eR,e.__scopeMenu),d=en(eR,e.__scopeMenu),l=(0,s.useRef)(null),{pointerGraceTimerRef:p,onPointerGraceIntentChange:u}=d,h={__scopeMenu:e.__scopeMenu},m=(0,s.useCallback)(()=>{l.current&&window.clearTimeout(l.current),l.current=null},[]);return(0,s.useEffect)(()=>m,[m]),(0,s.useEffect)(()=>{let e=p.current;return()=>{window.clearTimeout(e),u(null)}},[p,u]),(0,s.createElement)(et,(0,i.Z)({asChild:!0},h),(0,s.createElement)(ef,(0,i.Z)({id:c.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":c.contentId,"data-state":eC(r.open)},e,{ref:(0,n.F)(t,c.onTriggerChange),onClick:t=>{var i;null===(i=e.onClick)||void 0===i||i.call(e,t),e.disabled||t.defaultPrevented||(t.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:(0,a.M)(e.onPointerMove,eT(t=>{d.onItemEnter(t),t.defaultPrevented||e.disabled||r.open||l.current||(d.onPointerGraceIntentChange(null),l.current=window.setTimeout(()=>{r.onOpenChange(!0),m()},100))})),onPointerLeave:(0,a.M)(e.onPointerLeave,eT(e=>{var t,i;m();let s=null===(t=r.content)||void 0===t?void 0:t.getBoundingClientRect();if(s){let a=null===(i=r.content)||void 0===i?void 0:i.dataset.side,n="right"===a,o=s[n?"left":"right"],c=s[n?"right":"left"];d.onPointerGraceIntentChange({area:[{x:e.clientX+(n?-5:5),y:e.clientY},{x:o,y:s.top},{x:c,y:s.top},{x:c,y:s.bottom},{x:o,y:s.bottom}],side:a}),window.clearTimeout(p.current),p.current=window.setTimeout(()=>d.onPointerGraceIntentChange(null),300)}else{if(d.onTriggerLeave(e),e.defaultPrevented)return;d.onPointerGraceIntentChange(null)}})),onKeyDown:(0,a.M)(e.onKeyDown,t=>{let i=""!==d.searchRef.current;if(!e.disabled&&(!i||" "!==t.key)&&z[o.dir].includes(t.key)){var s;r.onOpenChange(!0),null===(s=r.content)||void 0===s||s.focus(),t.preventDefault()}})})))},(e,t)=>{let r=ei(es,e.__scopeMenu),{forceMount:o=r.forceMount,...c}=e,d=Y(es,e.__scopeMenu),l=X(es,e.__scopeMenu),p=eS("MenuSubContent",e.__scopeMenu),u=(0,s.useRef)(null),h=(0,n.e)(t,u);return(0,s.createElement)(V.Provider,{scope:e.__scopeMenu},(0,s.createElement)(_.z,{present:o||d.open},(0,s.createElement)(V.Slot,{scope:e.__scopeMenu},(0,s.createElement)(el,(0,i.Z)({id:p.contentId,"aria-labelledby":p.triggerId},c,{ref:h,align:"start",side:"rtl"===l.dir?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:e=>{var t;l.isUsingKeyboardRef.current&&(null===(t=u.current)||void 0===t||t.focus()),e.preventDefault()},onCloseAutoFocus:e=>e.preventDefault(),onFocusOutside:(0,a.M)(e.onFocusOutside,e=>{e.target!==p.trigger&&d.onOpenChange(!1)}),onEscapeKeyDown:(0,a.M)(e.onEscapeKeyDown,e=>{l.onClose(),e.preventDefault()}),onKeyDown:(0,a.M)(e.onKeyDown,e=>{let t=e.currentTarget.contains(e.target),r=U[l.dir].includes(e.key);if(t&&r){var i;d.onOpenChange(!1),null===(i=p.trigger)||void 0===i||i.focus(),e.preventDefault()}})})))))};let ek="DropdownMenu",[eE,ex]=(0,o.b)(ek,[H]),eI=H(),[eL,eO]=eE(ek),eM=e=>{let{__scopeDropdownMenu:t,children:r,dir:a,open:n,defaultOpen:o,onOpenChange:d,modal:l=!0}=e,p=eI(t),u=(0,s.useRef)(null),[h=!1,m]=(0,c.T)({prop:n,defaultProp:o,onChange:d});return(0,s.createElement)(eL,{scope:t,triggerId:(0,f.M)(),triggerRef:u,contentId:(0,f.M)(),open:h,onOpenChange:m,onOpenToggle:(0,s.useCallback)(()=>m(e=>!e),[m]),modal:l},(0,s.createElement)(ee,(0,i.Z)({},p,{open:h,onOpenChange:m,dir:a,modal:l}),r))},ej=(0,s.forwardRef)((e,t)=>{let{__scopeDropdownMenu:r,disabled:o=!1,...c}=e,l=eO("DropdownMenuTrigger",r),p=eI(r);return(0,s.createElement)(et,(0,i.Z)({asChild:!0},p),(0,s.createElement)(d.WV.button,(0,i.Z)({type:"button",id:l.triggerId,"aria-haspopup":"menu","aria-expanded":l.open,"aria-controls":l.open?l.contentId:void 0,"data-state":l.open?"open":"closed","data-disabled":o?"":void 0,disabled:o},c,{ref:(0,n.F)(t,l.triggerRef),onPointerDown:(0,a.M)(e.onPointerDown,e=>{o||0!==e.button||!1!==e.ctrlKey||(l.onOpenToggle(),l.open||e.preventDefault())}),onKeyDown:(0,a.M)(e.onKeyDown,e=>{!o&&(["Enter"," "].includes(e.key)&&l.onOpenToggle(),"ArrowDown"===e.key&&l.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(e.key)&&e.preventDefault())})})))}),eA=(0,s.forwardRef)((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,o=eO("DropdownMenuContent",r),c=eI(r),d=(0,s.useRef)(!1);return(0,s.createElement)(eo,(0,i.Z)({id:o.contentId,"aria-labelledby":o.triggerId},c,n,{ref:t,onCloseAutoFocus:(0,a.M)(e.onCloseAutoFocus,e=>{var t;d.current||null===(t=o.triggerRef.current)||void 0===t||t.focus(),d.current=!1,e.preventDefault()}),onInteractOutside:(0,a.M)(e.onInteractOutside,e=>{let t=e.detail.originalEvent,r=0===t.button&&!0===t.ctrlKey,i=2===t.button||r;(!o.modal||i)&&(d.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),eN=eM,eF=ej,eB=eA},48583:function(e,t,r){"use strict";r.d(t,{Dv:function(){return d},KO:function(){return p},b9:function(){return l}});var i=r(67294),s=r(15103);let a=(0,i.createContext)(void 0),n=e=>{let t=(0,i.useContext)(a);return(null==e?void 0:e.store)||t||(0,s.K7)()},o=e=>"function"==typeof(null==e?void 0:e.then),c=i.use||(e=>{if("pending"===e.status)throw e;if("fulfilled"===e.status)return e.value;if("rejected"===e.status)throw e.reason;throw e.status="pending",e.then(t=>{e.status="fulfilled",e.value=t},t=>{e.status="rejected",e.reason=t}),e});function d(e,t){let r=n(t),[[s,a,d],l]=(0,i.useReducer)(t=>{let i=r.get(e);return Object.is(t[0],i)&&t[1]===r&&t[2]===e?t:[i,r,e]},void 0,()=>[r.get(e),r,e]),p=s;(a!==r||d!==e)&&(l(),p=r.get(e));let u=null==t?void 0:t.delay;return(0,i.useEffect)(()=>{let t=r.sub(e,()=>{if("number"==typeof u){setTimeout(l,u);return}l()});return l(),t},[r,e,u]),(0,i.useDebugValue)(p),o(p)?c(p):p}function l(e,t){let r=n(t),s=(0,i.useCallback)((...t)=>{if(!("write"in e))throw Error("not writable atom");return r.set(e,...t)},[r,e]);return s}function p(e,t){return[d(e,t),l(e,t)]}},15103:function(e,t,r){"use strict";let i;r.d(t,{K7:function(){return b},cn:function(){return a}});let s=0;function a(e,t){let r=`atom${++s}`,i={toString:()=>r};return"function"==typeof e?i.read=e:(i.init=e,i.read=e=>e(i),i.write=(e,t,r)=>t(i,"function"==typeof r?r(e(i)):r)),t&&(i.write=t),i}let n=e=>"init"in e,o=e=>!!e.write,c=new WeakMap,d=(e,t)=>{c.set(e,t),e.catch(()=>{}).finally(()=>c.delete(e))},l=(e,t)=>{let r=c.get(e);r&&(c.delete(e),r(t))},p=(e,t)=>{e.status="fulfilled",e.value=t},u=(e,t)=>{e.status="rejected",e.reason=t},h=e=>"function"==typeof(null==e?void 0:e.then),m=(e,t)=>"v"in e&&"v"in t&&Object.is(e.v,t.v),f=(e,t)=>"e"in e&&"e"in t&&Object.is(e.e,t.e),g=e=>"v"in e&&e.v instanceof Promise,_=(e,t)=>"v"in e&&"v"in t&&e.v.orig&&e.v.orig===t.v.orig,v=e=>{if("e"in e)throw e.e;return e.v},y=()=>{let e,t,r;let i=new WeakMap,s=new WeakMap,a=new Map;e=new Set,t=new Set,r=new Set;let c=e=>i.get(e),y=(e,t)=>{Object.freeze(t);let r=i.get(e);if(i.set(e,t),a.has(e)||a.set(e,r),r&&g(r)){let s="v"in t?t.v instanceof Promise?t.v:Promise.resolve(t.v):Promise.reject(t.e);l(r.v,s)}},b=(e,t,r)=>{let i=new Map,s=!1;r.forEach((r,a)=>{r||a!==e||(r=t),r?(i.set(a,r),t.d.get(a)!==r&&(s=!0)):console.warn("[Bug] atom state not found")}),(s||t.d.size!==i.size)&&(t.d=i)},w=(e,t,r)=>{let i=c(e),s={d:(null==i?void 0:i.d)||new Map,v:t};if(r&&b(e,s,r),i&&m(i,s)&&i.d===s.d)return i;if(i&&g(i)&&g(s)&&_(i,s)){if(i.d===s.d)return i;s.v=i.v}return y(e,s),s},S=(e,t,r,i)=>{if(h(t)){let s;let a=new Promise((i,n)=>{let o=!1;t.then(t=>{if(!o){o=!0;let s=c(e),n=w(e,a,r);p(a,t),i(t),(null==s?void 0:s.d)!==n.d&&M(e,n,null==s?void 0:s.d)}},t=>{if(!o){o=!0;let i=c(e),s=w(e,a,r);u(a,t),n(t),(null==i?void 0:i.d)!==s.d&&M(e,s,null==i?void 0:i.d)}}),s=e=>{o||(o=!0,e.then(e=>p(a,e),e=>u(a,e)),i(e))}});return a.orig=t,a.status="pending",d(a,e=>{e&&s(e),null==i||i()}),w(e,a,r)}return w(e,t,r)},R=(e,t,r)=>{let i=c(e),s={d:(null==i?void 0:i.d)||new Map,e:t};return(r&&b(e,s,r),i&&f(i,s)&&i.d===s.d)?i:(y(e,s),s)},C=e=>{let t,r;let i=c(e);if(i&&(i.d.forEach((t,r)=>{r===e||s.has(r)||C(r)}),Array.from(i.d).every(([t,r])=>{let i=c(t);return t===e||i===r||i&&!g(i)&&m(i,r)})))return i;let a=new Map,d=!0,l=t=>{if(t===e){let r=c(t);if(r)return a.set(t,r),v(r);if(n(t))return a.set(t,void 0),t.init;throw Error("no atom init")}let i=C(t);return a.set(t,i),v(i)},p={get signal(){return t||(t=new AbortController),t.signal},get setSelf(){return o(e)||console.warn("setSelf function cannot be used with read-only atom"),!r&&o(e)&&(r=(...t)=>{if(d&&console.warn("setSelf function cannot be called in sync"),!d)return I(e,...t)}),r}};try{let u=e.read(l,p);return S(e,u,a,()=>null==t?void 0:t.abort())}catch(h){return R(e,h,a)}finally{d=!1}},D=e=>v(C(e)),P=e=>{let t=s.get(e);return t||(t=L(e)),t},T=(e,t)=>!t.l.size&&(!t.t.size||1===t.t.size&&t.t.has(e)),k=e=>{let t=s.get(e);t&&T(e,t)&&O(e)},E=e=>{let t=new Map,r=new WeakMap,i=e=>{let a=s.get(e);null==a||a.t.forEach(s=>{s!==e&&(t.set(s,(t.get(s)||new Set).add(e)),r.set(s,(r.get(s)||0)+1),i(s))})};i(e);let a=e=>{let i=s.get(e);null==i||i.t.forEach(i=>{var s;if(i!==e){let n=r.get(i);if(n&&r.set(i,--n),!n){let o=!!(null==(s=t.get(i))?void 0:s.size);if(o){let d=c(i),l=C(i);o=!d||!m(d,l)}o||t.forEach(e=>e.delete(i))}a(i)}})};a(e)},x=(e,...r)=>{let i=!0,s=e=>v(C(e)),a=(r,...s)=>{let a;if(r===e){if(!n(r))throw Error("atom not writable");let o=c(r),d=S(r,s[0]);o&&m(o,d)||E(r)}else a=x(r,...s);if(!i){let l=j();t.forEach(e=>e({type:"async-write",flushed:l}))}return a},o=e.write(s,a,...r);return i=!1,o},I=(e,...r)=>{let i=x(e,...r),s=j();return t.forEach(e=>e({type:"write",flushed:s})),i},L=(e,t)=>{let i={t:new Set(t&&[t]),l:new Set};if(s.set(e,i),r.add(e),C(e).d.forEach((t,r)=>{let i=s.get(r);i?i.t.add(e):r!==e&&L(r,e)}),C(e),o(e)&&e.onMount){let a=e.onMount((...t)=>I(e,...t));a&&(i.u=a)}return i},O=e=>{var t;let i=null==(t=s.get(e))?void 0:t.u;i&&i(),s.delete(e),r.delete(e);let a=c(e);a?(g(a)&&l(a.v),a.d.forEach((t,r)=>{if(r!==e){let i=s.get(r);i&&(i.t.delete(e),T(r,i)&&O(r))}})):console.warn("[Bug] could not find atom state to unmount",e)},M=(e,t,r)=>{let i=new Set(t.d.keys());null==r||r.forEach((t,r)=>{if(i.has(r)){i.delete(r);return}let a=s.get(r);a&&(a.t.delete(e),T(r,a)&&O(r))}),i.forEach(t=>{let r=s.get(t);r?r.t.add(e):s.has(e)&&L(t,e)})},j=()=>{let t;for(t=new Set;a.size;){let r=Array.from(a);a.clear(),r.forEach(([e,r])=>{let i=c(e);if(i){i.d!==(null==r?void 0:r.d)&&M(e,i,null==r?void 0:r.d);let a=s.get(e);a&&!(r&&!g(r)&&(m(r,i)||f(r,i)))&&(a.l.forEach(e=>e()),t.add(e))}else console.warn("[Bug] no atom state to flush")})}return e.forEach(e=>e("state")),t},A=(r,i)=>{let s=P(r),a=j(),n=s.l;return n.add(i),e.forEach(e=>e("sub")),t.forEach(e=>e({type:"sub",flushed:a})),()=>{n.delete(i),k(r),e.forEach(e=>e("unsub")),t.forEach(e=>e({type:"unsub"}))}};return{get:D,set:I,sub:A,dev_subscribe_store:(r,i)=>2!==i?(console.warn("The current StoreListener revision is 2. The older ones are deprecated."),e.add(r),()=>{e.delete(r)}):(t.add(r),()=>{t.delete(r)}),dev_get_mounted_atoms:()=>r.values(),dev_get_atom_state:e=>i.get(e),dev_get_mounted:e=>s.get(e),dev_restore_atoms:e=>{for(let[r,i]of e)n(r)&&(S(r,i),E(r));let s=j();t.forEach(e=>e({type:"restore",flushed:s}))}}},b=()=>(i||(i=y()),i)}}]);